public void testShort(){ShortNode n=ShortNode.valueOf((short)1);assertStandardEquals(n);assertTrue(0 != n.hashCode());assertEquals(JsonToken.VALUE_NUMBER_INT,n.asToken());assertEquals(JsonParser.NumberType.INT,n.numberType());assertEquals(1,n.intValue());assertEquals(1L,n.longValue());assertEquals(BigDecimal.ONE,n.decimalValue());assertEquals(BigInteger.ONE,n.bigIntegerValue());assertEquals("1",n.asText());assertNodeNumbers(n,1,1.0);assertTrue(ShortNode.valueOf((short)0).canConvertToInt());assertTrue(ShortNode.valueOf(Short.MAX_VALUE).canConvertToInt());assertTrue(ShortNode.valueOf(Short.MIN_VALUE).canConvertToInt());assertTrue(ShortNode.valueOf((short)0).canConvertToLong());assertTrue(ShortNode.valueOf(Short.MAX_VALUE).canConvertToLong());assertTrue(ShortNode.valueOf(Short.MIN_VALUE).canConvertToLong());}
public void testInt(){IntNode n=IntNode.valueOf(1);assertStandardEquals(n);assertTrue(0 != n.hashCode());assertEquals(JsonToken.VALUE_NUMBER_INT,n.asToken());assertEquals(JsonParser.NumberType.INT,n.numberType());assertEquals(1,n.intValue());assertEquals(1L,n.longValue());assertEquals(BigDecimal.ONE,n.decimalValue());assertEquals(BigInteger.ONE,n.bigIntegerValue());assertEquals("1",n.asText());assertNodeNumbers(n,1,1.0);assertTrue(IntNode.valueOf(0).canConvertToInt());assertTrue(IntNode.valueOf(Integer.MAX_VALUE).canConvertToInt());assertTrue(IntNode.valueOf(Integer.MIN_VALUE).canConvertToInt());assertTrue(IntNode.valueOf(0).canConvertToLong());assertTrue(IntNode.valueOf(Integer.MAX_VALUE).canConvertToLong());assertTrue(IntNode.valueOf(Integer.MIN_VALUE).canConvertToLong());}
public void testLong(){LongNode n=LongNode.valueOf(1L);assertStandardEquals(n);assertTrue(0 != n.hashCode());assertEquals(JsonToken.VALUE_NUMBER_INT,n.asToken());assertEquals(JsonParser.NumberType.LONG,n.numberType());assertEquals(1,n.intValue());assertEquals(1L,n.longValue());assertEquals(BigDecimal.ONE,n.decimalValue());assertEquals(BigInteger.ONE,n.bigIntegerValue());assertEquals("1",n.asText());assertNodeNumbers(n,1,1.0);assertTrue(LongNode.valueOf(0).canConvertToInt());assertTrue(LongNode.valueOf(Integer.MAX_VALUE).canConvertToInt());assertTrue(LongNode.valueOf(Integer.MIN_VALUE).canConvertToInt());assertFalse(LongNode.valueOf(1L + Integer.MAX_VALUE).canConvertToInt());assertFalse(LongNode.valueOf(-1L + Integer.MIN_VALUE).canConvertToInt());assertTrue(LongNode.valueOf(0L).canConvertToLong());assertTrue(LongNode.valueOf(Long.MAX_VALUE).canConvertToLong());assertTrue(LongNode.valueOf(Long.MIN_VALUE).canConvertToLong());}
public void testDouble(){DoubleNode n=DoubleNode.valueOf(0.25);assertStandardEquals(n);assertTrue(0 != n.hashCode());assertEquals(JsonToken.VALUE_NUMBER_FLOAT,n.asToken());assertEquals(JsonParser.NumberType.DOUBLE,n.numberType());assertEquals(0,n.intValue());assertEquals(0.25,n.doubleValue());assertNotNull(n.decimalValue());assertEquals(BigInteger.ZERO,n.bigIntegerValue());assertEquals("0.25",n.asText());assertNodeNumbers(DoubleNode.valueOf(4.5),4,4.5);assertTrue(DoubleNode.valueOf(0).canConvertToInt());assertTrue(DoubleNode.valueOf(Integer.MAX_VALUE).canConvertToInt());assertTrue(DoubleNode.valueOf(Integer.MIN_VALUE).canConvertToInt());assertFalse(DoubleNode.valueOf(1L + Integer.MAX_VALUE).canConvertToInt());assertFalse(DoubleNode.valueOf(-1L + Integer.MIN_VALUE).canConvertToInt());assertTrue(DoubleNode.valueOf(0L).canConvertToLong());assertTrue(DoubleNode.valueOf(Long.MAX_VALUE).canConvertToLong());assertTrue(DoubleNode.valueOf(Long.MIN_VALUE).canConvertToLong());}
public void testFloat(){FloatNode n=FloatNode.valueOf(0.25f);assertStandardEquals(n);assertTrue(0 != n.hashCode());assertEquals(JsonToken.VALUE_NUMBER_FLOAT,n.asToken());assertEquals(JsonParser.NumberType.FLOAT,n.numberType());assertEquals(0,n.intValue());assertEquals(0.25,n.doubleValue());assertEquals(0.25f,n.floatValue());assertNotNull(n.decimalValue());assertEquals(BigInteger.ZERO,n.bigIntegerValue());assertEquals("0.25",n.asText());assertNodeNumbers(FloatNode.valueOf(4.5f),4,4.5f);assertTrue(FloatNode.valueOf(0).canConvertToInt());assertTrue(FloatNode.valueOf(Integer.MAX_VALUE).canConvertToInt());assertTrue(FloatNode.valueOf(Integer.MIN_VALUE).canConvertToInt());assertFalse(FloatNode.valueOf(1000L + Integer.MAX_VALUE).canConvertToInt());assertFalse(FloatNode.valueOf(-1000L + Integer.MIN_VALUE).canConvertToInt());assertTrue(FloatNode.valueOf(0L).canConvertToLong());assertTrue(FloatNode.valueOf(Integer.MAX_VALUE).canConvertToLong());assertTrue(FloatNode.valueOf(Integer.MIN_VALUE).canConvertToLong());}
public void testDecimalNode()throws Exception {DecimalNode n=DecimalNode.valueOf(BigDecimal.ONE);assertStandardEquals(n);assertTrue(n.equals(new DecimalNode(BigDecimal.ONE)));assertEquals(JsonToken.VALUE_NUMBER_FLOAT,n.asToken());assertEquals(JsonParser.NumberType.BIG_DECIMAL,n.numberType());assertTrue(n.isNumber());assertFalse(n.isIntegralNumber());assertTrue(n.isBigDecimal());assertEquals(BigDecimal.ONE,n.numberValue());assertEquals(1,n.intValue());assertEquals(1L,n.longValue());assertEquals(BigDecimal.ONE,n.decimalValue());assertEquals("1",n.asText());assertNodeNumbers(n,1,1.0);assertTrue(DecimalNode.valueOf(BigDecimal.ZERO).canConvertToInt());assertTrue(DecimalNode.valueOf(BigDecimal.valueOf(Integer.MAX_VALUE)).canConvertToInt());assertTrue(DecimalNode.valueOf(BigDecimal.valueOf(Integer.MIN_VALUE)).canConvertToInt());assertFalse(DecimalNode.valueOf(BigDecimal.valueOf(1L + Integer.MAX_VALUE)).canConvertToInt());assertFalse(DecimalNode.valueOf(BigDecimal.valueOf(-1L + Integer.MIN_VALUE)).canConvertToInt());assertTrue(DecimalNode.valueOf(BigDecimal.ZERO).canConvertToLong());assertTrue(DecimalNode.valueOf(BigDecimal.valueOf(Long.MAX_VALUE)).canConvertToLong());assertTrue(DecimalNode.valueOf(BigDecimal.valueOf(Long.MIN_VALUE)).canConvertToLong());}
public void testBigIntegerNode()throws Exception {BigIntegerNode n=BigIntegerNode.valueOf(BigInteger.ONE);assertStandardEquals(n);assertTrue(n.equals(new BigIntegerNode(BigInteger.ONE)));assertEquals(JsonToken.VALUE_NUMBER_INT,n.asToken());assertEquals(JsonParser.NumberType.BIG_INTEGER,n.numberType());assertTrue(n.isNumber());assertTrue(n.isIntegralNumber());assertTrue(n.isBigInteger());assertEquals(BigInteger.ONE,n.numberValue());assertEquals(1,n.intValue());assertEquals(1L,n.longValue());assertEquals(BigInteger.ONE,n.bigIntegerValue());assertEquals("1",n.asText());assertNodeNumbers(n,1,1.0);BigInteger maxLong=BigInteger.valueOf(Long.MAX_VALUE);n=BigIntegerNode.valueOf(maxLong);assertEquals(Long.MAX_VALUE,n.longValue());ObjectMapper mapper=new ObjectMapper();JsonNode n2=mapper.readTree(maxLong.toString());assertEquals(Long.MAX_VALUE,n2.longValue());BigInteger beyondLong=maxLong.shiftLeft(2);n2=mapper.readTree(beyondLong.toString());assertEquals(beyondLong,n2.bigIntegerValue());assertTrue(BigIntegerNode.valueOf(BigInteger.ZERO).canConvertToInt());assertTrue(BigIntegerNode.valueOf(BigInteger.valueOf(Integer.MAX_VALUE)).canConvertToInt());assertTrue(BigIntegerNode.valueOf(BigInteger.valueOf(Integer.MIN_VALUE)).canConvertToInt());assertFalse(BigIntegerNode.valueOf(BigInteger.valueOf(1L + Integer.MAX_VALUE)).canConvertToInt());assertFalse(BigIntegerNode.valueOf(BigInteger.valueOf(-1L + Integer.MIN_VALUE)).canConvertToInt());assertTrue(BigIntegerNode.valueOf(BigInteger.ZERO).canConvertToLong());assertTrue(BigIntegerNode.valueOf(BigInteger.valueOf(Long.MAX_VALUE)).canConvertToLong());assertTrue(BigIntegerNode.valueOf(BigInteger.valueOf(Long.MIN_VALUE)).canConvertToLong());}
public void testText(){assertNull(TextNode.valueOf(null));TextNode empty=TextNode.valueOf("");assertStandardEquals(empty);assertSame(TextNode.EMPTY_STRING_NODE,empty);assertNodeNumbers(TextNode.valueOf("-3"),-3,-3.0);assertNodeNumbers(TextNode.valueOf("17.75"),17,17.75);long value=127353264013893L;TextNode n=TextNode.valueOf(String.valueOf(value));assertEquals(value,n.asLong());assertNodeNumbersForNonNumeric(TextNode.valueOf("foobar"));}
public void testBoolean(){BooleanNode f=BooleanNode.getFalse();assertNotNull(f);assertTrue(f.isBoolean());assertSame(f,BooleanNode.valueOf(false));assertStandardEquals(f);assertFalse(f.booleanValue());assertFalse(f.asBoolean());assertEquals("false",f.asText());assertEquals(JsonToken.VALUE_FALSE,f.asToken());BooleanNode t=BooleanNode.getTrue();assertNotNull(t);assertTrue(t.isBoolean());assertSame(t,BooleanNode.valueOf(true));assertStandardEquals(t);assertTrue(t.booleanValue());assertTrue(t.asBoolean());assertEquals("true",t.asText());assertEquals(JsonToken.VALUE_TRUE,t.asToken());assertNodeNumbers(f,0,0.0);assertNodeNumbers(t,1,1.0);}
public void testBinary()throws Exception {assertNull(BinaryNode.valueOf(null));assertNull(BinaryNode.valueOf(null,0,0));BinaryNode empty=BinaryNode.valueOf(new byte[1],0,0);assertSame(BinaryNode.EMPTY_BINARY_NODE,empty);assertStandardEquals(empty);byte[]data=new byte[3];data[1]=(byte)3;BinaryNode n=BinaryNode.valueOf(data,1,1);data[2]=(byte)3;BinaryNode n2=BinaryNode.valueOf(data,2,1);assertTrue(n.equals(n2));assertEquals("\"Aw==\"",n.toString());assertEquals("AAMD",new BinaryNode(data).asText());assertNodeNumbersForNonNumeric(n);}
public void testPOJO(){POJONode n=new POJONode("x");assertStandardEquals(n);assertEquals(n,new POJONode("x"));assertEquals("x",n.asText());assertEquals("x",n.toString());assertEquals(new POJONode(null),new POJONode(null));assertNodeNumbersForNonNumeric(n);assertNodeNumbers(new POJONode(Integer.valueOf(123)),123,123.0);}
public void testSimple()throws Exception {IPlanet input=getProxy(IPlanet.class,new Planet("Foo"));String json=MAPPER.writeValueAsString(input);assertEquals("{\"name\":\"Foo\"}",json);Planet output=MAPPER.readValue(json,Planet.class);assertEquals("Foo",output.getName());}
@SuppressWarnings("unused")public void testSerializeAsExternalizable()throws Exception {ByteArrayOutputStream bytes=new ByteArrayOutputStream();ObjectOutputStream obs=new ObjectOutputStream(bytes);final MyPojo input=new MyPojo(13,"Foobar",new int[]{1,2,3});obs.writeObject(input);obs.close();byte[]ser=bytes.toByteArray();byte[]json=MapperHolder.mapper().writeValueAsBytes(input);int ix=indexOf(ser,json);if (ix < 0){fail("Serialization (" + ser.length + ")does NOT contain JSON (of "+ json.length+ ")");}if (false){bytes=new ByteArrayOutputStream();obs=new ObjectOutputStream(bytes);MyPojoNative p=new MyPojoNative(13,"Foobar",new int[]{1,2,3});obs.writeObject(p);obs.close();System.out.println("Native size: " + bytes.size()+ ",vs JSON: "+ ser.length);}ObjectInputStream ins=new ObjectInputStream(new ByteArrayInputStream(ser));MyPojo output=(MyPojo)ins.readObject();ins.close();assertNotNull(output);assertEquals(input,output);}
/** * Basic test for ensuring that we can get "xxx-like" types recognized.*/public void testLikeTypeConstruction()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.setTypeFactory(mapper.getTypeFactory().withModifier(new MyTypeModifier()));JavaType type=mapper.constructType(MyMapLikeType.class);assertTrue(type.isMapLikeType());JavaType param=((MapLikeType)type).getKeyType();assertNotNull(param);assertSame(String.class,param.getRawClass());param=((MapLikeType)type).getContentType();assertNotNull(param);assertSame(Integer.class,param.getRawClass());type=mapper.constructType(MyCollectionLikeType.class);assertTrue(type.isCollectionLikeType());param=((CollectionLikeType)type).getContentType();assertNotNull(param);assertSame(Integer.class,param.getRawClass());}
public void testCollectionLikeSerialization()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.setTypeFactory(mapper.getTypeFactory().withModifier(new MyTypeModifier()));mapper.registerModule(new ModifierModule());assertEquals("[19]",mapper.writeValueAsString(new MyCollectionLikeType(19)));}
public void testMapLikeSerialization()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.setTypeFactory(mapper.getTypeFactory().withModifier(new MyTypeModifier()));mapper.registerModule(new ModifierModule());assertEquals("{\"x\":\"xxx:3\"}",mapper.writeValueAsString(new MyMapLikeType("x",3)));}
public void testCollectionLikeDeserialization()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.setTypeFactory(mapper.getTypeFactory().withModifier(new MyTypeModifier()));mapper.registerModule(new ModifierModule());MyMapLikeType result=mapper.readValue("{\"a\":13}",MyMapLikeType.class);assertEquals("a",result.getKey());assertEquals(Integer.valueOf(13),result.getValue());}
public void testMapLikeDeserialization()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.setTypeFactory(mapper.getTypeFactory().withModifier(new MyTypeModifier()));mapper.registerModule(new ModifierModule());MyCollectionLikeType result=mapper.readValue("[-37]",MyCollectionLikeType.class);assertEquals(Integer.valueOf(-37),result.getValue());}
public void testIssue265()throws Exception {Dog dog=new Dog("medor");dog.setBoneCount(3);Container1 c1=new Container1();c1.setAnimal(dog);String s1=mapper.writeValueAsString(c1);Assert.assertTrue("polymorphic type info is kept (1)",s1.indexOf("\"object-type\":\"doggy\"")>= 0);Container2<Animal> c2=new Container2<Animal>();c2.setAnimal(dog);String s2=mapper.writeValueAsString(c2);Assert.assertTrue("polymorphic type info is kept (2)",s2.indexOf("\"object-type\":\"doggy\"")>= 0);}
public void testIssue329()throws Exception {ArrayList<Animal> animals=new ArrayList<Animal>();animals.add(new Dog("Spot"));JavaType rootType=TypeFactory.defaultInstance().constructParametricType(Iterator.class,Animal.class);String json=mapper.writerWithType(rootType).writeValueAsString(animals.iterator());if (json.indexOf("\"object-type\":\"doggy\"")< 0){fail("No polymorphic type retained,should be;JSON = '" + json + "'");}}
public void testIssue508()throws Exception {List<List<Issue508A>> l=new ArrayList<List<Issue508A>>();List<Issue508A> l2=new ArrayList<Issue508A>();l2.add(new Issue508A());l.add(l2);TypeReference<?> typeRef=new TypeReference<List<List<Issue508A>>>(){};String json=mapper.writerWithType(typeRef).writeValueAsString(l);List<?> output=mapper.readValue(json,typeRef);assertEquals(1,output.size());Object ob=output.get(0);assertTrue(ob instanceof List<?>);List<?> list2=(List<?>)ob;assertEquals(1,list2.size());ob=list2.get(0);assertSame(Issue508A.class,ob.getClass());}
public void testSimpleScalars()throws Exception {ObjectMapper m=new ObjectMapper();assertEquals("callback(\"abc\")",serializeAsString(m,new JSONPObject("callback","abc")));assertEquals("calc(123)",serializeAsString(m,new JSONPObject("calc",Integer.valueOf(123))));assertEquals("dummy(null)",serializeAsString(m,new JSONPObject("dummy",null)));}
public void testSimpleBean()throws Exception {ObjectMapper m=new ObjectMapper();assertEquals("xxx({\"a\":\"123\",\"b\":\"456\"})",serializeAsString(m,new JSONPObject("xxx",new Impl("123","456"))));}
/** * Test to ensure that it is possible to force a static type for wrapped value.*/public void testWithType()throws Exception {ObjectMapper m=new ObjectMapper();Object ob=new Impl("abc","def");JavaType type=TypeFactory.defaultInstance().uncheckedSimpleType(Base.class);assertEquals("do({\"a\":\"abc\"})",serializeAsString(m,new JSONPObject("do",ob,type)));}
@SuppressWarnings("unchecked")public void testSimpleValueDefinition()throws Exception {ObjectMapper m=new ObjectMapper();Map<String,Object> result=writeAndMap(m,new WrapperClassForAs());assertEquals(1,result.size());Object ob=result.get("value");result=(Map<String,Object>)ob;assertEquals(1,result.size());assertEquals(Integer.valueOf(3),result.get("x"));}
public void testBrokenAnnotation()throws Exception {ObjectMapper m=new ObjectMapper();try {serializeAsString(m,new BrokenClass());}catch(Exception e){verifyException(e,"not a super-type of");}}
@SuppressWarnings("unchecked")public void testStaticTypingForClass()throws Exception {ObjectMapper m=new ObjectMapper();Map<String,Object> result=writeAndMap(m,new WrapperClassForStaticTyping());assertEquals(1,result.size());Object ob=result.get("value");result=(Map<String,Object>)ob;assertEquals(1,result.size());assertEquals(Integer.valueOf(3),result.get("x"));}
@SuppressWarnings("unchecked")public void testMixedTypingForClass()throws Exception {ObjectMapper m=new ObjectMapper();Map<String,Object> result=writeAndMap(m,new WrapperClassForStaticTyping2());assertEquals(2,result.size());Object obStatic=result.get("staticValue");Map<String,Object> stat=(Map<String,Object>)obStatic;assertEquals(1,stat.size());assertEquals(Integer.valueOf(3),stat.get("x"));Object obDynamic=result.get("dynamicValue");Map<String,Object> dyn=(Map<String,Object>)obDynamic;assertEquals(2,dyn.size());assertEquals(Integer.valueOf(3),dyn.get("x"));assertEquals(Integer.valueOf(5),dyn.get("y"));}
public void testStaticTypingWithMap()throws Exception {ObjectMapper m=new ObjectMapper();m.configure(MapperFeature.USE_STATIC_TYPING,true);ValueMap map=new ValueMap();map.put("a",new ValueClass());assertEquals("{\"a\":{\"x\":3}}",serializeAsString(m,map));}
public void testStaticTypingWithArrayList()throws Exception {ObjectMapper m=new ObjectMapper();m.configure(MapperFeature.USE_STATIC_TYPING,true);ValueList list=new ValueList();list.add(new ValueClass());assertEquals("[{\"x\":3}]",m.writeValueAsString(list));}
public void testStaticTypingWithLinkedList()throws Exception {ObjectMapper m=new ObjectMapper();m.configure(MapperFeature.USE_STATIC_TYPING,true);ValueLinkedList list=new ValueLinkedList();list.add(new ValueClass());assertEquals("[{\"x\":3}]",serializeAsString(m,list));}
public void testStaticTypingWithArray()throws Exception {ObjectMapper m=new ObjectMapper();m.configure(MapperFeature.USE_STATIC_TYPING,true);ValueInterface[]array=new ValueInterface[]{new ValueClass()};assertEquals("[{\"x\":3}]",serializeAsString(m,array));}
public void testProblem294()throws Exception {assertEquals("{\"id\":\"fooId\",\"bar\":\"barId\"}",new ObjectMapper().writeValueAsString(new Foo294("fooId","barId")));}
public void testAbstract()throws Exception {TypeFactory tf=TypeFactory.defaultInstance();TypeBindings b=new TypeBindings(tf,AbstractType.class);assertEquals(2,b.getBindingCount());JavaType obType=tf.constructType(Object.class);assertEquals(obType,b.findType("A"));assertEquals(obType,b.findType("B"));}
public void testSimple()throws Exception {TypeFactory tf=TypeFactory.defaultInstance();TypeBindings b=new TypeBindings(tf,LongStringType.class);assertEquals(2,b.getBindingCount());assertEquals(tf.constructType(Long.class),b.findType("A"));assertEquals(tf.constructType(String.class),b.findType("B"));}
public void testInnerType()throws Exception {TypeFactory tf=TypeFactory.defaultInstance();JavaType type=tf.constructType(InnerGenericTyping.InnerClass.class);assertEquals(MapType.class,type.getClass());JavaType keyType=type.getKeyType();assertEquals(Object.class,keyType.getRawClass());JavaType valueType=type.getContentType();assertEquals(Collection.class,valueType.getRawClass());JavaType vt2=valueType.getContentType();assertEquals(Object.class,vt2.getRawClass());}
/** * Test writing of individual simple values*/public void testSimpleWrites()throws IOException {TokenBuffer buf=new TokenBuffer(null);JsonParser jp=buf.asParser();assertNull(jp.getCurrentToken());assertNull(jp.nextToken());jp.close();buf.writeString("abc");jp=buf.asParser();assertNull(jp.getCurrentToken());assertToken(JsonToken.VALUE_STRING,jp.nextToken());assertEquals("abc",jp.getText());assertNull(jp.nextToken());jp.close();buf.writeNumber(13);jp=buf.asParser();assertNull(jp.getCurrentToken());assertToken(JsonToken.VALUE_STRING,jp.nextToken());assertToken(JsonToken.VALUE_NUMBER_INT,jp.nextToken());assertEquals(13,jp.getIntValue());assertNull(jp.nextToken());jp.close();buf.close();}
public void testSimpleArray()throws IOException {TokenBuffer buf=new TokenBuffer(null);assertTrue(buf.getOutputContext().inRoot());buf.writeStartArray();assertTrue(buf.getOutputContext().inArray());buf.writeEndArray();assertTrue(buf.getOutputContext().inRoot());JsonParser jp=buf.asParser();assertNull(jp.getCurrentToken());assertTrue(jp.getParsingContext().inRoot());assertToken(JsonToken.START_ARRAY,jp.nextToken());assertTrue(jp.getParsingContext().inArray());assertToken(JsonToken.END_ARRAY,jp.nextToken());assertTrue(jp.getParsingContext().inRoot());assertNull(jp.nextToken());jp.close();buf.close();buf=new TokenBuffer(null);buf.writeStartArray();buf.writeBoolean(true);buf.writeNull();buf.writeEndArray();jp=buf.asParser();assertToken(JsonToken.START_ARRAY,jp.nextToken());assertToken(JsonToken.VALUE_TRUE,jp.nextToken());assertTrue(jp.getBooleanValue());assertToken(JsonToken.VALUE_NULL,jp.nextToken());assertToken(JsonToken.END_ARRAY,jp.nextToken());assertNull(jp.nextToken());jp.close();buf.close();buf=new TokenBuffer(null);buf.writeStartArray();buf.writeStartArray();buf.writeBinary(new byte[3]);buf.writeEndArray();buf.writeEndArray();jp=buf.asParser();assertToken(JsonToken.START_ARRAY,jp.nextToken());assertToken(JsonToken.START_ARRAY,jp.nextToken());assertToken(JsonToken.VALUE_EMBEDDED_OBJECT,jp.nextToken());Object ob=jp.getEmbeddedObject();assertNotNull(ob);assertTrue(ob instanceof byte[]);assertEquals(3,((byte[])ob).length);assertToken(JsonToken.END_ARRAY,jp.nextToken());assertToken(JsonToken.END_ARRAY,jp.nextToken());assertNull(jp.nextToken());jp.close();buf.close();}
public void testSimpleObject()throws IOException {TokenBuffer buf=new TokenBuffer(null);assertTrue(buf.getOutputContext().inRoot());buf.writeStartObject();assertTrue(buf.getOutputContext().inObject());buf.writeEndObject();assertTrue(buf.getOutputContext().inRoot());JsonParser jp=buf.asParser();assertNull(jp.getCurrentToken());assertTrue(jp.getParsingContext().inRoot());assertToken(JsonToken.START_OBJECT,jp.nextToken());assertTrue(jp.getParsingContext().inObject());assertToken(JsonToken.END_OBJECT,jp.nextToken());assertTrue(jp.getParsingContext().inRoot());assertNull(jp.nextToken());jp.close();buf.close();buf=new TokenBuffer(null);buf.writeStartObject();buf.writeNumberField("num",1.25);buf.writeEndObject();jp=buf.asParser();assertNull(jp.getCurrentToken());assertToken(JsonToken.START_OBJECT,jp.nextToken());assertNull(jp.getCurrentName());assertToken(JsonToken.FIELD_NAME,jp.nextToken());assertEquals("num",jp.getCurrentName());jp.overrideCurrentName("bah");assertEquals("bah",jp.getCurrentName());assertToken(JsonToken.VALUE_NUMBER_FLOAT,jp.nextToken());assertEquals(1.25,jp.getDoubleValue());assertEquals("bah",jp.getCurrentName());assertToken(JsonToken.END_OBJECT,jp.nextToken());assertNull(jp.getCurrentName());assertNull(jp.nextToken());jp.close();buf.close();}
/** * Verify handling of that "standard" test document (from JSON specification)*/public void testWithJSONSampleDoc()throws Exception {JsonParser jp=createParserUsingReader(SAMPLE_DOC_JSON_SPEC);TokenBuffer tb=new TokenBuffer(null);while (jp.nextToken()!= null){tb.copyCurrentEvent(jp);}verifyJsonSpecSampleDoc(tb.asParser(),false);verifyJsonSpecSampleDoc(tb.asParser(),true);tb.close();}
public void testAppend()throws IOException {TokenBuffer buf1=new TokenBuffer(null);buf1.writeStartObject();buf1.writeFieldName("a");buf1.writeBoolean(true);TokenBuffer buf2=new TokenBuffer(null);buf2.writeFieldName("b");buf2.writeNumber(13);buf2.writeEndObject();buf1.append(buf2);JsonParser jp=buf1.asParser();assertToken(JsonToken.START_OBJECT,jp.nextToken());assertToken(JsonToken.FIELD_NAME,jp.nextToken());assertEquals("a",jp.getCurrentName());assertToken(JsonToken.VALUE_TRUE,jp.nextToken());assertToken(JsonToken.FIELD_NAME,jp.nextToken());assertEquals("b",jp.getCurrentName());assertToken(JsonToken.VALUE_NUMBER_INT,jp.nextToken());assertEquals(13,jp.getIntValue());assertToken(JsonToken.END_OBJECT,jp.nextToken());jp.close();buf1.close();}
public void testWithJsonParserSequenceSimple()throws IOException {TokenBuffer buf=new TokenBuffer(null);buf.writeStartArray();buf.writeString("test");JsonParser jp=createParserUsingReader("[true,null ]");JsonParserSequence seq=JsonParserSequence.createFlattened(buf.asParser(),jp);assertEquals(2,seq.containedParsersCount());assertFalse(jp.isClosed());assertFalse(seq.hasCurrentToken());assertNull(seq.getCurrentToken());assertNull(seq.getCurrentName());assertToken(JsonToken.START_ARRAY,seq.nextToken());assertToken(JsonToken.VALUE_STRING,seq.nextToken());assertEquals("test",seq.getText());assertToken(JsonToken.START_ARRAY,seq.nextToken());assertToken(JsonToken.VALUE_TRUE,seq.nextToken());assertToken(JsonToken.VALUE_NULL,seq.nextToken());assertToken(JsonToken.END_ARRAY,seq.nextToken());assertNull(seq.nextToken());assertNull(seq.nextToken());assertTrue(jp.isClosed());jp.close();buf.close();}
/** * Test to verify that TokenBuffer and JsonParserSequence work together as expected.*/public void testWithMultipleJsonParserSequences()throws IOException {TokenBuffer buf1=new TokenBuffer(null);buf1.writeStartArray();TokenBuffer buf2=new TokenBuffer(null);buf2.writeString("a");TokenBuffer buf3=new TokenBuffer(null);buf3.writeNumber(13);TokenBuffer buf4=new TokenBuffer(null);buf4.writeEndArray();JsonParserSequence seq1=JsonParserSequence.createFlattened(buf1.asParser(),buf2.asParser());assertEquals(2,seq1.containedParsersCount());JsonParserSequence seq2=JsonParserSequence.createFlattened(buf3.asParser(),buf4.asParser());assertEquals(2,seq2.containedParsersCount());JsonParserSequence combo=JsonParserSequence.createFlattened(seq1,seq2);assertEquals(4,combo.containedParsersCount());assertToken(JsonToken.START_ARRAY,combo.nextToken());assertToken(JsonToken.VALUE_STRING,combo.nextToken());assertEquals("a",combo.getText());assertToken(JsonToken.VALUE_NUMBER_INT,combo.nextToken());assertEquals(13,combo.getIntValue());assertToken(JsonToken.END_ARRAY,combo.nextToken());assertNull(combo.nextToken());buf1.close();buf2.close();buf3.close();buf4.close();}
public void testNotKarl()throws IOException {final ObjectMapper mapper=new ObjectMapper();final String serialized=mapper.writeValueAsString(new NotKarlBean());assertEquals("{\"map\":{\"Not Karl\":1}}",serialized);}
public void testKarl()throws IOException {final ObjectMapper mapper=new ObjectMapper();final String serialized=mapper.writeValueAsString(new KarlBean());assertEquals("{\"map\":{\"Karl\":1}}",serialized);}
public void testBoth()throws IOException {final ObjectMapper mapper=new ObjectMapper();final String value1=mapper.writeValueAsString(new NotKarlBean());assertEquals("{\"map\":{\"Not Karl\":1}}",value1);final String value2=mapper.writeValueAsString(new KarlBean());assertEquals("{\"map\":{\"Karl\":1}}",value2);}
public void testQNameSer()throws Exception {QName qn=new QName("http://abc","tag","prefix");assertEquals(quote(qn.toString()),serializeAsString(qn));}
public void testDurationSer()throws Exception {DatatypeFactory dtf=DatatypeFactory.newInstance();Duration dur=dtf.newDurationDayTime(false,15,19,58,1);assertEquals(quote(dur.toString()),serializeAsString(dur));}
public void testXMLGregorianCalendarSerAndDeser()throws Exception {DatatypeFactory dtf=DatatypeFactory.newInstance();XMLGregorianCalendar cal=dtf.newXMLGregorianCalendar(1974,10,10,18,15,17,123,0);ObjectMapper mapper=new ObjectMapper();long timestamp=cal.toGregorianCalendar().getTimeInMillis();String numStr=String.valueOf(timestamp);assertEquals(numStr,mapper.writeValueAsString(cal));XMLGregorianCalendar calOut=mapper.readValue(numStr,XMLGregorianCalendar.class);assertNotNull(calOut);assertEquals(timestamp,calOut.toGregorianCalendar().getTimeInMillis());mapper.configure(SerializationFeature.WRITE_DATES_AS_TIMESTAMPS,false);String exp=cal.toXMLFormat();String act=mapper.writeValueAsString(cal);act=act.substring(1,act.length()- 1);exp=removeZ(exp);act=removeZ(act);assertEquals(exp,act);}
public void testDeserializerLoading(){new CoreXMLDeserializers.DurationDeserializer();new CoreXMLDeserializers.GregorianCalendarDeserializer();new CoreXMLDeserializers.QNameDeserializer();}
public void testQNameDeser()throws Exception {QName qn=new QName("http://abc","tag","prefix");String qstr=qn.toString();ObjectMapper mapper=new ObjectMapper();assertEquals("Should deserialize to equal QName (exp serialization: '" + qstr + "')",qn,mapper.readValue(quote(qstr),QName.class));}
public void testCalendarDeser()throws Exception {DatatypeFactory dtf=DatatypeFactory.newInstance();XMLGregorianCalendar cal=dtf.newXMLGregorianCalendar(1974,10,10,18,15,17,123,0);String exp=cal.toXMLFormat();assertEquals("Should deserialize to equal XMLGregorianCalendar ('" + exp + "')",cal,new ObjectMapper().readValue(quote(exp),XMLGregorianCalendar.class));}
public void testDurationDeser()throws Exception {DatatypeFactory dtf=DatatypeFactory.newInstance();Duration dur=dtf.newDurationDayTime(true,27,5,15,59);String exp=dur.toString();assertEquals("Should deserialize to equal Duration ('" + exp + "')",dur,new ObjectMapper().readValue(quote(exp),Duration.class));}
public void testFloatNaN()throws Exception {ObjectMapper m=new ObjectMapper();Float result=m.readValue(" \"NaN\"",Float.class);assertEquals(Float.valueOf(Float.NaN),result);}
public void testDoubleInf()throws Exception {ObjectMapper m=new ObjectMapper();Double result=m.readValue(" \"" + Double.POSITIVE_INFINITY + "\"",Double.class);assertEquals(Double.valueOf(Double.POSITIVE_INFINITY),result);result=m.readValue(" \"" + Double.NEGATIVE_INFINITY + "\"",Double.class);assertEquals(Double.valueOf(Double.NEGATIVE_INFINITY),result);}
public void testEmptyAsNumber()throws Exception {ObjectMapper m=new ObjectMapper();assertNull(m.readValue(quote(""),Integer.class));assertNull(m.readValue(quote(""),Long.class));assertNull(m.readValue(quote(""),Float.class));assertNull(m.readValue(quote(""),Double.class));assertNull(m.readValue(quote(""),BigInteger.class));assertNull(m.readValue(quote(""),BigDecimal.class));}
public void testDeserializeDecimalHappyPath()throws Exception {ObjectMapper mapper=new ObjectMapper();String json="{\"defaultValue\":{\"value\": 123}}";MyBeanHolder result=mapper.readValue(json,MyBeanHolder.class);assertEquals(BigDecimal.valueOf(123),result.defaultValue.value.decimal);}
public void testDeserializeDecimalProperException()throws Exception {ObjectMapper mapper=new ObjectMapper();String json="{\"defaultValue\":{\"value\": \"123\"}}";try {mapper.readValue(json,MyBeanHolder.class);fail("should have raised exception");}catch(JsonParseException e){verifyException(e,"not numeric");}}
public void testDeserializeDecimalProperExceptionWhenIdSet()throws Exception {ObjectMapper mapper=new ObjectMapper();String json="{\"id\": 5,\"defaultValue\":{\"value\": \"123\"}}";try {MyBeanHolder result=mapper.readValue(json,MyBeanHolder.class);fail("should have raised exception instead value was set to " + result.defaultValue.value.decimal.toString());}catch(JsonParseException e){verifyException(e,"not numeric");}}
public void testDefaults()throws Exception {ObjectMapper m=new ObjectMapper();assertEquals("{\"p1\":\"public\"}",m.writeValueAsString(new FieldBean()));assertEquals("{\"a\":\"a\"}",m.writeValueAsString(new MethodBean()));}
public void testProtectedViaAnnotations()throws Exception {ObjectMapper m=new ObjectMapper();Map<String,Object> result=writeAndMap(m,new ProtFieldBean());assertEquals(2,result.size());assertEquals("public",result.get("p1"));assertEquals("protected",result.get("p2"));assertNull(result.get("p3"));result=writeAndMap(m,new ProtMethodBean());assertEquals(2,result.size());assertEquals("a",result.get("a"));assertEquals("b",result.get("b"));assertNull(result.get("c"));}
public void testPrivateUsingGlobals()throws Exception {ObjectMapper m=new ObjectMapper();VisibilityChecker<?> vc=m.getVisibilityChecker();vc=vc.withFieldVisibility(JsonAutoDetect.Visibility.ANY);m.setVisibilityChecker(vc);Map<String,Object> result=writeAndMap(m,new FieldBean());assertEquals(3,result.size());assertEquals("public",result.get("p1"));assertEquals("protected",result.get("p2"));assertEquals("private",result.get("p3"));m=new ObjectMapper();vc=m.getVisibilityChecker();vc=vc.withGetterVisibility(JsonAutoDetect.Visibility.ANY);m.setVisibilityChecker(vc);result=writeAndMap(m,new MethodBean());assertEquals(3,result.size());assertEquals("a",result.get("a"));assertEquals("b",result.get("b"));assertEquals("c",result.get("c"));}
public void testBasicSetup()throws Exception {ObjectMapper m=new ObjectMapper();VisibilityChecker<?> vc=m.getVisibilityChecker();vc=vc.with(JsonAutoDetect.Visibility.ANY);m.setVisibilityChecker(vc);Map<String,Object> result=writeAndMap(m,new FieldBean());assertEquals(3,result.size());assertEquals("public",result.get("p1"));assertEquals("protected",result.get("p2"));assertEquals("private",result.get("p3"));}
public void testMapperShortcutMethods()throws Exception {ObjectMapper m=new ObjectMapper();m.setVisibility(PropertyAccessor.FIELD,JsonAutoDetect.Visibility.ANY);Map<String,Object> result=writeAndMap(m,new FieldBean());assertEquals(3,result.size());assertEquals("public",result.get("p1"));assertEquals("protected",result.get("p2"));assertEquals("private",result.get("p3"));}
public void testSimple(){assertEquals(Boolean.TRUE,MAPPER.convertValue("true",Boolean.class));assertEquals(Integer.valueOf(-3),MAPPER.convertValue("  -3 ",Integer.class));assertEquals(Long.valueOf(77),MAPPER.convertValue("77",Long.class));int[]ints={1,2,3};List<Integer> Ints=new ArrayList<Integer>();Ints.add(1);Ints.add(2);Ints.add(3);assertArrayEquals(ints,MAPPER.convertValue(Ints,int[].class));}
public void testStringsToInts(){assertArrayEquals(new int[]{1,2,3,4,-1,0},MAPPER.convertValue("1  2 3    4  -1 0".split("\\s+"),int[].class));}
public void testBytesToBase64AndBack()throws Exception {byte[]input=new byte[]{1,2,3,4,5,6,7};String encoded=MAPPER.convertValue(input,String.class);assertNotNull(encoded);byte[]result=MAPPER.convertValue(encoded,byte[].class);assertArrayEquals(input,result);}
public void testBytestoCharArray()throws Exception {byte[]input=new byte[]{1,2,3,4,5,6,7};char[]expEncoded=MAPPER.convertValue(input,String.class).toCharArray();char[]actEncoded=MAPPER.convertValue(input,char[].class);assertArrayEquals(expEncoded,actEncoded);}
public void testSimpleKeySer()throws Exception {ObjectMapper mapper=new ObjectMapper();SimpleModule module=new SimpleModule("test",Version.unknownVersion());module.addKeySerializer(String.class,new ContextualKeySerializer("prefix"));mapper.registerModule(module);Map<String,Object> input=new HashMap<String,Object>();input.put("a",Integer.valueOf(3));String json=mapper.writerWithType(TypeFactory.defaultInstance().constructMapType(HashMap.class,String.class,Object.class)).writeValueAsString(input);assertEquals("{\"prefix:a\":3}",json);}
public void testSimpleKeyDeser()throws Exception {ObjectMapper mapper=new ObjectMapper();SimpleModule module=new SimpleModule("test",Version.unknownVersion());module.addKeyDeserializer(String.class,new ContextualDeser("???"));mapper.registerModule(module);MapBean result=mapper.readValue("{\"map\":{\"a\":3}}",MapBean.class);Map<String,Integer> map=result.map;assertNotNull(map);assertEquals(1,map.size());Map.Entry<String,Integer> entry=map.entrySet().iterator().next();assertEquals(Integer.valueOf(3),entry.getValue());assertEquals("map:a",entry.getKey());}
public void testFromStringCtor()throws Exception {CtorValueBean result=MAPPER.readValue("\"abc\"",CtorValueBean.class);assertEquals("abc",result.toString());}
public void testFromIntCtor()throws Exception {CtorValueBean result=MAPPER.readValue("13",CtorValueBean.class);assertEquals("13",result.toString());}
public void testFromLongCtor()throws Exception {long value=12345678901244L;CtorValueBean result=MAPPER.readValue("" + value,CtorValueBean.class);assertEquals("" + value,result.toString());}
public void testFromStringFactory()throws Exception {FactoryValueBean result=MAPPER.readValue("\"abc\"",FactoryValueBean.class);assertEquals("abc",result.toString());}
public void testFromIntFactory()throws Exception {FactoryValueBean result=MAPPER.readValue("13",FactoryValueBean.class);assertEquals("13",result.toString());}
public void testFromLongFactory()throws Exception {long value=12345678901244L;FactoryValueBean result=MAPPER.readValue("" + value,FactoryValueBean.class);assertEquals("" + value,result.toString());}
public void testSimpleBean()throws Exception {ArrayList<Object> misc=new ArrayList<Object>();misc.add("xyz");misc.add(42);misc.add(null);misc.add(Boolean.TRUE);TestBean bean=new TestBean(13,-900L,"\"test\"",new URI("http://foobar.com"),misc);String json=MAPPER.writeValueAsString(bean);TestBean result=MAPPER.readValue(json,TestBean.class);assertEquals(bean,result);}
public void testListBean()throws Exception {final int COUNT=13;ArrayList<CtorValueBean> beans=new ArrayList<CtorValueBean>();for (int i=0;i < COUNT;++i){beans.add(new CtorValueBean(i));}BeanWithList bean=new BeanWithList(beans);StringWriter sw=new StringWriter();MAPPER.writeValue(sw,bean);BeanWithList result=MAPPER.readValue(sw.toString(),BeanWithList.class);assertEquals(bean,result);}
/** * Also,let's verify that unknown fields cause an exception with default settings.*/public void testUnknownFields()throws Exception {try {TestBean bean=MAPPER.readValue("{\"foobar\" : 3 }",TestBean.class);fail("Expected an exception,got bean: " + bean);}catch(JsonMappingException jse){;}}
public void testBasics()throws IOException {ArrayNode n=new ArrayNode(JsonNodeFactory.instance);assertStandardEquals(n);assertFalse(n.elements().hasNext());assertFalse(n.fieldNames().hasNext());TextNode text=TextNode.valueOf("x");n.add(text);assertEquals(1,n.size());assertFalse(0 == n.hashCode());assertTrue(n.elements().hasNext());assertFalse(n.fieldNames().hasNext());assertNull(n.get("x"));assertTrue(n.path("x").isMissingNode());assertSame(text,n.get(0));assertFalse(n.has("field"));assertFalse(n.hasNonNull("field"));assertTrue(n.has(0));assertTrue(n.hasNonNull(0));assertFalse(n.has(1));assertFalse(n.hasNonNull(1));n.add((JsonNode)null);assertEquals(2,n.size());assertTrue(n.get(1).isNull());assertTrue(n.has(1));assertFalse(n.hasNonNull(1));n.set(1,text);assertSame(text,n.get(1));n.set(0,null);assertTrue(n.get(0).isNull());ArrayNode n2=new ArrayNode(JsonNodeFactory.instance);n2.add("foobar");assertFalse(n.equals(n2));n.addAll(n2);assertEquals(3,n.size());assertFalse(n.get(0).isTextual());assertNotNull(n.remove(0));assertEquals(2,n.size());assertTrue(n.get(0).isTextual());ArrayList<JsonNode> nodes=new ArrayList<JsonNode>();nodes.add(text);n.addAll(nodes);assertEquals(3,n.size());assertNull(n.get(10000));assertNull(n.remove(-4));TextNode text2=TextNode.valueOf("b");n.insert(0,text2);assertEquals(4,n.size());assertSame(text2,n.get(0));assertNotNull(n.addArray());assertEquals(5,n.size());n.addPOJO("foo");assertEquals(6,n.size());JsonGenerator jg=new MappingJsonFactory().createGenerator(new StringWriter());n.serialize(jg,null);n.removeAll();assertEquals(0,n.size());}
public void testAdds(){ArrayNode n=new ArrayNode(JsonNodeFactory.instance);assertNotNull(n.addArray());assertNotNull(n.addObject());n.addPOJO("foobar");n.add(1);n.add(1L);n.add(0.5);n.add(0.5f);assertEquals(7,n.size());assertNotNull(n.insertArray(0));assertNotNull(n.insertObject(0));n.insertPOJO(2,"xxx");assertEquals(10,n.size());}
/** * Test to verify [JACKSON-227]*/public void testNullChecking(){ArrayNode a1=JsonNodeFactory.instance.arrayNode();ArrayNode a2=JsonNodeFactory.instance.arrayNode();a1.addAll(a2);assertEquals(0,a1.size());assertEquals(0,a2.size());a2.addAll(a1);assertEquals(0,a1.size());assertEquals(0,a2.size());}
/** * Another test to verify [JACKSON-227]...*/public void testNullChecking2(){ObjectMapper mapper=new ObjectMapper();ArrayNode src=mapper.createArrayNode();ArrayNode dest=mapper.createArrayNode();src.add("element");dest.addAll(src);}
public void testParser()throws Exception {ArrayNode n=new ArrayNode(JsonNodeFactory.instance);n.add(123);TreeTraversingParser p=new TreeTraversingParser(n,null);p.setCodec(null);assertNull(p.getCodec());assertNotNull(p.getParsingContext());assertNotNull(p.getTokenLocation());assertNotNull(p.getCurrentLocation());assertNull(p.getEmbeddedObject());assertNull(p.currentNode());assertToken(JsonToken.START_ARRAY,p.nextToken());p.skipChildren();assertToken(JsonToken.END_ARRAY,p.getCurrentToken());p.close();p=new TreeTraversingParser(n,null);p.nextToken();assertToken(JsonToken.VALUE_NUMBER_INT,p.nextToken());assertEquals(JsonParser.NumberType.INT,p.getNumberType());p.close();}
public void testWithCreators()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);UrlJob input=new UrlJob(123L,"http://foo",3);String json=mapper.writeValueAsString(input);assertNotNull(json);Job output=mapper.readValue(json,Job.class);assertNotNull(output);assertSame(UrlJob.class,output.getClass());UrlJob o2=(UrlJob)output;assertEquals(123L,o2.id);assertEquals("http://foo",o2.getUrl());assertEquals(3,o2.getCount());}
public void testKeyDeserializers()throws Exception {ObjectMapper mapper=new ObjectMapper();SimpleModule mod=new SimpleModule("test",Version.unknownVersion());mod.addKeyDeserializer(Foo.class,new FooKeyDeserializer());mapper.registerModule(mod);Map<Foo,Integer> map=mapper.readValue("{\"a\":3}",new TypeReference<Map<Foo,Integer>>(){});assertNotNull(map);assertEquals(1,map.size());Foo foo=map.keySet().iterator().next();assertEquals("a",foo.value);}
public void testClassMixInsTopLevel()throws IOException {ObjectMapper m=new ObjectMapper();LeafClass result=m.readValue("{\"a\":\"value\"}",LeafClass.class);assertEquals("XXXvalue",result.a);m=new ObjectMapper();m.addMixInAnnotations(LeafClass.class,MixIn.class);result=m.readValue("{\"a\":\"value\"}",LeafClass.class);assertEquals("value",result.a);}
public void testClassMixInsMidLevel()throws IOException {ObjectMapper m=new ObjectMapper();m.addMixInAnnotations(BaseClass.class,MixIn.class);{BaseClass result=m.readValue("{\"a\":\"value\"}",BaseClass.class);assertEquals("value",result.a);}{LeafClass result=m.readValue("{\"a\":\"value\"}",LeafClass.class);assertEquals("XXXvalue",result.a);}}
public void testClassMixInsForObjectClass()throws IOException {ObjectMapper m=new ObjectMapper();m.addMixInAnnotations(Object.class,MixIn.class);{BaseClass result=m.readValue("{\"a\":\"\"}",BaseClass.class);assertEquals("",result.a);}{LeafClass result=m.readValue("{\"a\":\"\"}",LeafClass.class);assertEquals("XXX",result.a);}}
public void testListWithPolymorphic()throws Exception {ObjectMapper mapper=new ObjectMapper();BeanListWrapper beans=new BeanListWrapper();assertEquals("{\"beans\":[{\"@type\":\"bean\",\"x\":0}]}",mapper.writeValueAsString(beans));ObjectWriter w=mapper.writerWithView(Object.class);assertEquals("{\"beans\":[{\"@type\":\"bean\",\"x\":0}]}",w.writeValueAsString(beans));}
public void testIntList()throws Exception {TypedList<Integer> input=new TypedList<Integer>();input.add(5);input.add(13);assertEquals("[\"" + TypedList.class.getName()+ "\",[5,13]]",serializeAsString(input));}
public void testStringListAsProp()throws Exception {TypedListAsProp<String> input=new TypedListAsProp<String>();input.add("a");input.add("b");assertEquals("[\"" + TypedListAsProp.class.getName()+ "\",[\"a\",\"b\"]]",serializeAsString(input));}
public void testStringListAsObjectWrapper()throws Exception {TypedListAsWrapper<Boolean> input=new TypedListAsWrapper<Boolean>();input.add(true);input.add(null);input.add(false);String expName="TestTypedArraySerialization$TypedListAsWrapper";assertEquals("{\"" + expName + "\":[true,null,false]}",serializeAsString(input));}
public void testIntArray()throws Exception {ObjectMapper m=new ObjectMapper();m.addMixInAnnotations(int[].class,WrapperMixIn.class);int[]input=new int[]{1,2,3};String clsName=int[].class.getName();assertEquals("{\"" + clsName + "\":[1,2,3]}",serializeAsString(m,input));}
public void testGenericArray()throws Exception {ObjectMapper m;final A[]input=new A[]{new B()};final String EXP="[{\"BB\":{\"value\":2}}]";m=new ObjectMapper();assertEquals(EXP,m.writeValueAsString(input));m=new ObjectMapper();m.configure(MapperFeature.USE_STATIC_TYPING,true);assertEquals(EXP,m.writeValueAsString(input));}
public void testJsonLocation()throws Exception {ObjectMapper m=new ObjectMapper();JsonLocation loc=new JsonLocation("whatever",-1,-1,100,13);String ser=serializeAsString(m,loc);JsonLocation result=m.readValue(ser,JsonLocation.class);assertNotNull(result);assertEquals(loc.getSourceRef(),result.getSourceRef());assertEquals(loc.getByteOffset(),result.getByteOffset());assertEquals(loc.getCharOffset(),result.getCharOffset());assertEquals(loc.getColumnNr(),result.getColumnNr());assertEquals(loc.getLineNr(),result.getLineNr());}
public void testJsonLocationProps(){JsonLocation loc=new JsonLocation(null,-1,-1,100,13);assertTrue(loc.equals(loc));assertFalse(loc.equals(null));assertFalse(loc.equals("abx"));loc.hashCode();}
/** * Verify that  {@link TokenBuffer}can be properly deserializedautomatically,using the "standard" JSON sample document*/public void testTokenBufferWithSample()throws Exception {ObjectMapper m=new ObjectMapper();TokenBuffer result=m.readValue(SAMPLE_DOC_JSON_SPEC,TokenBuffer.class);verifyJsonSpecSampleDoc(result.asParser(),true);}
public void testTokenBufferWithSequence()throws Exception {ObjectMapper m=new ObjectMapper();JsonParser jp=createParserUsingReader("[32,[1 ],\"abc\",{\"a\" : true}]");assertToken(JsonToken.START_ARRAY,jp.nextToken());assertToken(JsonToken.VALUE_NUMBER_INT,jp.nextToken());TokenBuffer buf=m.readValue(jp,TokenBuffer.class);JsonParser bufParser=buf.asParser();assertToken(JsonToken.VALUE_NUMBER_INT,bufParser.nextToken());assertEquals(32,bufParser.getIntValue());assertNull(bufParser.nextToken());buf=m.readValue(jp,TokenBuffer.class);bufParser=buf.asParser();assertToken(JsonToken.START_ARRAY,bufParser.nextToken());assertToken(JsonToken.VALUE_NUMBER_INT,bufParser.nextToken());assertEquals(1,bufParser.getIntValue());assertToken(JsonToken.END_ARRAY,bufParser.nextToken());assertNull(bufParser.nextToken());buf=m.readValue(jp,TokenBuffer.class);String str=m.readValue(buf.asParser(),String.class);assertEquals("abc",str);buf=m.readValue(jp,TokenBuffer.class);Map<?,?> map=m.readValue(buf.asParser(),Map.class);assertEquals(1,map.size());assertEquals(Boolean.TRUE,map.get("a"));assertEquals(JsonToken.END_ARRAY,jp.nextToken());assertNull(jp.nextToken());}
public void testJavaType()throws Exception {ObjectMapper mapper=new ObjectMapper();TypeFactory tf=TypeFactory.defaultInstance();String json=mapper.writeValueAsString(tf.constructType(String.class));assertEquals(quote(java.lang.String.class.getName()),json);JavaType t=mapper.readValue(json,JavaType.class);assertNotNull(t);assertEquals(String.class,t.getRawClass());}
public void testSimpleSerialization()throws Exception {Object ob=newGroovyObject(SIMPLE_POGO);Map<String,Object> result=writeAndMap(MAPPER,ob);assertEquals(2,result.size());assertEquals("whome",result.get("name"));Object num=result.get("id");assertNotNull(num);assertTrue(num instanceof Number);assertEquals(3,((Number)num).intValue());}
public void testSimpleDeserialization()throws Exception {Class<?> cls=defineGroovyClass(SIMPLE_POGO);Object pogo=MAPPER.readValue("{\"id\":9,\"name\":\"Bob\"}",cls);assertNotNull(pogo);Map<String,Object> result=writeAndMap(MAPPER,pogo);assertEquals(2,result.size());assertEquals("Bob",result.get("name"));Object num=result.get("id");assertNotNull(num);assertTrue(num instanceof Number);assertEquals(9,((Number)num).intValue());}
public void testBooleanDelegate()throws Exception {ObjectMapper m=new ObjectMapper();BooleanBean bb=m.readValue("true",BooleanBean.class);assertEquals(Boolean.TRUE,bb.value);bb=m.readValue(quote("true"),BooleanBean.class);assertEquals(Boolean.TRUE,bb.value);}
public void testWithCtorAndDelegate()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.setInjectableValues(new InjectableValues.Std().addValue(String.class,"Pooka"));CtorBean711 bean=null;try {bean=mapper.readValue("38",CtorBean711.class);}catch(JsonMappingException e){fail("Did not expect problems,got: " + e.getMessage());}assertEquals(38,bean.age);assertEquals("Pooka",bean.name);}
public void testWithFactoryAndDelegate()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.setInjectableValues(new InjectableValues.Std().addValue(String.class,"Fygar"));FactoryBean711 bean=null;try {bean=mapper.readValue("38",FactoryBean711.class);}catch(JsonMappingException e){fail("Did not expect problems,got: " + e.getMessage());}assertEquals(38,bean.age);assertEquals("Fygar",bean.name1);assertEquals("Fygar",bean.name2);}
/** * Unit test to verify translations of  {@link PropertyNamingStrategy#CAMEL_CASE_TO_LOWER_CASE_WITH_UNDERSCORES}outside the context of an ObjectMapper. CAMEL_CASE_TO_LOWER_CASE_WITH_UNDERSCORES was added in Jackson 1.9,as per [JACKSON-598].*/@Test public void testLowerCaseStrategyStandAlone(){for(Object[]pair : NAME_TRANSLATIONS){String translatedJavaName=PropertyNamingStrategy.CAMEL_CASE_TO_LOWER_CASE_WITH_UNDERSCORES.nameForField(null,null,(String)pair[0]);assertEquals((String)pair[1],translatedJavaName);}}
public void testLowerCaseTranslations()throws Exception {String json=mapper.writeValueAsString(new PersonBean("Joe","Sixpack",42));assertEquals("{\"first_name\":\"Joe\",\"last_name\":\"Sixpack\",\"age\":42}",json);PersonBean result=mapper.readValue(json,PersonBean.class);assertEquals("Joe",result.firstName);assertEquals("Sixpack",result.lastName);assertEquals(42,result.age);}
public void testLowerCaseAcronymsTranslations()throws Exception {String json=mapper.writeValueAsString(new Acronyms("world wide web","http://jackson.codehaus.org","/path1/,/path2/"));assertEquals("{\"www\":\"world wide web\",\"some_url\":\"http://jackson.codehaus.org\",\"some_uris\":\"/path1/,/path2/\"}",json);Acronyms result=mapper.readValue(json,Acronyms.class);assertEquals("world wide web",result.WWW);assertEquals("http://jackson.codehaus.org",result.someURL);assertEquals("/path1/,/path2/",result.someURIs);}
public void testLowerCaseOtherNonStandardNamesTranslations()throws Exception {String json=mapper.writeValueAsString(new OtherNonStandardNames("Results","_User","___","$User"));assertEquals("{\"results\":\"Results\",\"user\":\"_User\",\"__\":\"___\",\"$_user\":\"$User\"}",json);OtherNonStandardNames result=mapper.readValue(json,OtherNonStandardNames.class);assertEquals("Results",result.Results);assertEquals("_User",result._User);assertEquals("___",result.___);assertEquals("$User",result.$User);}
public void testLowerCaseUnchangedNames()throws Exception {String json=mapper.writeValueAsString(new UnchangedNames("from_user","_user","from$user","from7user","_"));assertEquals("{\"from_user\":\"from_user\",\"user\":\"_user\",\"from$user\":\"from$user\",\"from7user\":\"from7user\",\"_\":\"_\"}",json);UnchangedNames result=mapper.readValue(json,UnchangedNames.class);assertEquals("from_user",result.from_user);assertEquals("_user",result._user);assertEquals("from$user",result.from$user);assertEquals("from7user",result.from7user);assertEquals("_",result._);}
/** * Unit test to verify translations of  {@link PropertyNamingStrategy#PASCAL_CASE_TO_CAMEL_CASE}outside the context of an ObjectMapper. PASCAL_CASE_TO_CAMEL_CASE was added in Jackson 2.1.0,as per [JACKSON-63].*/@Test public void testPascalCaseStandAlone(){String translatedJavaName=PropertyNamingStrategy.PASCAL_CASE_TO_CAMEL_CASE.nameForField(null,null,"userName");assertEquals("UserName",translatedJavaName);translatedJavaName=PropertyNamingStrategy.PASCAL_CASE_TO_CAMEL_CASE.nameForField(null,null,"User");assertEquals("User",translatedJavaName);translatedJavaName=PropertyNamingStrategy.PASCAL_CASE_TO_CAMEL_CASE.nameForField(null,null,"user");assertEquals("User",translatedJavaName);translatedJavaName=PropertyNamingStrategy.PASCAL_CASE_TO_CAMEL_CASE.nameForField(null,null,"x");assertEquals("X",translatedJavaName);}
public void testColumnMetadata()throws Exception {ColumnMetadata col=new ColumnMetadata("Billy","employee","comment");Wrapper w=new Wrapper();w.a=col;w.b=col;String json=MAPPER.writeValueAsString(w);Wrapper deserialized=MAPPER.readValue(json,Wrapper.class);assertNotNull(deserialized);assertNotNull(deserialized.a);assertNotNull(deserialized.b);assertEquals("Billy",deserialized.a.getName());assertEquals("employee",deserialized.a.getType());assertEquals("comment",deserialized.a.getComment());assertSame(deserialized.a,deserialized.b);}
public void testMixedRefsIssue188()throws Exception {Company comp=new Company();Employee e1=new Employee(1,"First",null);Employee e2=new Employee(2,"Second",e1);e1.addReport(e2);comp.add(e1);comp.add(e2);String json=MAPPER.writeValueAsString(comp);assertEquals("{\"employees\":[" + "{\"id\":1,\"name\":\"First\",\"manager\":null,\"reports\":[2]}," + "{\"id\":2,\"name\":\"Second\",\"manager\":1,\"reports\":[]}"+ "]}",json);}
public void testMapperVersions(){ObjectMapper mapper=new ObjectMapper();assertVersion(mapper);assertVersion(mapper.reader());assertVersion(mapper.writer());assertVersion(new JacksonAnnotationIntrospector());}
public void testSimple()throws Exception {String json="{\"x\":1,\"y\":2}";Object o=mapper.readValue(json,ValueClassXY.class);assertNotNull(o);assertSame(ValueClassXY.class,o.getClass());ValueClassXY value=(ValueClassXY)o;assertEquals(value._x,2);assertEquals(value._y,3);}
public void testMultiAccess()throws Exception {String json="{\"c\":3,\"a\":2,\"b\":-9}";ValueClassABC value=mapper.readValue(json,ValueClassABC.class);assertNotNull(value);assertEquals(value.a,2);assertEquals(value.b,-9);assertEquals(value.c,3);}
public void testImmutable()throws Exception {final String json="{\"value\":13}";ValueImmutable value=mapper.readValue(json,ValueImmutable.class);assertEquals(13,value.value);}
public void testCustomWith()throws Exception {final String json="{\"value\":1}";ValueFoo value=mapper.readValue(json,ValueFoo.class);assertEquals(1,value.value);}
public void testWithCreator()throws Exception {final String json="{\"a\":1,\"c\":3,\"b\":2}";CreatorValue value=mapper.readValue(json,CreatorValue.class);assertEquals(1,value.a);assertEquals(2,value.b);assertEquals(3,value.c);}
public void testBasics(){ObjectNode n=new ObjectNode(JsonNodeFactory.instance);assertStandardEquals(n);assertFalse(n.elements().hasNext());assertFalse(n.fields().hasNext());assertFalse(n.fieldNames().hasNext());assertNull(n.get("a"));assertTrue(n.path("a").isMissingNode());TextNode text=TextNode.valueOf("x");n.set("a",text);assertEquals(1,n.size());assertTrue(n.elements().hasNext());assertTrue(n.fields().hasNext());assertTrue(n.fieldNames().hasNext());assertSame(text,n.get("a"));assertSame(text,n.path("a"));assertNull(n.get("b"));assertNull(n.get(0));assertFalse(n.has(0));assertFalse(n.hasNonNull(0));assertTrue(n.has("a"));assertTrue(n.hasNonNull("a"));assertFalse(n.has("b"));assertFalse(n.hasNonNull("b"));ObjectNode n2=new ObjectNode(JsonNodeFactory.instance);n2.put("b",13);assertFalse(n.equals(n2));n.setAll(n2);assertEquals(2,n.size());n.set("null",(JsonNode)null);assertEquals(3,n.size());assertTrue(n.has("null"));assertFalse(n.hasNonNull("null"));n.put("null","notReallNull");assertEquals(3,n.size());assertNotNull(n.remove("null"));assertEquals(2,n.size());Map<String,JsonNode> nodes=new HashMap<String,JsonNode>();nodes.put("d",text);n.setAll(nodes);assertEquals(3,n.size());n.removeAll();assertEquals(0,n.size());}
/** * Verify null handling*/public void testNullChecking(){ObjectNode o1=JsonNodeFactory.instance.objectNode();ObjectNode o2=JsonNodeFactory.instance.objectNode();o1.setAll(o2);assertEquals(0,o1.size());assertEquals(0,o2.size());o1.set("x",null);JsonNode n=o1.get("x");assertNotNull(n);assertSame(n,NullNode.instance);o1.put("str",(String)null);n=o1.get("str");assertNotNull(n);assertSame(n,NullNode.instance);o1.put("d",(BigDecimal)null);n=o1.get("d");assertNotNull(n);assertSame(n,NullNode.instance);}
/** * Another test to verify [JACKSON-227]...*/public void testNullChecking2(){ObjectNode src=MAPPER.createObjectNode();ObjectNode dest=MAPPER.createObjectNode();src.put("a","b");dest.setAll(src);}
public void testRemove(){ObjectNode ob=MAPPER.createObjectNode();ob.put("a","a");ob.put("b","b");ob.put("c","c");assertEquals(3,ob.size());assertSame(ob,ob.without(Arrays.asList("a","c")));assertEquals(1,ob.size());assertEquals("b",ob.get("b").textValue());}
public void testRetain(){ObjectNode ob=MAPPER.createObjectNode();ob.put("a","a");ob.put("b","b");ob.put("c","c");assertEquals(3,ob.size());assertSame(ob,ob.retain("a","c"));assertEquals(2,ob.size());assertEquals("a",ob.get("a").textValue());assertNull(ob.get("b"));assertEquals("c",ob.get("c").textValue());}
public void testValidWith()throws Exception {ObjectNode root=MAPPER.createObjectNode();assertEquals("{}",MAPPER.writeValueAsString(root));JsonNode child=root.with("prop");assertTrue(child instanceof ObjectNode);assertEquals("{\"prop\":{}}",MAPPER.writeValueAsString(root));}
public void testValidWithArray()throws Exception {ObjectNode root=MAPPER.createObjectNode();assertEquals("{}",MAPPER.writeValueAsString(root));JsonNode child=root.withArray("arr");assertTrue(child instanceof ArrayNode);assertEquals("{\"arr\":[]}",MAPPER.writeValueAsString(root));}
public void testInvalidWith()throws Exception {JsonNode root=MAPPER.createArrayNode();try {root.with("prop");fail("Expected exception");}catch(UnsupportedOperationException e){verifyException(e,"not of type ObjectNode");}ObjectNode root2=MAPPER.createObjectNode();root2.put("prop",13);try {root2.with("prop");fail("Expected exception");}catch(UnsupportedOperationException e){verifyException(e,"has value that is not");}}
public void testInvalidWithArray()throws Exception {JsonNode root=MAPPER.createArrayNode();try {root.withArray("prop");fail("Expected exception");}catch(UnsupportedOperationException e){verifyException(e,"not of type ObjectNode");}ObjectNode root2=MAPPER.createObjectNode();root2.put("prop",13);try {root2.withArray("prop");fail("Expected exception");}catch(UnsupportedOperationException e){verifyException(e,"has value that is not");}}
public void testSetAll()throws Exception {ObjectNode root=MAPPER.createObjectNode();assertEquals(0,root.size());HashMap<String,JsonNode> map=new HashMap<String,JsonNode>();map.put("a",root.numberNode(1));root.setAll(map);assertEquals(1,root.size());assertTrue(root.has("a"));assertFalse(root.has("b"));map.put("b",root.numberNode(2));root.setAll(map);assertEquals(2,root.size());assertTrue(root.has("a"));assertTrue(root.has("b"));assertEquals(2,root.path("b").intValue());ObjectNode root2=MAPPER.createObjectNode();root2.setAll(root);assertEquals(2,root.size());assertEquals(2,root2.size());root2.setAll(root);assertEquals(2,root.size());assertEquals(2,root2.size());ObjectNode root3=MAPPER.createObjectNode();root3.put("a",2);root3.put("c",3);assertEquals(2,root3.path("a").intValue());root3.setAll(root2);assertEquals(3,root3.size());assertEquals(1,root3.path("a").intValue());}
/** * Basic test to ensure we do not have functioning default serializers for custom types used in tests.*/public void testWithoutModule(){ObjectMapper mapper=new ObjectMapper();try {mapper.writeValueAsString(new CustomBean("foo",3));fail("Should have caused an exception");}catch(IOException e){verifyException(e,"No serializer found");}try {mapper.readValue("{\"str\":\"ab\",\"num\":2}",CustomBean.class);fail("Should have caused an exception");}catch(IOException e){verifyException(e,"No suitable constructor found");}}
public void testSimpleBeanSerializer()throws Exception {ObjectMapper mapper=new ObjectMapper();SimpleModule mod=new SimpleModule("test",Version.unknownVersion());mod.addSerializer(new CustomBeanSerializer());mapper.registerModule(mod);assertEquals(quote("abcde|5"),mapper.writeValueAsString(new CustomBean("abcde",5)));}
public void testSimpleEnumSerializer()throws Exception {ObjectMapper mapper=new ObjectMapper();SimpleModule mod=new SimpleModule("test",Version.unknownVersion());mod.addSerializer(new SimpleEnumSerializer());mapper.registerModule(mod);assertEquals(quote("b"),mapper.writeValueAsString(SimpleEnum.B));}
public void testSimpleInterfaceSerializer()throws Exception {ObjectMapper mapper=new ObjectMapper();SimpleModule mod=new SimpleModule("test",Version.unknownVersion());mod.addSerializer(new BaseSerializer());mapper.registerModule(mod);assertEquals(quote("Base:1"),mapper.writeValueAsString(new Impl1()));assertEquals(quote("Base:2"),mapper.writeValueAsString(new Impl2()));}
public void testSimpleBeanDeserializer()throws Exception {ObjectMapper mapper=new ObjectMapper();SimpleModule mod=new SimpleModule("test",Version.unknownVersion());mod.addDeserializer(CustomBean.class,new CustomBeanDeserializer());mapper.registerModule(mod);CustomBean bean=mapper.readValue(quote("xyz|3"),CustomBean.class);assertEquals("xyz",bean.str);assertEquals(3,bean.num);}
public void testSimpleEnumDeserializer()throws Exception {ObjectMapper mapper=new ObjectMapper();SimpleModule mod=new SimpleModule("test",Version.unknownVersion());mod.addDeserializer(SimpleEnum.class,new SimpleEnumDeserializer());mapper.registerModule(mod);SimpleEnum result=mapper.readValue(quote("a"),SimpleEnum.class);assertSame(SimpleEnum.A,result);}
public void testMultipleModules()throws Exception {MySimpleModule mod1=new MySimpleModule("test1",Version.unknownVersion());SimpleModule mod2=new SimpleModule("test2",Version.unknownVersion());mod1.addSerializer(SimpleEnum.class,new SimpleEnumSerializer());mod1.addDeserializer(CustomBean.class,new CustomBeanDeserializer());mod2.addDeserializer(SimpleEnum.class,new SimpleEnumDeserializer());mod2.addSerializer(CustomBean.class,new CustomBeanSerializer());ObjectMapper mapper=new ObjectMapper();mapper.registerModule(mod1);mapper.registerModule(mod2);assertEquals(quote("b"),mapper.writeValueAsString(SimpleEnum.B));SimpleEnum result=mapper.readValue(quote("a"),SimpleEnum.class);assertSame(SimpleEnum.A,result);mapper=new ObjectMapper();mapper.registerModule(mod2);mapper.registerModule(mod1);assertEquals(quote("b"),mapper.writeValueAsString(SimpleEnum.B));result=mapper.readValue(quote("a"),SimpleEnum.class);assertSame(SimpleEnum.A,result);}
public void testMixIns()throws Exception {SimpleModule module=new SimpleModule("test",Version.unknownVersion());module.setMixInAnnotation(MixableBean.class,MixInForOrder.class);ObjectMapper mapper=new ObjectMapper();mapper.registerModule(module);Map<String,Object> props=this.writeAndMap(mapper,new MixableBean());assertEquals(3,props.size());assertEquals(Integer.valueOf(3),props.get("c"));assertEquals(Integer.valueOf(1),props.get("a"));assertEquals(Integer.valueOf(2),props.get("b"));}
public void testAccessToMapper()throws Exception {ContextVerifierModule module=new ContextVerifierModule();ObjectMapper mapper=new ObjectMapper();mapper.registerModule(module);}
public void testBasicsWithNullNode()throws Exception {NullNode n=NullNode.instance;assertFalse(n.isContainerNode());assertFalse(n.isBigDecimal());assertFalse(n.isBigInteger());assertFalse(n.isBinary());assertFalse(n.isBoolean());assertFalse(n.isPojo());assertFalse(n.isMissingNode());assertFalse(n.booleanValue());assertNull(n.numberValue());assertEquals(0,n.intValue());assertEquals(0L,n.longValue());assertEquals(BigDecimal.ZERO,n.decimalValue());assertEquals(BigInteger.ZERO,n.bigIntegerValue());assertEquals(0,n.size());assertFalse(n.elements().hasNext());assertFalse(n.fieldNames().hasNext());assertNotNull(n.path("xyz"));assertTrue(n.path("xyz").isMissingNode());assertFalse(n.has("field"));assertFalse(n.has(3));assertNodeNumbersForNonNumeric(n);}
public void testUsesDeserializersNullValue()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.registerModule(new TestModule());Container container=mapper.readValue("{}",Container.class);assertEquals(NULL_CONTAINED,container.contained);}
public void testSimpleObject()throws Exception {String JSON="{\"key\" : 1,\"b\" : \"x\" }";ObjectMapper mapper=new ObjectMapper();JsonNode root=mapper.readTree(JSON);assertFalse(root.isValueNode());assertTrue(root.isContainerNode());assertFalse(root.isArray());assertTrue(root.isObject());assertEquals(2,root.size());Iterator<JsonNode> it=root.iterator();assertNotNull(it);assertTrue(it.hasNext());JsonNode n=it.next();assertNotNull(n);assertEquals(IntNode.valueOf(1),n);assertTrue(it.hasNext());n=it.next();assertNotNull(n);assertEquals(TextNode.valueOf("x"),n);assertFalse(it.hasNext());ObjectNode obNode=(ObjectNode)root;Iterator<Map.Entry<String,JsonNode>> fit=obNode.fields();assertTrue(fit.hasNext());Map.Entry<String,JsonNode> en=fit.next();assertEquals("key",en.getKey());assertEquals(IntNode.valueOf(1),en.getValue());assertTrue(fit.hasNext());en=fit.next();assertEquals("b",en.getKey());assertEquals(TextNode.valueOf("x"),en.getValue());fit.remove();assertEquals(1,obNode.size());assertEquals(IntNode.valueOf(1),root.get("key"));assertNull(root.get("b"));}
public void testSimplePath()throws Exception {JsonNode root=new ObjectMapper().readTree("{\"results\" :{\"a\" : 3}}");assertTrue(root.isObject());JsonNode rnode=root.path("results");assertNotNull(rnode);assertTrue(rnode.isObject());assertEquals(3,rnode.path("a").intValue());}
public void testSimpleProxied()throws Exception {Enhancer enh=new Enhancer();enh.setInterfaces(new Class[]{BeanInterface.class});enh.setCallback(new MethodInterceptor(){@Override public Object intercept(Object obj,Method method,Object[]args,MethodProxy proxy)throws Throwable {if ("getX".equals(method.getName())){return Integer.valueOf(13);}return proxy.invokeSuper(obj,args);}});BeanInterface bean=(BeanInterface)enh.create();ObjectMapper mapper=new ObjectMapper();Map<String,Object> result=writeAndMap(mapper,bean);assertEquals(1,result.size());assertEquals(Integer.valueOf(13),result.get("x"));}
public void testIssue877()throws Exception {BaseInterfaceImpl one=new BaseInterfaceImpl();BaseInterfaceImpl two=new BaseInterfaceImpl();one.addInstance(two);two.addInstance(one);ListWrapper<BaseInterfaceImpl> myList=new ListWrapper<BaseInterfaceImpl>();myList.add(one);myList.add(two);ObjectMapper om=new ObjectMapper();om.enableDefaultTypingAsProperty(ObjectMapper.DefaultTyping.NON_FINAL,"@class");String json=om.writerWithDefaultPrettyPrinter().writeValueAsString(myList);ListWrapper<BaseInterfaceImpl> result;result=om.readValue(json,new TypeReference<ListWrapper<BaseInterfaceImpl>>(){});assertNotNull(result);System.out.println("deserialised list size = " + result.size());}
public void testSimple()throws Exception {ObjectMapper mapper=new ObjectMapper();SimpleModule module=new SimpleModule("test",Version.unknownVersion());module.addDeserializer(StringValue.class,new MyContextualDeserializer());mapper.registerModule(module);ContextualBean bean=mapper.readValue("{\"a\":\"1\",\"b\":\"2\"}",ContextualBean.class);assertEquals("a=1",bean.a.value);assertEquals("b=2",bean.b.value);bean=mapper.readValue("{\"a\":\"3\",\"b\":\"4\"}",ContextualBean.class);assertEquals("a=3",bean.a.value);assertEquals("b=4",bean.b.value);}
public void testSimpleWithAnnotations()throws Exception {ObjectMapper mapper=_mapperWithAnnotatedContextual();ContextualBean bean=mapper.readValue("{\"a\":\"1\",\"b\":\"2\"}",ContextualBean.class);assertEquals("NameA=1",bean.a.value);assertEquals("NameB=2",bean.b.value);bean=mapper.readValue("{\"a\":\"x\",\"b\":\"y\"}",ContextualBean.class);assertEquals("NameA=x",bean.a.value);assertEquals("NameB=y",bean.b.value);}
public void testSimpleWithClassAnnotations()throws Exception {ObjectMapper mapper=_mapperWithAnnotatedContextual();ContextualClassBean bean=mapper.readValue("{\"a\":\"1\",\"b\":\"2\"}",ContextualClassBean.class);assertEquals("Class=1",bean.a.value);assertEquals("NameB=2",bean.b.value);bean=mapper.readValue("{\"a\":\"123\",\"b\":\"345\"}",ContextualClassBean.class);assertEquals("Class=123",bean.a.value);assertEquals("NameB=345",bean.b.value);}
public void testAnnotatedCtor()throws Exception {ObjectMapper mapper=_mapperWithAnnotatedContextual();ContextualCtorBean bean=mapper.readValue("{\"a\":\"foo\",\"b\":\"bar\"}",ContextualCtorBean.class);assertEquals("CtorA=foo",bean.a);assertEquals("CtorB=bar",bean.b);bean=mapper.readValue("{\"a\":\"1\",\"b\":\"0\"}",ContextualCtorBean.class);assertEquals("CtorA=1",bean.a);assertEquals("CtorB=0",bean.b);}
public void testAnnotatedArray()throws Exception {ObjectMapper mapper=_mapperWithAnnotatedContextual();ContextualArrayBean bean=mapper.readValue("{\"beans\":[\"x\"]}",ContextualArrayBean.class);assertEquals(1,bean.beans.length);assertEquals("array=x",bean.beans[0].value);bean=mapper.readValue("{\"beans\":[\"a\",\"b\"]}",ContextualArrayBean.class);assertEquals(2,bean.beans.length);assertEquals("array=a",bean.beans[0].value);assertEquals("array=b",bean.beans[1].value);}
public void testAnnotatedList()throws Exception {ObjectMapper mapper=_mapperWithAnnotatedContextual();ContextualListBean bean=mapper.readValue("{\"beans\":[\"x\"]}",ContextualListBean.class);assertEquals(1,bean.beans.size());assertEquals("list=x",bean.beans.get(0).value);bean=mapper.readValue("{\"beans\":[\"x\",\"y\",\"z\"]}",ContextualListBean.class);assertEquals(3,bean.beans.size());assertEquals("list=x",bean.beans.get(0).value);assertEquals("list=y",bean.beans.get(1).value);assertEquals("list=z",bean.beans.get(2).value);}
public void testAnnotatedMap()throws Exception {ObjectMapper mapper=_mapperWithAnnotatedContextual();ContextualMapBean bean=mapper.readValue("{\"beans\":{\"a\":\"b\"}}",ContextualMapBean.class);assertEquals(1,bean.beans.size());Map.Entry<String,StringValue> entry=bean.beans.entrySet().iterator().next();assertEquals("a",entry.getKey());assertEquals("map=b",entry.getValue().value);bean=mapper.readValue("{\"beans\":{\"x\":\"y\",\"1\":\"2\"}}",ContextualMapBean.class);assertEquals(2,bean.beans.size());Iterator<Map.Entry<String,StringValue>> it=bean.beans.entrySet().iterator();entry=it.next();assertEquals("x",entry.getKey());assertEquals("map=y",entry.getValue().value);entry=it.next();assertEquals("1",entry.getKey());assertEquals("map=2",entry.getValue().value);}
public void testWithView()throws Exception {AsArrayWithView input=new AsArrayWithView();input.a=1;input.b=2;input.c=3;String json=MAPPER.writerWithView(ViewA.class).writeValueAsString(input);assertEquals("[1,null,3]",json);AsArrayWithView output=MAPPER.reader(AsArrayWithView.class).withView(ViewB.class).readValue("[1,2,3]");assertEquals(3,output.c);assertEquals(2,output.b);assertEquals(0,output.a);}
public void testWithCreatorsOrdered()throws Exception {CreatorAsArray input=new CreatorAsArray(3,4);input.a=1;input.b=2;String json=MAPPER.writeValueAsString(input);assertEquals("[3,4,1,2]",json);CreatorAsArray output=MAPPER.readValue(json,CreatorAsArray.class);assertEquals(1,output.a);assertEquals(2,output.b);assertEquals(3,output.x);assertEquals(4,output.y);}
public void testWithCreatorsShuffled()throws Exception {CreatorAsArrayShuffled input=new CreatorAsArrayShuffled(3,4);input.a=1;input.b=2;String json=MAPPER.writeValueAsString(input);assertEquals("[1,2,3,4]",json);CreatorAsArrayShuffled output=MAPPER.readValue(json,CreatorAsArrayShuffled.class);assertEquals(1,output.a);assertEquals(2,output.b);assertEquals(3,output.x);assertEquals(4,output.y);}
/** * First things first,let's ensure we can serialize using class name,written as main-level property name*/public void testSimpleClassAsProperty()throws Exception {ObjectMapper m=new ObjectMapper();Animal a=m.readValue(asJSONObjectValueString("@classy",Cat.class.getName(),"furColor","tabby","name","Garfield"),Animal.class);assertNotNull(a);assertEquals(Cat.class,a.getClass());Cat c=(Cat)a;assertEquals("Garfield",c.name);assertEquals("tabby",c.furColor);}
public void testTypeAsWrapper()throws Exception {ObjectMapper m=new ObjectMapper();m.addMixInAnnotations(Animal.class,TypeWithWrapper.class);String JSON="{\".TestTypedDeserialization$Dog\" : " + asJSONObjectValueString(m,"name","Scooby","boneCount","6")+ " }";Animal a=m.readValue(JSON,Animal.class);assertTrue(a instanceof Animal);assertEquals(Dog.class,a.getClass());Dog d=(Dog)a;assertEquals("Scooby",d.name);assertEquals(6,d.boneCount);}
public void testTypeAsArray()throws Exception {ObjectMapper m=new ObjectMapper();m.addMixInAnnotations(Animal.class,TypeWithArray.class);String JSON="[\"" + Dog.class.getName()+ "\","+ asJSONObjectValueString(m,"name","Martti","boneCount","11")+ " ]";Animal a=m.readValue(JSON,Animal.class);assertEquals(Dog.class,a.getClass());Dog d=(Dog)a;assertEquals("Martti",d.name);assertEquals(11,d.boneCount);}
public void testListAsArray()throws Exception {ObjectMapper m=new ObjectMapper();String JSON="[\n" + asJSONObjectValueString(m,"@classy",Cat.class.getName(),"name","Hello","furColor","white")+ ",\n"+ asJSONObjectValueString(m,"boneCount",Integer.valueOf(1),"@classy",Dog.class.getName(),"name","Bob")+ ",\n"+ asJSONObjectValueString(m,"@classy",Fish.class.getName())+ ",null\n]";JavaType expType=TypeFactory.defaultInstance().constructCollectionType(ArrayList.class,Animal.class);List<Animal> animals=m.readValue(JSON,expType);assertNotNull(animals);assertEquals(4,animals.size());Cat c=(Cat)animals.get(0);assertEquals("Hello",c.name);assertEquals("white",c.furColor);Dog d=(Dog)animals.get(1);assertEquals("Bob",d.name);assertEquals(1,d.boneCount);Fish f=(Fish)animals.get(2);assertNotNull(f);assertNull(animals.get(3));}
public void testCagedAnimal()throws Exception {ObjectMapper m=new ObjectMapper();String jsonCat=asJSONObjectValueString(m,"@classy",Cat.class.getName(),"name","Nilson","furColor","black");String JSON="{\"animal\":" + jsonCat + "}";AnimalContainer cont=m.readValue(JSON,AnimalContainer.class);assertNotNull(cont);Animal a=cont.animal;assertNotNull(a);Cat c=(Cat)a;assertEquals("Nilson",c.name);assertEquals("black",c.furColor);}
/** * Test that verifies that there are few limitations on polymorphic base class.*/public void testAbstractEmptyBaseClass()throws Exception {DummyBase result=new ObjectMapper().readValue("[\"" + DummyImpl.class.getName()+ "\",{\"x\":3}]",DummyBase.class);assertNotNull(result);assertEquals(DummyImpl.class,result.getClass());assertEquals(3,((DummyImpl)result).x);}
public void testIssue506WithDate()throws Exception {Issue506DateBean input=new Issue506DateBean();input.date=new Date(1234L);ObjectMapper mapper=new ObjectMapper();String json=mapper.writeValueAsString(input);Issue506DateBean output=mapper.readValue(json,Issue506DateBean.class);assertEquals(input.date,output.date);}
public void testIssue506WithNumber()throws Exception {Issue506NumberBean input=new Issue506NumberBean();input.number=Long.valueOf(4567L);ObjectMapper mapper=new ObjectMapper();String json=mapper.writeValueAsString(input);Issue506NumberBean output=mapper.readValue(json,Issue506NumberBean.class);assertEquals(input.number,output.number);}
public void testMissing(){MissingNode n=MissingNode.getInstance();assertTrue(n.isMissingNode());assertEquals(JsonToken.NOT_AVAILABLE,n.asToken());assertEquals("",n.asText());assertStandardEquals(n);assertEquals("",n.toString());assertNodeNumbersForNonNumeric(n);assertTrue(n.asBoolean(true));assertEquals(4,n.asInt(4));assertEquals(5L,n.asLong(5));assertEquals(0.25,n.asDouble(0.25));}
public void testSimpleTypes(){Class<?>[]classes=new Class<?>[]{boolean.class,byte.class,char.class,short.class,int.class,long.class,float.class,double.class,Boolean.class,Byte.class,Character.class,Short.class,Integer.class,Long.class,Float.class,Double.class,String.class,Object.class,Calendar.class,Date.class};TypeFactory tf=TypeFactory.defaultInstance();for(Class<?> clz : classes){assertSame(clz,tf.constructType(clz).getRawClass());assertSame(clz,tf.constructType(clz).getRawClass());}}
public void testArrays(){Class<?>[]classes=new Class<?>[]{boolean[].class,byte[].class,char[].class,short[].class,int[].class,long[].class,float[].class,double[].class,String[].class,Object[].class,Calendar[].class};TypeFactory tf=TypeFactory.defaultInstance();for(Class<?> clz : classes){assertSame(clz,tf.constructType(clz).getRawClass());Class<?> elemType=clz.getComponentType();assertSame(clz,tf.constructArrayType(elemType).getRawClass());}}
public void testCollections(){TypeFactory tf=TypeFactory.defaultInstance();JavaType t=tf.constructType(ArrayList.class);assertEquals(CollectionType.class,t.getClass());assertSame(ArrayList.class,t.getRawClass());t=tf.constructType(new TypeReference<ArrayList<String>>(){});assertEquals(CollectionType.class,t.getClass());assertSame(ArrayList.class,t.getRawClass());JavaType elemType=((CollectionType)t).getContentType();assertNotNull(elemType);assertSame(SimpleType.class,elemType.getClass());assertSame(String.class,elemType.getRawClass());t=tf.constructCollectionType(ArrayList.class,String.class);assertEquals(CollectionType.class,t.getClass());assertSame(String.class,((CollectionType)t).getContentType().getRawClass());}
public void testMaps(){TypeFactory tf=TypeFactory.defaultInstance();JavaType t=tf.constructType(HashMap.class);assertEquals(MapType.class,t.getClass());assertSame(HashMap.class,t.getRawClass());t=tf.constructMapType(TreeMap.class,String.class,Integer.class);assertEquals(MapType.class,t.getClass());assertSame(String.class,((MapType)t).getKeyType().getRawClass());assertSame(Integer.class,((MapType)t).getContentType().getRawClass());t=tf.constructType(new TypeReference<HashMap<String,Integer>>(){});assertEquals(MapType.class,t.getClass());assertSame(HashMap.class,t.getRawClass());MapType mt=(MapType)t;assertEquals(tf.constructType(String.class),mt.getKeyType());assertEquals(tf.constructType(Integer.class),mt.getContentType());t=tf.constructType(new TypeReference<LongValuedMap<Boolean>>(){});assertEquals(MapType.class,t.getClass());assertSame(LongValuedMap.class,t.getRawClass());mt=(MapType)t;assertEquals(tf.constructType(Boolean.class),mt.getKeyType());assertEquals(tf.constructType(Long.class),mt.getContentType());}
public void testIterator(){TypeFactory tf=TypeFactory.defaultInstance();JavaType t=tf.constructType(new TypeReference<Iterator<String>>(){});assertEquals(SimpleType.class,t.getClass());assertSame(Iterator.class,t.getRawClass());assertEquals(1,t.containedTypeCount());assertEquals(tf.constructType(String.class),t.containedType(0));assertNull(t.containedType(1));}
/** * Test for verifying that parametric types can be constructed programmatically* @since 1.5*/public void testParametricTypes(){TypeFactory tf=TypeFactory.defaultInstance();JavaType t=tf.constructParametricType(ArrayList.class,String.class);assertEquals(CollectionType.class,t.getClass());JavaType strC=tf.constructType(String.class);assertEquals(1,t.containedTypeCount());assertEquals(strC,t.containedType(0));assertNull(t.containedType(1));JavaType t2=tf.constructParametricType(Map.class,strC,t);assertEquals(MapType.class,t2.getClass());assertEquals(2,t2.containedTypeCount());assertEquals(strC,t2.containedType(0));assertEquals(t,t2.containedType(1));assertNull(t2.containedType(2));JavaType custom=tf.constructParametricType(SingleArgGeneric.class,String.class);assertEquals(SimpleType.class,custom.getClass());assertEquals(1,custom.containedTypeCount());assertEquals(strC,custom.containedType(0));assertNull(custom.containedType(1));assertEquals("X",custom.containedTypeName(0));try {tf.constructParametricType(Map.class,strC);}catch(IllegalArgumentException e){verifyException(e,"Need exactly 2 parameter types for Map types");}try {tf.constructParametricType(SingleArgGeneric.class,strC,strC);}catch(IllegalArgumentException e){verifyException(e,"expected 1 parameters,was given 2");}}
/** * Test for checking that canonical name handling works ok*/public void testCanonicalNames(){TypeFactory tf=TypeFactory.defaultInstance();JavaType t=tf.constructType(java.util.Calendar.class);String can=t.toCanonical();assertEquals("java.util.Calendar",can);assertEquals(t,tf.constructFromCanonical(can));t=tf.constructType(java.util.ArrayList.class);can=t.toCanonical();assertEquals("java.util.ArrayList<java.lang.Object>",can);assertEquals(t,tf.constructFromCanonical(can));t=tf.constructType(java.util.TreeMap.class);can=t.toCanonical();assertEquals("java.util.TreeMap<java.lang.Object,java.lang.Object>",can);assertEquals(t,tf.constructFromCanonical(can));t=tf.constructMapType(EnumMap.class,EnumForCanonical.class,String.class);can=t.toCanonical();assertEquals("java.util.EnumMap<com.fasterxml.jackson.databind.type.TestTypeFactory$EnumForCanonical,java.lang.String>",can);assertEquals(t,tf.constructFromCanonical(can));}
/** * @since 1.6*/public void testSuperTypeDetectionClass(){TypeFactory tf=TypeFactory.defaultInstance();HierarchicType sub=tf._findSuperTypeChain(MyStringIntMap.class,HashMap.class);assertNotNull(sub);assertEquals(2,_countSupers(sub));assertSame(MyStringIntMap.class,sub.getRawClass());HierarchicType sup=sub.getSuperType();assertSame(MyStringXMap.class,sup.getRawClass());HierarchicType sup2=sup.getSuperType();assertSame(HashMap.class,sup2.getRawClass());assertNull(sup2.getSuperType());}
/** * @since 1.6*/public void testSuperTypeDetectionInterface(){TypeFactory tf=TypeFactory.defaultInstance();HierarchicType sub=tf._findSuperTypeChain(MyList.class,List.class);assertNotNull(sub);assertEquals(2,_countSupers(sub));assertSame(MyList.class,sub.getRawClass());HierarchicType sup=sub.getSuperType();assertSame(IntermediateList.class,sup.getRawClass());HierarchicType sup2=sup.getSuperType();assertSame(List.class,sup2.getRawClass());assertNull(sup2.getSuperType());sub=tf._findSuperTypeChain(MyMap.class,Map.class);assertNotNull(sub);assertEquals(2,_countSupers(sub));assertSame(MyMap.class,sub.getRawClass());sup=sub.getSuperType();assertSame(IntermediateMap.class,sup.getRawClass());sup2=sup.getSuperType();assertSame(Map.class,sup2.getRawClass());assertNull(sup2.getSuperType());}
/** * @since 1.6*/public void testAtomicArrayRefParameterDetection(){TypeFactory tf=TypeFactory.defaultInstance();JavaType type=tf.constructType(new TypeReference<AtomicReference<long[]>>(){});HierarchicType sub=tf._findSuperTypeChain(type.getRawClass(),AtomicReference.class);assertNotNull(sub);assertEquals(0,_countSupers(sub));assertTrue(AtomicReference.class.isAssignableFrom(type.getRawClass()));assertNull(sub.getSuperType());}
/** * @since 1.6*/public void testMapTypesSimple(){TypeFactory tf=TypeFactory.defaultInstance();JavaType type=tf.constructType(new TypeReference<Map<String,Boolean>>(){});MapType mapType=(MapType)type;assertEquals(tf.constructType(String.class),mapType.getKeyType());assertEquals(tf.constructType(Boolean.class),mapType.getContentType());}
/** * @since 1.6*/public void testMapTypesRaw(){TypeFactory tf=TypeFactory.defaultInstance();JavaType type=tf.constructType(HashMap.class);MapType mapType=(MapType)type;assertEquals(tf.constructType(Object.class),mapType.getKeyType());assertEquals(tf.constructType(Object.class),mapType.getContentType());}
/** * @since 1.6*/public void testMapTypesAdvanced(){TypeFactory tf=TypeFactory.defaultInstance();JavaType type=tf.constructType(MyMap.class);MapType mapType=(MapType)type;assertEquals(tf.constructType(String.class),mapType.getKeyType());assertEquals(tf.constructType(Long.class),mapType.getContentType());type=tf.constructType(MapInterface.class);mapType=(MapType)type;assertEquals(tf.constructType(String.class),mapType.getKeyType());assertEquals(tf.constructType(Integer.class),mapType.getContentType());type=tf.constructType(MyStringIntMap.class);mapType=(MapType)type;assertEquals(tf.constructType(String.class),mapType.getKeyType());assertEquals(tf.constructType(Integer.class),mapType.getContentType());}
/** * Specific test to verify that complicate name mangling schemes do not fool type resolver* @since 1.6*/public void testMapTypesSneaky(){TypeFactory tf=TypeFactory.defaultInstance();JavaType type=tf.constructType(IntLongMap.class);MapType mapType=(MapType)type;assertEquals(tf.constructType(Integer.class),mapType.getKeyType());assertEquals(tf.constructType(Long.class),mapType.getContentType());}
/** * Plus sneaky types may be found via introspection as well.* @since 1.7*/public void testSneakyFieldTypes()throws Exception {TypeFactory tf=TypeFactory.defaultInstance();Field field=SneakyBean.class.getDeclaredField("intMap");JavaType type=tf.constructType(field.getGenericType());assertTrue(type instanceof MapType);MapType mapType=(MapType)type;assertEquals(tf.constructType(Integer.class),mapType.getKeyType());assertEquals(tf.constructType(Long.class),mapType.getContentType());field=SneakyBean.class.getDeclaredField("longList");type=tf.constructType(field.getGenericType());assertTrue(type instanceof CollectionType);CollectionType collectionType=(CollectionType)type;assertEquals(tf.constructType(Long.class),collectionType.getContentType());}
/** * Looks like type handling actually differs for properties,too.* @since 1.7*/public void testSneakyBeanProperties()throws Exception {ObjectMapper mapper=new ObjectMapper();StringLongMapBean bean=mapper.readValue("{\"value\":{\"a\":123}}",StringLongMapBean.class);assertNotNull(bean);Map<String,Long> map=bean.value;assertEquals(1,map.size());assertEquals(Long.valueOf(123),map.get("a"));StringListBean bean2=mapper.readValue("{\"value\":[\"...\"]}",StringListBean.class);assertNotNull(bean2);List<String> list=bean2.value;assertSame(GenericList.class,list.getClass());assertEquals(1,list.size());assertEquals("...",list.get(0));}
public void testAtomicArrayRefParameters(){TypeFactory tf=TypeFactory.defaultInstance();JavaType type=tf.constructType(new TypeReference<AtomicReference<long[]>>(){});JavaType[]params=tf.findTypeParameters(type,AtomicReference.class);assertNotNull(params);assertEquals(1,params.length);assertEquals(tf.constructType(long[].class),params[0]);}
public void testSneakySelfRefs()throws Exception {ObjectMapper mapper=new ObjectMapper();String json=mapper.writeValueAsString(new SneakyBean2());assertEquals("{\"foobar\":null}",json);}
public void testRawCollections(){TypeFactory tf=TypeFactory.defaultInstance();JavaType type=tf.constructRawCollectionType(ArrayList.class);assertTrue(type.isContainerType());assertEquals(TypeFactory.unknownType(),type.getContentType());type=tf.constructRawCollectionLikeType(String.class);assertTrue(type.isCollectionLikeType());assertEquals(TypeFactory.unknownType(),type.getContentType());}
public void testRawMaps(){TypeFactory tf=TypeFactory.defaultInstance();JavaType type=tf.constructRawMapType(HashMap.class);assertTrue(type.isContainerType());assertEquals(TypeFactory.unknownType(),type.getKeyType());assertEquals(TypeFactory.unknownType(),type.getContentType());type=tf.constructRawMapLikeType(String.class);assertTrue(type.isMapLikeType());assertEquals(TypeFactory.unknownType(),type.getKeyType());assertEquals(TypeFactory.unknownType(),type.getContentType());}
public void testMoreSpecificType(){TypeFactory tf=TypeFactory.defaultInstance();JavaType t1=tf.constructCollectionType(Collection.class,Object.class);JavaType t2=tf.constructCollectionType(List.class,Object.class);assertSame(t2,tf.moreSpecificType(t1,t2));assertSame(t2,tf.moreSpecificType(t2,t1));t1=tf.constructType(Double.class);t2=tf.constructType(Number.class);assertSame(t1,tf.moreSpecificType(t1,t2));assertSame(t1,tf.moreSpecificType(t2,t1));t1=tf.constructType(Double.class);t2=tf.constructType(String.class);assertSame(t1,tf.moreSpecificType(t1,t2));assertSame(t2,tf.moreSpecificType(t2,t1));}
public void testMapSerializer()throws IOException {assertEquals("\"{a=b,c=d}\"",MAPPER.writeValueAsString(new PseudoMap("a","b","c","d")));}
public void testMapNullSerialization()throws IOException {ObjectMapper m=new ObjectMapper();Map<String,String> map=new HashMap<String,String>();map.put("a",null);assertEquals("{\"a\":null}",m.writeValueAsString(map));m.configure(SerializationFeature.WRITE_NULL_MAP_VALUES,false);assertEquals("{}",m.writeValueAsString(map));}
public void testMapKeyValueSerialization()throws IOException {Map<String,String> map=new HashMap<String,String>();map.put("a","b");assertEquals("[\"a\"]",MAPPER.writeValueAsString(map.keySet()));assertEquals("[\"b\"]",MAPPER.writeValueAsString(map.values()));map=new TreeMap<String,String>();map.put("c","d");assertEquals("[\"c\"]",MAPPER.writeValueAsString(map.keySet()));assertEquals("[\"d\"]",MAPPER.writeValueAsString(map.values()));map=new ConcurrentHashMap<String,String>();map.put("e","f");assertEquals("[\"e\"]",MAPPER.writeValueAsString(map.keySet()));assertEquals("[\"f\"]",MAPPER.writeValueAsString(map.values()));}
public void testDefaultKeySerializer()throws IOException {ObjectMapper m=new ObjectMapper();m.getSerializerProvider().setDefaultKeySerializer(new DefaultKeySerializer());Map<String,String> map=new HashMap<String,String>();map.put("a","b");assertEquals("{\"DEFAULT:a\":\"b\"}",m.writeValueAsString(map));}
public void testOrderByKey()throws IOException {ObjectMapper m=new ObjectMapper();assertFalse(m.isEnabled(SerializationFeature.ORDER_MAP_ENTRIES_BY_KEYS));LinkedHashMap<String,Integer> map=new LinkedHashMap<String,Integer>();map.put("b",3);map.put("a",6);assertEquals("{\"b\":3,\"a\":6}",m.writeValueAsString(map));assertEquals("{\"a\":6,\"b\":3}",m.writer(SerializationFeature.ORDER_MAP_ENTRIES_BY_KEYS).writeValueAsString(map));}
public void testOverrideClassValid()throws Exception {ObjectMapper m=new ObjectMapper();CollectionHolder result=m.readValue("{\"strings\" :[\"test\"]}",CollectionHolder.class);Collection<String> strs=result._strings;assertEquals(1,strs.size());assertEquals(TreeSet.class,strs.getClass());assertEquals("test",strs.iterator().next());}
public void testOverrideMapValid()throws Exception {ObjectMapper m=new ObjectMapper();MapHolder result=m.readValue("{\"strings\" :{\"a\" : 3}}",MapHolder.class);Map<String,String> strs=result._data;assertEquals(1,strs.size());assertEquals(TreeMap.class,strs.getClass());String value=strs.get("a");assertEquals("3",value);}
public void testOverrideArrayClass()throws Exception {ObjectMapper m=new ObjectMapper();ArrayHolder result=m.readValue("{\"strings\" :[\"test\"]}",ArrayHolder.class);String[]strs=result._strings;assertEquals(1,strs.length);assertEquals(String[].class,strs.getClass());assertEquals("test",strs[0]);}
public void testOverrideClassInvalid()throws Exception {try {BrokenCollectionHolder result=new ObjectMapper().readValue("{\"strings\" :[]}",BrokenCollectionHolder.class);fail("Expected a failure,but got results: " + result);}catch(JsonMappingException jme){verifyException(jme,"is not assignable to");}}
public void testRootInterfaceAs()throws Exception {RootInterface value=new ObjectMapper().readValue("{\"a\":\"abc\" }",RootInterface.class);assertTrue(value instanceof RootInterfaceImpl);assertEquals("abc",value.getA());}
public void testRootInterfaceUsing()throws Exception {RootString value=new ObjectMapper().readValue("\"xxx\"",RootString.class);assertTrue(value instanceof RootString);assertEquals("xxx",value.contents());}
public void testRootListAs()throws Exception {RootMap value=new ObjectMapper().readValue("{\"a\":\"b\"}",RootMap.class);assertEquals(1,value.size());Object v2=value.get("a");assertEquals(RootStringImpl.class,v2.getClass());assertEquals("b",((RootString)v2).contents());}
public void testRootMapAs()throws Exception {RootList value=new ObjectMapper().readValue("[\"c\" ]",RootList.class);assertEquals(1,value.size());Object v2=value.get(0);assertEquals(RootStringImpl.class,v2.getClass());assertEquals("c",((RootString)v2).contents());}
@SuppressWarnings("unchecked")public void testOverrideKeyClassValid()throws Exception {ObjectMapper m=new ObjectMapper();MapKeyHolder result=m.readValue("{\"map\" :{\"xxx\" : \"yyy\"}}",MapKeyHolder.class);Map<StringWrapper,String> map=(Map<StringWrapper,String>)(Map<?,?>)result._map;assertEquals(1,map.size());Map.Entry<StringWrapper,String> en=map.entrySet().iterator().next();StringWrapper key=en.getKey();assertEquals(StringWrapper.class,key.getClass());assertEquals("xxx",key._string);assertEquals("yyy",en.getValue());}
public void testOverrideKeyClassInvalid()throws Exception {try {BrokenMapKeyHolder result=new ObjectMapper().readValue("{\"123\" : \"xxx\" }",BrokenMapKeyHolder.class);fail("Expected a failure,but got results: " + result);}catch(JsonMappingException jme){verifyException(jme,"is not assignable to");}}
@SuppressWarnings("unchecked")public void testOverrideContentClassValid()throws Exception {ObjectMapper m=new ObjectMapper();ListContentHolder result=m.readValue("{\"list\" :[\"abc\"]}",ListContentHolder.class);List<StringWrapper> list=(List<StringWrapper>)result._list;assertEquals(1,list.size());Object value=list.get(0);assertEquals(StringWrapper.class,value.getClass());assertEquals("abc",((StringWrapper)value)._string);}
public void testOverrideArrayContents()throws Exception {ObjectMapper m=new ObjectMapper();ArrayContentHolder result=m.readValue("{\"data\" :[1,2,3]}",ArrayContentHolder.class);Object[]data=result._data;assertEquals(3,data.length);assertEquals(Long[].class,data.getClass());assertEquals(1L,data[0]);assertEquals(2L,data[1]);assertEquals(3L,data[2]);}
public void testOverrideMapContents()throws Exception {ObjectMapper m=new ObjectMapper();MapContentHolder result=m.readValue("{\"map\" :{\"a\" : 9}}",MapContentHolder.class);Map<Object,Object> map=result._map;assertEquals(1,map.size());Object ob=map.values().iterator().next();assertEquals(Integer.class,ob.getClass());assertEquals(Integer.valueOf(9),ob);}
public void testSimpleAutoDetect()throws Exception {ObjectMapper m=new ObjectMapper();SimpleFieldBean result=m.readValue("{\"x\" : -13 }",SimpleFieldBean.class);assertEquals(-13,result.x);assertEquals(0,result.y);}
public void testSimpleAnnotation()throws Exception {ObjectMapper m=new ObjectMapper();SimpleFieldBean2 bean=m.readValue("{\"values\" :[\"x\",\"y\"]}",SimpleFieldBean2.class);String[]values=bean.values;assertNotNull(values);assertEquals(2,values.length);assertEquals("x",values[0]);assertEquals("y",values[1]);}
public void testNoAutoDetect()throws Exception {ObjectMapper m=new ObjectMapper();NoAutoDetectBean bean=m.readValue("{\"z\" : 7 }",NoAutoDetectBean.class);assertEquals(7,bean._z);}
public void testTypeAnnotation()throws Exception {ObjectMapper m=new ObjectMapper();AbstractWrapper w=m.readValue("{\"value\" : \"abc\" }",AbstractWrapper.class);Abstract bean=w.value;assertNotNull(bean);assertEquals(Concrete.class,bean.getClass());assertEquals("abc",((Concrete)bean).value);}
public void testFailureDueToDups()throws Exception {try {writeAndMap(new ObjectMapper(),new DupFieldBean());}catch(JsonMappingException e){verifyException(e,"Multiple fields representing property");}}
public void testFailureDueToDups2()throws Exception {try {writeAndMap(new ObjectMapper(),new DupFieldBean2());}catch(JsonMappingException e){verifyException(e,"Multiple fields representing property");}}
public void testOkFieldOverride()throws Exception {ObjectMapper m=new ObjectMapper();OkDupFieldBean result=m.readValue("{\"x\" : 1,\"y\" : 2 }",OkDupFieldBean.class);assertEquals(1,result.myX);assertEquals(2,result.y);}
public void testUntypedArray()throws Exception {String JSON="[1,null,\"x\",true,2.0 ]";Object[]result=MAPPER.readValue(JSON,Object[].class);assertNotNull(result);assertEquals(5,result.length);assertEquals(Integer.valueOf(1),result[0]);assertNull(result[1]);assertEquals("x",result[2]);assertEquals(Boolean.TRUE,result[3]);assertEquals(Double.valueOf(2.0),result[4]);}
public void testIntegerArray()throws Exception {final int LEN=90000;StringBuilder sb=new StringBuilder();sb.append('[');for (int i=0;i < LEN;++i){if (i > 0){sb.append(',');}sb.append(i);}sb.append(']');Integer[]result=MAPPER.readValue(sb.toString(),Integer[].class);assertNotNull(result);assertEquals(LEN,result.length);for (int i=0;i < LEN;++i){assertEquals(i,result[i].intValue());}}
public void testFromEmptyString()throws Exception {ObjectMapper m=new ObjectMapper();m.configure(DeserializationFeature.ACCEPT_EMPTY_STRING_AS_NULL_OBJECT,true);assertNull(m.readValue(quote(""),Object[].class));assertNull(m.readValue(quote(""),String[].class));assertNull(m.readValue(quote(""),int[].class));}
public void testFromEmptyString2()throws Exception {ObjectMapper m=new ObjectMapper();m.configure(DeserializationFeature.ACCEPT_EMPTY_STRING_AS_NULL_OBJECT,true);m.configure(DeserializationFeature.ACCEPT_SINGLE_VALUE_AS_ARRAY,true);Product p=m.readValue("{\"thelist\":\"\"}",Product.class);assertNotNull(p);assertNull(p.thelist);}
public void testUntypedArrayOfArrays()throws Exception {final String JSON="[[[-0.027512,51.503221],[-0.008497,51.503221],[-0.008497,51.509744],[-0.027512,51.509744]]]";Object result=MAPPER.readValue(JSON,Object.class);assertEquals(ArrayList.class,result.getClass());assertNotNull(result);Object[]array=MAPPER.readValue(JSON,Object[].class);assertNotNull(array);assertEquals(Object[].class,array.getClass());ObjectWrapper w=MAPPER.readValue("{\"wrapped\":" + JSON + "}",ObjectWrapper.class);assertNotNull(w);assertNotNull(w.wrapped);assertEquals(ArrayList.class,w.wrapped.getClass());ObjectArrayWrapper aw=MAPPER.readValue("{\"wrapped\":" + JSON + "}",ObjectArrayWrapper.class);assertNotNull(aw);assertNotNull(aw.wrapped);}
public void testStringArray()throws Exception {final String[]STRS=new String[]{"a","b","abcd","","???","\"quoted\"","lf: \n"};StringWriter sw=new StringWriter();JsonGenerator jg=new JsonFactory().createGenerator(sw);jg.writeStartArray();for(String str : STRS){jg.writeString(str);}jg.writeEndArray();jg.close();String[]result=MAPPER.readValue(sw.toString(),String[].class);assertNotNull(result);assertEquals(STRS.length,result.length);for (int i=0;i < STRS.length;++i){assertEquals(STRS[i],result[i]);}}
public void testCharArray()throws Exception {final String TEST_STR="Let's just test it? Ok!";char[]result=MAPPER.readValue("\"" + TEST_STR + "\"",char[].class);assertEquals(TEST_STR,new String(result));result=MAPPER.readValue("[\"a\",\"b\",\"c\"]",char[].class);assertEquals("abc",new String(result));}
public void testBooleanArray()throws Exception {boolean[]result=MAPPER.readValue("[true,false,false ]",boolean[].class);assertNotNull(result);assertEquals(3,result.length);assertTrue(result[0]);assertFalse(result[1]);assertFalse(result[2]);}
public void testByteArrayAsNumbers()throws Exception {final int LEN=37000;StringBuilder sb=new StringBuilder();sb.append('[');for (int i=0;i < LEN;++i){int value=i - 128;sb.append((value < 256)? value : (value & 0x7F));sb.append(',');}sb.append("0]");byte[]result=MAPPER.readValue(sb.toString(),byte[].class);assertNotNull(result);assertEquals(LEN + 1,result.length);for (int i=0;i < LEN;++i){int value=i - 128;byte exp=(byte)((value < 256)? value : (value & 0x7F));if (exp != result[i]){fail("At offset #" + i + " ("+ result.length+ "),expected "+ exp+ ",got "+ result[i]);}assertEquals(exp,result[i]);}assertEquals(0,result[LEN]);}
public void testByteArrayAsBase64()throws Exception {JsonFactory jf=new JsonFactory();StringWriter sw=new StringWriter();int LEN=9000;byte[]TEST=new byte[LEN];for (int i=0;i < LEN;++i){TEST[i]=(byte)i;}JsonGenerator jg=jf.createGenerator(sw);jg.writeBinary(TEST);jg.close();String inputData=sw.toString();byte[]result=MAPPER.readValue(inputData,byte[].class);assertNotNull(result);assertArrayEquals(TEST,result);}
/** * And then bit more challenging case;let's try decoding multiple byte arrays from an array...*/public void testByteArraysAsBase64()throws Exception {JsonFactory jf=new JsonFactory();StringWriter sw=new StringWriter(1000);final int entryCount=15;JsonGenerator jg=jf.createGenerator(sw);jg.writeStartArray();byte[][]entries=new byte[entryCount][];for (int i=0;i < entryCount;++i){byte[]b=new byte[1000 - i * 20];for (int x=0;x < b.length;++x){b[x]=(byte)(i + x);}entries[i]=b;jg.writeBinary(b);}jg.writeEndArray();jg.close();String inputData=sw.toString();byte[][]result=MAPPER.readValue(inputData,byte[][].class);assertNotNull(result);assertEquals(entryCount,result.length);for (int i=0;i < entryCount;++i){byte[]b=result[i];assertArrayEquals("Comparing entry #" + i + "/"+ entryCount,entries[i],b);}}
public void testByteArraysWith763()throws Exception {String[]input=new String[]{"YQ==","Yg==","Yw=="};byte[][]data=MAPPER.convertValue(input,byte[][].class);assertEquals("a",new String(data[0],"US-ASCII"));assertEquals("b",new String(data[1],"US-ASCII"));assertEquals("c",new String(data[2],"US-ASCII"));}
public void testShortArray()throws Exception {final int LEN=31001;StringBuilder sb=new StringBuilder();sb.append('[');for (int i=0;i < LEN;++i){if (i > 0){sb.append(',');}sb.append(i);}sb.append(']');short[]result=MAPPER.readValue(sb.toString(),short[].class);assertNotNull(result);assertEquals(LEN,result.length);for (int i=0;i < LEN;++i){short exp=(short)i;assertEquals(exp,result[i]);}}
public void testIntArray()throws Exception {final int LEN=70000;StringBuilder sb=new StringBuilder();sb.append('[');for (int i=0;i < LEN;++i){if (i > 0){sb.append(',');}sb.append(-i);}sb.append(']');int[]result=MAPPER.readValue(sb.toString(),int[].class);assertNotNull(result);assertEquals(LEN,result.length);for (int i=0;i < LEN;++i){assertEquals(-i,result[i]);}}
public void testLongArray()throws Exception {final int LEN=12300;StringBuilder sb=new StringBuilder();sb.append('[');for (int i=0;i < LEN;++i){if (i > 0){sb.append(',');}sb.append(i);}sb.append(']');long[]result=MAPPER.readValue(sb.toString(),long[].class);assertNotNull(result);assertEquals(LEN,result.length);for (int i=0;i < LEN;++i){long exp=(long)i;assertEquals(exp,result[i]);}}
public void testDoubleArray()throws Exception {final int LEN=7000;StringBuilder sb=new StringBuilder();sb.append('[');for (int i=0;i < LEN;++i){if (i > 0){sb.append(',');}sb.append(i).append('.').append(i % 10);}sb.append(']');double[]result=MAPPER.readValue(sb.toString(),double[].class);assertNotNull(result);assertEquals(LEN,result.length);for (int i=0;i < LEN;++i){String expStr=String.valueOf(i)+ "." + String.valueOf(i % 10);String actStr=String.valueOf(result[i]);if (!expStr.equals(actStr)){fail("Entry #" + i + "/"+ LEN+ ";exp '"+ expStr+ "',got '"+ actStr+ "'");}}}
public void testFloatArray()throws Exception {final int LEN=7000;StringBuilder sb=new StringBuilder();sb.append('[');for (int i=0;i < LEN;++i){if (i > 0){sb.append(',');}sb.append(i).append('.').append(i % 10);}sb.append(']');float[]result=MAPPER.readValue(sb.toString(),float[].class);assertNotNull(result);assertEquals(LEN,result.length);for (int i=0;i < LEN;++i){String expStr=String.valueOf(i)+ "." + String.valueOf(i % 10);assertEquals(expStr,String.valueOf(result[i]));}}
public void testBeanArray()throws Exception {List<Bean1> src=new ArrayList<Bean1>();List<Bean2> b2=new ArrayList<Bean2>();b2.add(new Bean2("a"));b2.add(new Bean2("foobar"));src.add(new Bean1(1,2,b2));b2=new ArrayList<Bean2>();b2.add(null);src.add(new Bean1(4,5,b2));StringWriter sw=new StringWriter();MAPPER.writeValue(sw,src);List<Bean1> result=MAPPER.readValue(sw.toString(),new TypeReference<List<Bean1>>(){});assertNotNull(result);assertEquals(src,result);}
public void testCustomDeserializers()throws Exception {ObjectMapper mapper=new ObjectMapper();SimpleModule testModule=new SimpleModule("test",Version.unknownVersion());testModule.addDeserializer(NonDeserializable[].class,new CustomNonDeserArrayDeserializer());mapper.registerModule(testModule);NonDeserializable[]result=mapper.readValue("[\"a\"]",NonDeserializable[].class);assertNotNull(result);assertEquals(1,result.length);assertEquals("a",result[0].value);}
public void testSerialization()throws Exception {ObjectMapper m=new ObjectMapper();assertEquals("[{\"doggy\":{\"name\":\"Spot\",\"ageInYears\":3}}]",m.writeValueAsString(new Animal[]{new Dog("Spot",3)}));assertEquals("[{\"MaineCoon\":{\"name\":\"Belzebub\",\"purrs\":true}}]",m.writeValueAsString(new Animal[]{new MaineCoon("Belzebub",true)}));}
public void testRoundTrip()throws Exception {ObjectMapper m=new ObjectMapper();Animal[]input=new Animal[]{new Dog("Odie",7),null,new MaineCoon("Piru",false),new Persian("Khomeini",true)};String json=m.writeValueAsString(input);List<Animal> output=m.readValue(json,TypeFactory.defaultInstance().constructCollectionType(ArrayList.class,Animal.class));assertEquals(input.length,output.size());for (int i=0,len=input.length;i < len;++i){assertEquals("Entry #" + i + " differs,input = '"+ json+ "'",input[i],output.get(i));}}
public void testRoundTripMap()throws Exception {ObjectMapper m=new ObjectMapper();AnimalMap input=new AnimalMap();input.put("venla",new MaineCoon("Venla",true));input.put("ama",new Dog("Amadeus",13));String json=m.writeValueAsString(input);AnimalMap output=m.readValue(json,AnimalMap.class);assertEquals(input,output);}
public void testSimpleSerialization()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.registerSubtypes(ValueBean.class);assertEquals("{\"bean\":{\"value\":11},\"extType\":\"vbean\"}",mapper.writeValueAsString(new ExternalBean(11)));}
public void testImproperExternalIdSerialization()throws Exception {ObjectMapper mapper=new ObjectMapper();assertEquals("{\"extType\":\"funk\",\"i\":3}",mapper.writeValueAsString(new FunkyExternalBean()));}
public void testSimpleDeserialization()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.registerSubtypes(ValueBean.class);ExternalBean result=mapper.readValue("{\"bean\":{\"value\":11},\"extType\":\"vbean\"}",ExternalBean.class);assertNotNull(result);assertNotNull(result.bean);ValueBean vb=(ValueBean)result.bean;assertEquals(11,vb.value);}
public void testMultipleTypeIdsDeserialization()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.registerSubtypes(ValueBean.class);String json=mapper.writeValueAsString(new ExternalBean3(3));ExternalBean3 result=mapper.readValue(json,ExternalBean3.class);assertNotNull(result);assertNotNull(result.value1);assertNotNull(result.value2);assertNotNull(result.value3);assertEquals(3,((ValueBean)result.value1).value);assertEquals(4,((ValueBean)result.value2).value);assertEquals(5,((ValueBean)result.value3).value);assertEquals(3,result.foo);}
public void testExternalTypeWithCreator()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.registerSubtypes(ValueBean.class);String json=mapper.writeValueAsString(new ExternalBeanWithCreator(7));ExternalBeanWithCreator result=mapper.readValue(json,ExternalBeanWithCreator.class);assertNotNull(result);assertNotNull(result.value);assertEquals(7,((ValueBean)result.value).value);assertEquals(7,result.foo);}
public void testImproperExternalIdDeserialization()throws Exception {FunkyExternalBean result=MAPPER.readValue("{\"extType\":\"funk\",\"i\":3}",FunkyExternalBean.class);assertNotNull(result);assertEquals(3,result.i);}
public void testIssue798()throws Exception {Base base=new Derived1("derived1 prop val","base prop val");BaseContainer baseContainer=new BaseContainer("bc prop val",base);String generatedJson=MAPPER.writeValueAsString(baseContainer);BaseContainer baseContainer2=MAPPER.readValue(generatedJson,BaseContainer.class);assertEquals("bc prop val",baseContainer.getBaseContainerProperty());Base b=baseContainer2.getBase();assertNotNull(b);if (b.getClass()!= Derived1.class){fail("Should have type Derived1,was " + b.getClass().getName());}Derived1 derived1=(Derived1)b;assertEquals("base prop val",derived1.getBaseProperty());assertEquals("derived1 prop val",derived1.getDerived1Property());}
public void testIssue831()throws Exception {final String JSON="{\"petType\": \"dog\",\n" + "\"pet\":{\"name\": \"Pluto\" }\n}";House831 result=MAPPER.readValue(JSON,House831.class);assertNotNull(result);assertNotNull(result.pet);assertSame(Dog.class,result.pet.getClass());assertEquals("dog",result.petType);}
public void testWithScalar118()throws Exception {ExternalTypeWithNonPOJO input=new ExternalTypeWithNonPOJO(new java.util.Date(123L));String json=MAPPER.writeValueAsString(input);assertNotNull(json);ExternalTypeWithNonPOJO result=MAPPER.readValue(json,ExternalTypeWithNonPOJO.class);assertNotNull(result.value);assertTrue(result.value instanceof java.util.Date);}
public void testWithNaturalScalar118()throws Exception {ExternalTypeWithNonPOJO input=new ExternalTypeWithNonPOJO(Integer.valueOf(13));String json=MAPPER.writeValueAsString(input);assertNotNull(json);ExternalTypeWithNonPOJO result=MAPPER.readValue(json,ExternalTypeWithNonPOJO.class);assertNotNull(result.value);assertTrue(result.value instanceof Integer);input=new ExternalTypeWithNonPOJO(Boolean.TRUE);json=MAPPER.writeValueAsString(input);assertNotNull(json);result=MAPPER.readValue(json,ExternalTypeWithNonPOJO.class);assertNotNull(result.value);assertTrue(result.value instanceof Boolean);input=new ExternalTypeWithNonPOJO("foobar");json=MAPPER.writeValueAsString(input);assertNotNull(json);result=MAPPER.readValue(json,ExternalTypeWithNonPOJO.class);assertNotNull(result.value);assertTrue(result.value instanceof String);assertEquals("foobar",result.value);}
public void testWithAsValue()throws Exception {ExternalTypeWithNonPOJO input=new ExternalTypeWithNonPOJO(new AsValueThingy(12345L));String json=MAPPER.writeValueAsString(input);assertNotNull(json);assertEquals("{\"value\":12345,\"type\":\"date\"}",json);ExternalTypeWithNonPOJO result=MAPPER.readValue(json,ExternalTypeWithNonPOJO.class);assertNotNull(result);assertNotNull(result.value);assertEquals(Date.class,result.value.getClass());assertEquals(12345L,((Date)result.value).getTime());}
public void testNullXform()throws Exception {assertNull(mapper.convertValue(null,Integer.class));assertNull(mapper.convertValue(null,String.class));assertNull(mapper.convertValue(null,byte[].class));}
/** * Tests to verify that primitive number arrays round-trip correctly,i.e. type -> type gives equal (although not necessarily same)output*/public void testArrayIdentityTransforms()throws Exception {verifyByteArrayConversion(bytes(),byte[].class);verifyShortArrayConversion(shorts(),short[].class);verifyIntArrayConversion(ints(),int[].class);verifyLongArrayConversion(longs(),long[].class);verifyFloatArrayConversion(floats(),float[].class);verifyDoubleArrayConversion(doubles(),float[].class);}
public void testByteArrayFrom()throws Exception {byte[]data=_convert("c3VyZS4=",byte[].class);byte[]exp="sure.".getBytes("Ascii");verifyIntegralArrays(exp,data,exp.length);}
public void testShortArrayToX()throws Exception {short[]data=shorts();verifyShortArrayConversion(data,byte[].class);verifyShortArrayConversion(data,int[].class);verifyShortArrayConversion(data,long[].class);}
public void testIntArrayToX()throws Exception {int[]data=ints();verifyIntArrayConversion(data,byte[].class);verifyIntArrayConversion(data,short[].class);verifyIntArrayConversion(data,long[].class);List<Number> expNums=_numberList(data,data.length);List<Integer> actNums=mapper.convertValue(data,new TypeReference<List<Integer>>(){});assertEquals(expNums,actNums);}
public void testLongArrayToX()throws Exception {long[]data=longs();verifyLongArrayConversion(data,byte[].class);verifyLongArrayConversion(data,short[].class);verifyLongArrayConversion(data,int[].class);List<Number> expNums=_numberList(data,data.length);List<Long> actNums=mapper.convertValue(data,new TypeReference<List<Long>>(){});assertEquals(expNums,actNums);}
public void testOverflows(){try {mapper.convertValue(new int[]{1000},byte[].class);}catch(IllegalArgumentException e){verifyException(e,OVERFLOW_MSG_BYTE);}try {mapper.convertValue(new int[]{-99999},short[].class);}catch(IllegalArgumentException e){verifyException(e,OVERFLOW_MSG);}try {mapper.convertValue(new long[]{Long.MAX_VALUE},int[].class);}catch(IllegalArgumentException e){verifyException(e,OVERFLOW_MSG);}BigInteger biggie=BigInteger.valueOf(Long.MAX_VALUE);biggie.add(BigInteger.ONE);List<BigInteger> l=new ArrayList<BigInteger>();l.add(biggie);try {mapper.convertValue(l,int[].class);}catch(IllegalArgumentException e){verifyException(e,OVERFLOW_MSG);}}
public void testRootViaMapper()throws Exception {ObjectMapper mapper=rootMapper();String json=mapper.writeValueAsString(new Bean());assertEquals("{\"rudy\":{\"a\":3}}",json);Bean bean=mapper.readValue(json,Bean.class);assertNotNull(bean);json=mapper.writeValueAsString(new RootBeanWithEmpty());assertEquals("{\"RootBeanWithEmpty\":{\"a\":2}}",json);RootBeanWithEmpty bean2=mapper.readValue(json,RootBeanWithEmpty.class);assertNotNull(bean2);assertEquals(2,bean2.a);}
public void testRootViaWriterAndReader()throws Exception {ObjectMapper mapper=rootMapper();String json=mapper.writer().writeValueAsString(new Bean());assertEquals("{\"rudy\":{\"a\":3}}",json);Bean bean=mapper.reader(Bean.class).readValue(json);assertNotNull(bean);}
public void testReconfiguringOfWrapping()throws Exception {ObjectMapper mapper=new ObjectMapper();final Bean input=new Bean();String jsonUnwrapped=mapper.writeValueAsString(input);assertEquals("{\"a\":3}",jsonUnwrapped);String jsonWrapped=mapper.writer(SerializationFeature.WRAP_ROOT_VALUE).writeValueAsString(input);assertEquals("{\"rudy\":{\"a\":3}}",jsonWrapped);Bean result=mapper.readValue(jsonUnwrapped,Bean.class);assertNotNull(result);try {result=mapper.reader(Bean.class).with(DeserializationFeature.UNWRAP_ROOT_VALUE).readValue(jsonUnwrapped);fail("Should have failed");}catch(JsonMappingException e){verifyException(e,"Root name 'a'");}result=mapper.reader(Bean.class).with(DeserializationFeature.UNWRAP_ROOT_VALUE).readValue(jsonWrapped);assertNotNull(result);}
public void testRootUsingExplicitConfig()throws Exception {ObjectMapper mapper=new ObjectMapper();ObjectWriter writer=mapper.writer().withRootName("wrapper");String json=writer.writeValueAsString(new Bean());assertEquals("{\"wrapper\":{\"a\":3}}",json);ObjectReader reader=mapper.reader(Bean.class).withRootName("wrapper");Bean bean=reader.readValue(json);assertNotNull(bean);ObjectMapper wrapping=rootMapper();json=wrapping.writer().withRootName("something").writeValueAsString(new Bean());assertEquals("{\"something\":{\"a\":3}}",json);json=wrapping.writer().withRootName("").writeValueAsString(new Bean());assertEquals("{\"a\":3}",json);bean=wrapping.reader(Bean.class).withRootName("").readValue(json);assertNotNull(bean);}
public void testStaticFields()throws Exception {ObjectMapper m=new ObjectMapper();Map<String,Object> result=writeAndMap(m,new FieldBean());assertEquals(1,result.size());assertEquals(Integer.valueOf(1),result.get("x"));}
public void testStaticMethods()throws Exception {ObjectMapper m=new ObjectMapper();Map<String,Object> result=writeAndMap(m,new GetterBean());assertEquals(1,result.size());assertEquals(Integer.valueOf(3),result.get("x"));}
public void testClassAnnotationSimple()throws Exception {String json=objectWriter().writeValueAsString(new ConvertingBean(1,2));assertEquals("[1,2]",json);}
public void testClassAnnotationForLists()throws Exception {String json=objectWriter().writeValueAsString(new ConvertingBeanContainer(new ConvertingBean(1,2),new ConvertingBean(3,4)));assertEquals("{\"values\":[[1,2],[3,4]]}",json);}
public void testPropertyAnnotationSimple()throws Exception {String json=objectWriter().writeValueAsString(new PointWrapper(3,4));assertEquals("{\"value\":[3,4]}",json);}
public void testPropertyAnnotationForArrays()throws Exception {String json=objectWriter().writeValueAsString(new PointListWrapperArray(4,5));assertEquals("{\"values\":[[4,5],[5,4]]}",json);}
public void testPropertyAnnotationForLists()throws Exception {String json=objectWriter().writeValueAsString(new PointListWrapperList(7,8));assertEquals("{\"values\":[[7,8],[8,7]]}",json);}
public void testPropertyAnnotationForMaps()throws Exception {String json=objectWriter().writeValueAsString(new PointListWrapperMap("a",1,2));assertEquals("{\"values\":{\"a\":[1,2]}}",json);}
public void testFindExplicit()throws JsonMappingException {ObjectMapper mapper=new ObjectMapper();SerializationConfig config=mapper.getSerializationConfig();SerializerFactory f=new BeanSerializerFactory(null);DefaultSerializerProvider prov=new DefaultSerializerProvider.Impl().createInstance(config,f);assertNotNull(prov.findKeySerializer(mapper.constructType(String.class),null));assertNotNull(prov.getDefaultNullKeySerializer());assertNotNull(prov.getDefaultNullValueSerializer());assertNotNull(prov.getUnknownTypeSerializer(getClass()));assertTrue(prov.createInstance(config,f).hasSerializerFor(String.class));assertTrue(prov.createInstance(config,f).hasSerializerFor(String.class));assertTrue(prov.createInstance(config,f).hasSerializerFor(MyBean.class));assertTrue(prov.createInstance(config,f).hasSerializerFor(MyBean.class));}
public void testCustomRootNulls()throws Exception {ObjectMapper mapper=new ObjectMapper();SimpleModule module=new SimpleModule("test",Version.unknownVersion());module.addDeserializer(String.class,new FunnyNullDeserializer());mapper.registerModule(module);String str=mapper.readValue("null",String.class);assertNotNull(str);assertEquals("funny",str);ObjectReader reader=mapper.reader(String.class);str=reader.readValue("null");assertNotNull(str);assertEquals("funny",str);}
public void testFormat(){String result=df.format(date);assertEquals("2007-08-13T19:51:23Z",result);}
public void testParse()throws Exception {Date result=df.parse("2007-08-13T19:51:23Z");assertEquals(date,result);}
public void testCloneObject()throws Exception {DateFormat clone=(DateFormat)df.clone();assertSame(df,clone);}
/** * Unit test that verifies that by default all exceptions except for JsonMappingException are caught and wrapped.*/public void testCatchAndRethrow()throws Exception {ObjectMapper mapper=new ObjectMapper();SimpleModule module=new SimpleModule("test-exceptions",Version.unknownVersion());module.addSerializer(Bean.class,new SerializerWithErrors());mapper.registerModule(module);try {StringWriter sw=new StringWriter();Bean[]b={new Bean()};List<Bean[]> l=new ArrayList<Bean[]>();l.add(b);mapper.writeValue(sw,l);fail("Should have gotten an exception");}catch(IOException e){verifyException(e,"test string");Throwable root=e.getCause();assertNotNull(root);if (!(root instanceof IllegalArgumentException)){fail("Wrapped exception not IAE,but " + root.getClass());}}}
/** * Unit test for verifying that regular IOExceptions are not wrapped but are passed through as is.*/public void testExceptionWithSimpleMapper()throws Exception {ObjectMapper mapper=new ObjectMapper();try {BrokenStringWriter sw=new BrokenStringWriter("TEST");mapper.writeValue(sw,createLongObject());fail("Should have gotten an exception");}catch(IOException e){verifyException(e,IOException.class,"TEST");}}
public void testExceptionWithMapperAndGenerator()throws Exception {ObjectMapper mapper=new ObjectMapper();JsonFactory f=new MappingJsonFactory();BrokenStringWriter sw=new BrokenStringWriter("TEST");JsonGenerator jg=f.createGenerator(sw);try {mapper.writeValue(jg,createLongObject());fail("Should have gotten an exception");}catch(IOException e){verifyException(e,IOException.class,"TEST");}}
public void testExceptionWithGeneratorMapping()throws Exception {JsonFactory f=new MappingJsonFactory();JsonGenerator jg=f.createGenerator(new BrokenStringWriter("TEST"));try {jg.writeObject(createLongObject());fail("Should have gotten an exception");}catch(Exception e){verifyException(e,IOException.class,"TEST");}}
public void testDeserializerResolution()throws Exception {final String JSON="{\"value\":42}";for (int i=0;i < 5;++i){final ObjectMapper mapper=new ObjectMapper();Runnable r=new Runnable(){@Override public void run(){try {mapper.readValue(JSON,Bean.class);}catch(Exception e){}}};Thread t=new Thread(r);t.start();Thread.sleep(10L);Bean b=mapper.readValue(JSON,Bean.class);assertEquals(13,b.value);t.join();}}
public void testViaConstructor()throws Exception {ObjectMapper m=new ObjectMapper();ConstructorFromMap result=m.readValue("{\"x\":1,\"y\" : \"abc\" }",ConstructorFromMap.class);assertEquals(1,result._x);assertEquals("abc",result._y);}
public void testViaFactory()throws Exception {ObjectMapper m=new ObjectMapper();FactoryFromPoint result=m.readValue("{\"x\" : 3,\"y\" : 4 }",FactoryFromPoint.class);assertEquals(3,result._x);assertEquals(4,result._y);}
public void testViaFactoryUsingString()throws Exception {ObjectMapper m=new ObjectMapper();FactoryFromDecimalString result=m.readValue("\"12.57\"",FactoryFromDecimalString.class);assertNotNull(result);assertEquals(12,result._value);}
public void testEnumIndexes(){int max=0;for(SerializationFeature f : SerializationFeature.values()){max=Math.max(max,f.ordinal());}if (max >= 31){fail("Max number of SerializationFeature enums reached: " + max);}}
public void testDefaults(){SerializationConfig cfg=MAPPER.getSerializationConfig();assertTrue(cfg.isEnabled(MapperFeature.USE_ANNOTATIONS));assertTrue(cfg.isEnabled(MapperFeature.AUTO_DETECT_GETTERS));assertTrue(cfg.isEnabled(MapperFeature.CAN_OVERRIDE_ACCESS_MODIFIERS));assertTrue(cfg.isEnabled(SerializationFeature.WRITE_DATES_AS_TIMESTAMPS));assertFalse(cfg.isEnabled(SerializationFeature.INDENT_OUTPUT));assertFalse(cfg.isEnabled(MapperFeature.USE_STATIC_TYPING));assertTrue(cfg.isEnabled(MapperFeature.AUTO_DETECT_IS_GETTERS));assertTrue(cfg.isEnabled(SerializationFeature.FAIL_ON_EMPTY_BEANS));assertTrue(cfg.isEnabled(MapperFeature.DEFAULT_VIEW_INCLUSION));}
public void testOverrideIntrospectors(){SerializationConfig cfg=MAPPER.getSerializationConfig();cfg=cfg.with((ClassIntrospector)null);cfg=cfg.with((AnnotationIntrospector)null);assertNull(cfg.getAnnotationIntrospector());}
public void testMisc(){ObjectMapper m=new ObjectMapper();m.setDateFormat(null);assertNotNull(m.getSerializationConfig().toString());}
public void testIndentation()throws Exception {Map<String,Integer> map=new HashMap<String,Integer>();map.put("a",Integer.valueOf(2));String result=MAPPER.writer().with(SerializationFeature.INDENT_OUTPUT).writeValueAsString(map);String lf=getLF();assertEquals("{" + lf + "  \"a\" : 2"+ lf+ "}",result);}
public void testAnnotationsDisabled()throws Exception {assertTrue(MAPPER.isEnabled(MapperFeature.USE_ANNOTATIONS));Map<String,Object> result=writeAndMap(MAPPER,new AnnoBean());assertEquals(2,result.size());ObjectMapper m2=new ObjectMapper();m2.configure(MapperFeature.USE_ANNOTATIONS,false);result=writeAndMap(m2,new AnnoBean());assertEquals(1,result.size());}
/** * Test for verifying working of [JACKSON-191]*/public void testProviderConfig()throws Exception {ObjectMapper mapper=new ObjectMapper();DefaultSerializerProvider prov=(DefaultSerializerProvider)mapper.getSerializerProvider();assertEquals(0,prov.cachedSerializersCount());Map<String,Object> result=this.writeAndMap(mapper,new AnnoBean());assertEquals(2,result.size());assertEquals(Integer.valueOf(1),result.get("x"));assertEquals(Integer.valueOf(2),result.get("y"));int count=prov.cachedSerializersCount();if (count < 2){fail("Should have at least 2 cached serializers,got " + count);}prov.flushCachedSerializers();assertEquals(0,prov.cachedSerializersCount());}
public void testIndentWithPassedGenerator()throws Exception {Indentable input=new Indentable();assertEquals("{\"a\":3}",MAPPER.writeValueAsString(input));String LF=getLF();String INDENTED="{" + LF + "  \"a\" : 3"+ LF+ "}";final ObjectWriter indentWriter=MAPPER.writer().with(SerializationFeature.INDENT_OUTPUT);assertEquals(INDENTED,indentWriter.writeValueAsString(input));StringWriter sw=new StringWriter();JsonGenerator jgen=MAPPER.getFactory().createGenerator(sw);indentWriter.writeValue(jgen,input);jgen.close();assertEquals(INDENTED,sw.toString());sw=new StringWriter();ObjectMapper m2=new ObjectMapper();m2.enable(SerializationFeature.INDENT_OUTPUT);jgen=m2.getFactory().createGenerator(sw);m2.writeValue(jgen,input);jgen.close();assertEquals(INDENTED,sw.toString());}
public void testNoAccessOverrides()throws Exception {ObjectMapper m=new ObjectMapper();m.disable(MapperFeature.CAN_OVERRIDE_ACCESS_MODIFIERS);assertEquals("{\"x\":1}",m.writeValueAsString(new SimpleBean()));}
/** * Related to issues [JACKSON-155],[#170].*/public void testFile()throws Exception {File src=new File("/test").getAbsoluteFile();String abs=src.getAbsolutePath();String json=mapper.writeValueAsString(abs);File result=mapper.readValue(json,File.class);assertEquals(abs,result.getAbsolutePath());final ObjectMapper mapper2=new ObjectMapper();mapper2.setVisibility(PropertyAccessor.CREATOR,Visibility.NONE);result=mapper2.readValue(json,File.class);assertEquals(abs,result.getAbsolutePath());}
public void testRegexps()throws IOException {final String PATTERN_STR="abc:\\s?(\\d+)";Pattern exp=Pattern.compile(PATTERN_STR);String json=mapper.writeValueAsString(exp);Pattern result=mapper.readValue(json,Pattern.class);assertEquals(exp.pattern(),result.pattern());}
public void testCurrency()throws IOException {Currency usd=Currency.getInstance("USD");assertEquals(usd,new ObjectMapper().readValue(quote("USD"),Currency.class));}
/** * Test for [JACKSON-419]*/public void testLocale()throws IOException {assertEquals(new Locale("en"),mapper.readValue(quote("en"),Locale.class));assertEquals(new Locale("es","ES"),mapper.readValue(quote("es_ES"),Locale.class));assertEquals(new Locale("FI","fi","savo"),mapper.readValue(quote("fi_FI_savo"),Locale.class));}
/** * Test for [JACKSON-420](add DeserializationConfig.FAIL_ON_NULL_FOR_PRIMITIVES)*/public void testNullForPrimitives()throws IOException {PrimitivesBean bean=mapper.readValue("{\"intValue\":null,\"booleanValue\":null,\"doubleValue\":null}",PrimitivesBean.class);assertNotNull(bean);assertEquals(0,bean.intValue);assertEquals(false,bean.booleanValue);assertEquals(0.0,bean.doubleValue);bean=mapper.readValue("{\"byteValue\":null,\"longValue\":null,\"floatValue\":null}",PrimitivesBean.class);assertNotNull(bean);assertEquals((byte)0,bean.byteValue);assertEquals(0L,bean.longValue);assertEquals(0.0f,bean.floatValue);final ObjectMapper mapper2=new ObjectMapper();mapper2.configure(DeserializationFeature.FAIL_ON_NULL_FOR_PRIMITIVES,true);try {mapper2.readValue("{\"booleanValue\":null}",PrimitivesBean.class);fail("Expected failure for boolean + null");}catch(JsonMappingException e){verifyException(e,"Can not map JSON null into type boolean");}try {mapper2.readValue("{\"byteValue\":null}",PrimitivesBean.class);fail("Expected failure for byte + null");}catch(JsonMappingException e){verifyException(e,"Can not map JSON null into type byte");}try {mapper2.readValue("{\"charValue\":null}",PrimitivesBean.class);fail("Expected failure for char + null");}catch(JsonMappingException e){verifyException(e,"Can not map JSON null into type char");}try {mapper2.readValue("{\"shortValue\":null}",PrimitivesBean.class);fail("Expected failure for short + null");}catch(JsonMappingException e){verifyException(e,"Can not map JSON null into type short");}try {mapper2.readValue("{\"intValue\":null}",PrimitivesBean.class);fail("Expected failure for int + null");}catch(JsonMappingException e){verifyException(e,"Can not map JSON null into type int");}try {mapper2.readValue("{\"longValue\":null}",PrimitivesBean.class);fail("Expected failure for long + null");}catch(JsonMappingException e){verifyException(e,"Can not map JSON null into type long");}try {mapper2.readValue("{\"floatValue\":null}",PrimitivesBean.class);fail("Expected failure for float + null");}catch(JsonMappingException e){verifyException(e,"Can not map JSON null into type float");}try {mapper2.readValue("{\"doubleValue\":null}",PrimitivesBean.class);fail("Expected failure for double + null");}catch(JsonMappingException e){verifyException(e,"Can not map JSON null into type double");}}
/** * Test for [JACKSON-483],allow handling of CharSequence*/public void testCharSequence()throws IOException {CharSequence cs=mapper.readValue("\"abc\"",CharSequence.class);assertEquals(String.class,cs.getClass());assertEquals("abc",cs.toString());}
public void testInetAddress()throws IOException {InetAddress address=mapper.readValue(quote("127.0.0.1"),InetAddress.class);assertEquals("127.0.0.1",address.getHostAddress());final String HOST="www.ning.com";address=mapper.readValue(quote(HOST),InetAddress.class);assertEquals(HOST,address.getHostName());}
public void testClass()throws IOException {ObjectMapper mapper=new ObjectMapper();assertSame(String.class,mapper.readValue(quote("java.lang.String"),Class.class));assertSame(Boolean.TYPE,mapper.readValue(quote("boolean"),Class.class));assertSame(Byte.TYPE,mapper.readValue(quote("byte"),Class.class));assertSame(Short.TYPE,mapper.readValue(quote("short"),Class.class));assertSame(Character.TYPE,mapper.readValue(quote("char"),Class.class));assertSame(Integer.TYPE,mapper.readValue(quote("int"),Class.class));assertSame(Long.TYPE,mapper.readValue(quote("long"),Class.class));assertSame(Float.TYPE,mapper.readValue(quote("float"),Class.class));assertSame(Double.TYPE,mapper.readValue(quote("double"),Class.class));assertSame(Void.TYPE,mapper.readValue(quote("void"),Class.class));}
public void testClassWithParams()throws IOException {String json=mapper.writeValueAsString(new ParamClassBean("Foobar"));ParamClassBean result=mapper.readValue(json,ParamClassBean.class);assertEquals("Foobar",result.name);assertSame(String.class,result.clazz);}
public void testEmptyStringForWrappers()throws IOException {WrappersBean bean;bean=mapper.readValue("{\"booleanValue\":\"\"}",WrappersBean.class);assertNull(bean.booleanValue);bean=mapper.readValue("{\"byteValue\":\"\"}",WrappersBean.class);assertNull(bean.byteValue);bean=mapper.readValue("{\"charValue\":\"\"}",WrappersBean.class);assertNull(bean.charValue);bean=mapper.readValue("{\"shortValue\":\"\"}",WrappersBean.class);assertNull(bean.shortValue);bean=mapper.readValue("{\"intValue\":\"\"}",WrappersBean.class);assertNull(bean.intValue);bean=mapper.readValue("{\"longValue\":\"\"}",WrappersBean.class);assertNull(bean.longValue);bean=mapper.readValue("{\"floatValue\":\"\"}",WrappersBean.class);assertNull(bean.floatValue);bean=mapper.readValue("{\"doubleValue\":\"\"}",WrappersBean.class);assertNull(bean.doubleValue);}
public void testEmptyStringForPrimitives()throws IOException {PrimitivesBean bean;bean=mapper.readValue("{\"booleanValue\":\"\"}",PrimitivesBean.class);assertFalse(bean.booleanValue);bean=mapper.readValue("{\"byteValue\":\"\"}",PrimitivesBean.class);assertEquals((byte)0,bean.byteValue);bean=mapper.readValue("{\"charValue\":\"\"}",PrimitivesBean.class);assertEquals((char)0,bean.charValue);bean=mapper.readValue("{\"shortValue\":\"\"}",PrimitivesBean.class);assertEquals((short)0,bean.shortValue);bean=mapper.readValue("{\"intValue\":\"\"}",PrimitivesBean.class);assertEquals(0,bean.intValue);bean=mapper.readValue("{\"longValue\":\"\"}",PrimitivesBean.class);assertEquals(0L,bean.longValue);bean=mapper.readValue("{\"floatValue\":\"\"}",PrimitivesBean.class);assertEquals(0.0f,bean.floatValue);bean=mapper.readValue("{\"doubleValue\":\"\"}",PrimitivesBean.class);assertEquals(0.0,bean.doubleValue);}
public void testUntypedWithJsonArrays()throws Exception {Object ob=mapper.readValue("[1]",Object.class);assertTrue(ob instanceof List<?>);mapper.configure(DeserializationFeature.USE_JAVA_ARRAY_FOR_JSON_ARRAY,true);ob=mapper.readValue("[1]",Object.class);assertEquals(Object[].class,ob.getClass());}
public void testLongToBoolean()throws Exception {long value=1L + Integer.MAX_VALUE;BooleanBean b=mapper.readValue("{\"primitive\" : " + value + ",\"wrapper\":"+ value+ ",\"ctor\":"+ value+ "}",BooleanBean.class);assertEquals(Boolean.TRUE,b.wrapper);assertTrue(b.primitive);assertEquals(Boolean.TRUE,b.ctor);}
public void testCharset()throws Exception {Charset UTF8=Charset.forName("UTF-8");assertSame(UTF8,mapper.readValue(quote("UTF-8"),Charset.class));}
public void testStackTraceElement()throws Exception {StackTraceElement elem=null;try {throw new IllegalStateException();}catch(Exception e){elem=e.getStackTrace()[0];}String json=mapper.writeValueAsString(elem);StackTraceElement back=mapper.readValue(json,StackTraceElement.class);assertEquals("testStackTraceElement",back.getMethodName());assertEquals(elem.getLineNumber(),back.getLineNumber());assertEquals(elem.getClassName(),back.getClassName());assertEquals(elem.isNativeMethod(),back.isNativeMethod());assertTrue(back.getClassName().endsWith("TestJdkTypes"));assertFalse(back.isNativeMethod());}
public void testIntAsNumber()throws Exception {Number result=new ObjectMapper().readValue(new StringReader(" 123 "),Number.class);assertEquals(Integer.valueOf(123),result);}
public void testLongAsNumber()throws Exception {long exp=1234567890123L;Number result=new ObjectMapper().readValue(String.valueOf(exp),Number.class);assertEquals(Long.valueOf(exp),result);}
public void testBigIntAsNumber()throws Exception {BigInteger biggie=new BigInteger("1234567890123456789012345678901234567890");Number result=new ObjectMapper().readValue(biggie.toString(),Number.class);assertEquals(BigInteger.class,biggie.getClass());assertEquals(biggie,result);}
public void testIntTypeOverride()throws Exception {ObjectMapper m=new ObjectMapper();m.enable(DeserializationFeature.USE_BIG_INTEGER_FOR_INTS);BigInteger exp=BigInteger.valueOf(123L);Number result=m.readValue(new StringReader(" 123 "),Number.class);assertEquals(BigInteger.class,result.getClass());assertEquals(exp,result);m.readValue(new StringReader("123"),Object.class);assertEquals(BigInteger.class,result.getClass());assertEquals(exp,result);}
/** * Related to [JACKSON-72]: by default should wrap floating-point Number as Double*/public void testDoubleAsNumber()throws Exception {Number result=new ObjectMapper().readValue(new StringReader(" 1.0 "),Number.class);assertEquals(Double.valueOf(1.0),result);}
/** * Test for verifying [JACKSON-72].*/public void testFpTypeOverrideSimple()throws Exception {ObjectMapper m=new ObjectMapper();m.enable(DeserializationFeature.USE_BIG_DECIMAL_FOR_FLOATS);BigDecimal dec=new BigDecimal("0.1");Number result=m.readValue(dec.toString(),Number.class);assertEquals(BigDecimal.class,result.getClass());assertEquals(dec,result);Object value=m.readValue(dec.toString(),Object.class);assertEquals(BigDecimal.class,result.getClass());assertEquals(dec,value);}
public void testFpTypeOverrideStructured()throws Exception {ObjectMapper m=new ObjectMapper();BigDecimal dec=new BigDecimal("-19.37");m.enable(DeserializationFeature.USE_BIG_DECIMAL_FOR_FLOATS);@SuppressWarnings("unchecked")List<Object> list=(List<Object>)m.readValue("[" + dec.toString()+ " ]",List.class);assertEquals(1,list.size());Object val=list.get(0);assertEquals(BigDecimal.class,val.getClass());assertEquals(dec,val);Map<?,?> map=m.readValue("{\"a\" : " + dec.toString()+ " }",Map.class);assertEquals(1,map.size());val=map.get("a");assertEquals(BigDecimal.class,val.getClass());assertEquals(dec,val);}
public void testSimpleIgnore()throws Exception {ObjectMapper m=new ObjectMapper();Bean result=m.readValue("{\"x\":3}",Bean.class);assertEquals(3,result._x);}
public void testBundledIgnore()throws Exception {assertEquals("{\"foobar\":13}",MAPPER.writeValueAsString(new Bean()));}
public void testVisibilityBundle()throws Exception {assertEquals("{\"b\":5}",MAPPER.writeValueAsString(new NoAutoDetect()));}
public void testIssue92()throws Exception {assertEquals("{\"_id\":\"abc\"}",MAPPER.writeValueAsString(new Bean92()));}
public void testIOException()throws IOException {IOException ioe=new IOException("TEST");String json=MAPPER.writeValueAsString(ioe);IOException result=MAPPER.readValue(json,IOException.class);assertEquals(ioe.getMessage(),result.getMessage());}
public void testWithCreator()throws IOException {final String MSG="the message";String json=MAPPER.writeValueAsString(new MyException(MSG,3));MyException result=MAPPER.readValue(json,MyException.class);assertEquals(MSG,result.getMessage());assertEquals(3,result.value);assertEquals(1,result.stuff.size());assertEquals(result.getFoo(),result.stuff.get("foo"));}
public void testWithNullMessage()throws IOException {final ObjectMapper mapper=new ObjectMapper();mapper.setSerializationInclusion(JsonInclude.Include.NON_NULL);String json=mapper.writeValueAsString(new IOException((String)null));IOException result=mapper.readValue(json,IOException.class);assertNotNull(result);assertNull(result.getMessage());}
public void testNoArgsException()throws IOException {MyNoArgException exc=MAPPER.readValue("{}",MyNoArgException.class);assertNotNull(exc);}
public void testJDK7SuppressionProperty()throws IOException {Exception exc=MAPPER.readValue("{\"suppressed\":[]}",IOException.class);assertNotNull(exc);}
public void testTypedSerialization()throws Exception {ObjectMapper mapper=new ObjectMapper();String singleJson=mapper.writerWithType(Issue822Interface.class).writeValueAsString(new Issue822Impl());assertEquals("{\"a\":3}",singleJson);}
public void testTypedArrays()throws Exception {ObjectMapper mapper=new ObjectMapper();assertEquals("[{\"a\":3}]",mapper.writerWithType(Issue822Interface[].class).writeValueAsString(new Issue822Interface[]{new Issue822Impl()}));}
public void testTypedLists()throws Exception {ObjectMapper mapper=new ObjectMapper();List<Issue822Interface> list=new ArrayList<Issue822Interface>();list.add(new Issue822Impl());String listJson=mapper.writerWithType(new TypeReference<List<Issue822Interface>>(){}).writeValueAsString(list);assertEquals("[{\"a\":3}]",listJson);}
public void testTypedMaps()throws Exception {ObjectMapper mapper=new ObjectMapper();Map<String,Issue822Interface> map=new HashMap<String,Issue822Interface>();map.put("a",new Issue822Impl());String listJson=mapper.writerWithType(new TypeReference<Map<String,Issue822Interface>>(){}).writeValueAsString(map);assertEquals("{\"a\":{\"a\":3}}",listJson);}
/** * Unit test that verifies that we can mix in @JsonAnySetter annotation,as expected.*/public void testWithAnySetter()throws IOException {ObjectMapper m=new ObjectMapper();m.addMixInAnnotations(BaseClass.class,MixIn.class);BaseClass result=m.readValue("{\"a\" : 3,\"b\" : true }",BaseClass.class);assertNotNull(result);assertEquals(2,result.values.size());assertEquals(Integer.valueOf(3),result.values.get("a"));assertEquals(Boolean.TRUE,result.values.get("b"));}
public void testPropertyWithSubtypes()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.registerSubtypes(SubB.class,SubC.class,SubD.class);String json=mapper.writeValueAsString(new PropertyBean(new SubC()));PropertyBean result=mapper.readValue(json,PropertyBean.class);assertSame(SubC.class,result.value.getClass());}
public void testSubtypesViaModule()throws Exception {ObjectMapper mapper=new ObjectMapper();SimpleModule module=new SimpleModule();module.registerSubtypes(SubB.class,SubC.class,SubD.class);mapper.registerModule(module);String json=mapper.writeValueAsString(new PropertyBean(new SubC()));PropertyBean result=mapper.readValue(json,PropertyBean.class);assertSame(SubC.class,result.value.getClass());}
public void testSerialization()throws Exception {SubB bean=new SubB();ObjectMapper mapper=new ObjectMapper();assertEquals("{\"@type\":\"TypeB\",\"b\":1}",mapper.writeValueAsString(bean));mapper=new ObjectMapper();mapper.registerSubtypes(new NamedType(SubB.class,"typeB"));assertEquals("{\"@type\":\"typeB\",\"b\":1}",mapper.writeValueAsString(bean));assertEquals("{\"@type\":\"TestSubtypes$SubD\",\"d\":0}",mapper.writeValueAsString(new SubD()));}
public void testDeserializationNonNamed()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.registerSubtypes(SubC.class);SuperType bean=mapper.readValue("{\"@type\":\"TestSubtypes$SubC\",\"c\":1}",SuperType.class);assertSame(SubC.class,bean.getClass());assertEquals(1,((SubC)bean).c);}
public void testDeserializatioNamed()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.registerSubtypes(SubB.class);mapper.registerSubtypes(new NamedType(SubD.class,"TypeD"));SuperType bean=mapper.readValue("{\"@type\":\"TypeB\",\"b\":13}",SuperType.class);assertSame(SubB.class,bean.getClass());assertEquals(13,((SubB)bean).b);bean=mapper.readValue("{\"@type\":\"TypeD\",\"d\":-4}",SuperType.class);assertSame(SubD.class,bean.getClass());assertEquals(-4,((SubD)bean).d);}
public void testEmptyBean()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.configure(SerializationFeature.FAIL_ON_EMPTY_BEANS,true);String json=mapper.writeValueAsString(new EmptyBean());assertEquals("{\"@type\":\"TestSubtypes$EmptyBean\"}",json);mapper=new ObjectMapper();mapper.configure(SerializationFeature.FAIL_ON_EMPTY_BEANS,false);json=mapper.writeValueAsString(new EmptyBean());assertEquals("{\"@type\":\"TestSubtypes$EmptyBean\"}",json);mapper=new ObjectMapper();mapper.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);mapper.configure(SerializationFeature.FAIL_ON_EMPTY_BEANS,false);json=mapper.writeValueAsString(new EmptyNonFinal());assertEquals("[\"com.fasterxml.jackson.databind.jsontype.TestSubtypes$EmptyNonFinal\",{}]",json);}
public void testDefaultImpl()throws Exception {ObjectMapper mapper=new ObjectMapper();SuperTypeWithDefault bean=mapper.readValue("{\"a\":13}",SuperTypeWithDefault.class);assertEquals(DefaultImpl.class,bean.getClass());assertEquals(13,((DefaultImpl)bean).a);bean=mapper.readValue("{\"a\":14,\"#type\":\"foobar\"}",SuperTypeWithDefault.class);assertEquals(DefaultImpl.class,bean.getClass());assertEquals(14,((DefaultImpl)bean).a);bean=mapper.readValue("{\"#type\":\"foobar\",\"a\":15}",SuperTypeWithDefault.class);assertEquals(DefaultImpl.class,bean.getClass());assertEquals(15,((DefaultImpl)bean).a);bean=mapper.readValue("{\"#type\":\"foobar\"}",SuperTypeWithDefault.class);assertEquals(DefaultImpl.class,bean.getClass());assertEquals(0,((DefaultImpl)bean).a);}
public void testDefaultImplViaModule()throws Exception {final String JSON="{\"a\":123}";ObjectMapper mapper=new ObjectMapper();try {mapper.readValue(JSON,SuperTypeWithoutDefault.class);fail("Expected an exception");}catch(JsonMappingException e){verifyException(e,"missing property");}mapper=new ObjectMapper();SimpleModule module=new SimpleModule("test",Version.unknownVersion());module.addAbstractTypeMapping(SuperTypeWithoutDefault.class,DefaultImpl505.class);mapper.registerModule(module);SuperTypeWithoutDefault bean=mapper.readValue(JSON,SuperTypeWithoutDefault.class);assertNotNull(bean);assertEquals(DefaultImpl505.class,bean.getClass());assertEquals(123,((DefaultImpl505)bean).a);bean=mapper.readValue("{\"#type\":\"foobar\"}",SuperTypeWithoutDefault.class);assertEquals(DefaultImpl505.class,bean.getClass());assertEquals(0,((DefaultImpl505)bean).a);}
public void testFromArray()throws Exception {ObjectMapper mapper=new ObjectMapper();ArrayNode root=mapper.createArrayNode();root.add(TEXT1);root.add(3);ObjectNode obj=root.addObject();obj.put(FIELD1,true);obj.putArray(FIELD2);root.add(false);for (int i=0;i < 2;++i){StringWriter sw=new StringWriter();if (i == 0){JsonGenerator gen=new JsonFactory().createGenerator(sw);root.serialize(gen,null);gen.close();}else {mapper.writeValue(sw,root);}verifyFromArray(sw.toString());}verifyFromArray(root.toString());}
public void testFromMap()throws Exception {ObjectMapper mapper=new ObjectMapper();ObjectNode root=mapper.createObjectNode();root.put(FIELD4,TEXT2);root.put(FIELD3,-1);root.putArray(FIELD2);root.put(FIELD1,DOUBLE_VALUE);for (int i=0;i < 2;++i){StringWriter sw=new StringWriter();if (i == 0){JsonGenerator gen=new JsonFactory().createGenerator(sw);root.serialize(gen,null);gen.close();}else {mapper.writeValue(sw,root);}verifyFromMap(sw.toString());}verifyFromMap(root.toString());}
/** * Unit test to check for regression of [JACKSON-18].*/public void testSmallNumbers()throws Exception {ObjectMapper mapper=new ObjectMapper();ArrayNode root=mapper.createArrayNode();for (int i=-20;i <= 20;++i){JsonNode n=root.numberNode(i);root.add(n);assertEquals(String.valueOf(i),n.toString());}for (int type=0;type < 2;++type){StringWriter sw=new StringWriter();if (type == 0){JsonGenerator gen=new JsonFactory().createGenerator(sw);root.serialize(gen,null);gen.close();}else {mapper.writeValue(sw,root);}String doc=sw.toString();JsonParser jp=new JsonFactory().createParser(new StringReader(doc));assertEquals(JsonToken.START_ARRAY,jp.nextToken());for (int i=-20;i <= 20;++i){assertEquals(JsonToken.VALUE_NUMBER_INT,jp.nextToken());assertEquals(i,jp.getIntValue());assertEquals("" + i,jp.getText());}assertEquals(JsonToken.END_ARRAY,jp.nextToken());jp.close();}}
public void testNull()throws Exception {ObjectMapper mapper=new ObjectMapper();StringWriter sw=new StringWriter();mapper.writeValue(sw,NullNode.instance);assertEquals("null",sw.toString());}
public void testBinary()throws Exception {ObjectMapper mapper=new ObjectMapper();final int LENGTH=13045;byte[]data=new byte[LENGTH];for (int i=0;i < LENGTH;++i){data[i]=(byte)i;}StringWriter sw=new StringWriter();mapper.writeValue(sw,BinaryNode.valueOf(data));JsonParser jp=new JsonFactory().createParser(sw.toString());assertToken(JsonToken.VALUE_STRING,jp.nextToken());assertArrayEquals(data,jp.getBinaryValue());jp.close();}
/** * This is an indirect test that should trigger problems if (and only if)underlying parser is advanced beyond the only element array. Basically,although content is invalid,this should be encountered quite yet.*/public void testEagerAdvance()throws IOException {ObjectMapper mapper=new ObjectMapper();JsonParser jp=createParserUsingReader("[1  ");assertToken(JsonToken.START_ARRAY,jp.nextToken());assertToken(JsonToken.VALUE_NUMBER_INT,jp.nextToken());Integer I=mapper.readValue(jp,Integer.class);assertEquals(Integer.valueOf(1),I);try {jp.nextToken();}catch(IOException ioe){verifyException(ioe,"Unexpected end-of-input: expected close marker for ARRAY");}}
public void testSimpleInclusionFilter()throws Exception {ObjectMapper mapper=new ObjectMapper();FilterProvider prov=new SimpleFilterProvider().addFilter("RootFilter",SimpleBeanPropertyFilter.filterOutAllExcept("a"));assertEquals("{\"a\":\"a\"}",mapper.writer(prov).writeValueAsString(new Bean()));mapper=new ObjectMapper();mapper.setFilters(prov);assertEquals("{\"a\":\"a\"}",mapper.writeValueAsString(new Bean()));}
public void testSimpleExclusionFilter()throws Exception {ObjectMapper mapper=new ObjectMapper();FilterProvider prov=new SimpleFilterProvider().addFilter("RootFilter",SimpleBeanPropertyFilter.serializeAllExcept("a"));assertEquals("{\"b\":\"b\"}",mapper.writer(prov).writeValueAsString(new Bean()));}
public void testMissingFilter()throws Exception {ObjectMapper mapper=new ObjectMapper();try {mapper.writeValueAsString(new Bean());fail("Should have failed without configured filter");}catch(JsonMappingException e){verifyException(e,"Can not resolve BeanPropertyFilter with id 'RootFilter'");}SimpleFilterProvider fp=new SimpleFilterProvider().setFailOnUnknownId(false);mapper.setFilters(fp);String json=mapper.writeValueAsString(new Bean());assertEquals("{\"a\":\"a\",\"b\":\"b\"}",json);}
public void testDefaultFilter()throws Exception {ObjectMapper mapper=new ObjectMapper();FilterProvider prov=new SimpleFilterProvider().setDefaultFilter(SimpleBeanPropertyFilter.filterOutAllExcept("b"));assertEquals("{\"b\":\"b\"}",mapper.writer(prov).writeValueAsString(new Bean()));}
public void testIssue89()throws Exception {ObjectMapper mapper=new ObjectMapper();Pod pod=new Pod();pod.username="Bob";pod.userPassword="s3cr3t!";String json=mapper.writeValueAsString(pod);assertEquals("{\"username\":\"Bob\"}",json);Pod pod2=mapper.readValue("{\"username\":\"Bill\",\"user_password\":\"foo!\"}",Pod.class);assertEquals("Bill",pod2.username);assertEquals("foo!",pod2.userPassword);}
public void testVisibleWithProperty()throws Exception {String json=mapper.writeValueAsString(new PropertyBean());assertEquals("{\"type\":\"BaseType\",\"a\":3}",json);PropertyBean result=mapper.readValue(json,PropertyBean.class);assertEquals("BaseType",result.type);result=mapper.readValue("{\"a\":7,\"type\":\"BaseType\"}",PropertyBean.class);assertEquals(7,result.a);assertEquals("BaseType",result.type);}
public void testVisibleWithWrapperArray()throws Exception {String json=mapper.writeValueAsString(new WrapperArrayBean());assertEquals("[\"ArrayType\",{\"a\":1}]",json);WrapperArrayBean result=mapper.readValue(json,WrapperArrayBean.class);assertEquals("ArrayType",result.type);assertEquals(1,result.a);}
public void testVisibleWithWrapperObject()throws Exception {String json=mapper.writeValueAsString(new WrapperObjectBean());assertEquals("{\"ObjectType\":{\"a\":2}}",json);WrapperObjectBean result=mapper.readValue(json,WrapperObjectBean.class);assertEquals("ObjectType",result.type);}
public void testVisibleWithExternalId()throws Exception {String json=mapper.writeValueAsString(new ExternalIdWrapper());ExternalIdWrapper result=mapper.readValue(json,ExternalIdWrapper.class);assertEquals("ExternalType",result.bean.type);assertEquals(2,result.bean.a);}
public void testTypeIdFromProperty()throws Exception {assertEquals("{\"type\":\"SomeType\",\"a\":3}",mapper.writeValueAsString(new TypeIdFromFieldProperty()));}
public void testTypeIdFromArray()throws Exception {assertEquals("[\"SomeType\",{\"a\":3}]",mapper.writeValueAsString(new TypeIdFromFieldArray()));}
public void testTypeIdFromObject()throws Exception {assertEquals("{\"SomeType\":{\"a\":3}}",mapper.writeValueAsString(new TypeIdFromMethodObject()));}
public void testTypeIdFromExternal()throws Exception {String json=mapper.writeValueAsString(new ExternalIdWrapper2());assertEquals("{\"bean\":{\"a\":2},\"type\":\"SomeType\"}",json);}
public void testInvalidMultipleTypeIds()throws Exception {try {mapper.writeValueAsString(new MultipleIds());fail("Should have failed");}catch(JsonMappingException e){verifyException(e,"multiple type ids");}}
public void testWithObjectSimple(){ObjectNode root=mapper.createObjectNode();root.put("a",3);assertEquals(1,root.size());ObjectNode copy=root.deepCopy();assertEquals(1,copy.size());root.put("b",7);assertEquals(2,root.size());assertEquals(1,copy.size());copy.put("c",3);assertEquals(2,root.size());assertEquals(2,copy.size());}
public void testWithArraySimple(){ArrayNode root=mapper.createArrayNode();root.add("a");assertEquals(1,root.size());ArrayNode copy=root.deepCopy();assertEquals(1,copy.size());root.add(7);assertEquals(2,root.size());assertEquals(1,copy.size());copy.add(3);assertEquals(2,root.size());assertEquals(2,copy.size());}
public void testWithNested(){ObjectNode root=mapper.createObjectNode();ObjectNode leafObject=root.putObject("ob");ArrayNode leafArray=root.putArray("arr");assertEquals(2,root.size());leafObject.put("a",3);assertEquals(1,leafObject.size());leafArray.add(true);assertEquals(1,leafArray.size());ObjectNode copy=root.deepCopy();assertNotSame(copy,root);assertEquals(2,copy.size());leafObject.put("x",9);assertEquals(2,leafObject.size());assertEquals(1,copy.get("ob").size());leafArray.add("foobar");assertEquals(2,leafArray.size());assertEquals(1,copy.get("arr").size());((ObjectNode)copy.get("ob")).put("c",3);assertEquals(2,leafObject.size());assertEquals(2,copy.get("ob").size());((ArrayNode)copy.get("arr")).add(13);assertEquals(2,leafArray.size());assertEquals(2,copy.get("arr").size());}
public void testImplicitOrderByCreator()throws Exception {assertEquals("{\"c\":1,\"a\":2,\"b\":0}",serializeAsString(new BeanWithCreator(1,2)));}
public void testExplicitOrder()throws Exception {assertEquals("{\"c\":3,\"a\":1,\"b\":2,\"d\":4}",serializeAsString(new BeanWithOrder(1,2,3,4)));}
public void testAlphabeticOrder()throws Exception {assertEquals("{\"d\":4,\"a\":1,\"b\":2,\"c\":3}",serializeAsString(new SubBeanWithOrder(1,2,3,4)));}
public void testOrderWithMixins()throws Exception {ObjectMapper m=new ObjectMapper();m.addMixInAnnotations(BeanWithOrder.class,OrderMixIn.class);assertEquals("{\"b\":2,\"a\":1,\"c\":3,\"d\":4}",serializeAsString(m,new BeanWithOrder(1,2,3,4)));}
public void testOrderWrt268()throws Exception {assertEquals("{\"a\":\"a\",\"b\":\"b\",\"x\":\"x\",\"z\":\"z\"}",serializeAsString(new BeanFor268()));}
public void testOrderWithFeature()throws Exception {ObjectMapper m=new ObjectMapper();m.configure(MapperFeature.SORT_PROPERTIES_ALPHABETICALLY,true);assertEquals("{\"a\":1,\"b\":2,\"c\":3,\"d\":4}",serializeAsString(m,new BeanFor459()));}
public void testLongStringArray()throws Exception {final int SIZE=40000;StringBuilder sb=new StringBuilder(SIZE * 2);for (int i=0;i < SIZE;++i){sb.append((char)i);}String str=sb.toString();byte[]data=MAPPER.writeValueAsBytes(new String[]{"abc",str,null,str});JsonParser jp=MAPPER.getFactory().createParser(data);assertToken(JsonToken.START_ARRAY,jp.nextToken());assertToken(JsonToken.VALUE_STRING,jp.nextToken());assertEquals("abc",jp.getText());assertToken(JsonToken.VALUE_STRING,jp.nextToken());String actual=jp.getText();assertEquals(str.length(),actual.length());assertEquals(str,actual);assertToken(JsonToken.VALUE_NULL,jp.nextToken());assertToken(JsonToken.VALUE_STRING,jp.nextToken());assertEquals(str,jp.getText());assertToken(JsonToken.END_ARRAY,jp.nextToken());assertNull(jp.nextToken());}
public void testIntArray()throws Exception {StringWriter sw=new StringWriter();MAPPER.writeValue(sw,new int[]{1,2,3,-7});assertEquals("[1,2,3,-7]",sw.toString().trim());}
public void testBigIntArray()throws Exception {final int SIZE=99999;int[]ints=new int[SIZE];for (int i=0;i < ints.length;++i){ints[i]=i;}JsonFactory f=MAPPER.getFactory();for (int round=0;round < 3;++round){byte[]data=MAPPER.writeValueAsBytes(ints);JsonParser jp=f.createParser(data);assertToken(JsonToken.START_ARRAY,jp.nextToken());for (int i=0;i < SIZE;++i){assertToken(JsonToken.VALUE_NUMBER_INT,jp.nextToken());assertEquals(i,jp.getIntValue());}assertToken(JsonToken.END_ARRAY,jp.nextToken());}}
public void testLongArray()throws Exception {StringWriter sw=new StringWriter();MAPPER.writeValue(sw,new long[]{Long.MIN_VALUE,0,Long.MAX_VALUE});assertEquals("[" + Long.MIN_VALUE + ",0,"+ Long.MAX_VALUE+ "]",sw.toString().trim());}
public void testStringArray()throws Exception {StringWriter sw=new StringWriter();MAPPER.writeValue(sw,new String[]{"a","\"foo\"",null});assertEquals("[\"a\",\"\\\"foo\\\"\",null]",sw.toString().trim());}
public void testDoubleArray()throws Exception {StringWriter sw=new StringWriter();MAPPER.writeValue(sw,new double[]{1.01,2.0,-7,Double.NaN,Double.NEGATIVE_INFINITY,Double.POSITIVE_INFINITY});assertEquals("[1.01,2.0,-7.0,\"NaN\",\"-Infinity\",\"Infinity\"]",sw.toString().trim());}
public void testFloatArray()throws Exception {StringWriter sw=new StringWriter();MAPPER.writeValue(sw,new float[]{1.01f,2.0f,-7f,Float.NaN,Float.NEGATIVE_INFINITY,Float.POSITIVE_INFINITY});assertEquals("[1.01,2.0,-7.0,\"NaN\",\"-Infinity\",\"Infinity\"]",sw.toString().trim());}
public void testDeserializationWithObject()throws Exception {Inter inter=objectReader(Inter.class).readValue("{\"type\": \"mine\",\"blah\": [\"a\",\"b\",\"c\"]}");assertTrue(inter instanceof MyInter);assertFalse(inter instanceof LegacyInter);assertEquals(Arrays.asList("a","b","c"),((MyInter)inter).blah);}
public void testDeserializationWithString()throws Exception {Inter inter=objectReader(Inter.class).readValue("\"a,b,c,d\"");assertTrue(inter instanceof LegacyInter);assertEquals(Arrays.asList("a","b","c","d"),((MyInter)inter).blah);}
public void testDeserializationWithArray()throws Exception {Inter inter=objectReader(Inter.class).readValue("[\"a\",\"b\",\"c\",\"d\"]");assertTrue(inter instanceof LegacyInter);assertEquals(Arrays.asList("a","b","c","d"),((MyInter)inter).blah);}
public void testDeserializationWithArrayOfSize2()throws Exception {Inter inter=objectReader(Inter.class).readValue("[\"a\",\"b\"]");assertTrue(inter instanceof LegacyInter);assertEquals(Arrays.asList("a","b"),((MyInter)inter).blah);}
public void testDefaultAsNoClass()throws Exception {Object ob=objectReader(DefaultWithNoClass.class).readValue("{}");assertNull(ob);ob=objectReader(DefaultWithNoClass.class).readValue("{\"bogus\":3 }");assertNull(ob);}
public void testBadTypeAsNull()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.disable(DeserializationFeature.FAIL_ON_INVALID_SUBTYPE);Object ob=mapper.readValue("{}",MysteryPolymorphic.class);assertNull(ob);ob=mapper.readValue("{\"whatever\":13}",MysteryPolymorphic.class);assertNull(ob);}
public void testSimpleGetterInheritance()throws Exception {ObjectMapper m=new ObjectMapper();Map<String,Object> result=writeAndMap(m,new PojoSubclass());assertEquals(2,result.size());assertEquals(Integer.valueOf(7),result.get("length"));assertEquals(Integer.valueOf(9),result.get("width"));}
public void testSimpleGetterInterfaceImpl()throws Exception {ObjectMapper m=new ObjectMapper();Map<String,Object> result=writeAndMap(m,new PojoImpl());assertEquals(3,result.size());assertEquals(Integer.valueOf(5),result.get("foobar"));assertEquals(Integer.valueOf(1),result.get("width"));assertEquals(Integer.valueOf(2),result.get("length"));}
public void testCustomContentSerializer()throws Exception {ObjectMapper m=new ObjectMapper();MyObject object=new MyObject();object.list=Arrays.asList("foo");String json=m.writeValueAsString(object);assertEquals("{\"list\":[\"bar\"]}",json);}
public void testCustomization()throws Exception {ObjectMapper objectMapper=new ObjectMapper();objectMapper.addMixInAnnotations(Element.class,ElementMixin.class);Element element=DocumentBuilderFactory.newInstance().newDocumentBuilder().newDocument().createElement("el");StringWriter sw=new StringWriter();objectMapper.writeValue(sw,element);assertEquals(sw.toString(),"\"element\"");}
@SuppressWarnings({"unchecked","rawtypes"})public void testCustomLists()throws Exception {ObjectMapper mapper=new ObjectMapper();SimpleModule module=new SimpleModule("test",Version.unknownVersion());JsonSerializer<?> ser=new CollectionSerializer(null,false,null,null,null);final JsonSerializer<Object> collectionSerializer=(JsonSerializer<Object>)ser;module.addSerializer(Collection.class,new JsonSerializer<Collection>(){@Override public void serialize(Collection value,JsonGenerator jgen,SerializerProvider provider)throws IOException,JsonProcessingException {if (value.size()!= 0){collectionSerializer.serialize(value,jgen,provider);}else {jgen.writeNull();}}});mapper.registerModule(module);assertEquals("null",mapper.writeValueAsString(new ArrayList<Object>()));}
public void testDelegating()throws Exception {ObjectMapper mapper=new ObjectMapper();SimpleModule module=new SimpleModule("test",Version.unknownVersion());module.addSerializer(new StdDelegatingSerializer(Immutable.class,new StdConverter<Immutable,Map<String,Integer>>(){@Override public Map<String,Integer> convert(Immutable value){HashMap<String,Integer> map=new LinkedHashMap<String,Integer>();map.put("x",value.x());map.put("y",value.y());return map;}}));mapper.registerModule(module);assertEquals("{\"x\":3,\"y\":7}",mapper.writeValueAsString(new Immutable()));}
public void testLowerBound()throws Exception {IntBeanWrapper<?> result=new ObjectMapper().readValue("{\"wrapped\":{\"x\":3}}",IntBeanWrapper.class);assertNotNull(result);assertEquals(IntBean.class,result.wrapped.getClass());assertEquals(3,result.wrapped.x);}
public void testBounded()throws Exception {ObjectMapper mapper=new ObjectMapper();BoundedWrapper<IntBean> result=mapper.readValue("{\"values\":[{\"x\":3}]}",new TypeReference<BoundedWrapper<IntBean>>(){});List<?> list=result.values;assertEquals(1,list.size());Object ob=list.get(0);assertEquals(IntBean.class,ob.getClass());assertEquals(3,result.values.get(0).x);}
public void testGenericsComplex()throws Exception {ObjectMapper m=new ObjectMapper();DoubleRange in=new DoubleRange(-0.5,0.5);String json=m.writeValueAsString(in);DoubleRange out=m.readValue(json,DoubleRange.class);assertNotNull(out);assertEquals(-0.5,out.start);assertEquals(0.5,out.end);}
public void testIssue778()throws Exception {final ObjectMapper mapper=new ObjectMapper();String json="{\"rows\":[{\"d\":{}}]}";final TypeReference<?> type=new TypeReference<ResultSetWithDoc<MyDoc>>(){};ResultSetWithDoc<MyDoc> rs=mapper.readValue(json,type);Document d=rs.rows.iterator().next().d;assertEquals(MyDoc.class,d.getClass());}
public void testSimpleSetterlessCollectionOk()throws Exception {CollectionBean result=new ObjectMapper().readValue("{\"values\":[\"abc\",\"def\" ]}",CollectionBean.class);List<String> l=result._values;assertEquals(2,l.size());assertEquals("abc",l.get(0));assertEquals("def",l.get(1));}
/** * Let's also verify that disabling the feature makes deserialization fail for setterless bean*/public void testSimpleSetterlessCollectionFailure()throws Exception {ObjectMapper m=new ObjectMapper();assertTrue(m.isEnabled(MapperFeature.USE_GETTERS_AS_SETTERS));m.configure(MapperFeature.USE_GETTERS_AS_SETTERS,false);assertFalse(m.isEnabled(MapperFeature.USE_GETTERS_AS_SETTERS));try {m.readValue("{\"values\":[\"abc\",\"def\" ]}",CollectionBean.class);fail("Expected an exception");}catch(JsonMappingException e){verifyException(e,"Unrecognized field");}}
public void testSimpleSetterlessMapOk()throws Exception {MapBean result=new ObjectMapper().readValue("{\"values\":{\"a\": 15,\"b\" : -3 }}",MapBean.class);Map<String,Integer> m=result._values;assertEquals(2,m.size());assertEquals(Integer.valueOf(15),m.get("a"));assertEquals(Integer.valueOf(-3),m.get("b"));}
public void testSimpleSetterlessMapFailure()throws Exception {ObjectMapper m=new ObjectMapper();m.configure(MapperFeature.USE_GETTERS_AS_SETTERS,false);try {m.readValue("{\"values\":{\"a\":3 }}",MapBean.class);fail("Expected an exception");}catch(JsonMappingException e){verifyException(e,"Unrecognized field");}}
public void testSetterlessPrecedence()throws Exception {ObjectMapper m=new ObjectMapper();m.configure(MapperFeature.USE_GETTERS_AS_SETTERS,true);Dual value=m.readValue("{\"list\":[1,2,3]},valueType)",Dual.class);assertNotNull(value);assertEquals(3,value.values.size());}
public void testFinalFieldIgnoral()throws Exception {ObjectMapper mapper=new ObjectMapper();assertTrue(mapper.isEnabled(MapperFeature.ALLOW_FINAL_FIELDS_AS_MUTATORS));mapper.disable(MapperFeature.ALLOW_FINAL_FIELDS_AS_MUTATORS);try {mapper.readValue("{\"x\":2}",FixedPoint.class);fail("Should not try to use final field");}catch(JsonMappingException e){verifyException(e,"unrecognized field \"x\"");}}
public void testDeserializationInference()throws Exception {final String JSON="{\"x\":2}";ObjectMapper mapper=new ObjectMapper();assertTrue(mapper.isEnabled(MapperFeature.INFER_PROPERTY_MUTATORS));Point p=mapper.readValue(JSON,Point.class);assertEquals(2,p.x);mapper=new ObjectMapper();mapper.disable(MapperFeature.INFER_PROPERTY_MUTATORS);try {p=mapper.readValue(JSON,Point.class);fail("Should not succeeed");}catch(JsonMappingException e){verifyException(e,"unrecognized field \"x\"");}}
public void testWithIdNone()throws Exception {final ObjectMapper mapper=new ObjectMapper();mapper.enableDefaultTyping();String json=mapper.writeValueAsString(new NoType());assertEquals("{\"a\":3}",json);NoTypeInterface bean=mapper.readValue("{\"a\":6}",NoTypeInterface.class);assertNotNull(bean);NoType impl=(NoType)bean;assertEquals(6,impl.a);}
public void testCustomTypeIdResolver()throws Exception {ObjectMapper m=new ObjectMapper();List<JavaType> types=new ArrayList<JavaType>();CustomResolver.initTypes=types;String json=m.writeValueAsString(new CustomBean[]{new CustomBean(28)});assertEquals("[{\"*\":{\"x\":28}}]",json);assertEquals(1,types.size());assertEquals(CustomBean.class,types.get(0).getRawClass());types=new ArrayList<JavaType>();CustomResolver.initTypes=types;CustomBean[]result=m.readValue(json,CustomBean[].class);assertNotNull(result);assertEquals(1,result.length);assertEquals(28,result[0].x);assertEquals(1,types.size());assertEquals(CustomBean.class,types.get(0).getRawClass());}
/** * Simple unit test for verifying that we get String array back,even though declared type is Object array*/public void testArrayTypingSimple()throws Exception {ObjectMapper m=new ObjectMapper();m.enableDefaultTyping(DefaultTyping.NON_CONCRETE_AND_ARRAYS);ArrayBean bean=new ArrayBean(new String[0]);String json=m.writeValueAsString(bean);ArrayBean result=m.readValue(json,ArrayBean.class);assertNotNull(result.values);assertEquals(String[].class,result.values.getClass());}
public void testArrayTypingNested()throws Exception {ObjectMapper m=new ObjectMapper();m.enableDefaultTyping(DefaultTyping.NON_CONCRETE_AND_ARRAYS);ArrayBean bean=new ArrayBean(new String[0][0]);String json=m.writeValueAsString(bean);ArrayBean result=m.readValue(json,ArrayBean.class);assertNotNull(result.values);assertEquals(String[][].class,result.values.getClass());}
public void testNodeInArray()throws Exception {JsonNode node=new ObjectMapper().readTree("{\"a\":3}");ObjectMapper m=new ObjectMapper();m.enableDefaultTyping(DefaultTyping.JAVA_LANG_OBJECT);Object[]obs=new Object[]{node};String json=m.writeValueAsString(obs);Object[]result=m.readValue(json,Object[].class);assertEquals(1,result.length);Object ob=result[0];assertTrue(ob instanceof JsonNode);}
public void testArraysOfArrays()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL,JsonTypeInfo.As.PROPERTY);Object value=new Object[][]{new Object[]{}};String json=mapper.writeValueAsString(value);_testArraysAs(mapper,json,Object[][].class);_testArraysAs(mapper,json,Object[].class);_testArraysAs(mapper,json,Object.class);}
public void testPolymorphicTest()throws Exception {Child c=new Child();c.w=10;c.h=11;MAPPER.readerForUpdating(c).readValue("{\"x\":3,\"y\":4,\"w\":111}");assertEquals(3,c.x);assertEquals(4,c.y);assertEquals(111,c.w);}
@SuppressWarnings("unchecked")public void testSuperClass()throws Exception {ObjectMapper mapper=new ObjectMapper();SubType bean=new SubType();Map<String,Object> result=writeAndMap(mapper,bean);assertEquals(4,result.size());assertEquals("a",result.get("a"));assertEquals(Integer.valueOf(3),result.get("b"));assertEquals("x",result.get("a2"));assertEquals(Boolean.TRUE,result.get("b2"));ObjectWriter w=mapper.writerWithType(BaseType.class);String json=w.writeValueAsString(bean);result=(Map<String,Object>)mapper.readValue(json,Map.class);assertEquals(2,result.size());assertEquals("a",result.get("a"));assertEquals(Integer.valueOf(3),result.get("b"));}
public void testSuperInterface()throws Exception {ObjectMapper mapper=new ObjectMapper();SubType bean=new SubType();ObjectWriter w=mapper.writerWithType(BaseInterface.class);String json=w.writeValueAsString(bean);@SuppressWarnings("unchecked")Map<String,Object> result=mapper.readValue(json,Map.class);assertEquals(1,result.size());assertEquals(Integer.valueOf(3),result.get("b"));}
public void testInArray()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.configure(MapperFeature.USE_STATIC_TYPING,true);SubType[]ob=new SubType[]{new SubType()};String json=mapper.writerWithType(BaseInterface[].class).writeValueAsString(ob);assertEquals("[{\"b\":3}]",json);}
/** * Unit test to ensure that proper exception is thrown if declared root type is not compatible with given value instance.*/public void testIncompatibleRootType()throws Exception {ObjectMapper mapper=new ObjectMapper();SubType bean=new SubType();ObjectWriter w=mapper.writerWithType(HashMap.class);try {w.writeValueAsString(bean);fail("Should have failed due to incompatible type");}catch(JsonProcessingException e){verifyException(e,"Incompatible types");}}
/** * Unit test to verify [JACKSON-398]*/public void testJackson398()throws Exception {ObjectMapper mapper=new ObjectMapper();JavaType collectionType=TypeFactory.defaultInstance().constructCollectionType(ArrayList.class,BaseClass398.class);List<TestClass398> typedList=new ArrayList<TestClass398>();typedList.add(new TestClass398());final String EXP="[{\"beanClass\":\"TestRootType$TestClass398\",\"property\":\"aa\"}]";String json=mapper.writerWithType(collectionType).writeValueAsString(typedList);assertEquals(EXP,json);StringWriter out=new StringWriter();JsonFactory f=new JsonFactory();mapper.writerWithType(collectionType).writeValue(f.createGenerator(out),typedList);assertEquals(EXP,out.toString());}
public void testRootWrapping()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.configure(SerializationFeature.WRAP_ROOT_VALUE,true);String json=mapper.writeValueAsString(new StringWrapper("abc"));assertEquals("{\"StringWrapper\":{\"str\":\"abc\"}}",json);}
/** * Test to verify that there is support for specifying root type as primitive,even if wrapper value is passed (there is no way to pass primitive values as Objects);this to support frameworks that may pass unprocessed {@link java.lang.reflect.Type}from field or method.*/public void testIssue456WrapperPart()throws Exception {ObjectMapper mapper=new ObjectMapper();assertEquals("123",mapper.writerWithType(Integer.TYPE).writeValueAsString(Integer.valueOf(123)));assertEquals("456",mapper.writerWithType(Long.TYPE).writeValueAsString(Long.valueOf(456L)));}
public void testRootNameAnnotation()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.configure(SerializationFeature.WRAP_ROOT_VALUE,true);String json=mapper.writeValueAsString(new WithRootName());assertEquals("{\"root\":{\"a\":3}}",json);}
public void testSerializedAsListWithClassAnnotations()throws IOException {SimpleValueList list=new SimpleValueList();list.add(new ActualValue("foo"));assertEquals("[{\"value\":\"foo\"}]",MAPPER.writeValueAsString(list));}
public void testSerializedAsMapWithClassAnnotations()throws IOException {SimpleValueMap map=new SimpleValueMap();map.put(new SimpleKey("x"),new ActualValue("y"));assertEquals("{\"toString:x\":{\"value\":\"y\"}}",MAPPER.writeValueAsString(map));}
public void testSerializedAsListWithClassSerializer()throws IOException {ObjectMapper m=new ObjectMapper();SimpleValueListWithSerializer list=new SimpleValueListWithSerializer();list.add(new ActualValue("foo"));assertEquals("[\"value foo\"]",m.writeValueAsString(list));}
public void testSerializedAsListWithPropertyAnnotations()throws IOException {ListWrapperSimple input=new ListWrapperSimple("bar");assertEquals("{\"values\":[{\"value\":\"bar\"}]}",MAPPER.writeValueAsString(input));}
public void testSerializedAsMapWithClassSerializer()throws IOException {SimpleValueMapWithSerializer map=new SimpleValueMapWithSerializer();map.put(new SimpleKey("abc"),new ActualValue("123"));assertEquals("{\"key abc\":\"value 123\"}",MAPPER.writeValueAsString(map));}
public void testSerializedAsMapWithPropertyAnnotations()throws IOException {MapWrapperSimple input=new MapWrapperSimple("a","b");assertEquals("{\"values\":{\"toString:a\":{\"value\":\"b\"}}}",MAPPER.writeValueAsString(input));}
public void testSerializedAsListWithPropertyAnnotations2()throws IOException {ListWrapperWithSerializer input=new ListWrapperWithSerializer("abc");assertEquals("{\"values\":[\"value abc\"]}",MAPPER.writeValueAsString(input));}
public void testSerializedAsMapWithPropertyAnnotations2()throws IOException {MapWrapperWithSerializer input=new MapWrapperWithSerializer("foo","b");assertEquals("{\"values\":{\"key foo\":\"value b\"}}",MAPPER.writeValueAsString(input));}
public void testEmptyInclusion()throws IOException {ObjectMapper defMapper=MAPPER;ObjectMapper inclMapper=new ObjectMapper().setSerializationInclusion(JsonInclude.Include.NON_EMPTY);StringWrapper str=new StringWrapper("");assertEquals("{\"str\":\"\"}",defMapper.writeValueAsString(str));assertEquals("{}",inclMapper.writeValueAsString(str));assertEquals("{}",inclMapper.writeValueAsString(new StringWrapper()));ListWrapper<String> list=new ListWrapper<String>();assertEquals("{\"list\":[]}",defMapper.writeValueAsString(list));assertEquals("{}",inclMapper.writeValueAsString(list));assertEquals("{}",inclMapper.writeValueAsString(new ListWrapper<String>()));MapWrapper<String,Integer> map=new MapWrapper<String,Integer>(new HashMap<String,Integer>());assertEquals("{\"map\":{}}",defMapper.writeValueAsString(map));assertEquals("{}",inclMapper.writeValueAsString(map));assertEquals("{}",inclMapper.writeValueAsString(new MapWrapper<String,Integer>(null)));ArrayWrapper<Integer> array=new ArrayWrapper<Integer>(new Integer[0]);assertEquals("{\"array\":[]}",defMapper.writeValueAsString(array));assertEquals("{}",inclMapper.writeValueAsString(array));assertEquals("{}",inclMapper.writeValueAsString(new ArrayWrapper<Integer>(null)));}
public void testNullSerializer()throws Exception {String json=MAPPER.writeValueAsString(new NullBean());assertEquals("{\"value\":null}",json);}
public void testSerializeSimpleNonNS()throws Exception {Document doc=DocumentBuilderFactory.newInstance().newDocumentBuilder().parse(new InputSource(new StringReader(SIMPLE_XML)));assertNotNull(doc);ObjectMapper mapper=new ObjectMapper();String outputRaw=mapper.writeValueAsString(doc);String output=mapper.readValue(outputRaw,String.class);assertEquals(SIMPLE_XML,normalizeOutput(output));}
public void testDeserializeNonNS()throws Exception {ObjectMapper mapper=new ObjectMapper();for (int i=0;i < 2;++i){Document doc;if (i == 0){doc=mapper.readValue(quote(SIMPLE_XML),Document.class);}else {Node node=mapper.readValue(quote(SIMPLE_XML),Node.class);doc=(Document)node;}Element root=doc.getDocumentElement();assertNotNull(root);assertEquals("root",root.getTagName());assertEquals("3",root.getAttribute("attr"));assertEquals(1,root.getAttributes().getLength());NodeList nodes=root.getChildNodes();assertEquals(2,nodes.getLength());Element leaf=(Element)nodes.item(0);assertEquals("leaf",leaf.getTagName());assertEquals(0,leaf.getAttributes().getLength());ProcessingInstruction pi=(ProcessingInstruction)nodes.item(1);assertEquals("proc",pi.getTarget());assertEquals("instr",pi.getData());}}
public void testDeserializeNS()throws Exception {ObjectMapper mapper=new ObjectMapper();Document doc=mapper.readValue(quote(SIMPLE_XML_NS),Document.class);Element root=doc.getDocumentElement();assertNotNull(root);assertEquals("root",root.getTagName());String uri=root.getNamespaceURI();assertTrue((uri == null)|| "".equals(uri));assertEquals(0,root.getChildNodes().getLength());assertEquals(2,root.getAttributes().getLength());assertEquals("abc",root.getAttributeNS("http://foo","attr"));}
public void testAtomicBoolean()throws Exception {ObjectMapper mapper=new ObjectMapper();AtomicBoolean b=mapper.readValue("true",AtomicBoolean.class);assertTrue(b.get());}
public void testAtomicInt()throws Exception {ObjectMapper mapper=new ObjectMapper();AtomicInteger value=mapper.readValue("13",AtomicInteger.class);assertEquals(13,value.get());}
public void testAtomicLong()throws Exception {ObjectMapper mapper=new ObjectMapper();AtomicLong value=mapper.readValue("12345678901",AtomicLong.class);assertEquals(12345678901L,value.get());}
public void testAtomicReference()throws Exception {ObjectMapper mapper=new ObjectMapper();AtomicReference<long[]> value=mapper.readValue("[1,2]",new com.fasterxml.jackson.core.type.TypeReference<AtomicReference<long[]>>(){});Object ob=value.get();assertNotNull(ob);assertEquals(long[].class,ob.getClass());long[]longs=(long[])ob;assertNotNull(longs);assertEquals(2,longs.length);assertEquals(1,longs[0]);assertEquals(2,longs[1]);}
public void testBooleanPrimitive()throws Exception {BooleanBean result=MAPPER.readValue(new StringReader("{\"v\":true}"),BooleanBean.class);assertTrue(result._v);result=MAPPER.readValue(new StringReader("{\"v\":null}"),BooleanBean.class);assertNotNull(result);assertFalse(result._v);boolean[]array=MAPPER.readValue(new StringReader("[null ]"),boolean[].class);assertNotNull(array);assertEquals(1,array.length);assertFalse(array[0]);}
public void testIntPrimitive()throws Exception {IntBean result=MAPPER.readValue(new StringReader("{\"v\":3}"),IntBean.class);assertEquals(3,result._v);result=MAPPER.readValue(new StringReader("{\"v\":null}"),IntBean.class);assertNotNull(result);assertEquals(0,result._v);int[]array=MAPPER.readValue(new StringReader("[null ]"),int[].class);assertNotNull(array);assertEquals(1,array.length);assertEquals(0,array[0]);}
public void testDoublePrimitive()throws Exception {double value=0.016;DoubleBean result=MAPPER.readValue(new StringReader("{\"v\":" + value + "}"),DoubleBean.class);assertEquals(value,result._v);result=MAPPER.readValue(new StringReader("{\"v\":null}"),DoubleBean.class);assertNotNull(result);assertEquals(0.0,result._v);double[]array=MAPPER.readValue(new StringReader("[null ]"),double[].class);assertNotNull(array);assertEquals(1,array.length);assertEquals(0.0,array[0]);}
public void testDoublePrimitiveNonNumeric()throws Exception {double value=Double.POSITIVE_INFINITY;DoubleBean result=MAPPER.readValue(new StringReader("{\"v\":\"" + value + "\"}"),DoubleBean.class);assertEquals(value,result._v);double[]array=MAPPER.readValue(new StringReader("[\"Infinity\" ]"),double[].class);assertNotNull(array);assertEquals(1,array.length);assertEquals(Double.POSITIVE_INFINITY,array[0]);}
public void testFloatPrimitiveNonNumeric()throws Exception {float value=Float.POSITIVE_INFINITY;FloatBean result=MAPPER.readValue(new StringReader("{\"v\":\"" + value + "\"}"),FloatBean.class);assertEquals(value,result._v);float[]array=MAPPER.readValue(new StringReader("[\"Infinity\" ]"),float[].class);assertNotNull(array);assertEquals(1,array.length);assertEquals(Float.POSITIVE_INFINITY,array[0]);}
/** * Beyond simple case,let's also ensure that method overriding works as expected.*/public void testIntWithOverride()throws Exception {IntBean2 result=MAPPER.readValue(new StringReader("{\"v\":8}"),IntBean2.class);assertEquals(9,result._v);}
/** * Simple unit test to verify that we can map boolean values to java.lang.Boolean.*/public void testBooleanWrapper()throws Exception {Boolean result=MAPPER.readValue(new StringReader("true"),Boolean.class);assertEquals(Boolean.TRUE,result);result=MAPPER.readValue(new StringReader("false"),Boolean.class);assertEquals(Boolean.FALSE,result);result=MAPPER.readValue(new StringReader("0"),Boolean.class);assertEquals(Boolean.FALSE,result);result=MAPPER.readValue(new StringReader("1"),Boolean.class);assertEquals(Boolean.TRUE,result);}
public void testByteWrapper()throws Exception {Byte result=MAPPER.readValue(new StringReader("   -42\t"),Byte.class);assertEquals(Byte.valueOf((byte)-42),result);result=MAPPER.readValue(new StringReader(" \"-12\""),Byte.class);assertEquals(Byte.valueOf((byte)-12),result);result=MAPPER.readValue(new StringReader(" 39.07"),Byte.class);assertEquals(Byte.valueOf((byte)39),result);}
public void testShortWrapper()throws Exception {Short result=MAPPER.readValue(new StringReader("37"),Short.class);assertEquals(Short.valueOf((short)37),result);result=MAPPER.readValue(new StringReader(" \"-1009\""),Short.class);assertEquals(Short.valueOf((short)-1009),result);result=MAPPER.readValue(new StringReader("-12.9"),Short.class);assertEquals(Short.valueOf((short)-12),result);}
public void testCharacterWrapper()throws Exception {Character result=MAPPER.readValue(new StringReader("\"a\""),Character.class);assertEquals(Character.valueOf('a'),result);result=MAPPER.readValue(new StringReader(" " + ((int)'X')),Character.class);assertEquals(Character.valueOf('X'),result);}
public void testIntWrapper()throws Exception {Integer result=MAPPER.readValue(new StringReader("   -42\t"),Integer.class);assertEquals(Integer.valueOf(-42),result);result=MAPPER.readValue(new StringReader(" \"-1200\""),Integer.class);assertEquals(Integer.valueOf(-1200),result);result=MAPPER.readValue(new StringReader(" 39.07"),Integer.class);assertEquals(Integer.valueOf(39),result);}
public void testLongWrapper()throws Exception {Long result=MAPPER.readValue(new StringReader("12345678901"),Long.class);assertEquals(Long.valueOf(12345678901L),result);result=MAPPER.readValue(new StringReader(" \"-9876\""),Long.class);assertEquals(Long.valueOf(-9876),result);result=MAPPER.readValue(new StringReader("1918.3"),Long.class);assertEquals(Long.valueOf(1918),result);}
public void testFloatWrapper()throws Exception {String[]STRS=new String[]{"1.0","0.0","-0.3","0.7","42.012","-999.0",NAN_STRING};for(String str : STRS){Float exp=Float.valueOf(str);Float result;if (NAN_STRING != str){result=MAPPER.readValue(new StringReader(str),Float.class);assertEquals(exp,result);}result=MAPPER.readValue(new StringReader(" \"" + str + "\""),Float.class);assertEquals(exp,result);}}
public void testDoubleWrapper()throws Exception {String[]STRS=new String[]{"1.0","0.0","-0.3","0.7","42.012","-999.0",NAN_STRING};for(String str : STRS){Double exp=Double.valueOf(str);Double result;if (NAN_STRING != str){result=MAPPER.readValue(new StringReader(str),Double.class);assertEquals(exp,result);}result=MAPPER.readValue(new StringReader(" \"" + str + "\""),Double.class);assertEquals(exp,result);}}
public void testBase64Variants()throws Exception {final byte[]INPUT="abcdefghijklmnopqrstuvwxyz1234567890abcdefghijklmnopqrstuvwxyz1234567890X".getBytes("UTF-8");Assert.assertArrayEquals(INPUT,MAPPER.readValue(quote("YWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXoxMjM0NTY3ODkwYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXoxMjM0NTY3ODkwWA=="),byte[].class));ObjectReader reader=MAPPER.reader(byte[].class);Assert.assertArrayEquals(INPUT,(byte[])reader.with(Base64Variants.MIME_NO_LINEFEEDS).readValue(quote("YWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXoxMjM0NTY3ODkwYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXoxMjM0NTY3ODkwWA==")));Assert.assertArrayEquals(INPUT,(byte[])reader.with(Base64Variants.MIME).readValue(quote("YWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXoxMjM0NTY3ODkwYWJjZGVmZ2hpamtsbW5vcHFyc3R1\\ndnd4eXoxMjM0NTY3ODkwWA==")));Assert.assertArrayEquals(INPUT,(byte[])reader.with(Base64Variants.MODIFIED_FOR_URL).readValue(quote("YWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXoxMjM0NTY3ODkwYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXoxMjM0NTY3ODkwWA")));Assert.assertArrayEquals(INPUT,(byte[])reader.with(Base64Variants.PEM).readValue(quote("YWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXoxMjM0NTY3ODkwYWJjZGVmZ2hpamts\\nbW5vcHFyc3R1dnd4eXoxMjM0NTY3ODkwWA==")));}
public void testSingleString()throws Exception {String value="FOO!";String result=MAPPER.readValue(new StringReader("\"" + value + "\""),String.class);assertEquals(value,result);}
public void testNull()throws Exception {Object result=MAPPER.readValue("   null",Object.class);assertNull(result);}
public void testClass()throws Exception {Class<?> result=MAPPER.readValue("\"java.lang.String\"",Class.class);assertEquals(String.class,result);}
public void testBigDecimal()throws Exception {BigDecimal value=new BigDecimal("0.001");BigDecimal result=MAPPER.readValue(new StringReader(value.toString()),BigDecimal.class);assertEquals(value,result);}
public void testBigInteger()throws Exception {BigInteger value=new BigInteger("-1234567890123456789012345567809");BigInteger result=MAPPER.readValue(new StringReader(value.toString()),BigInteger.class);assertEquals(value,result);}
public void testUUID()throws Exception {UUID value=UUID.fromString("76e6d183-5f68-4afa-b94a-922c1fdb83f8");assertEquals(value,MAPPER.readValue("\"" + value.toString()+ "\"",UUID.class));TokenBuffer buf=new TokenBuffer(null);buf.writeObject(null);assertNull(MAPPER.readValue(buf.asParser(),UUID.class));buf.close();buf=new TokenBuffer(null);buf.writeObject(value);assertSame(value,MAPPER.readValue(buf.asParser(),UUID.class));ByteArrayOutputStream bytes=new ByteArrayOutputStream();DataOutputStream out=new DataOutputStream(bytes);out.writeLong(value.getMostSignificantBits());out.writeLong(value.getLeastSignificantBits());byte[]data=bytes.toByteArray();assertEquals(16,data.length);buf.writeObject(data);UUID value2=MAPPER.readValue(buf.asParser(),UUID.class);assertEquals(value,value2);buf.close();}
public void testURL()throws Exception {URL value=new URL("http://foo.com");assertEquals(value,MAPPER.readValue("\"" + value.toString()+ "\"",URL.class));TokenBuffer buf=new TokenBuffer(null);buf.writeObject(null);assertNull(MAPPER.readValue(buf.asParser(),URL.class));buf.close();buf=new TokenBuffer(null);buf.writeObject(value);assertSame(value,MAPPER.readValue(buf.asParser(),URL.class));buf.close();}
public void testURI()throws Exception {URI value=new URI("http://foo.com");assertEquals(value,MAPPER.readValue("\"" + value.toString()+ "\"",URI.class));}
/** * Then a unit test to verify that we can conveniently bind sequence of space-separate simple values*/public void testSequenceOfInts()throws Exception {final int NR_OF_INTS=100;StringBuilder sb=new StringBuilder();for (int i=0;i < NR_OF_INTS;++i){sb.append(" ");sb.append(i);}JsonParser jp=MAPPER.getFactory().createParser(sb.toString());for (int i=0;i < NR_OF_INTS;++i){Integer result=MAPPER.readValue(jp,Integer.class);assertEquals(Integer.valueOf(i),result);}}
public void testLocation()throws IOException {File f=new File("/tmp/test.json");JsonLocation loc=new JsonLocation(f,-1,100,13);ObjectMapper mapper=new ObjectMapper();Map<String,Object> result=writeAndMap(mapper,loc);assertEquals(5,result.size());assertEquals(f.getAbsolutePath(),result.get("sourceRef"));assertEquals(Integer.valueOf(-1),result.get("charOffset"));assertEquals(Integer.valueOf(-1),result.get("byteOffset"));assertEquals(Integer.valueOf(100),result.get("lineNr"));assertEquals(Integer.valueOf(13),result.get("columnNr"));}
/** * Verify that  {@link TokenBuffer}can be properly serializedautomatically,using the "standard" JSON sample document*/public void testTokenBuffer()throws Exception {JsonParser jp=createParserUsingReader(SAMPLE_DOC_JSON_SPEC);TokenBuffer tb=new TokenBuffer(null);while (jp.nextToken()!= null){tb.copyCurrentEvent(jp);}String str=serializeAsString(tb);verifyJsonSpecSampleDoc(createParserUsingReader(str),true);}
public void testListAsObject()throws Exception {CollectionAsPOJO list=new CollectionAsPOJO();list.add("a");list.add("b");String json=MAPPER.writeValueAsString(list);assertEquals("{\"size\":2,\"values\":[\"a\",\"b\"]}",json);CollectionAsPOJO result=MAPPER.readValue(json,CollectionAsPOJO.class);assertEquals(2,result.size());}
public void testSimpleNonStaticInner()throws Exception {ObjectMapper mapper=new ObjectMapper();Dog input=new Dog("Smurf",true);String json=mapper.writeValueAsString(input);Dog output=mapper.readValue(json,Dog.class);assertEquals("Smurf",output.name);assertNotNull(output.brain);assertTrue(output.brain.isThinking);assertEquals("Smurf",output.brain.parentName());output.name="Foo";assertEquals("Foo",output.brain.parentName());}
public void testCollections()throws IOException {final int entryLen=98;for (int type=0;type < 4;++type){Object value;if (type == 0){int[]ints=new int[entryLen];for (int i=0;i < entryLen;++i){ints[i]=Integer.valueOf(i);}value=ints;}else {Collection<Integer> c;switch (type){case 1:        c=new LinkedList<Integer>();break;case 2:    c=new TreeSet<Integer>();break;default:c=new ArrayList<Integer>();break;}for (int i=0;i < entryLen;++i){c.add(Integer.valueOf(i));}value=c;}String json=MAPPER.writeValueAsString(value);JsonParser jp=new JsonFactory().createParser(json);assertToken(JsonToken.START_ARRAY,jp.nextToken());for (int i=0;i < entryLen;++i){assertToken(JsonToken.VALUE_NUMBER_INT,jp.nextToken());assertEquals(i,jp.getIntValue());}assertToken(JsonToken.END_ARRAY,jp.nextToken());}}
public void testBigCollection()throws IOException {final int COUNT=9999;ArrayList<Integer> value=new ArrayList<Integer>();for (int i=0;i <= COUNT;++i){value.add(i);}for (int mode=0;mode < 3;++mode){JsonParser jp=null;switch (mode){case 0:{byte[]data=MAPPER.writeValueAsBytes(value);jp=new JsonFactory().createParser(data);}break;case 1:{StringWriter sw=new StringWriter(value.size());MAPPER.writeValue(sw,value);jp=createParserUsingReader(sw.toString());}break;case 2:{String str=MAPPER.writeValueAsString(value);jp=createParserUsingReader(str);}break;}assertToken(JsonToken.START_ARRAY,jp.nextToken());for (int i=0;i <= COUNT;++i){assertEquals(JsonToken.VALUE_NUMBER_INT,jp.nextToken());assertEquals(i,jp.getIntValue());}assertToken(JsonToken.END_ARRAY,jp.nextToken());jp.close();}}
public void testEnumMap()throws IOException {EnumMap<Key,String> map=new EnumMap<Key,String>(Key.class);map.put(Key.B,"xyz");map.put(Key.C,"abc");String json=MAPPER.writeValueAsString(map);assertEquals("{\"B\":\"xyz\",\"C\":\"abc\"}",json.trim());}
public void testIterator()throws IOException {StringWriter sw=new StringWriter();ArrayList<Integer> l=new ArrayList<Integer>();l.add(1);l.add(-9);l.add(0);MAPPER.writeValue(sw,l.iterator());assertEquals("[1,-9,0]",sw.toString().trim());}
public void testIterable()throws IOException {StringWriter sw=new StringWriter();MAPPER.writeValue(sw,new IterableWrapper(new int[]{1,2,3}));assertEquals("[1,2,3]",sw.toString().trim());}
@SuppressWarnings("unchecked")public void testEmptyBeanCollection()throws IOException {Collection<Object> x=new ArrayList<Object>();x.add("foobar");CollectionBean cb=new CollectionBean(x);Map<String,Object> result=writeAndMap(MAPPER,cb);assertEquals(1,result.size());assertTrue(result.containsKey("values"));Collection<Object> x2=(Collection<Object>)result.get("values");assertNotNull(x2);assertEquals(x,x2);}
public void testNullBeanCollection()throws IOException {CollectionBean cb=new CollectionBean(null);Map<String,Object> result=writeAndMap(MAPPER,cb);assertEquals(1,result.size());assertTrue(result.containsKey("values"));assertNull(result.get("values"));}
@SuppressWarnings("unchecked")public void testEmptyBeanEnumMap()throws IOException {EnumMap<Key,String> map=new EnumMap<Key,String>(Key.class);EnumMapBean b=new EnumMapBean(map);Map<String,Object> result=writeAndMap(MAPPER,b);assertEquals(1,result.size());assertTrue(result.containsKey("map"));Map<Object,Object> map2=(Map<Object,Object>)result.get("map");assertNotNull(map2);assertEquals(0,map2.size());}
public void testNullBeanEnumMap()throws IOException {EnumMapBean b=new EnumMapBean(null);Map<String,Object> result=writeAndMap(MAPPER,b);assertEquals(1,result.size());assertTrue(result.containsKey("map"));assertNull(result.get("map"));}
public void testListSerializer()throws IOException {assertEquals("\"[ab,cd,ef]\"",MAPPER.writeValueAsString(new PseudoList("ab","cd","ef")));}
public void testEmptyListOrArray()throws IOException {EmptyListBean list=new EmptyListBean();EmptyArrayBean array=new EmptyArrayBean();assertTrue(MAPPER.isEnabled(SerializationFeature.WRITE_EMPTY_JSON_ARRAYS));assertEquals("{\"empty\":[]}",MAPPER.writeValueAsString(list));assertEquals("{\"empty\":[]}",MAPPER.writeValueAsString(array));ObjectMapper m=new ObjectMapper();m.configure(SerializationFeature.WRITE_EMPTY_JSON_ARRAYS,false);assertEquals("{}",m.writeValueAsString(list));assertEquals("{}",m.writeValueAsString(array));}
public void testWithIterable()throws IOException {assertEquals("{\"values\":[\"value\"]}",MAPPER.writeValueAsString(new BeanWithIterable()));assertEquals("[1,2,3]",MAPPER.writeValueAsString(new IntIterable()));}
public void testSimple(){POJOPropertiesCollector coll=collector(mapper,Simple.class,true);Map<String,POJOPropertyBuilder> props=coll.getPropertyMap();assertEquals(1,props.size());POJOPropertyBuilder prop=props.get("value");assertNotNull(prop);assertTrue(prop.hasSetter());assertTrue(prop.hasGetter());assertTrue(prop.hasField());}
public void testSimpleFieldVisibility(){POJOPropertiesCollector coll=collector(mapper,SimpleFieldDeser.class,false);Map<String,POJOPropertyBuilder> props=coll.getPropertyMap();assertEquals(1,props.size());POJOPropertyBuilder prop=props.get("values");assertNotNull(prop);assertFalse(prop.hasSetter());assertFalse(prop.hasGetter());assertTrue(prop.hasField());}
public void testSimpleGetterVisibility(){POJOPropertiesCollector coll=collector(mapper,SimpleGetterVisibility.class,true);Map<String,POJOPropertyBuilder> props=coll.getPropertyMap();assertEquals(1,props.size());POJOPropertyBuilder prop=props.get("a");assertNotNull(prop);assertFalse(prop.hasSetter());assertTrue(prop.hasGetter());assertFalse(prop.hasField());}
public void testEmpty(){POJOPropertiesCollector coll=collector(mapper,Empty.class,true);Map<String,POJOPropertyBuilder> props=coll.getPropertyMap();assertEquals(0,props.size());}
public void testPartialIgnore(){POJOPropertiesCollector coll=collector(mapper,IgnoredSetter.class,true);Map<String,POJOPropertyBuilder> props=coll.getPropertyMap();assertEquals(1,props.size());POJOPropertyBuilder prop=props.get("value");assertNotNull(prop);assertFalse(prop.hasSetter());assertTrue(prop.hasGetter());assertTrue(prop.hasField());}
public void testSimpleRenamed(){POJOPropertiesCollector coll=collector(mapper,RenamedProperties.class,true);Map<String,POJOPropertyBuilder> props=coll.getPropertyMap();assertEquals(1,props.size());POJOPropertyBuilder prop=props.get("x");assertNotNull(prop);assertTrue(prop.hasSetter());assertTrue(prop.hasGetter());assertTrue(prop.hasField());}
public void testSimpleRenamed2(){POJOPropertiesCollector coll=collector(mapper,RenamedProperties2.class,true);Map<String,POJOPropertyBuilder> props=coll.getPropertyMap();assertEquals(1,props.size());POJOPropertyBuilder prop=props.get("renamed");assertNotNull(prop);assertTrue(prop.hasSetter());assertTrue(prop.hasGetter());assertFalse(prop.hasField());}
public void testMergeWithRename(){POJOPropertiesCollector coll=collector(mapper,MergedProperties.class,true);Map<String,POJOPropertyBuilder> props=coll.getPropertyMap();assertEquals(1,props.size());POJOPropertyBuilder prop=props.get("x");assertNotNull(prop);assertTrue(prop.hasSetter());assertFalse(prop.hasGetter());assertTrue(prop.hasField());}
public void testSimpleIgnoreAndRename(){POJOPropertiesCollector coll=collector(mapper,IgnoredRenamedSetter.class,true);Map<String,POJOPropertyBuilder> props=coll.getPropertyMap();assertEquals(1,props.size());POJOPropertyBuilder prop=props.get("y");assertNotNull(prop);assertTrue(prop.hasSetter());assertFalse(prop.hasGetter());assertFalse(prop.hasField());}
public void testGlobalVisibilityForGetters(){ObjectMapper m=new ObjectMapper();m.configure(MapperFeature.AUTO_DETECT_GETTERS,false);POJOPropertiesCollector coll=collector(m,SimpleGetterVisibility.class,true);Map<String,POJOPropertyBuilder> props=coll.getPropertyMap();assertEquals(0,props.size());}
public void testCollectionOfIgnored(){POJOPropertiesCollector coll=collector(mapper,ImplicitIgnores.class,false);Map<String,POJOPropertyBuilder> props=coll.getPropertyMap();assertEquals(1,props.size());Collection<String> ign=coll.getIgnoredPropertyNames();assertEquals(2,ign.size());assertTrue(ign.contains("a"));assertTrue(ign.contains("b"));}
public void testSimpleOrderingForDeserialization(){POJOPropertiesCollector coll=collector(mapper,SortedProperties.class,false);List<BeanPropertyDefinition> props=coll.getProperties();assertEquals(4,props.size());assertEquals("a",props.get(0).getName());assertEquals("b",props.get(1).getName());assertEquals("c",props.get(2).getName());assertEquals("d",props.get(3).getName());}
public void testSimpleWithType(){POJOPropertiesCollector coll=collector(mapper,TypeTestBean.class,true);List<BeanPropertyDefinition> props=coll.getProperties();assertEquals(1,props.size());assertEquals("value",props.get(0).getName());AnnotatedMember m=props.get(0).getAccessor();assertTrue(m instanceof AnnotatedMethod);assertEquals(Integer.class,m.getRawType());coll=collector(mapper,TypeTestBean.class,false);props=coll.getProperties();assertEquals(1,props.size());assertEquals("value",props.get(0).getName());m=props.get(0).getMutator();assertEquals(AnnotatedParameter.class,m.getClass());assertEquals(String.class,m.getRawType());}
public void testInnerClassWithAnnotationsInCreator()throws Exception {BasicBeanDescription beanDesc;beanDesc=mapper.getSerializationConfig().introspect(mapper.constructType(Issue701Bean.class));assertNotNull(beanDesc);beanDesc=mapper.getDeserializationConfig().introspect(mapper.constructType(Issue701Bean.class));assertNotNull(beanDesc);}
public void testJackson703()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.configure(MapperFeature.USE_ANNOTATIONS,false);BasicBeanDescription beanDesc=mapper.getSerializationConfig().introspect(mapper.constructType(Jackson703.class));assertNotNull(beanDesc);Jackson703 bean=new Jackson703();String json=mapper.writeValueAsString(bean);assertNotNull(json);}
public void testJackson744()throws Exception {BasicBeanDescription beanDesc=mapper.getDeserializationConfig().introspect(mapper.constructType(Issue744Bean.class));assertNotNull(beanDesc);AnnotatedMethod setter=beanDesc.findAnySetter();assertNotNull(setter);}
@SuppressWarnings("unchecked")public void testIssue468a()throws Exception {Person1 p1=new Person1("John");p1.setAccount(new Key<Account>(new Account("something",42L)));ObjectMapper mapper=new ObjectMapper();String json=mapper.writeValueAsString(p1);Map<String,Object> map=mapper.readValue(json,Map.class);assertEquals("John",map.get("name"));Object ob=map.get("account");assertNotNull(ob);Map<String,Object> acct=(Map<String,Object>)ob;Object idOb=acct.get("id");assertNotNull(idOb);Map<String,Object> key=(Map<String,Object>)idOb;assertEquals("something",key.get("name"));assertEquals(Integer.valueOf(42),key.get("id"));}
@SuppressWarnings("unchecked")public void testIssue468b()throws Exception {Person2 p2=new Person2("John");List<Key<Account>> accounts=new ArrayList<Key<Account>>();accounts.add(new Key<Account>(new Account("a",42L)));accounts.add(new Key<Account>(new Account("b",43L)));accounts.add(new Key<Account>(new Account("c",44L)));p2.setAccounts(accounts);ObjectMapper mapper=new ObjectMapper();String json=mapper.writeValueAsString(p2);Map<String,Object> map=mapper.readValue(json,Map.class);assertEquals("John",map.get("name"));Object ob=map.get("accounts");assertNotNull(ob);List<?> acctList=(List<?>)ob;assertEquals(3,acctList.size());}
/** * Issue [JACKSON-572]is about unbound type variables,usually resulting from inner classes of generic classes (like Sets).*/public void testUnboundIssue572()throws Exception {GenericBogusWrapper<Integer> list=new GenericBogusWrapper<Integer>(Integer.valueOf(7));String json=new ObjectMapper().writeValueAsString(list);assertEquals("{\"wrapped\":{\"value\":7}}",json);}
/** * Unit test to verify that limited number of core types do NOT include type information,even if declared as Object. This is only done for types that JSON scalar values natively map to: String,Integer and Boolean (and nulls never have type information)*/public void testNumericScalars()throws Exception {ObjectMapper m=new ObjectMapper();m.enableDefaultTyping();assertEquals("[123]",m.writeValueAsString(new Object[]{Integer.valueOf(123)}));assertEquals("[[\"java.lang.Long\",37]]",m.writeValueAsString(new Object[]{Long.valueOf(37)}));assertEquals("[0.25]",m.writeValueAsString(new Object[]{Double.valueOf(0.25)}));assertEquals("[[\"java.lang.Float\",0.5]]",m.writeValueAsString(new Object[]{Float.valueOf(0.5f)}));}
public void testDateScalars()throws Exception {ObjectMapper m=new ObjectMapper();m.enableDefaultTyping();long ts=12345678L;assertEquals("[[\"java.util.Date\"," + ts + "]]",m.writeValueAsString(new Object[]{new Date(ts)}));Calendar c=Calendar.getInstance();c.setTimeInMillis(ts);String json=m.writeValueAsString(new Object[]{c});assertEquals("[[\"" + c.getClass().getName()+ "\","+ ts+ "]]",json);Object[]result=m.readValue(json,Object[].class);assertEquals(1,result.length);assertTrue(result[0]instanceof Calendar);assertEquals(ts,((Calendar)result[0]).getTimeInMillis());}
public void testMiscScalars()throws Exception {ObjectMapper m=new ObjectMapper();m.enableDefaultTyping();assertEquals("[\"abc\"]",m.writeValueAsString(new Object[]{"abc"}));assertEquals("[true,null,false]",m.writeValueAsString(new Boolean[]{true,null,false}));}
/** * Test for verifying that contents of "untyped" homogenous arrays are properly handled,*/public void testScalarArrays()throws Exception {ObjectMapper m=new ObjectMapper();m.enableDefaultTyping(ObjectMapper.DefaultTyping.JAVA_LANG_OBJECT);Object[]input=new Object[]{"abc",new Date(1234567),null,Integer.valueOf(456)};String json=m.writeValueAsString(input);assertEquals("[\"abc\",[\"java.util.Date\",1234567],null,456]",json);Object[]output=m.readValue(json,Object[].class);assertArrayEquals(input,output);}
/** * Loosely scalar;for [JACKSON-417]*/public void test417()throws Exception {ObjectMapper m=new ObjectMapper();m.enableDefaultTyping();Jackson417Bean input=new Jackson417Bean();String json=m.writeValueAsString(input);Jackson417Bean result=m.readValue(json,Jackson417Bean.class);assertEquals(input.foo,result.foo);assertEquals(input.bar,result.bar);}
public void testSimpleField()throws Exception {ObjectMapper mapper=new ObjectMapper();String json=mapper.writeValueAsString(new FieldWrapperBean(new StringWrapper("foo")));FieldWrapperBean bean=mapper.readValue(json,FieldWrapperBean.class);assertNotNull(bean.value);assertEquals(StringWrapper.class,bean.value.getClass());assertEquals(((StringWrapper)bean.value).str,"foo");}
public void testSimpleMethod()throws Exception {ObjectMapper mapper=new ObjectMapper();String json=mapper.writeValueAsString(new FieldWrapperBean(new IntWrapper(37)));FieldWrapperBean bean=mapper.readValue(json,FieldWrapperBean.class);assertNotNull(bean.value);assertEquals(IntWrapper.class,bean.value.getClass());assertEquals(((IntWrapper)bean.value).i,37);}
public void testSimpleListField()throws Exception {ObjectMapper mapper=new ObjectMapper();FieldWrapperBeanList list=new FieldWrapperBeanList();list.add(new FieldWrapperBean(new OtherBean()));String json=mapper.writeValueAsString(list);FieldWrapperBeanList result=mapper.readValue(json,FieldWrapperBeanList.class);assertNotNull(result);assertEquals(1,result.size());FieldWrapperBean bean=list.get(0);assertEquals(OtherBean.class,bean.value.getClass());assertEquals(((OtherBean)bean.value).x,1);assertEquals(((OtherBean)bean.value).y,1);}
public void testSimpleListMethod()throws Exception {ObjectMapper mapper=new ObjectMapper();MethodWrapperBeanList list=new MethodWrapperBeanList();list.add(new MethodWrapperBean(new BooleanWrapper(true)));list.add(new MethodWrapperBean(new StringWrapper("x")));list.add(new MethodWrapperBean(new OtherBean()));String json=mapper.writeValueAsString(list);MethodWrapperBeanList result=mapper.readValue(json,MethodWrapperBeanList.class);assertNotNull(result);assertEquals(3,result.size());MethodWrapperBean bean=result.get(0);assertEquals(BooleanWrapper.class,bean.value.getClass());assertEquals(((BooleanWrapper)bean.value).b,Boolean.TRUE);bean=result.get(1);assertEquals(StringWrapper.class,bean.value.getClass());assertEquals(((StringWrapper)bean.value).str,"x");bean=result.get(2);assertEquals(OtherBean.class,bean.value.getClass());}
public void testSimpleArrayField()throws Exception {ObjectMapper mapper=new ObjectMapper();FieldWrapperBeanArray array=new FieldWrapperBeanArray(new FieldWrapperBean[]{new FieldWrapperBean(new BooleanWrapper(true))});String json=mapper.writeValueAsString(array);FieldWrapperBeanArray result=mapper.readValue(json,FieldWrapperBeanArray.class);assertNotNull(result);FieldWrapperBean[]beans=result.beans;assertEquals(1,beans.length);FieldWrapperBean bean=beans[0];assertEquals(BooleanWrapper.class,bean.value.getClass());assertEquals(((BooleanWrapper)bean.value).b,Boolean.TRUE);}
public void testSimpleArrayMethod()throws Exception {ObjectMapper mapper=new ObjectMapper();MethodWrapperBeanArray array=new MethodWrapperBeanArray(new MethodWrapperBean[]{new MethodWrapperBean(new StringWrapper("A"))});String json=mapper.writeValueAsString(array);MethodWrapperBeanArray result=mapper.readValue(json,MethodWrapperBeanArray.class);assertNotNull(result);MethodWrapperBean[]beans=result.beans;assertEquals(1,beans.length);MethodWrapperBean bean=beans[0];assertEquals(StringWrapper.class,bean.value.getClass());assertEquals(((StringWrapper)bean.value).str,"A");}
public void testSimpleMapField()throws Exception {ObjectMapper mapper=new ObjectMapper();FieldWrapperBeanMap map=new FieldWrapperBeanMap();map.put("foop",new FieldWrapperBean(new IntWrapper(13)));String json=mapper.writeValueAsString(map);FieldWrapperBeanMap result=mapper.readValue(json,FieldWrapperBeanMap.class);assertNotNull(result);assertEquals(1,result.size());FieldWrapperBean bean=result.get("foop");assertNotNull(bean);Object ob=bean.value;assertEquals(IntWrapper.class,ob.getClass());assertEquals(((IntWrapper)ob).i,13);}
public void testSimpleMapMethod()throws Exception {ObjectMapper mapper=new ObjectMapper();MethodWrapperBeanMap map=new MethodWrapperBeanMap();map.put("xyz",new MethodWrapperBean(new BooleanWrapper(true)));String json=mapper.writeValueAsString(map);MethodWrapperBeanMap result=mapper.readValue(json,MethodWrapperBeanMap.class);assertNotNull(result);assertEquals(1,result.size());MethodWrapperBean bean=result.get("xyz");assertNotNull(bean);Object ob=bean.value;assertEquals(BooleanWrapper.class,ob.getClass());assertEquals(((BooleanWrapper)ob).b,Boolean.TRUE);}
public void testSimpleClass(){TypeFactory tf=TypeFactory.defaultInstance();JavaType baseType=tf.constructType(BaseType.class);assertSame(BaseType.class,baseType.getRawClass());assertTrue(baseType.hasRawClass(BaseType.class));assertFalse(baseType.isArrayType());assertFalse(baseType.isContainerType());assertFalse(baseType.isEnumType());assertFalse(baseType.isInterface());assertFalse(baseType.isPrimitive());assertNull(baseType.getContentType());assertNull(baseType.getValueHandler());assertSame(baseType,baseType.narrowBy(BaseType.class));assertSame(baseType,baseType.widenBy(BaseType.class));try {baseType.narrowBy(SubType.class);}catch(IllegalArgumentException e){verifyException(e,"should never be called");}}
public void testMapType(){TypeFactory tf=TypeFactory.defaultInstance();JavaType keyT=tf.constructType(String.class);JavaType baseT=tf.constructType(BaseType.class);MapType mapT=MapType.construct(Map.class,keyT,baseT);assertNotNull(mapT);assertTrue(mapT.isContainerType());assertSame(mapT,mapT.narrowContentsBy(BaseType.class));assertSame(mapT,mapT.narrowKey(String.class));assertTrue(mapT.equals(mapT));assertFalse(mapT.equals(null));assertFalse(mapT.equals("xyz"));MapType mapT2=MapType.construct(HashMap.class,keyT,baseT);assertFalse(mapT.equals(mapT2));try {SimpleType.construct(HashMap.class);}catch(IllegalArgumentException e){verifyException(e,"for a Map");}}
public void testArrayType(){TypeFactory tf=TypeFactory.defaultInstance();JavaType arrayT=ArrayType.construct(tf.constructType(String.class),null,null);assertNotNull(arrayT);assertTrue(arrayT.isContainerType());assertSame(arrayT,arrayT.narrowContentsBy(String.class));assertNotNull(arrayT.toString());assertTrue(arrayT.equals(arrayT));assertFalse(arrayT.equals(null));assertFalse(arrayT.equals("xyz"));assertTrue(arrayT.equals(ArrayType.construct(tf.constructType(String.class),null,null)));assertFalse(arrayT.equals(ArrayType.construct(tf.constructType(Integer.class),null,null)));try {SimpleType.construct(String[].class);}catch(IllegalArgumentException e){verifyException(e,"for an array");}}
public void testCollectionType(){TypeFactory tf=TypeFactory.defaultInstance();JavaType collectionT=CollectionType.construct(List.class,tf.constructType(String.class));assertNotNull(collectionT);assertTrue(collectionT.isContainerType());assertSame(collectionT,collectionT.narrowContentsBy(String.class));assertNotNull(collectionT.toString());assertTrue(collectionT.equals(collectionT));assertFalse(collectionT.equals(null));assertFalse(collectionT.equals("xyz"));assertTrue(collectionT.equals(CollectionType.construct(List.class,tf.constructType(String.class))));assertFalse(collectionT.equals(CollectionType.construct(Set.class,tf.constructType(String.class))));try {SimpleType.construct(ArrayList.class);}catch(IllegalArgumentException e){verifyException(e,"for a Collection");}}
public void testEnumType(){TypeFactory tf=TypeFactory.defaultInstance();assertTrue(tf.constructType(MyEnum.class).isEnumType());assertTrue(tf.constructType(MyEnum2.class).isEnumType());assertTrue(tf.constructType(MyEnum.A.getClass()).isEnumType());assertTrue(tf.constructType(MyEnum2.A.getClass()).isEnumType());}
public void testClassKey(){ClassKey key=new ClassKey(String.class);assertEquals(0,key.compareTo(key));assertTrue(key.equals(key));assertFalse(key.equals(null));assertFalse(key.equals("foo"));assertFalse(key.equals(new ClassKey(Integer.class)));assertEquals(String.class.getName(),key.toString());}
public void testJavaTypeAsJLRType(){TypeFactory tf=TypeFactory.defaultInstance();JavaType t1=tf.constructType(getClass());JavaType t2=tf.constructType(t1);assertSame(t1,t2);}
/** * Test to check that [JACKSON-201]works if there is a recognized annotation (which indicates type is serializable)*/public void testEmptyWithAnnotations()throws Exception {try {serializeAsString(mapper,new Empty());}catch(JsonMappingException e){verifyException(e,"No serializer found for class");}assertEquals("{}",serializeAsString(mapper,new EmptyWithAnno()));ObjectMapper m2=new ObjectMapper();m2.addMixInAnnotations(Empty.class,EmptyWithAnno.class);assertEquals("{}",m2.writeValueAsString(new Empty()));}
/** * Alternative it is possible to use a feature to allow serializing empty classes,too*/public void testEmptyWithFeature()throws Exception {assertTrue(mapper.getSerializationConfig().isEnabled(SerializationFeature.FAIL_ON_EMPTY_BEANS));mapper.configure(SerializationFeature.FAIL_ON_EMPTY_BEANS,false);assertEquals("{}",serializeAsString(mapper,new Empty()));}
public void testCustomNoEmpty()throws Exception {assertEquals("{\"value\":123}",mapper.writeValueAsString(new NonZeroWrapper(123)));assertEquals("{}",mapper.writeValueAsString(new NonZeroWrapper(0)));}
public void testClassAnnotationSimple()throws Exception {ConvertingBean bean=objectReader(ConvertingBean.class).readValue("[1,2]");assertNotNull(bean);assertEquals(1,bean.x);assertEquals(2,bean.y);}
public void testClassAnnotationForLists()throws Exception {ConvertingBeanContainer container=objectReader(ConvertingBeanContainer.class).readValue("{\"values\":[[1,2],[3,4]]}");assertNotNull(container);assertNotNull(container.values);assertEquals(2,container.values.size());assertEquals(4,container.values.get(1).y);}
public void testPropertyAnnotationSimple()throws Exception {PointWrapper wrapper=objectReader(PointWrapper.class).readValue("{\"value\":[3,4]}");assertNotNull(wrapper);assertNotNull(wrapper.value);assertEquals(3,wrapper.value.x);assertEquals(4,wrapper.value.y);}
public void testPropertyAnnotationLowerCasing()throws Exception {LowerCaseText text=objectReader(LowerCaseText.class).readValue("{\"text\":\"Yay!\"}");assertNotNull(text);assertNotNull(text.text);assertEquals("yay!",text.text);}
public void testPropertyAnnotationArrayLC()throws Exception {LowerCaseTextArray texts=objectReader(LowerCaseTextArray.class).readValue("{\"texts\":[\"ABC\"]}");assertNotNull(texts);assertNotNull(texts.texts);assertEquals(1,texts.texts.length);assertEquals("abc",texts.texts[0]);}
public void testPropertyAnnotationForArrays()throws Exception {PointListWrapperArray array=objectReader(PointListWrapperArray.class).readValue("{\"values\":[[4,5],[5,4]]}");assertNotNull(array);assertNotNull(array.values);assertEquals(2,array.values.length);assertEquals(5,array.values[1].x);}
public void testPropertyAnnotationForLists()throws Exception {PointListWrapperList array=objectReader(PointListWrapperList.class).readValue("{\"values\":[[7,8],[8,7]]}");assertNotNull(array);assertNotNull(array.values);assertEquals(2,array.values.size());assertEquals(7,array.values.get(0).x);}
public void testPropertyAnnotationForMaps()throws Exception {PointListWrapperMap map=objectReader(PointListWrapperMap.class).readValue("{\"values\":{\"a\":[1,2]}}");assertNotNull(map);assertNotNull(map.values);assertEquals(1,map.values.size());Point p=map.values.get("a");assertNotNull(p);assertEquals(1,p.x);assertEquals(2,p.y);}
/** * Sanity test to ensure the pieces all work when put together.*/public void testComplexObject()throws Exception {FixtureObject aTestObj=new FixtureObject();ObjectMapper aMapper=new ObjectMapper();StringWriter aWriter=new StringWriter();JsonGenerator aGen=new JsonFactory().createGenerator(aWriter);aMapper.writeValue(aGen,aTestObj);aGen.close();JsonParser jp=new JsonFactory().createParser(new StringReader(aWriter.toString()));assertEquals(JsonToken.START_OBJECT,jp.nextToken());while (jp.nextToken()!= JsonToken.END_OBJECT){assertEquals(JsonToken.FIELD_NAME,jp.getCurrentToken());String name=jp.getCurrentName();JsonToken t=jp.nextToken();if (name.equals("uri")){assertToken(JsonToken.VALUE_STRING,t);assertEquals(FixtureObject.VALUE_URSTR,getAndVerifyText(jp));}else     if (name.equals("url")){assertToken(JsonToken.VALUE_STRING,t);assertEquals(FixtureObject.VALUE_URSTR,getAndVerifyText(jp));}else     if (name.equals("testNull")){assertToken(JsonToken.VALUE_NULL,t);}else     if (name.equals("testString")){assertToken(JsonToken.VALUE_STRING,t);assertEquals(FixtureObject.VALUE_STRING,getAndVerifyText(jp));}else     if (name.equals("testBoolean")){assertToken(JsonToken.VALUE_TRUE,t);}else     if (name.equals("testEnum")){assertToken(JsonToken.VALUE_STRING,t);assertEquals(FixtureObject.VALUE_ENUM.toString(),getAndVerifyText(jp));}else     if (name.equals("testInteger")){assertToken(JsonToken.VALUE_NUMBER_INT,t);assertEquals(jp.getIntValue(),FixtureObject.VALUE_INT);}else     if (name.equals("testLong")){assertToken(JsonToken.VALUE_NUMBER_INT,t);assertEquals(jp.getLongValue(),FixtureObject.VALUE_LONG);}else     if (name.equals("testBigInteger")){assertToken(JsonToken.VALUE_NUMBER_INT,t);assertEquals(jp.getLongValue(),FixtureObject.VALUE_BIGINT.longValue());}else     if (name.equals("testBigDecimal")){assertToken(JsonToken.VALUE_NUMBER_FLOAT,t);assertEquals(jp.getText(),FixtureObject.VALUE_BIGDEC.toString());}else     if (name.equals("testCharacter")){assertToken(JsonToken.VALUE_STRING,t);assertEquals(String.valueOf(FixtureObject.VALUE_CHAR),getAndVerifyText(jp));}else     if (name.equals("testShort")){assertToken(JsonToken.VALUE_NUMBER_INT,t);assertEquals(jp.getIntValue(),FixtureObject.VALUE_SHORT);}else     if (name.equals("testByte")){assertToken(JsonToken.VALUE_NUMBER_INT,t);assertEquals(jp.getIntValue(),FixtureObject.VALUE_BYTE);}else     if (name.equals("testFloat")){assertToken(JsonToken.VALUE_NUMBER_FLOAT,t);assertEquals(jp.getDecimalValue().floatValue(),FixtureObject.VALUE_FLOAT);}else     if (name.equals("testDouble")){assertToken(JsonToken.VALUE_NUMBER_FLOAT,t);assertEquals(jp.getDoubleValue(),FixtureObject.VALUE_DBL);}else     if (name.equals("testStringBuffer")){assertToken(JsonToken.VALUE_STRING,t);assertEquals(FixtureObject.VALUE_STRING,getAndVerifyText(jp));}else     if (name.equals("testError")){assertToken(JsonToken.START_OBJECT,t);while (jp.nextToken()== JsonToken.FIELD_NAME){name=jp.getCurrentName();if (name.equals("cause")){assertEquals(JsonToken.VALUE_NULL,jp.nextToken());}else         if (name.equals("message")){assertEquals(JsonToken.VALUE_STRING,jp.nextToken());assertEquals(FixtureObject.VALUE_ERRTXT,getAndVerifyText(jp));}else         if (name.equals("localizedMessage")){assertEquals(JsonToken.VALUE_STRING,jp.nextToken());}else         if (name.equals("stackTrace")){assertEquals(JsonToken.START_ARRAY,jp.nextToken());int i=0;while (jp.nextToken()!= JsonToken.END_ARRAY){if (i >= 100000){assertTrue("Probably run away loop in test. StackTrack Array was not properly closed.",false);}}}else         if (name.equals("suppressed")){assertEquals(JsonToken.START_ARRAY,jp.nextToken());assertEquals(JsonToken.END_ARRAY,jp.nextToken());}else {fail("Unexpected field name '" + name + "'");}}assertEquals(JsonToken.END_OBJECT,jp.getCurrentToken());}else {fail("Unexpected field,name '" + name + "'");}}assertNull(jp.nextToken());}
public void testTagList()throws Exception {ObjectMapper m=new ObjectMapper();TagList list=new TagList();list.add(Tag.A);list.add(Tag.B);String json=m.writeValueAsString(list);TagList result=m.readValue(json,TagList.class);assertEquals(2,result.size());assertSame(Tag.A,result.get(0));assertSame(Tag.B,result.get(1));}
public void testEnumInterface()throws Exception {ObjectMapper m=new ObjectMapper();String json=m.writeValueAsString(Tag.B);EnumInterface result=m.readValue(json,EnumInterface.class);assertSame(Tag.B,result);}
public void testEnumInterfaceList()throws Exception {ObjectMapper m=new ObjectMapper();EnumInterfaceList list=new EnumInterfaceList();list.add(Tag.A);list.add(Tag.B);String json=m.writeValueAsString(list);EnumInterfaceList result=m.readValue(json,EnumInterfaceList.class);assertEquals(2,result.size());assertSame(Tag.A,result.get(0));assertSame(Tag.B,result.get(1));}
public void testUntypedEnum()throws Exception {ObjectMapper mapper=new ObjectMapper();String str=mapper.writeValueAsString(new UntypedEnumBean(TestEnum.B));UntypedEnumBean result=mapper.readValue(str,UntypedEnumBean.class);assertNotNull(result);assertNotNull(result.value);Object ob=result.value;assertSame(TestEnum.class,ob.getClass());assertEquals(TestEnum.B,result.value);}
public void testSimpleBuilder()throws Exception {ValueClassXY value=MAPPER.readValue("[1,2]",ValueClassXY.class);assertEquals(2,value._x);assertEquals(3,value._y);}
public void testBoolean()throws Exception {assertEquals("true",serializeAsString(MAPPER,Boolean.TRUE));assertEquals("false",serializeAsString(MAPPER,Boolean.FALSE));}
public void testBooleanArray()throws Exception {assertEquals("[true,false]",serializeAsString(MAPPER,new boolean[]{true,false}));assertEquals("[true,false]",serializeAsString(MAPPER,new Boolean[]{Boolean.TRUE,Boolean.FALSE}));}
public void testByteArray()throws Exception {byte[]data={1,17,-3,127,-128};Byte[]data2=new Byte[data.length];for (int i=0;i < data.length;++i){data2[i]=data[i];}String str1=serializeAsString(MAPPER,data);String str2=serializeAsString(MAPPER,data2);assertArrayEquals(data,MAPPER.readValue(str1,byte[].class));assertArrayEquals(data2,MAPPER.readValue(str2,Byte[].class));}
public void testBase64Variants()throws Exception {final byte[]INPUT="abcdefghijklmnopqrstuvwxyz1234567890abcdefghijklmnopqrstuvwxyz1234567890X".getBytes("UTF-8");assertEquals(quote("YWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXoxMjM0NTY3ODkwYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXoxMjM0NTY3ODkwWA=="),MAPPER.writeValueAsString(INPUT));assertEquals(quote("YWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXoxMjM0NTY3ODkwYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXoxMjM0NTY3ODkwWA=="),MAPPER.writer(Base64Variants.MIME_NO_LINEFEEDS).writeValueAsString(INPUT));assertEquals(quote("YWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXoxMjM0NTY3ODkwYWJjZGVmZ2hpamtsbW5vcHFyc3R1\\ndnd4eXoxMjM0NTY3ODkwWA=="),MAPPER.writer(Base64Variants.MIME).writeValueAsString(INPUT));assertEquals(quote("YWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXoxMjM0NTY3ODkwYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXoxMjM0NTY3ODkwWA"),MAPPER.writer(Base64Variants.MODIFIED_FOR_URL).writeValueAsString(INPUT));assertEquals(quote("YWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXoxMjM0NTY3ODkwYWJjZGVmZ2hpamts\\nbW5vcHFyc3R1dnd4eXoxMjM0NTY3ODkwWA=="),MAPPER.writer(Base64Variants.PEM).writeValueAsString(INPUT));}
public void testShortArray()throws Exception {assertEquals("[0,1]",serializeAsString(MAPPER,new short[]{0,1}));assertEquals("[2,3]",serializeAsString(MAPPER,new Short[]{2,3}));}
public void testIntArray()throws Exception {assertEquals("[0,-3]",serializeAsString(MAPPER,new int[]{0,-3}));assertEquals("[13,9]",serializeAsString(MAPPER,new Integer[]{13,9}));}
public void testFloat()throws Exception {double[]values=new double[]{0.0,1.0,0.1,-37.01,999.99,0.3,33.3,Double.NaN,Double.POSITIVE_INFINITY,Double.NEGATIVE_INFINITY};for(double d : values){float f=(float)d;String expected=String.valueOf(f);if (Float.isNaN(f)|| Float.isInfinite(f)){expected="\"" + expected + "\"";}assertEquals(expected,serializeAsString(MAPPER,Float.valueOf(f)));}}
public void testDouble()throws Exception {double[]values=new double[]{0.0,1.0,0.1,-37.01,999.99,0.3,33.3,Double.NaN,Double.POSITIVE_INFINITY,Double.NEGATIVE_INFINITY};for(double d : values){String expected=String.valueOf(d);if (Double.isNaN(d)|| Double.isInfinite(d)){expected="\"" + d + "\"";}assertEquals(expected,MAPPER.writeValueAsString(Double.valueOf(d)));}}
public void testBigInteger()throws Exception {BigInteger[]values=new BigInteger[]{BigInteger.ONE,BigInteger.TEN,BigInteger.ZERO,BigInteger.valueOf(1234567890L),new BigInteger("123456789012345678901234568"),new BigInteger("-1250000124326904597090347547457")};for(BigInteger value : values){String expected=value.toString();assertEquals(expected,MAPPER.writeValueAsString(value));}}
public void testClass()throws Exception {String result=MAPPER.writeValueAsString(java.util.List.class);assertEquals("\"java.util.List\"",result);}
public void testSimple()throws Exception {String JSON="\"OK\" \"RULES\"  null";JsonParser jp=MAPPER.getFactory().createParser(JSON);assertEquals(TestEnum.OK,MAPPER.readValue(jp,TestEnum.class));assertEquals(TestEnum.RULES,MAPPER.readValue(jp,TestEnum.class));assertNull(MAPPER.readValue(jp,TestEnum.class));assertFalse(jp.hasCurrentToken());assertEquals(TestEnum.JACKSON,MAPPER.readValue(" 0 ",TestEnum.class));try {MAPPER.readValue("\"NO-SUCH-VALUE\"",TestEnum.class);fail("Expected an exception for bogus enum value...");}catch(JsonMappingException jex){verifyException(jex,"value not one of declared");}}
/** * Enums are considered complex if they have code (and hence sub-classes)... an example is TimeUnit*/public void testComplexEnum()throws Exception {String json=MAPPER.writeValueAsString(TimeUnit.SECONDS);assertEquals(quote("SECONDS"),json);TimeUnit result=MAPPER.readValue(json,TimeUnit.class);assertSame(TimeUnit.SECONDS,result);}
/** * Testing to see that annotation override works*/public void testAnnotated()throws Exception {AnnotatedTestEnum e=MAPPER.readValue("\"JACKSON\"",AnnotatedTestEnum.class);assertEquals(AnnotatedTestEnum.OK,e);}
public void testEnumMaps()throws Exception {EnumMap<TestEnum,String> value=MAPPER.readValue("{\"OK\":\"value\"}",new TypeReference<EnumMap<TestEnum,String>>(){});assertEquals("value",value.get(TestEnum.OK));}
public void testSubclassedEnums()throws Exception {EnumWithSubClass value=MAPPER.readValue("\"A\"",EnumWithSubClass.class);assertEquals(EnumWithSubClass.A,value);}
public void testCreatorEnums()throws Exception {EnumWithCreator value=MAPPER.readValue("\"enumA\"",EnumWithCreator.class);assertEquals(EnumWithCreator.A,value);}
public void testToStringEnums()throws Exception {ObjectMapper m=new ObjectMapper();m.configure(DeserializationFeature.READ_ENUMS_USING_TO_STRING,true);LowerCaseEnum value=m.readValue("\"c\"",LowerCaseEnum.class);assertEquals(LowerCaseEnum.C,value);}
public void testToStringEnumMaps()throws Exception {ObjectMapper m=new ObjectMapper();m.configure(DeserializationFeature.READ_ENUMS_USING_TO_STRING,true);EnumMap<LowerCaseEnum,String> value=m.readValue("{\"a\":\"value\"}",new TypeReference<EnumMap<LowerCaseEnum,String>>(){});assertEquals("value",value.get(LowerCaseEnum.A));}
public void testNumbersToEnums()throws Exception {assertFalse(MAPPER.getDeserializationConfig().isEnabled(DeserializationFeature.FAIL_ON_NUMBERS_FOR_ENUMS));TestEnum value=MAPPER.readValue("1",TestEnum.class);assertSame(TestEnum.RULES,value);ObjectMapper m=new ObjectMapper();m.configure(DeserializationFeature.FAIL_ON_NUMBERS_FOR_ENUMS,true);try {value=m.readValue("1",TestEnum.class);fail("Expected an error");}catch(JsonMappingException e){verifyException(e,"Not allowed to deserialize Enum value out of JSON number");}}
public void testEnumsWithIndex()throws Exception {ObjectMapper m=new ObjectMapper();m.enable(SerializationFeature.WRITE_ENUMS_USING_INDEX);String json=m.writeValueAsString(TestEnum.RULES);assertEquals(String.valueOf(TestEnum.RULES.ordinal()),json);TestEnum result=m.readValue(json,TestEnum.class);assertSame(TestEnum.RULES,result);}
public void testEnumsWithJsonValue()throws Exception {EnumWithJsonValue e=MAPPER.readValue(quote("foo"),EnumWithJsonValue.class);assertSame(EnumWithJsonValue.A,e);e=MAPPER.readValue(quote("bar"),EnumWithJsonValue.class);assertSame(EnumWithJsonValue.B,e);EnumSet<EnumWithJsonValue> set=MAPPER.readValue("[\"bar\"]",new TypeReference<EnumSet<EnumWithJsonValue>>(){});assertNotNull(set);assertEquals(1,set.size());assertTrue(set.contains(EnumWithJsonValue.B));assertFalse(set.contains(EnumWithJsonValue.A));EnumMap<EnumWithJsonValue,Integer> map=MAPPER.readValue("{\"foo\":13}",new TypeReference<EnumMap<EnumWithJsonValue,Integer>>(){});assertNotNull(map);assertEquals(1,map.size());assertEquals(Integer.valueOf(13),map.get(EnumWithJsonValue.A));}
public void testEnumWithCreatorEnumMaps()throws Exception {EnumMap<EnumWithCreator,String> value=MAPPER.readValue("{\"enumA\":\"value\"}",new TypeReference<EnumMap<EnumWithCreator,String>>(){});assertEquals("value",value.get(EnumWithCreator.A));}
public void testEnumWithCreatorMaps()throws Exception {java.util.HashMap<EnumWithCreator,String> value=MAPPER.readValue("{\"enumA\":\"value\"}",new TypeReference<java.util.HashMap<EnumWithCreator,String>>(){});assertEquals("value",value.get(EnumWithCreator.A));}
public void testEnumWithCreatorEnumSets()throws Exception {EnumSet<EnumWithCreator> value=MAPPER.readValue("[\"enumA\"]",new TypeReference<EnumSet<EnumWithCreator>>(){});assertTrue(value.contains(EnumWithCreator.A));}
public void testAllowUnknownEnumValuesReadAsNull()throws Exception {ObjectReader reader=MAPPER.reader(DeserializationFeature.READ_UNKNOWN_ENUM_VALUES_AS_NULL);assertNull(reader.withType(TestEnum.class).readValue("\"NO-SUCH-VALUE\""));assertNull(reader.withType(TestEnum.class).readValue(" 4343 "));}
public void testAllowUnknownEnumValuesForEnumSets()throws Exception {ObjectReader reader=MAPPER.reader(DeserializationFeature.READ_UNKNOWN_ENUM_VALUES_AS_NULL);EnumSet<TestEnum> result=reader.withType(new TypeReference<EnumSet<TestEnum>>(){}).readValue("[\"NO-SUCH-VALUE\"]");assertEquals(0,result.size());}
public void testAllowUnknownEnumValuesAsMapKeysReadAsNull()throws Exception {ObjectReader reader=MAPPER.reader(DeserializationFeature.READ_UNKNOWN_ENUM_VALUES_AS_NULL);ClassWithEnumMapKey result=reader.withType(ClassWithEnumMapKey.class).readValue("{\"map\":{\"NO-SUCH-VALUE\":\"val\"}}");assertTrue(result.map.containsKey(null));}
public void testDoNotAllowUnknownEnumValuesAsMapKeysWhenReadAsNullDisabled()throws Exception {assertFalse(MAPPER.isEnabled(DeserializationFeature.READ_UNKNOWN_ENUM_VALUES_AS_NULL));try {MAPPER.readValue("{\"map\":{\"NO-SUCH-VALUE\":\"val\"}}",ClassWithEnumMapKey.class);fail("Expected an exception for bogus enum value...");}catch(JsonMappingException jex){verifyException(jex,"Can not construct Map key");}}
public void testEnumsFromInts()throws Exception {ObjectMapper mapper=new ObjectMapper();TestEnumFor834 res=mapper.readValue("1 ",TestEnumFor834.class);assertSame(TestEnumFor834.ENUM_A,res);}
public void testEnumsWithEmpty()throws Exception {final ObjectMapper m=new ObjectMapper();m.configure(DeserializationFeature.ACCEPT_EMPTY_STRING_AS_NULL_OBJECT,true);TestEnum result=m.readValue("\"\"",TestEnum.class);assertNull(result);}
public void testCustomBeanDeserializer()throws Exception {String json="{\"beans\":[{\"c\":{\"a\":10,\"b\":20},\"d\":\"hello,tatu\"}]}";TestBeans beans=MAPPER.readValue(json,TestBeans.class);assertNotNull(beans);List<TestBean> results=beans.beans;assertNotNull(results);assertEquals(1,results.size());TestBean bean=results.get(0);assertEquals("hello,tatu",bean.d);CustomBean c=bean.c;assertNotNull(c);assertEquals(10,c.a);assertEquals(20,c.b);json="{\"beans\":[{\"c\":{\"b\":3,\"a\":-4},\"d\":\"\"}," + "{\"d\":\"abc\",\"c\":{\"b\":15}}]}";beans=MAPPER.readValue(json,TestBeans.class);assertNotNull(beans);results=beans.beans;assertNotNull(results);assertEquals(2,results.size());bean=results.get(0);assertEquals("",bean.d);c=bean.c;assertNotNull(c);assertEquals(-4,c.a);assertEquals(3,c.b);bean=results.get(1);assertEquals("abc",bean.d);c=bean.c;assertNotNull(c);assertEquals(0,c.a);assertEquals(15,c.b);}
public void testDelegating()throws Exception {ObjectMapper mapper=new ObjectMapper();SimpleModule module=new SimpleModule("test",Version.unknownVersion());module.addDeserializer(Immutable.class,new StdDelegatingDeserializer<Immutable>(new StdConverter<JsonNode,Immutable>(){@Override public Immutable convert(JsonNode value){int x=value.path("x").asInt();int y=value.path("y").asInt();return new Immutable(x,y);}}));mapper.registerModule(module);Immutable imm=mapper.readValue("{\"x\":3,\"y\":7}",Immutable.class);assertEquals(3,imm.x);assertEquals(7,imm.y);}
public void testIssue882()throws Exception {Model original=new Model(Collections.singletonMap(new CustomKey(123),"test"));String json=MAPPER.writeValueAsString(original);Model deserialized=MAPPER.readValue(json,Model.class);assertNotNull(deserialized);assertNotNull(deserialized.map);assertEquals(1,deserialized.map.size());}
public void testSimpleSerializationClass()throws Exception {Identifiable src=new Identifiable(13);src.next=src;String json=MAPPER.writeValueAsString(src);assertEquals(EXP_SIMPLE_INT_CLASS,json);json=MAPPER.writeValueAsString(src);assertEquals(EXP_SIMPLE_INT_CLASS,json);}
public void testSimpleSerializationProperty()throws Exception {IdWrapper src=new IdWrapper(7);src.node.next=src;String json=MAPPER.writeValueAsString(src);assertEquals(EXP_SIMPLE_INT_PROP,json);json=MAPPER.writeValueAsString(src);assertEquals(EXP_SIMPLE_INT_PROP,json);}
public void testCustomPropertyForClass()throws Exception {IdentifiableWithProp src=new IdentifiableWithProp(123,-19);src.next=src;String json=MAPPER.writeValueAsString(src);assertEquals(EXP_CUSTOM_PROP,json);json=MAPPER.writeValueAsString(src);assertEquals(EXP_CUSTOM_PROP,json);}
public void testCustomPropertyViaProperty()throws Exception {IdWrapperCustom src=new IdWrapperCustom(123,7);src.node.next=src;String json=MAPPER.writeValueAsString(src);assertEquals(EXP_CUSTOM_PROP_VIA_REF,json);json=MAPPER.writeValueAsString(src);assertEquals(EXP_CUSTOM_PROP_VIA_REF,json);}
public void testAlwaysAsId()throws Exception {String json=MAPPER.writeValueAsString(new AlwaysContainer());assertEquals("{\"a\":1,\"b\":2}",json);}
public void testAlwaysIdForTree()throws Exception {TreeNode root=new TreeNode(null,1,"root");TreeNode leaf=new TreeNode(root,2,"leaf");root.child=leaf;String json=MAPPER.writeValueAsString(root);assertEquals("{\"id\":1,\"name\":\"root\",\"parent\":null,\"child\":" + "{\"id\":2,\"name\":\"leaf\",\"parent\":1,\"child\":null}}",json);}
public void testInvalidProp()throws Exception {try {MAPPER.writeValueAsString(new Broken());fail("Should have thrown an exception");}catch(JsonMappingException e){verifyException(e,"can not find property with name 'id'");}}
public void testSimpleGetters()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.setPropertyNamingStrategy(new PrefixStrategy());assertEquals("{\"Get-key\":123}",mapper.writeValueAsString(new GetterBean()));}
public void testSimpleSetters()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.setPropertyNamingStrategy(new PrefixStrategy());SetterBean bean=mapper.readValue("{\"Set-key\":13}",SetterBean.class);assertEquals(13,bean.value);}
public void testSimpleFields()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.setPropertyNamingStrategy(new PrefixStrategy());String json=mapper.writeValueAsString(new FieldBean(999));assertEquals("{\"Field-key\":999}",json);FieldBean result=mapper.readValue(json,FieldBean.class);assertEquals(999,result.key);}
public void testCStyleNaming()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.setPropertyNamingStrategy(new CStyleStrategy());String json=mapper.writeValueAsString(new PersonBean("Joe","Sixpack",42));assertEquals("{\"first_name\":\"Joe\",\"last_name\":\"Sixpack\",\"age\":42}",json);PersonBean result=mapper.readValue(json,PersonBean.class);assertEquals("Joe",result.firstName);assertEquals("Sixpack",result.lastName);assertEquals(42,result.age);}
public void testWithGetterAsSetter()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.setPropertyNamingStrategy(new CStyleStrategy());SetterlessWithValue input=new SetterlessWithValue().add(3);String json=mapper.writeValueAsString(input);assertEquals("{\"value_list\":[{\"int_value\":3}]}",json);SetterlessWithValue result=mapper.readValue(json,SetterlessWithValue.class);assertNotNull(result.values);assertEquals(1,result.values.size());assertEquals(3,result.values.get(0).intValue);}
public void testJson()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.setPropertyNamingStrategy(new LcStrategy());RenamedCollectionBean foo=mapper.readValue("{\"thevalues\":[\"a\"]}",RenamedCollectionBean.class);assertNotNull(foo.getTheVALUEs());assertEquals(1,foo.getTheVALUEs().size());assertEquals("a",foo.getTheVALUEs().get(0));}
public void testPerClassAnnotation()throws Exception {final ObjectMapper mapper=new ObjectMapper();mapper.setPropertyNamingStrategy(new LcStrategy());BeanWithPrefixNames input=new BeanWithPrefixNames();String json=mapper.writeValueAsString(input);assertEquals("{\"Get-a\":3}",json);BeanWithPrefixNames output=mapper.readValue("{\"Set-a\":7}",BeanWithPrefixNames.class);assertEquals(7,output.a);}
/** * Test to verify details of how trying to deserialize into abstract type should fail (if there is no way to determine actual type information for the concrete type to use)*/public void testAbstractFailure()throws Exception {ObjectMapper m=new ObjectMapper();try {m.readValue("{\"x\" : 3 }",Abstract.class);fail("Should fail on trying to deserialize abstract type");}catch(JsonProcessingException e){verifyException(e,"can not construct");}}
public void testSimple(){POJOPropertiesCollector coll=collector(SimpleBuilder.class,"with");Map<String,POJOPropertyBuilder> props=coll.getPropertyMap();assertEquals(1,props.size());POJOPropertyBuilder prop=props.get("x");assertNotNull(prop);assertTrue(prop.hasField());assertFalse(prop.hasGetter());assertTrue(prop.hasSetter());}
public void testPropertyRemoval()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.registerModule(new ModuleImpl(new RemovingModifier("a")));Bean bean=new Bean();assertEquals("{\"b\":\"b\"}",mapper.writeValueAsString(bean));}
public void testPropertyReorder()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.registerModule(new ModuleImpl(new ReorderingModifier()));Bean bean=new Bean();assertEquals("{\"a\":\"a\",\"b\":\"b\"}",mapper.writeValueAsString(bean));}
public void testBuilderReplacement()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.registerModule(new ModuleImpl(new BuilderModifier(new BogusBeanSerializer(17))));Bean bean=new Bean();assertEquals("17",mapper.writeValueAsString(bean));}
public void testSerializerReplacement()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.registerModule(new ModuleImpl(new ReplacingModifier(new BogusBeanSerializer(123))));Bean bean=new Bean();assertEquals("123",mapper.writeValueAsString(bean));}
public void testEmptyBean()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.registerModule(new SimpleModule("test",Version.unknownVersion()){@Override public void setupModule(SetupContext context){super.setupModule(context);context.addBeanSerializerModifier(new EmptyBeanModifier());}});String json=mapper.writeValueAsString(new EmptyBean());assertEquals("{\"bogus\":\"foo\"}",json);}
public void testModifyArraySerializer()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.registerModule(new SimpleModule("test").setSerializerModifier(new ArraySerializerModifier()));assertEquals("123",mapper.writeValueAsString(new Integer[]{1,2}));}
public void testModifyCollectionSerializer()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.registerModule(new SimpleModule("test").setSerializerModifier(new CollectionSerializerModifier()));assertEquals("123",mapper.writeValueAsString(new ArrayList<Integer>()));}
public void testModifyMapSerializer()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.registerModule(new SimpleModule("test").setSerializerModifier(new MapSerializerModifier()));assertEquals("123",mapper.writeValueAsString(new HashMap<String,String>()));}
public void testModifyEnumSerializer()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.registerModule(new SimpleModule("test").setSerializerModifier(new EnumSerializerModifier()));assertEquals("123",mapper.writeValueAsString(EnumABC.C));}
public void testModifyKeySerializer()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.registerModule(new SimpleModule("test").setSerializerModifier(new KeySerializerModifier()));Map<String,Integer> map=new HashMap<String,Integer>();map.put("x",3);assertEquals("{\"foo\":3}",mapper.writeValueAsString(map));}
public void testFailWithDupProps()throws Exception {BeanWithConflict bean=new BeanWithConflict();ObjectMapper mapper=new ObjectMapper();try {String json=mapper.writeValueAsString(bean);fail("Should have failed due to conflicting accessor definitions;got JSON = " + json);}catch(JsonProcessingException e){verifyException(e,"Conflicting getter definitions");}}
public void testAtomicBoolean()throws Exception {ObjectMapper mapper=new ObjectMapper();assertEquals("true",serializeAsString(mapper,new AtomicBoolean(true)));assertEquals("false",serializeAsString(mapper,new AtomicBoolean(false)));}
public void testAtomicInteger()throws Exception {ObjectMapper mapper=new ObjectMapper();assertEquals("1",serializeAsString(mapper,new AtomicInteger(1)));assertEquals("-9",serializeAsString(mapper,new AtomicInteger(-9)));}
public void testAtomicLong()throws Exception {ObjectMapper mapper=new ObjectMapper();assertEquals("0",serializeAsString(mapper,new AtomicLong(0)));}
public void testAtomicReference()throws Exception {ObjectMapper mapper=new ObjectMapper();String[]strs=new String[]{"abc"};assertEquals("[\"abc\"]",serializeAsString(mapper,new AtomicReference<String[]>(strs)));}
public void testClassMixInsTopLevel()throws IOException {ObjectMapper mapper=new ObjectMapper();Map<String,Object> result;result=writeAndMap(mapper,new LeafClass("abc"));assertEquals(1,result.size());assertEquals("abc",result.get("a"));mapper=new ObjectMapper();mapper.addMixInAnnotations(LeafClass.class,MixIn.class);result=writeAndMap(mapper,new LeafClass("abc"));assertEquals(2,result.size());assertEquals("abc",result.get("a"));assertEquals("c",result.get("c"));mapper=new ObjectMapper();mapper.addMixInAnnotations(BaseClass.class,MixIn.class);result=writeAndMap(mapper,new LeafClass("abc"));assertEquals(1,result.size());assertEquals("abc",result.get("a"));}
public void testClassMixInsMidLevel()throws IOException {ObjectMapper mapper=new ObjectMapper();Map<String,Object> result;LeafClass bean=new LeafClass("xyz");bean._c="c2";result=writeAndMap(mapper,bean);assertEquals(2,result.size());assertEquals("xyz",result.get("a"));assertEquals("c2",result.get("c"));mapper=new ObjectMapper();mapper.addMixInAnnotations(BaseClass.class,MixInAutoDetect.class);result=writeAndMap(mapper,bean);assertEquals(1,result.size());assertEquals("c2",result.get("c"));}
public void testTimestampUtil()throws Exception {long now=123456789L;java.sql.Timestamp value=new java.sql.Timestamp(now);assertEquals(value,new ObjectMapper().readValue("" + now,java.sql.Timestamp.class));String dateStr=serializeTimestampAsString(value);java.sql.Timestamp result=new ObjectMapper().readValue("\"" + dateStr + "\"",java.sql.Timestamp.class);assertEquals("Date: expect " + value + " ("+ value.getTime()+ "),got "+ result+ " ("+ result.getTime()+ ")",value.getTime(),result.getTime());}
/** * Verifying that sub-classing works ok wrt generics information*/public void testListSubClass()throws Exception {ObjectMapper mapper=new ObjectMapper();ListSubClass result=mapper.readValue("[\"123\" ]",ListSubClass.class);assertEquals(1,result.size());Object value=result.get(0);assertEquals(StringWrapper.class,value.getClass());StringWrapper bw=(StringWrapper)value;assertEquals("123",bw.str);}
public void testAnnotatedLStringist()throws Exception {ObjectMapper mapper=new ObjectMapper();AnnotatedStringList result=mapper.readValue("[\"...\" ]",AnnotatedStringList.class);assertEquals(1,result.size());Object ob=result.get(0);assertEquals(StringWrapper.class,ob.getClass());assertEquals("...",((StringWrapper)ob).str);}
public void testAnnotatedBooleanList()throws Exception {ObjectMapper mapper=new ObjectMapper();AnnotatedBooleanList result=mapper.readValue("[false ]",AnnotatedBooleanList.class);assertEquals(1,result.size());Object ob=result.get(0);assertEquals(BooleanWrapper.class,ob.getClass());assertFalse(((BooleanWrapper)ob).b);}
public void testMaps(){TypeFactory tf=TypeFactory.defaultInstance();JavaType t=tf.constructType(new TypeReference<LongValuedMap<String>>(){});MapType type=(MapType)t;assertSame(LongValuedMap.class,type.getRawClass());assertEquals(tf.constructType(String.class),type.getKeyType());assertEquals(tf.constructType(Long.class),type.getContentType());}
public void testList(){JavaType t;TypeFactory tf=TypeFactory.defaultInstance();t=tf.constructType(new TypeReference<MyLongList<Integer>>(){});CollectionType type=(CollectionType)t;assertSame(MyLongList.class,type.getRawClass());assertEquals(tf.constructType(Long.class),type.getContentType());t=tf.constructType(LongList.class);type=(CollectionType)t;assertSame(LongList.class,type.getRawClass());assertEquals(tf.constructType(Long.class),type.getContentType());}
/** * By default we should just get an exception if an unknown property is encountered*/public void testUnknownHandlingDefault()throws Exception {try {MAPPER.readValue(new StringReader(JSON_UNKNOWN_FIELD),TestBean.class);}catch(JsonMappingException jex){verifyException(jex,"Unrecognized field \"foo\"");}}
/** * Test that verifies that it is possible to ignore unknown properties using {@link DeserializationProblemHandler}.*/public void testUnknownHandlingIgnoreWithHandler()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.clearProblemHandlers();mapper.addHandler(new MyHandler());TestBean result=mapper.readValue(new StringReader(JSON_UNKNOWN_FIELD),TestBean.class);assertNotNull(result);assertEquals(1,result._a);assertEquals(-1,result._b);assertEquals("foo:START_ARRAY",result._unknown);}
/** * Test that verifies that it is possible to ignore unknown properties using {@link DeserializationProblemHandler}and an ObjectReader.*/public void testUnknownHandlingIgnoreWithHandlerAndObjectReader()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.clearProblemHandlers();TestBean result=mapper.reader(TestBean.class).withHandler(new MyHandler()).readValue(new StringReader(JSON_UNKNOWN_FIELD));assertNotNull(result);assertEquals(1,result._a);assertEquals(-1,result._b);assertEquals("foo:START_ARRAY",result._unknown);}
/** * Test for checking that it is also possible to simply suppress error reporting for unknown properties.*/public void testUnknownHandlingIgnoreWithFeature()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES,false);TestBean result=null;try {result=mapper.readValue(new StringReader(JSON_UNKNOWN_FIELD),TestBean.class);}catch(JsonMappingException jex){fail("Did not expect a problem,got: " + jex.getMessage());}assertNotNull(result);assertEquals(1,result._a);assertNull(result._unknown);assertEquals(-1,result._b);}
public void testWithClassIgnore()throws Exception {IgnoreSome result=MAPPER.readValue("{\"a\":1,\"b\":2,\"c\":\"x\",\"d\":\"y\"}",IgnoreSome.class);assertEquals(1,result.a);assertEquals("y",result.d());assertEquals(0,result.b);assertNull(result.c());}
public void testClassIgnoreWithMap()throws Exception {IgnoreMap result=MAPPER.readValue("{\"a\":[1],\n" + "\"b\":2,\n" + "\"c\": \"x\",\n"+ "\"d\":false }",IgnoreMap.class);assertEquals(2,result.size());Object ob=result.get("b");assertEquals(Integer.class,ob.getClass());assertEquals(Integer.valueOf(2),ob);assertEquals("x",result.get("c"));assertFalse(result.containsKey("a"));assertFalse(result.containsKey("d"));}
public void testClassWithIgnoreUnknown()throws Exception {IgnoreUnknown result=MAPPER.readValue("{\"b\":3,\"c\":[1,2],\"x\":{},\"a\":-3}",IgnoreUnknown.class);assertEquals(-3,result.a);}
/** * Test that verifies that use of  {@link JsonIgnore}will add implicitskipping of matching properties.*/public void testClassWithUnknownAndIgnore()throws Exception {ImplicitIgnores result=MAPPER.readValue("{\"a\":1,\"b\":2,\"c\":3 }",ImplicitIgnores.class);assertEquals(3,result.c);try {MAPPER.readValue("{\"a\":1,\"b\":2,\"c\":3,\"d\":4 }",ImplicitIgnores.class);}catch(JsonMappingException e){verifyException(e,"Unrecognized field \"d\"");}}
public void testPropertyIgnoral()throws Exception {XYZWrapper1 result=MAPPER.readValue("{\"value\":{\"y\":2,\"x\":1,\"z\":3}}",XYZWrapper1.class);assertEquals(2,result.value.y);assertEquals(3,result.value.z);}
public void testPropertyIgnoralWithClass()throws Exception {XYZWrapper2 result=MAPPER.readValue("{\"value\":{\"y\":2,\"x\":1,\"z\":3}}",XYZWrapper2.class);assertEquals(1,result.value.x);}
public void testPropertyIgnoralForMap()throws Exception {MapWithoutX result=MAPPER.readValue("{\"values\":{\"x\":1,\"y\":2}}",MapWithoutX.class);assertNotNull(result.values);assertEquals(1,result.values.size());assertEquals(Integer.valueOf(2),result.values.get("y"));}
public void testSimpleStringGetter()throws Exception {ObjectMapper m=new ObjectMapper();String value="abc";String result=m.writeValueAsString(new ClassGetter<String>(value));String expected=String.format("{\"nonRaw\":\"%s\",\"raw\":%s,\"value\":%s}",value,value,value);assertEquals(expected,result);}
public void testSimpleNonStringGetter()throws Exception {ObjectMapper m=new ObjectMapper();int value=123;String result=m.writeValueAsString(new ClassGetter<Integer>(value));String expected=String.format("{\"nonRaw\":%d,\"raw\":%d,\"value\":%d}",value,value,value);assertEquals(expected,result);}
public void testNullStringGetter()throws Exception {ObjectMapper m=new ObjectMapper();String result=m.writeValueAsString(new ClassGetter<String>(null));String expected="{\"nonRaw\":null,\"raw\":null,\"value\":null}";assertEquals(expected,result);}
public void testProps(){ObjectMapper m=new ObjectMapper();assertNotNull(m.getNodeFactory());JsonNodeFactory nf=JsonNodeFactory.instance;m.setNodeFactory(nf);assertSame(nf,m.getNodeFactory());}
public void testSupport(){assertTrue(MAPPER.canSerialize(String.class));assertTrue(MAPPER.canDeserialize(TypeFactory.defaultInstance().constructType(String.class)));}
public void testTreeRead()throws Exception {String JSON="{}";JsonNode n=MAPPER.readTree(JSON);assertTrue(n instanceof ObjectNode);n=MAPPER.readTree(new StringReader(JSON));assertTrue(n instanceof ObjectNode);n=MAPPER.readTree(new ByteArrayInputStream(JSON.getBytes("UTF-8")));assertTrue(n instanceof ObjectNode);}
public void testConfigForPropertySorting()throws Exception {ObjectMapper m=new ObjectMapper();assertFalse(m.isEnabled(MapperFeature.SORT_PROPERTIES_ALPHABETICALLY));SerializationConfig sc=m.getSerializationConfig();assertFalse(sc.isEnabled(MapperFeature.SORT_PROPERTIES_ALPHABETICALLY));assertFalse(sc.shouldSortPropertiesAlphabetically());DeserializationConfig dc=m.getDeserializationConfig();assertFalse(dc.shouldSortPropertiesAlphabetically());m.enable(MapperFeature.SORT_PROPERTIES_ALPHABETICALLY);sc=m.getSerializationConfig();assertTrue(sc.isEnabled(MapperFeature.SORT_PROPERTIES_ALPHABETICALLY));assertTrue(sc.shouldSortPropertiesAlphabetically());dc=m.getDeserializationConfig();assertTrue(dc.isEnabled(MapperFeature.SORT_PROPERTIES_ALPHABETICALLY));assertTrue(dc.shouldSortPropertiesAlphabetically());}
public void testJsonFactoryLinkage(){assertSame(MAPPER,MAPPER.getFactory().getCodec());JsonFactory f=new JsonFactory();ObjectMapper m=new ObjectMapper(f);assertSame(f,m.getFactory());assertSame(m,f.getCodec());}
/** * Test for verifying working of [JACKSON-191]*/public void testProviderConfig()throws Exception {ObjectMapper m=new ObjectMapper();assertEquals(0,m._deserializationContext._cache.cachedDeserializersCount());Bean bean=m.readValue("{\"x\" : 3 }",Bean.class);assertNotNull(bean);assertEquals(1,m._deserializationContext._cache.cachedDeserializersCount());m._deserializationContext._cache.flushCachedDeserializers();assertEquals(0,m._deserializationContext._cache.cachedDeserializersCount());}
public void testCopy()throws Exception {ObjectMapper m=new ObjectMapper();assertTrue(m.isEnabled(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES));m.disable(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES);assertFalse(m.isEnabled(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES));ObjectMapper m2=m.copy();assertFalse(m2.isEnabled(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES));m2.enable(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES);assertTrue(m2.isEnabled(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES));assertFalse(m.isEnabled(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES));assertFalse(m.isEnabled(DeserializationFeature.UNWRAP_ROOT_VALUE));assertFalse(m2.isEnabled(DeserializationFeature.UNWRAP_ROOT_VALUE));m.enable(DeserializationFeature.UNWRAP_ROOT_VALUE);assertTrue(m.isEnabled(DeserializationFeature.UNWRAP_ROOT_VALUE));assertFalse(m2.isEnabled(DeserializationFeature.UNWRAP_ROOT_VALUE));assertNotSame(m.getFactory(),m2.getFactory());assertEquals(0,m.getSerializationConfig().mixInCount());assertEquals(0,m2.getSerializationConfig().mixInCount());assertEquals(0,m.getDeserializationConfig().mixInCount());assertEquals(0,m2.getDeserializationConfig().mixInCount());m.addMixInAnnotations(String.class,Integer.class);assertEquals(1,m.getSerializationConfig().mixInCount());assertEquals(0,m2.getSerializationConfig().mixInCount());assertEquals(1,m.getDeserializationConfig().mixInCount());assertEquals(0,m2.getDeserializationConfig().mixInCount());}
public void testSimpleJsonValue()throws Exception {ObjectMapper m=new ObjectMapper();String json=serializeAsString(m,new Bean());Map<?,?> map=m.readValue(json,Map.class);assertEquals(2,map.size());assertEquals(Integer.valueOf(3),map.get("x"));assertEquals(Boolean.TRUE,map.get("a"));}
public void testAnyOnly()throws Exception {ObjectMapper m;m=new ObjectMapper();m.configure(SerializationFeature.FAIL_ON_EMPTY_BEANS,true);String json=serializeAsString(m,new AnyOnlyBean());assertEquals("{\"a\":3}",json);m=new ObjectMapper();m.configure(SerializationFeature.FAIL_ON_EMPTY_BEANS,false);json=serializeAsString(m,new AnyOnlyBean());assertEquals("{\"a\":3}",json);}
public void testAsInt()throws Exception {assertEquals(9,IntNode.valueOf(9).asInt());assertEquals(7,LongNode.valueOf(7L).asInt());assertEquals(13,new TextNode("13").asInt());assertEquals(0,new TextNode("foobar").asInt());assertEquals(27,new TextNode("foobar").asInt(27));assertEquals(1,BooleanNode.TRUE.asInt());}
public void testAsBoolean()throws Exception {assertEquals(false,BooleanNode.FALSE.asBoolean());assertEquals(true,BooleanNode.TRUE.asBoolean());assertEquals(false,IntNode.valueOf(0).asBoolean());assertEquals(true,IntNode.valueOf(1).asBoolean());assertEquals(false,LongNode.valueOf(0).asBoolean());assertEquals(true,LongNode.valueOf(-34L).asBoolean());assertEquals(true,new TextNode("true").asBoolean());assertEquals(false,new TextNode("false").asBoolean());assertEquals(false,new TextNode("barf").asBoolean());assertEquals(true,new TextNode("barf").asBoolean(true));assertEquals(true,new POJONode(Boolean.TRUE).asBoolean());}
public void testTreeToValue()throws Exception {String JSON="{\"leaf\":{\"value\":13}}";ObjectMapper mapper=new ObjectMapper();mapper.addMixInAnnotations(Leaf.class,LeafMixIn.class);JsonNode root=mapper.readTree(JSON);Root r1=mapper.treeToValue(root,Root.class);assertNotNull(r1);assertEquals(13,r1.leaf.value);}
public void testBase64Text()throws Exception {final int[]LENS={1,2,3,4,7,9,32,33,34,35};final Base64Variant[]VARIANTS={Base64Variants.MIME,Base64Variants.MIME_NO_LINEFEEDS,Base64Variants.MODIFIED_FOR_URL,Base64Variants.PEM};for(int len : LENS){byte[]input=new byte[len];for (int i=0;i < input.length;++i){input[i]=(byte)i;}for(Base64Variant variant : VARIANTS){TextNode n=new TextNode(variant.encode(input));byte[]data=null;try {data=n.getBinaryValue(variant);}catch(Exception e){throw new IOException("Failed (variant " + variant + ",data length "+ len+ "): "+ e.getMessage());}assertNotNull(data);assertArrayEquals(data,input);}}}
/** * Simple test to verify that byte[]values can be handled properly when converting,as long as there is metadata (from POJO definitions).*/public void testIssue709()throws Exception {byte[]inputData=new byte[]{1,2,3};ObjectNode node=MAPPER.createObjectNode();node.put("data",inputData);Issue709Bean result=MAPPER.treeToValue(node,Issue709Bean.class);String json=MAPPER.writeValueAsString(node);Issue709Bean resultFromString=MAPPER.readValue(json,Issue709Bean.class);Issue709Bean resultFromConvert=MAPPER.convertValue(node,Issue709Bean.class);Assert.assertArrayEquals(inputData,resultFromString.data);Assert.assertArrayEquals(inputData,resultFromConvert.data);Assert.assertArrayEquals(inputData,result.data);}
public void testEmbeddedObject()throws Exception {TokenBuffer buf=new TokenBuffer(MAPPER);buf.writeObject(new byte[3]);JsonNode node=MAPPER.readTree(buf.asParser());buf.close();assertTrue(node.isBinary());byte[]data=node.binaryValue();assertNotNull(data);assertEquals(3,data.length);}
public void testEmbeddedObjectInArray()throws Exception {TokenBuffer buf=new TokenBuffer(MAPPER);buf.writeStartArray();buf.writeObject(MARKER);buf.writeEndArray();JsonNode node=MAPPER.readTree(buf.asParser());buf.close();assertTrue(node.isArray());assertEquals(1,node.size());JsonNode n=node.get(0);assertTrue(n.isPojo());assertSame(MARKER,((POJONode)n).getPojo());}
public void testEmbeddedObjectInObject()throws Exception {TokenBuffer buf=new TokenBuffer(MAPPER);buf.writeStartObject();buf.writeFieldName("pojo");buf.writeObject(MARKER);buf.writeEndObject();JsonNode node=MAPPER.readTree(buf.asParser());buf.close();assertTrue(node.isObject());assertEquals(1,node.size());JsonNode n=node.get("pojo");assertTrue(n.isPojo());assertSame(MARKER,((POJONode)n).getPojo());}
public void testSimpleIgnore()throws Exception {ObjectMapper m=new ObjectMapper();Map<String,Object> result=writeAndMap(m,new SizeClassEnabledIgnore());assertEquals(1,result.size());assertEquals(Integer.valueOf(1),result.get("x"));assertNull(result.get("y"));}
public void testDisabledIgnore()throws Exception {ObjectMapper m=new ObjectMapper();Map<String,Object> result=writeAndMap(m,new SizeClassDisabledIgnore());assertEquals(2,result.size());assertEquals(Integer.valueOf(3),result.get("x"));assertEquals(Integer.valueOf(4),result.get("y"));}
/** * Test case to verify that ignore tag can also be disabled via inheritance*/public void testIgnoreOver()throws Exception {ObjectMapper m=new ObjectMapper();Map<String,Object> result=writeAndMap(m,new BaseClassIgnore());assertEquals(1,result.size());assertEquals(Integer.valueOf(2),result.get("y"));result=writeAndMap(m,new SubClassNonIgnore());assertEquals(2,result.size());assertEquals(Integer.valueOf(3),result.get("x"));assertEquals(Integer.valueOf(2),result.get("y"));}
/** * @since 1.7*/public void testIgnoreType()throws Exception {ObjectMapper m=new ObjectMapper();assertEquals("{\"value\":13}",m.writeValueAsString(new NonIgnoredType()));}
public void testSimpleGetter()throws Exception {Map<String,Object> result=writeAndMap(MAPPER,new SizeClassGetter());assertEquals(3,result.size());assertEquals(Integer.valueOf(3),result.get("size"));assertEquals(Integer.valueOf(-17),result.get("length"));assertEquals(Integer.valueOf(0),result.get("value"));}
public void testSimpleGetter2()throws Exception {Map<String,Object> result=writeAndMap(MAPPER,new SizeClassGetter2());assertEquals(1,result.size());assertEquals(Integer.valueOf(3),result.get("x"));}
public void testSimpleGetter3()throws Exception {Map<String,Object> result=writeAndMap(MAPPER,new SizeClassGetter3());assertEquals(1,result.size());assertEquals(Integer.valueOf(8),result.get("y"));}
/** * Let's also verify that inherited super-class getters are used as expected*/public void testGetterInheritance()throws Exception {Map<String,Object> result=writeAndMap(MAPPER,new SubClassBean());assertEquals(3,result.size());assertEquals(Integer.valueOf(1),result.get("x"));assertEquals(Integer.valueOf(2),result.get("y"));assertEquals(Integer.valueOf(3),result.get("z"));}
/** * Unit test to verify that  {@link JsonSerialize#using}annotation workswhen applied to a class*/public void testClassSerializer()throws Exception {StringWriter sw=new StringWriter();MAPPER.writeValue(sw,new ClassSerializer());assertEquals("true",sw.toString());}
/** * Unit test to verify that @JsonSerializer annotation works when applied to a Method*/public void testActiveMethodSerializer()throws Exception {StringWriter sw=new StringWriter();MAPPER.writeValue(sw,new ClassMethodSerializer(13));assertEquals("{\"x\":\"X13X\"}",sw.toString());}
public void testInactiveMethodSerializer()throws Exception {String json=MAPPER.writeValueAsString(new InactiveClassMethodSerializer(8));assertEquals("{\"x\":8}",json);}
public void testGettersWithoutSetters()throws Exception {ObjectMapper m=new ObjectMapper();GettersWithoutSetters bean=new GettersWithoutSetters(123);assertFalse(m.isEnabled(MapperFeature.REQUIRE_SETTERS_FOR_GETTERS));assertEquals("{\"a\":3,\"b\":4,\"c\":5,\"d\":6}",m.writeValueAsString(bean));m=new ObjectMapper();m.enable(MapperFeature.REQUIRE_SETTERS_FOR_GETTERS);assertEquals("{\"a\":3,\"c\":5,\"d\":6}",m.writeValueAsString(bean));}
public void testGettersWithoutSettersOverride()throws Exception {GettersWithoutSetters2 bean=new GettersWithoutSetters2();ObjectMapper m=new ObjectMapper();m.enable(MapperFeature.REQUIRE_SETTERS_FOR_GETTERS);assertEquals("{\"a\":123}",m.writeValueAsString(bean));}
/** * First a test that treats results as plain old Object[]*/public void testUntyped(){_testObjectBuffer(null);}
public void testTyped(){_testObjectBuffer(Integer.class);}
public void testExplicitIgnoralWithBean()throws Exception {IgnoreSome value=new IgnoreSome();Map<String,Object> result=writeAndMap(MAPPER,value);assertEquals(2,result.size());assertFalse(result.containsKey("b"));assertFalse(result.containsKey("c"));assertEquals(Integer.valueOf(value.a),result.get("a"));assertEquals(value.getD(),result.get("d"));}
public void testExplicitIgnoralWithMap()throws Exception {MyMap value=new MyMap();value.put("a","b");value.put("@class",MyMap.class.getName());Map<String,Object> result=writeAndMap(MAPPER,value);assertEquals(1,result.size());assertFalse(result.containsKey("@class"));assertEquals(value.get("a"),result.get("a"));}
public void testIgnoreViaOnlyProps()throws Exception {assertEquals("{\"value\":{\"x\":1}}",MAPPER.writeValueAsString(new WrapperWithPropIgnore()));}
public void testIgnoreWithMapProperty()throws Exception {assertEquals("{\"value\":{\"b\":2}}",MAPPER.writeValueAsString(new MapWrapper()));}
public void testIgnoreViaPropsAndClass()throws Exception {assertEquals("{\"value\":{\"y\":2}}",MAPPER.writeValueAsString(new WrapperWithPropIgnore2()));}
public void testSimpleJsonValue()throws Exception {String result=MAPPER.writeValueAsString(new ValueClass<String>("abc"));assertEquals("\"abc\"",result);}
public void testJsonValueWithUseSerializer()throws Exception {String result=serializeAsString(MAPPER,new ToStringValueClass<Integer>(Integer.valueOf(123)));assertEquals("\"123\"",result);}
/** * Test for verifying that additional getters won't confuse serializer.*/public void testMixedJsonValue()throws Exception {String result=serializeAsString(MAPPER,new ToStringValueClass2("xyz"));assertEquals("\"xyz\"",result);}
public void testValueWithStaticType()throws Exception {assertEquals("{\"a\":\"a\",\"b\":\"b\"}",MAPPER.writeValueAsString(new ValueWrapper()));ObjectMapper staticMapper=new ObjectMapper();staticMapper.configure(MapperFeature.USE_STATIC_TYPING,true);assertEquals("{\"a\":\"a\"}",staticMapper.writeValueAsString(new ValueWrapper()));}
public void testMapWithJsonValue()throws Exception {assertEquals("{\"a\":\"1\"}",MAPPER.writeValueAsString(new MapBean()));}
public void testWithMap()throws Exception {assertEquals("42",MAPPER.writeValueAsString(new MapAsNumber()));}
public void testWithList()throws Exception {assertEquals("13",MAPPER.writeValueAsString(new ListAsNumber()));}
public void testInList()throws Exception {IntExtBean bean=new IntExtBean();bean.add(1);bean.add(2);String json=MAPPER.writeValueAsString(bean);assertEquals(json,"{\"values\":[{\"i\":1},{\"i\":2}]}");}
public void testPolymorphicSerdeWithDelegate()throws Exception {AdditionInterface adder=new AdditionInterfaceImpl(1);assertEquals(2,adder.add(1));String json=MAPPER.writeValueAsString(adder);assertEquals("{\"boingo\":\"boopsy\",\"toAdd\":1}",json);assertEquals(2,MAPPER.readValue(json,AdditionInterface.class).add(1));adder=new NegatingAdditionInterface(adder);assertEquals(0,adder.add(1));json=MAPPER.writeValueAsString(adder);assertEquals("{\"boingo\":\"boopsy\",\"toAdd\":1}",json);assertEquals(2,MAPPER.readValue(json,AdditionInterface.class).add(1));}
public void testInsertInListNoDup(){String[]arr=new String[]{"me","you","him"};String[]newarr;newarr=ArrayBuilders.insertInListNoDup(arr,"you");Assert.assertArrayEquals(new String[]{"you","me","him"},newarr);newarr=ArrayBuilders.insertInListNoDup(arr,"me");Assert.assertArrayEquals(new String[]{"me","you","him"},newarr);newarr=ArrayBuilders.insertInListNoDup(arr,"him");Assert.assertArrayEquals(new String[]{"him","me","you"},newarr);newarr=ArrayBuilders.insertInListNoDup(arr,"foobar");Assert.assertArrayEquals(new String[]{"foobar","me","you","him"},newarr);}
public void testNonMatching()throws Exception {JsonNode root=_buildTree();assertNull(root.findValue("boogaboo"));assertNull(root.findParent("boogaboo"));JsonNode n=root.findPath("boogaboo");assertNotNull(n);assertTrue(n.isMissingNode());assertTrue(root.findValues("boogaboo").isEmpty());assertTrue(root.findParents("boogaboo").isEmpty());}
public void testMatchingSingle()throws Exception {JsonNode root=_buildTree();JsonNode node=root.findValue("b");assertNotNull(node);assertEquals(3,node.intValue());node=root.findParent("b");assertNotNull(node);assertTrue(node.isObject());assertEquals(1,((ObjectNode)node).size());assertEquals(3,node.path("b").intValue());}
public void testMatchingMultiple()throws Exception {JsonNode root=_buildTree();List<JsonNode> nodes=root.findValues("value");assertEquals(2,nodes.size());assertEquals(3,nodes.get(0).intValue());assertEquals(42,nodes.get(1).intValue());nodes=root.findParents("value");assertEquals(2,nodes.size());assertTrue(nodes.get(0).isObject());assertTrue(nodes.get(1).isObject());assertEquals(3,nodes.get(0).path("value").intValue());assertEquals(42,nodes.get(1).path("value").intValue());List<String> values=root.findValuesAsText("value");assertEquals(2,values.size());assertEquals("3",values.get(0));assertEquals("42",values.get(1));}
public void testMethodAnnotations()throws Exception {ObjectMapper mapper=new ObjectMapper();SimpleModule module=new SimpleModule("test",Version.unknownVersion());module.addSerializer(String.class,new AnnotatedContextualSerializer());mapper.registerModule(module);assertEquals("{\"value\":\"see:foobar\"}",mapper.writeValueAsString(new ContextualBean("foobar")));}
public void testClassAnnotations()throws Exception {ObjectMapper mapper=new ObjectMapper();SimpleModule module=new SimpleModule("test",Version.unknownVersion());module.addSerializer(String.class,new AnnotatedContextualSerializer());mapper.registerModule(module);assertEquals("{\"value\":\"Voila->xyz\"}",mapper.writeValueAsString(new BeanWithClassConfig("xyz")));}
public void testWrappedBean()throws Exception {ObjectMapper mapper=new ObjectMapper();SimpleModule module=new SimpleModule("test",Version.unknownVersion());module.addSerializer(String.class,new AnnotatedContextualSerializer());mapper.registerModule(module);assertEquals("{\"wrapped\":{\"value\":\"see:xyz\"}}",mapper.writeValueAsString(new ContextualBeanWrapper("xyz")));}
public void testMethodAnnotationInArray()throws Exception {ObjectMapper mapper=new ObjectMapper();SimpleModule module=new SimpleModule("test",Version.unknownVersion());module.addSerializer(String.class,new AnnotatedContextualSerializer());mapper.registerModule(module);ContextualArrayBean beans=new ContextualArrayBean("123");assertEquals("{\"beans\":[\"array->123\"]}",mapper.writeValueAsString(beans));}
public void testMethodAnnotationInList()throws Exception {ObjectMapper mapper=new ObjectMapper();SimpleModule module=new SimpleModule("test",Version.unknownVersion());module.addSerializer(String.class,new AnnotatedContextualSerializer());mapper.registerModule(module);ContextualListBean beans=new ContextualListBean("abc");assertEquals("{\"beans\":[\"list->abc\"]}",mapper.writeValueAsString(beans));}
public void testMethodAnnotationInMap()throws Exception {ObjectMapper mapper=new ObjectMapper();SimpleModule module=new SimpleModule("test",Version.unknownVersion());module.addSerializer(String.class,new AnnotatedContextualSerializer());mapper.registerModule(module);ContextualMapBean map=new ContextualMapBean();map.beans.put("first","In Map");assertEquals("{\"beans\":{\"first\":\"map->In Map\"}}",mapper.writeValueAsString(map));}
public void testContextualViaAnnotation()throws Exception {ObjectMapper mapper=new ObjectMapper();AnnotatedContextualBean bean=new AnnotatedContextualBean("abc");assertEquals("{\"value\":\"prefix->abc\"}",mapper.writeValueAsString(bean));}
public void testSimpleSetter()throws Exception {SizeClassSetter result=MAPPER.readValue("{\"other\":3,\"size\" : 2,\"length\" : -999 }",SizeClassSetter.class);assertEquals(3,result._other);assertEquals(2,result._size);assertEquals(-999,result._length);}
public void testSimpleSetter2()throws Exception {SizeClassSetter2 result=MAPPER.readValue("{\"x\": -3 }",SizeClassSetter2.class);assertEquals(-3,result._x);}
public void testSimpleSetter3()throws Exception {SizeClassSetter3 result=MAPPER.readValue("{\"x\": 128 }",SizeClassSetter3.class);assertEquals(128,result._x);}
/** * Test for verifying that super-class setters are used as expected.*/public void testSetterInheritance()throws Exception {BeanSubClass result=MAPPER.readValue("{\"x\":1,\"z\" : 3,\"y\" : 2 }",BeanSubClass.class);assertEquals(1,result._x);assertEquals(2,result._y);assertEquals(3,result._z);}
public void testImpliedProperty()throws Exception {BeanWithDeserialize bean=MAPPER.readValue("{\"a\":3}",BeanWithDeserialize.class);assertNotNull(bean);assertEquals(3,bean.a);}
/** * Verifies that a simple schema that is serialized can be deserialized back to equal schema instance*/public void testDeserializeSimple()throws Exception {ObjectMapper mapper=new ObjectMapper();JsonSchema schema=mapper.generateJsonSchema(Schemable.class);assertNotNull(schema);String schemaStr=mapper.writeValueAsString(schema);assertNotNull(schemaStr);JsonSchema result=mapper.readValue(schemaStr,JsonSchema.class);assertEquals("Trying to read from '" + schemaStr + "'",schema,result);}
/** * Verifying that sub-classing works ok wrt generics information*/public void testMapSubClass()throws Exception {ObjectMapper mapper=new ObjectMapper();MapSubClass result=mapper.readValue("{\"a\":true }",MapSubClass.class);assertEquals(1,result.size());Object value=result.get("a");assertEquals(BooleanWrapper.class,value.getClass());BooleanWrapper bw=(BooleanWrapper)value;assertEquals(Boolean.TRUE,bw.b);}
public void testMapWrapper()throws Exception {StringMap value=new ObjectMapper().readValue("{\"entries\":{\"a\":9}}",StringMap.class);assertNotNull(value.getEntries());assertEquals(1,value.getEntries().size());assertEquals(Long.valueOf(9),value.getEntries().get("a"));}
public void testIntermediateTypes()throws Exception {StringStringWrapperMap result=new ObjectMapper().readValue("{\"a\":\"b\"}",StringStringWrapperMap.class);assertEquals(1,result.size());Object value=result.get("a");assertNotNull(value);assertEquals(value.getClass(),StringWrapper.class);assertEquals("b",((StringWrapper)value).str);}
/** * Verifying that sub-classing works ok wrt generics information*/public void testAnnotatedMap()throws Exception {ObjectMapper mapper=new ObjectMapper();AnnotatedMap result=mapper.readValue("{\"a\":true }",AnnotatedMap.class);assertEquals(1,result.size());Map.Entry<Object,Object> en=result.entrySet().iterator().next();assertEquals(StringWrapper.class,en.getKey().getClass());assertEquals(BooleanWrapper.class,en.getValue().getClass());assertEquals("a",((StringWrapper)en.getKey()).str);assertEquals(Boolean.TRUE,((BooleanWrapper)en.getValue()).b);}
public void testKeyViaCtor()throws Exception {ObjectMapper mapper=new ObjectMapper();Map<KeyTypeCtor,Integer> map=mapper.readValue("{\"a\":123}",TypeFactory.defaultInstance().constructMapType(HashMap.class,KeyTypeCtor.class,Integer.class));assertEquals(1,map.size());Map.Entry<?,?> entry=map.entrySet().iterator().next();assertEquals(Integer.valueOf(123),entry.getValue());Object key=entry.getKey();assertEquals(KeyTypeCtor.class,key.getClass());assertEquals("a",((KeyTypeCtor)key).value);}
public void testKeyViaFactory()throws Exception {ObjectMapper mapper=new ObjectMapper();Map<KeyTypeCtor,Integer> map=mapper.readValue("{\"a\":123}",TypeFactory.defaultInstance().constructMapType(HashMap.class,KeyTypeFactory.class,Integer.class));assertEquals(1,map.size());Map.Entry<?,?> entry=map.entrySet().iterator().next();assertEquals(Integer.valueOf(123),entry.getValue());Object key=entry.getKey();assertEquals(KeyTypeFactory.class,key.getClass());assertEquals("a",((KeyTypeFactory)key).value);}
/** * Ensure that per-property dynamic types work,both for "native" types and others*/public void testScalarsWithTyping()throws Exception {ObjectMapper m=new ObjectMapper();String json;DynamicWrapper result;json=m.writeValueAsString(new DynamicWrapper(Integer.valueOf(3)));result=m.readValue(json,DynamicWrapper.class);assertEquals(Integer.valueOf(3),result.value);json=m.writeValueAsString(new DynamicWrapper("abc"));result=m.readValue(json,DynamicWrapper.class);assertEquals("abc",result.value);json=m.writeValueAsString(new DynamicWrapper("abc"));result=m.readValue(json,DynamicWrapper.class);assertEquals("abc",result.value);json=m.writeValueAsString(new DynamicWrapper(Boolean.TRUE));result=m.readValue(json,DynamicWrapper.class);assertEquals(Boolean.TRUE,result.value);json=m.writeValueAsString(new DynamicWrapper(Long.valueOf(7L)));result=m.readValue(json,DynamicWrapper.class);assertEquals(Long.valueOf(7),result.value);json=m.writeValueAsString(new DynamicWrapper(TestEnum.B));result=m.readValue(json,DynamicWrapper.class);assertEquals(TestEnum.B,result.value);}
public void testScalarsViaAbstractType()throws Exception {ObjectMapper m=new ObjectMapper();String json;AbstractWrapper result;json=m.writeValueAsString(new AbstractWrapper(Integer.valueOf(3)));result=m.readValue(json,AbstractWrapper.class);assertEquals(Integer.valueOf(3),result.value);json=m.writeValueAsString(new AbstractWrapper("abc"));result=m.readValue(json,AbstractWrapper.class);assertEquals("abc",result.value);json=m.writeValueAsString(new AbstractWrapper("abc"));result=m.readValue(json,AbstractWrapper.class);assertEquals("abc",result.value);json=m.writeValueAsString(new AbstractWrapper(Boolean.TRUE));result=m.readValue(json,AbstractWrapper.class);assertEquals(Boolean.TRUE,result.value);json=m.writeValueAsString(new AbstractWrapper(Long.valueOf(7L)));result=m.readValue(json,AbstractWrapper.class);assertEquals(Long.valueOf(7),result.value);json=m.writeValueAsString(new AbstractWrapper(TestEnum.B));result=m.readValue(json,AbstractWrapper.class);assertEquals(TestEnum.B,result.value);}
/** * tests getting serializer/deserializer instances.*/public void testSerializeDeserializeWithJaxbAnnotations()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.enable(SerializationFeature.INDENT_OUTPUT);JacksonExample ex=new JacksonExample();QName qname=new QName("urn:hi","hello");ex.setQname(qname);ex.setAttributeProperty("attributeValue");ex.setElementProperty("elementValue");ex.setWrappedElementProperty(Arrays.asList("wrappedElementValue"));ex.setEnumProperty(EnumExample.VALUE1);StringWriter writer=new StringWriter();mapper.writeValue(writer,ex);writer.flush();writer.close();String json=writer.toString();JacksonExample readEx=mapper.readValue(json,JacksonExample.class);assertEquals(ex.qname,readEx.qname);assertEquals(ex.attributeProperty,readEx.attributeProperty);assertEquals(ex.elementProperty,readEx.elementProperty);assertEquals(ex.wrappedElementProperty,readEx.wrappedElementProperty);assertEquals(ex.enumProperty,readEx.enumProperty);}
public void testJsonTypeResolver()throws Exception {JacksonAnnotationIntrospector ai=new JacksonAnnotationIntrospector();AnnotatedClass ac=AnnotatedClass.constructWithoutSuperTypes(TypeResolverBean.class,ai,null);JavaType baseType=TypeFactory.defaultInstance().constructType(TypeResolverBean.class);ObjectMapper mapper=new ObjectMapper();TypeResolverBuilder<?> rb=ai.findTypeResolver(mapper.getDeserializationConfig(),ac,baseType);assertNotNull(rb);assertSame(DummyBuilder.class,rb.getClass());}
/** * Tests to ensure that  {@link JsonIgnoreType}is detected as expectedby the standard introspector.* @since 1.7*/public void testIgnoredType()throws Exception {JacksonAnnotationIntrospector ai=new JacksonAnnotationIntrospector();AnnotatedClass ac=AnnotatedClass.construct(IgnoredType.class,ai,null);assertEquals(Boolean.TRUE,ai.isIgnorableType(ac));ac=AnnotatedClass.construct(IgnoredSubType.class,ai,null);assertEquals(Boolean.TRUE,ai.isIgnorableType(ac));}
public void testEnumHandling()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.setAnnotationIntrospector(new LcEnumIntrospector());assertEquals("\"value1\"",mapper.writeValueAsString(EnumExample.VALUE1));EnumExample result=mapper.readValue(quote("value1"),EnumExample.class);assertEquals(EnumExample.VALUE1,result);}
public void testRootBeans()throws Exception {final String JSON="{\"a\":3}{\"a\":27}";Iterator<Bean> it=MAPPER.reader(Bean.class).readValues(JSON);assertNotNull(((MappingIterator<?>)it).getCurrentLocation());assertTrue(it.hasNext());Bean b=it.next();assertEquals(3,b.a);assertTrue(it.hasNext());b=it.next();assertEquals(27,b.a);assertFalse(it.hasNext());}
public void testRootMaps()throws Exception {final String JSON="{\"a\":3}{\"a\":27}";Iterator<Map<?,?>> it=MAPPER.reader(Map.class).readValues(JSON);assertNotNull(((MappingIterator<?>)it).getCurrentLocation());assertTrue(it.hasNext());Map<?,?> map=it.next();assertEquals(1,map.size());assertEquals(Integer.valueOf(3),map.get("a"));assertTrue(it.hasNext());assertNotNull(((MappingIterator<?>)it).getCurrentLocation());map=it.next();assertEquals(1,map.size());assertEquals(Integer.valueOf(27),map.get("a"));assertFalse(it.hasNext());}
public void testRootBeansWithParser()throws Exception {final String JSON="{\"a\":3}{\"a\":27}";JsonParser jp=MAPPER.getFactory().createParser(JSON);Iterator<Bean> it=jp.readValuesAs(Bean.class);assertTrue(it.hasNext());Bean b=it.next();assertEquals(3,b.a);assertTrue(it.hasNext());b=it.next();assertEquals(27,b.a);assertFalse(it.hasNext());}
public void testRootArraysWithParser()throws Exception {final String JSON="[1][3]";JsonParser jp=MAPPER.getFactory().createParser(JSON);assertToken(JsonToken.START_ARRAY,jp.nextToken());Iterator<int[]> it=MAPPER.reader(int[].class).readValues(jp);assertTrue(it.hasNext());int[]array=it.next();assertEquals(1,array.length);assertEquals(1,array[0]);assertTrue(it.hasNext());array=it.next();assertEquals(1,array.length);assertEquals(3,array[0]);assertFalse(it.hasNext());}
public void testHasNextWithEndArray()throws Exception {final String JSON="[1,3]";JsonParser jp=MAPPER.getFactory().createParser(JSON);assertToken(JsonToken.START_ARRAY,jp.nextToken());jp.nextToken();Iterator<Integer> it=MAPPER.reader(Integer.class).readValues(jp);assertTrue(it.hasNext());int value=it.next();assertEquals(1,value);assertTrue(it.hasNext());value=it.next();assertEquals(3,value);assertFalse(it.hasNext());assertFalse(it.hasNext());}
public void testHasNextWithEndArrayManagedParser()throws Exception {final String JSON="[1,3]";Iterator<Integer> it=MAPPER.reader(Integer.class).readValues(JSON);assertTrue(it.hasNext());int value=it.next();assertEquals(1,value);assertTrue(it.hasNext());value=it.next();assertEquals(3,value);assertFalse(it.hasNext());assertFalse(it.hasNext());}
public void testNonRootBeans()throws Exception {final String JSON="{\"leaf\":[{\"a\":3},{\"a\":27}]}";JsonParser jp=MAPPER.getFactory().createParser(JSON);assertToken(JsonToken.START_OBJECT,jp.nextToken());assertToken(JsonToken.FIELD_NAME,jp.nextToken());assertToken(JsonToken.START_ARRAY,jp.nextToken());assertToken(JsonToken.START_OBJECT,jp.nextToken());Iterator<Bean> it=MAPPER.reader(Bean.class).readValues(jp);assertTrue(it.hasNext());Bean b=it.next();assertEquals(3,b.a);assertTrue(it.hasNext());b=it.next();assertEquals(27,b.a);assertFalse(it.hasNext());jp.close();}
public void testNonRootMapsWithParser()throws Exception {final String JSON="[{\"a\":3},{\"a\":27}]";JsonParser jp=MAPPER.getFactory().createParser(JSON);assertToken(JsonToken.START_ARRAY,jp.nextToken());jp.clearCurrentToken();Iterator<Map<?,?>> it=MAPPER.reader(Map.class).readValues(jp);assertTrue(it.hasNext());Map<?,?> map=it.next();assertEquals(1,map.size());assertEquals(Integer.valueOf(3),map.get("a"));assertTrue(it.hasNext());map=it.next();assertEquals(1,map.size());assertEquals(Integer.valueOf(27),map.get("a"));assertFalse(it.hasNext());jp.close();}
public void testNonRootMapsWithObjectReader()throws Exception {String JSON="[{\"hi\": \"ho\",\"neighbor\": \"Joe\" },\n" + "{\"boy\": \"howdy\",\"huh\": \"what\"}]";final MappingIterator<Map<String,Object>> iterator=MAPPER.reader().withType(new TypeReference<Map<String,Object>>(){}).readValues(JSON);Map<String,Object> map;assertTrue(iterator.hasNext());map=iterator.nextValue();assertEquals(2,map.size());assertTrue(iterator.hasNext());map=iterator.nextValue();assertEquals(2,map.size());assertFalse(iterator.hasNext());}
public void testNonRootArraysUsingParser()throws Exception {final String JSON="[[1],[3]]";JsonParser jp=MAPPER.getFactory().createParser(JSON);assertToken(JsonToken.START_ARRAY,jp.nextToken());assertToken(JsonToken.START_ARRAY,jp.nextToken());Iterator<int[]> it=MAPPER.readValues(jp,int[].class);assertTrue(it.hasNext());int[]array=it.next();assertEquals(1,array.length);assertEquals(1,array[0]);assertTrue(it.hasNext());array=it.next();assertEquals(1,array.length);assertEquals(3,array[0]);assertFalse(it.hasNext());jp.close();}
public void testListOfLongs()throws Exception {ObjectMapper m=new ObjectMapper();m.enableDefaultTyping();ListOfLongs input=new ListOfLongs(1L,2L,3L);String json=m.writeValueAsString(input);assertEquals("{\"longs\":[\"java.util.ArrayList\",[1,2,3]]}",json);ListOfLongs output=m.readValue(json,ListOfLongs.class);assertNotNull(output.longs);assertEquals(3,output.longs.size());assertEquals(Long.valueOf(1L),output.longs.get(0));assertEquals(Long.valueOf(2L),output.longs.get(1));assertEquals(Long.valueOf(3L),output.longs.get(2));}
/** * Then bit more heterogenous list;also tests mixing of regular scalar types,and non-typed ones (int and double will never have type info added;other numbers will if necessary)*/public void testListOfNumbers()throws Exception {ObjectMapper m=new ObjectMapper();m.enableDefaultTyping();ListOfNumbers input=new ListOfNumbers(Long.valueOf(1L),Integer.valueOf(2),Double.valueOf(3.0));String json=m.writeValueAsString(input);assertEquals("{\"nums\":[\"java.util.ArrayList\",[[\"java.lang.Long\",1],2,3.0]]}",json);ListOfNumbers output=m.readValue(json,ListOfNumbers.class);assertNotNull(output.nums);assertEquals(3,output.nums.size());assertEquals(Long.valueOf(1L),output.nums.get(0));assertEquals(Integer.valueOf(2),output.nums.get(1));assertEquals(Double.valueOf(3.0),output.nums.get(2));}
public void testDateTypes()throws Exception {ObjectMapper m=new ObjectMapper();m.enableDefaultTyping();ObjectListBean input=new ObjectListBean();List<Object> inputList=new ArrayList<Object>();inputList.add(TimeZone.getTimeZone("EST"));inputList.add(Locale.CHINESE);input.values=inputList;String json=m.writeValueAsString(input);ObjectListBean output=m.readValue(json,ObjectListBean.class);List<Object> outputList=output.values;assertEquals(2,outputList.size());assertTrue(outputList.get(0)instanceof TimeZone);assertTrue(outputList.get(1)instanceof Locale);}
public void testJackson628()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.enableDefaultTyping(DefaultTyping.NON_FINAL);ArrayList<Foo> data=new ArrayList<Foo>();String json=mapper.writeValueAsString(data);List<?> output=mapper.readValue(json,List.class);assertTrue(output.isEmpty());}
public void testJackson667()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL,JsonTypeInfo.As.PROPERTY);String json=mapper.writeValueAsString(new SetBean("abc"));SetBean bean=mapper.readValue(json,SetBean.class);assertNotNull(bean);assertTrue(bean.names instanceof HashSet);}
public void testUntypedMap()throws Exception {String JSON="{\"foo\" : \"bar\",\"crazy\" : true,\"null\" : null }";@SuppressWarnings("unchecked")Map<String,Object> result=(Map<String,Object>)MAPPER.readValue(JSON,Object.class);assertNotNull(result);assertTrue(result instanceof Map<?,?>);assertEquals(3,result.size());assertEquals("bar",result.get("foo"));assertEquals(Boolean.TRUE,result.get("crazy"));assertNull(result.get("null"));assertNull(result.get("bar"));assertNull(result.get(3));}
/** * Let's also try another way to express "gimme a Map" deserialization;this time by specifying a Map class,to reduce need to cast*/public void testUntypedMap2()throws Exception {String JSON="{\"a\" : \"x\" }";@SuppressWarnings("unchecked")HashMap<String,Object> result=MAPPER.readValue(JSON,HashMap.class);assertNotNull(result);assertTrue(result instanceof Map<?,?>);assertEquals(1,result.size());assertEquals("x",result.get("a"));}
/** * Unit test for [JACKSON-185]*/public void testUntypedMap3()throws Exception {String JSON="{\"a\":[{\"a\":\"b\"},\"value\"]}";Map<?,?> result=MAPPER.readValue(JSON,Map.class);assertTrue(result instanceof Map<?,?>);assertEquals(1,result.size());Object ob=result.get("a");assertNotNull(ob);Collection<?> list=(Collection<?>)ob;assertEquals(2,list.size());JSON="{\"var1\":\"val1\",\"var2\":\"val2\"," + "\"subvars\": [" + "{\"subvar1\" : \"subvar2\",\"x\" : \"y\" },"+ "{\"a\":1}]"+ " }";result=MAPPER.readValue(JSON,Map.class);assertTrue(result instanceof Map<?,?>);assertEquals(3,result.size());}
public void testSpecialMap()throws IOException {final ObjectWrapperMap map=MAPPER.readValue(UNTYPED_MAP_JSON,ObjectWrapperMap.class);_doTestUntyped(map);}
public void testGenericMap()throws IOException {final Map<String,ObjectWrapper> map=MAPPER.readValue(UNTYPED_MAP_JSON,new TypeReference<Map<String,ObjectWrapper>>(){});_doTestUntyped(map);}
public void testFromEmptyString()throws Exception {ObjectMapper m=new ObjectMapper();m.configure(DeserializationFeature.ACCEPT_EMPTY_STRING_AS_NULL_OBJECT,true);Map<?,?> result=m.readValue(quote(""),Map.class);assertNull(result);}
public void testExactStringIntMap()throws Exception {String JSON="{\"foo\" : 13,\"bar\" : -39,\n \"\" : 0 }";Map<String,Integer> result=MAPPER.readValue(JSON,new TypeReference<HashMap<String,Integer>>(){});assertNotNull(result);assertEquals(HashMap.class,result.getClass());assertEquals(3,result.size());assertEquals(Integer.valueOf(13),result.get("foo"));assertEquals(Integer.valueOf(-39),result.get("bar"));assertEquals(Integer.valueOf(0),result.get(""));assertNull(result.get("foobar"));assertNull(result.get(" "));}
/** * Let's also check that it is possible to do type conversions to allow use of non-String Map keys.*/public void testIntBooleanMap()throws Exception {String JSON="{\"1\" : true,\"-1\" : false }";Map<String,Integer> result=MAPPER.readValue(JSON,new TypeReference<HashMap<Integer,Boolean>>(){});assertNotNull(result);assertEquals(HashMap.class,result.getClass());assertEquals(2,result.size());assertEquals(Boolean.TRUE,result.get(Integer.valueOf(1)));assertEquals(Boolean.FALSE,result.get(Integer.valueOf(-1)));assertNull(result.get("foobar"));assertNull(result.get(0));}
public void testExactStringStringMap()throws Exception {String JSON="{\"a\" : \"b\" }";Map<String,Integer> result=MAPPER.readValue(JSON,new TypeReference<TreeMap<String,String>>(){});assertNotNull(result);assertEquals(TreeMap.class,result.getClass());assertEquals(1,result.size());assertEquals("b",result.get("a"));assertNull(result.get("b"));}
/** * Unit test that verifies that it's ok to have incomplete information about Map class itself,as long as it's something we good guess about: for example,<code>Map.Class</code> will be replaced by something like <code>HashMap.class</code>,if given.*/public void testGenericStringIntMap()throws Exception {String JSON="{\"a\" : 1,\"b\" : 2,\"c\" : -99 }";Map<String,Integer> result=MAPPER.readValue(JSON,new TypeReference<Map<String,Integer>>(){});assertNotNull(result);assertTrue(result instanceof Map<?,?>);assertEquals(3,result.size());assertEquals(Integer.valueOf(-99),result.get("c"));assertEquals(Integer.valueOf(2),result.get("b"));assertEquals(Integer.valueOf(1),result.get("a"));assertNull(result.get(""));}
public void testEnumMap()throws Exception {String JSON="{\"KEY1\" : \"\",\"WHATEVER\" : null }";EnumMap<Key,String> result=MAPPER.readValue(JSON,new TypeReference<EnumMap<Key,String>>(){});assertNotNull(result);assertEquals(EnumMap.class,result.getClass());assertEquals(2,result.size());assertEquals("",result.get(Key.KEY1));assertTrue(result.containsKey(Key.WHATEVER));assertNull(result.get(Key.WHATEVER));assertFalse(result.containsKey(Key.KEY2));assertNull(result.get(Key.KEY2));}
public void testMapWithEnums()throws Exception {String JSON="{\"KEY2\" : \"WHATEVER\" }";Map<Enum<?>,Enum<?>> result=MAPPER.readValue(JSON,new TypeReference<Map<Key,Key>>(){});assertNotNull(result);assertTrue(result instanceof Map<?,?>);assertEquals(1,result.size());assertEquals(Key.WHATEVER,result.get(Key.KEY2));assertNull(result.get(Key.WHATEVER));assertNull(result.get(Key.KEY1));}
public void testEnumPolymorphicSerializationTest()throws Exception {ObjectMapper mapper=new ObjectMapper();List<ITestType> testTypesList=new ArrayList<ITestType>();testTypesList.add(ConcreteType.ONE);testTypesList.add(ConcreteType.TWO);ListContainer listContainer=new ListContainer();listContainer.testTypes=testTypesList;String json=mapper.writeValueAsString(listContainer);listContainer=mapper.readValue(json,ListContainer.class);EnumMapContainer enumMapContainer=new EnumMapContainer();EnumMap<KeyEnum,ITestType> testTypesMap=new EnumMap<KeyEnum,ITestType>(KeyEnum.class);testTypesMap.put(KeyEnum.A,ConcreteType.ONE);testTypesMap.put(KeyEnum.B,ConcreteType.TWO);enumMapContainer.testTypes=testTypesMap;json=mapper.writeValueAsString(enumMapContainer);enumMapContainer=mapper.readValue(json,EnumMapContainer.class);}
public void testDateMap()throws Exception {Date date1=new Date(123456000L);DateFormat fmt=new SimpleDateFormat("EEE,dd MMM yyyy HH:mm:ss zzz",Locale.US);String JSON="{\"" + fmt.format(date1)+ "\" : \"\",\""+ new Date(0).getTime()+ "\" : null }";HashMap<Date,String> result=MAPPER.readValue(JSON,new TypeReference<HashMap<Date,String>>(){});assertNotNull(result);assertEquals(HashMap.class,result.getClass());assertEquals(2,result.size());assertTrue(result.containsKey(date1));assertEquals("",result.get(new Date(123456000L)));assertTrue(result.containsKey(new Date(0)));assertNull(result.get(new Date(0)));}
public void testCalendarMap()throws Exception {Calendar c=Calendar.getInstance(TimeZone.getTimeZone("GMT"));c.setTimeInMillis(123456000L);DateFormat fmt=new SimpleDateFormat("EEE,dd MMM yyyy HH:mm:ss zzz",Locale.US);String JSON="{\"" + fmt.format(c.getTime())+ "\" : \"\",\""+ new Date(0).getTime()+ "\" : null }";HashMap<Calendar,String> result=MAPPER.readValue(JSON,new TypeReference<HashMap<Calendar,String>>(){});assertNotNull(result);assertEquals(HashMap.class,result.getClass());assertEquals(2,result.size());assertTrue(result.containsKey(c));assertEquals("",result.get(c));c.setTimeInMillis(0);assertTrue(result.containsKey(c));assertNull(result.get(c));}
public void testUUIDKeyMap()throws Exception {UUID key=UUID.nameUUIDFromBytes("foobar".getBytes("UTF-8"));String JSON="{\"" + key + "\":4}";Map<UUID,Object> result=MAPPER.readValue(JSON,new TypeReference<Map<UUID,Object>>(){});assertNotNull(result);assertEquals(1,result.size());Object ob=result.keySet().iterator().next();assertNotNull(ob);assertEquals(UUID.class,ob.getClass());assertEquals(key,ob);}
public void testLocaleKeyMap()throws Exception {Locale key=Locale.CHINA;String JSON="{\"" + key + "\":4}";Map<Locale,Object> result=MAPPER.readValue(JSON,new TypeReference<Map<Locale,Object>>(){});assertNotNull(result);assertEquals(1,result.size());Object ob=result.keySet().iterator().next();assertNotNull(ob);assertEquals(Locale.class,ob.getClass());assertEquals(key,ob);}
public void testKeyWithCreator()throws Exception {KeyType key=MAPPER.readValue(quote("abc"),KeyType.class);assertEquals("abc",key.value);Map<KeyType,Integer> map=MAPPER.readValue("{\"foo\":3}",new TypeReference<Map<KeyType,Integer>>(){});assertEquals(1,map.size());key=map.keySet().iterator().next();assertEquals("foo",key.value);}
/** * Simple test to ensure that @JsonDeserialize.using is recognized*/public void testMapWithDeserializer()throws IOException {CustomMap result=MAPPER.readValue(quote("xyz"),CustomMap.class);assertEquals(1,result.size());assertEquals("xyz",result.get("x"));}
public void testMapError()throws Exception {try {Object result=MAPPER.readValue("[1,2 ]",new TypeReference<Map<String,String>>(){});fail("Expected an exception,but got result value: " + result);}catch(JsonMappingException jex){verifyException(jex,"START_ARRAY");}}
public void testNoCtorMap()throws Exception {try {BrokenMap result=MAPPER.readValue("{\"a\" : 3 }",BrokenMap.class);assertNull(result);}catch(JsonMappingException e){verifyException(e,"no default constructor found");}}
public void testSimple()throws Exception {ObjectMapper mapper=new ObjectMapper();String TEST="test exception";Map<String,Object> result=writeAndMap(mapper,new Exception(TEST));Object ob=result.get("suppressed");if (ob != null){assertEquals(5,result.size());}else {assertEquals(4,result.size());}assertEquals(TEST,result.get("message"));assertNull(result.get("cause"));assertEquals(TEST,result.get("localizedMessage"));Object traces=result.get("stackTrace");if (!(traces instanceof List<?>)){fail("Expected a List for exception member 'stackTrace',got: " + traces);}}
public void testEmptyCollection()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.configure(SerializationFeature.INDENT_OUTPUT,true);List<User> friends=new ArrayList<User>();friends.add(new DefaultUser("Joe Hildebrandt",null));friends.add(new DefaultEmployee("Richard Nasr",null,"MDA"));User user=new DefaultEmployee("John Vanspronssen",friends,"MDA");String json=mapper.writeValueAsString(user);mapper=new ObjectMapper();mapper.registerSubtypes(DefaultEmployee.class);mapper.registerSubtypes(DefaultUser.class);User result=mapper.readValue(json,User.class);assertNotNull(result);assertEquals(DefaultEmployee.class,result.getClass());friends=result.getFriends();assertEquals(2,friends.size());assertEquals(DefaultUser.class,friends.get(0).getClass());assertEquals(DefaultEmployee.class,friends.get(1).getClass());}
public void testInnerClassWithType()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.enableDefaultTyping(DefaultTyping.NON_FINAL);String json=mapper.writeValueAsString(new BeanWithAnon());BeanWithAnon result=mapper.readValue(json,BeanWithAnon.class);assertEquals(BeanWithAnon.class,result.getClass());}
public void testSimple()throws Exception {assertEquals("\"B\"",mapper.writeValueAsString(TestEnum.B));}
public void testEnumSet()throws Exception {StringWriter sw=new StringWriter();EnumSet<TestEnum> value=EnumSet.of(TestEnum.B);mapper.writeValue(sw,value);assertEquals("[\"B\"]",sw.toString());}
/** * Whereas regular Enum serializer uses enum names,some users prefer calling toString()instead. So let's verify that this can be done using annotation for enum class.*/public void testEnumUsingToString()throws Exception {StringWriter sw=new StringWriter();mapper.writeValue(sw,AnnotatedTestEnum.C2);assertEquals("\"c2\"",sw.toString());}
public void testSubclassedEnums()throws Exception {assertEquals("\"B\"",mapper.writeValueAsString(EnumWithSubClass.B));}
public void testEnumsWithJsonValue()throws Exception {assertEquals("\"bar\"",mapper.writeValueAsString(EnumWithJsonValue.B));}
public void testEnumsWithJsonValueUsingMixin()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.addMixInAnnotations(TestEnum.class,ToStringMixin.class);assertEquals("\"b\"",mapper.writeValueAsString(TestEnum.B));}
/** * Test for ensuring that @JsonSerializable is used with Enum types as well as with any other types.*/public void testSerializableEnum()throws Exception {assertEquals("\"foo\"",mapper.writeValueAsString(SerializableEnum.A));}
public void testToStringEnum()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.configure(SerializationFeature.WRITE_ENUMS_USING_TO_STRING,true);assertEquals("\"b\"",mapper.writeValueAsString(LowerCaseEnum.B));}
public void testToStringEnumWithEnumMap()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.configure(SerializationFeature.WRITE_ENUMS_USING_TO_STRING,true);EnumMap<LowerCaseEnum,String> m=new EnumMap<LowerCaseEnum,String>(LowerCaseEnum.class);m.put(LowerCaseEnum.C,"value");assertEquals("{\"c\":\"value\"}",mapper.writeValueAsString(m));}
public void testMapWithEnumKeys()throws Exception {MapBean bean=new MapBean();bean.add(TestEnum.B,3);String json=mapper.writeValueAsString(bean);assertEquals("{\"map\":{\"b\":3}}",json);}
public void testAsIndex()throws Exception {ObjectMapper mapper=new ObjectMapper();assertFalse(mapper.isEnabled(SerializationFeature.WRITE_ENUMS_USING_INDEX));assertEquals(quote("B"),mapper.writeValueAsString(TestEnum.B));mapper.enable(SerializationFeature.WRITE_ENUMS_USING_INDEX);assertEquals("1",mapper.writeValueAsString(TestEnum.B));}
public void testAnnotationsOnEnumCtor()throws Exception {assertEquals(quote("V1"),mapper.writeValueAsString(OK.V1));assertEquals(quote("V1"),mapper.writeValueAsString(NOT_OK.V1));assertEquals(quote("V2"),mapper.writeValueAsString(NOT_OK2.V2));}
public void testEnumAsObjectValid()throws Exception {assertEquals("{\"value\":\"a1\"}",mapper.writeValueAsString(PoNUM.A));}
public void testEnumAsIndexViaAnnotations()throws Exception {assertEquals("{\"text\":0}",mapper.writeValueAsString(new PoNUMContainer()));}
public void testEnumAsObjectBroken()throws Exception {try {String json=mapper.writeValueAsString(BrokenPoNum.A);fail("Should not have succeeded,produced: " + json);}catch(JsonMappingException e){verifyException(e,"Unsupported serialization shape");}}
public void testDateNumeric()throws IOException {assertTrue(MAPPER.isEnabled(SerializationFeature.WRITE_DATES_AS_TIMESTAMPS));String json=MAPPER.writeValueAsString(new Date(199L));assertEquals("199",json);}
public void testDateISO8601()throws IOException {ObjectMapper mapper=new ObjectMapper();mapper.configure(SerializationFeature.WRITE_DATES_AS_TIMESTAMPS,false);String json=mapper.writeValueAsString(new Date(0L));assertEquals("\"1970-01-01T00:00:00.000+0000\"",json);}
public void testDateOther()throws IOException {ObjectMapper mapper=new ObjectMapper();DateFormat df=new SimpleDateFormat("yyyy-MM-dd'X'HH:mm:ss");df.setTimeZone(TimeZone.getTimeZone("PST"));mapper.setDateFormat(df);assertEquals(quote("1969-12-31X16:00:00"),mapper.writeValueAsString(new Date(0L)));}
@SuppressWarnings("deprecation")public void testSqlDate()throws IOException {java.sql.Date date=new java.sql.Date(99,Calendar.APRIL,1);assertEquals(quote("1999-04-01"),MAPPER.writeValueAsString(date));}
public void testTimeZone()throws IOException {TimeZone input=TimeZone.getTimeZone("PST");String json=MAPPER.writeValueAsString(input);assertEquals(quote("PST"),json);}
public void testTimeZoneInBean()throws IOException {String json=MAPPER.writeValueAsString(new TimeZoneBean("PST"));assertEquals("{\"tz\":\"PST\"}",json);}
public void testDateUsingObjectWriter()throws IOException {DateFormat df=new SimpleDateFormat("yyyy-MM-dd'X'HH:mm:ss");df.setTimeZone(TimeZone.getTimeZone("PST"));assertEquals(quote("1969-12-31X16:00:00"),MAPPER.writer(df).writeValueAsString(new Date(0L)));ObjectWriter w=MAPPER.writer((DateFormat)null);assertEquals("0",w.writeValueAsString(new Date(0L)));w=w.with(df);assertEquals(quote("1969-12-31X16:00:00"),w.writeValueAsString(new Date(0L)));w=w.with((DateFormat)null);assertEquals("0",w.writeValueAsString(new Date(0L)));}
public void testDatesAsMapKeys()throws IOException {ObjectMapper mapper=new ObjectMapper();Map<Date,Integer> map=new HashMap<Date,Integer>();assertFalse(mapper.isEnabled(SerializationFeature.WRITE_DATE_KEYS_AS_TIMESTAMPS));map.put(new Date(0L),Integer.valueOf(1));assertEquals("{\"1970-01-01T00:00:00.000+0000\":1}",mapper.writeValueAsString(map));mapper.configure(SerializationFeature.WRITE_DATE_KEYS_AS_TIMESTAMPS,true);assertEquals("{\"0\":1}",mapper.writeValueAsString(map));}
public void testDateWithJsonFormat()throws Exception {ObjectMapper mapper=new ObjectMapper();String json;mapper.disable(SerializationFeature.WRITE_DATES_AS_TIMESTAMPS);json=mapper.writeValueAsString(new DateAsNumberBean(0L));assertEquals("{\"date\":0}",json);mapper.enable(SerializationFeature.WRITE_DATES_AS_TIMESTAMPS);json=mapper.writer().with(getUTCTimeZone()).writeValueAsString(new DateAsStringBean(0L));assertEquals("{\"date\":\"1970-01-01\"}",json);json=mapper.writeValueAsString(new DateInCETBean(0L));assertEquals("{\"date\":\"1970-01-01,01:00\"}",json);}
/** * Test to ensure that setting a TimeZone _after_ dateformat should enforce that timezone on format,regardless of TimeZone format had.*/public void testWithTimeZoneOverride()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.setDateFormat(new SimpleDateFormat("yyyy-MM-dd/HH:mm z"));mapper.setTimeZone(TimeZone.getTimeZone("PST"));mapper.disable(SerializationFeature.WRITE_DATES_AS_TIMESTAMPS);String json=mapper.writeValueAsString(new Date(0));assertEquals(quote("1969-12-31/16:00 PST"),json);}
/** * Verification of [JACKSON-301]*/public void testHandlingOfUnrecognized()throws Exception {UnrecognizedPropertyException exc=null;try {new ObjectMapper().readValue("{\"bar\":3}",Bean.class);}catch(UnrecognizedPropertyException e){exc=e;}if (exc == null){fail("Should have failed binding");}assertEquals("bar",exc.getUnrecognizedPropertyName());assertEquals(Bean.class,exc.getReferringClass());verifyException(exc,"propX");}
/** * Simple test to check behavior when end-of-stream is encountered without content. Used to expect EOFException (Jackson 1.x);but nowadays ought to be JsonMappingException*/public void testExceptionWithEmpty()throws Exception {ObjectMapper mapper=new ObjectMapper();try {Object result=mapper.readValue("    ",Object.class);fail("Expected an exception,but got result value: " + result);}catch(Exception e){verifyException(e,JsonMappingException.class,"No content");}}
public void testExceptionWithIncomplete()throws Exception {BrokenStringReader r=new BrokenStringReader("[1,","TEST");JsonFactory f=new JsonFactory();JsonParser jp=f.createParser(r);ObjectMapper mapper=new ObjectMapper();try {@SuppressWarnings("unused")Object ob=mapper.readValue(jp,Object.class);fail("Should have gotten an exception");}catch(IOException e){verifyException(e,IOException.class,"TEST");}}
public void testExceptionWithEOF()throws Exception {StringReader r=new StringReader("  3");JsonFactory f=new JsonFactory();JsonParser jp=f.createParser(r);ObjectMapper mapper=new ObjectMapper();Integer I=mapper.readValue(jp,Integer.class);assertEquals(3,I.intValue());try {I=mapper.readValue(jp,Integer.class);fail("Should have gotten an exception");}catch(IOException e){verifyException(e,JsonMappingException.class,"No content");}JsonToken t=jp.getCurrentToken();if (t != null){fail("Expected current token to be null after end-of-stream,was: " + t);}}
public void testUntypedList()throws Exception {String JSON="[\"text!\",true,null,23 ]";Object value=MAPPER.readValue(JSON,Object.class);assertNotNull(value);assertTrue(value instanceof ArrayList<?>);List<?> result=(List<?>)value;assertEquals(4,result.size());assertEquals("text!",result.get(0));assertEquals(Boolean.TRUE,result.get(1));assertNull(result.get(2));assertEquals(Integer.valueOf(23),result.get(3));}
public void testExactStringCollection()throws Exception {String JSON="[\"a\",\"b\" ]";List<String> result=MAPPER.readValue(JSON,new TypeReference<ArrayList<String>>(){});assertNotNull(result);assertEquals(ArrayList.class,result.getClass());assertEquals(2,result.size());assertEquals("a",result.get(0));assertEquals("b",result.get(1));}
public void testHashSet()throws Exception {String JSON="[\"KEY1\",\"KEY2\" ]";EnumSet<Key> result=MAPPER.readValue(JSON,new TypeReference<EnumSet<Key>>(){});assertNotNull(result);assertTrue(EnumSet.class.isAssignableFrom(result.getClass()));assertEquals(2,result.size());assertTrue(result.contains(Key.KEY1));assertTrue(result.contains(Key.KEY2));assertFalse(result.contains(Key.WHATEVER));}
public void testCustomDeserializer()throws IOException {CustomList result=MAPPER.readValue(quote("abc"),CustomList.class);assertEquals(1,result.size());assertEquals("abc",result.get(0));}
@SuppressWarnings("unchecked")public void testImplicitArrays()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.configure(DeserializationFeature.ACCEPT_SINGLE_VALUE_AS_ARRAY,true);List<Integer> ints=mapper.readValue("4",List.class);assertEquals(1,ints.size());assertEquals(Integer.valueOf(4),ints.get(0));List<String> strings=mapper.readValue(quote("abc"),new TypeReference<ArrayList<String>>(){});assertEquals(1,strings.size());assertEquals("abc",strings.get(0));int[]intArray=mapper.readValue("-7",int[].class);assertEquals(1,intArray.length);assertEquals(-7,intArray[0]);String[]stringArray=mapper.readValue(quote("xyz"),String[].class);assertEquals(1,stringArray.length);assertEquals("xyz",stringArray[0]);List<XBean> xbeanList=mapper.readValue("{\"x\":4}",new TypeReference<List<XBean>>(){});assertEquals(1,xbeanList.size());assertEquals(XBean.class,xbeanList.get(0).getClass());Object ob=mapper.readValue("{\"x\":29}",XBean[].class);XBean[]xbeanArray=(XBean[])ob;assertEquals(1,xbeanArray.length);assertEquals(XBean.class,xbeanArray[0].getClass());}
public void testFromEmptyString()throws Exception {ObjectReader r=MAPPER.reader(DeserializationFeature.ACCEPT_EMPTY_STRING_AS_NULL_OBJECT);List<?> result=r.withType(List.class).readValue(quote(""));assertNull(result);}
public void testArrayBlockingQueue()throws Exception {ArrayBlockingQueue<?> q=MAPPER.readValue("[1,2,3]",ArrayBlockingQueue.class);assertNotNull(q);assertEquals(3,q.size());assertEquals(Integer.valueOf(1),q.take());assertEquals(Integer.valueOf(2),q.take());assertEquals(Integer.valueOf(3),q.take());}
public void testIterableWithStrings()throws Exception {String JSON="{\"values\":[\"a\",\"b\"]}";ListAsIterable w=MAPPER.readValue(JSON,ListAsIterable.class);assertNotNull(w);assertNotNull(w.values);Iterator<String> it=w.values.iterator();assertTrue(it.hasNext());assertEquals("a",it.next());assertEquals("b",it.next());assertFalse(it.hasNext());}
public void testIterableWithBeans()throws Exception {String JSON="{\"nums\":[{\"x\":1},{\"x\":2}]}";ListAsIterableX w=MAPPER.readValue(JSON,ListAsIterableX.class);assertNotNull(w);assertNotNull(w.nums);Iterator<XBean> it=w.nums.iterator();assertTrue(it.hasNext());XBean xb=it.next();assertNotNull(xb);assertEquals(1,xb.x);xb=it.next();assertEquals(2,xb.x);assertFalse(it.hasNext());}
public void testSimpleNumberBean()throws Exception {ObjectMapper mapper=new ObjectMapper();NumberBean result=mapper.readValue("{\"number\":17}",NumberBean.class);assertEquals(17,result._number);}
/** * Unit test for verifying fix to [JACKSON-109].*/public void testGenericWrapper()throws Exception {ObjectMapper mapper=new ObjectMapper();Wrapper<SimpleBean> result=mapper.readValue("{\"value\":{\"x\" : 13}}",new TypeReference<Wrapper<SimpleBean>>(){});assertNotNull(result);assertEquals(Wrapper.class,result.getClass());Object contents=result.value;assertNotNull(contents);assertEquals(SimpleBean.class,contents.getClass());SimpleBean bean=(SimpleBean)contents;assertEquals(13,bean.x);}
/** * Unit test for verifying that we can use different type bindings for individual generic types;problem with [JACKSON-190]*/public void testMultipleWrappers()throws Exception {ObjectMapper mapper=new ObjectMapper();Wrapper<Boolean> result=mapper.readValue("{\"value\": true}",new TypeReference<Wrapper<Boolean>>(){});assertEquals(new Wrapper<Boolean>(Boolean.TRUE),result);Wrapper<String> result2=mapper.readValue("{\"value\": \"abc\"}",new TypeReference<Wrapper<String>>(){});assertEquals(new Wrapper<String>("abc"),result2);Wrapper<Long> result3=mapper.readValue("{\"value\": 7}",new TypeReference<Wrapper<Long>>(){});assertEquals(new Wrapper<Long>(7L),result3);}
/** * Unit test for verifying fix to [JACKSON-109].*/public void testArrayOfGenericWrappers()throws Exception {ObjectMapper mapper=new ObjectMapper();Wrapper<SimpleBean>[]result=mapper.readValue("[{\"value\":{\"x\" : 9}}]",new TypeReference<Wrapper<SimpleBean>[]>(){});assertNotNull(result);assertEquals(Wrapper[].class,result.getClass());assertEquals(1,result.length);Wrapper<SimpleBean> elem=result[0];Object contents=elem.value;assertNotNull(contents);assertEquals(SimpleBean.class,contents.getClass());SimpleBean bean=(SimpleBean)contents;assertEquals(9,bean.x);}
public void testSimple()throws Exception {assertEquals("null",new ObjectMapper().writeValueAsString(null));}
public void testOverriddenDefaultNulls()throws Exception {DefaultSerializerProvider sp=new DefaultSerializerProvider.Impl();sp.setNullValueSerializer(new NullSerializer());ObjectMapper m=new ObjectMapper();m.setSerializerProvider(sp);assertEquals("\"foobar\"",m.writeValueAsString(null));}
public void testCustomNulls()throws Exception {ObjectMapper m=new ObjectMapper();m.setSerializerProvider(new MyNullProvider());assertEquals("{\"name\":\"foobar\"}",m.writeValueAsString(new Bean1()));assertEquals("{\"type\":null}",m.writeValueAsString(new Bean2()));}
public void testGlobal()throws IOException {ObjectMapper m=new ObjectMapper();Map<String,Object> result=writeAndMap(m,new SimpleBean());assertEquals(2,result.size());assertEquals("a",result.get("a"));assertNull(result.get("b"));assertTrue(result.containsKey("b"));}
public void testNonNullByClass()throws IOException {ObjectMapper m=new ObjectMapper();Map<String,Object> result=writeAndMap(m,new NoNullsBean());assertEquals(1,result.size());assertFalse(result.containsKey("a"));assertNull(result.get("a"));assertTrue(result.containsKey("b"));assertNull(result.get("b"));}
public void testNonDefaultByClass()throws IOException {ObjectMapper m=new ObjectMapper();NonDefaultBean bean=new NonDefaultBean();bean._a="notA";Map<String,Object> result=writeAndMap(m,bean);assertEquals(1,result.size());assertTrue(result.containsKey("a"));assertEquals("notA",result.get("a"));assertFalse(result.containsKey("b"));assertNull(result.get("b"));}
public void testMixedMethod()throws IOException {ObjectMapper m=new ObjectMapper();MixedBean bean=new MixedBean();bean._a="xyz";bean._b=null;Map<String,Object> result=writeAndMap(m,bean);assertEquals(1,result.size());assertEquals("xyz",result.get("a"));assertFalse(result.containsKey("b"));bean._a="a";bean._b="b";result=writeAndMap(m,bean);assertEquals(1,result.size());assertEquals("b",result.get("b"));assertFalse(result.containsKey("a"));}
public void testDefaultForEmptyList()throws IOException {ObjectMapper m=new ObjectMapper();assertEquals("{}",m.writeValueAsString(new ListBean()));}
public void testNonEmptyDefaultArray()throws IOException {ObjectMapper m=new ObjectMapper();assertEquals("{}",m.writeValueAsString(new ArrayBean()));}
public void testExceptionFromConstructor()throws Exception {try {MAPPER.readValue("{}",BustedCtor.class);fail("Expected exception");}catch(JsonMappingException e){verifyException(e,": foobar");Throwable t=e.getCause();assertNotNull(t);assertEquals(IllegalArgumentException.class,t.getClass());assertEquals("foobar",t.getMessage());}}
public void testSimpleConstructor()throws Exception {HashTest test=MAPPER.readValue("{\"type\":\"custom\",\"bytes\":\"abc\" }",HashTest.class);assertEquals("custom",test.type);assertEquals("abc",new String(test.bytes,"UTF-8"));}
public void testMissingPrimitives()throws Exception {Primitives p=MAPPER.readValue("{}",Primitives.class);assertFalse(p.b);assertEquals(0,p.x);assertEquals(0.0,p.d);}
public void testJackson431()throws Exception {final Test431Container foo=MAPPER.readValue("{\"items\":\n" + "[{\"bar\": 0,\n" + "\"id\": \"id123\",\n"+ "\"foo\": 1\n"+ "}]}",Test431Container.class);assertNotNull(foo);}
public void testJackson438()throws Exception {try {MAPPER.readValue("{\"name\":\"foobar\" }",BeanFor438.class);fail("Should have failed");}catch(Exception e){if (!(e instanceof JsonMappingException)){fail("Should have received JsonMappingException,caught " + e.getClass().getName());}verifyException(e,"don't like that name");Throwable t=e.getCause();assertNotNull(t);assertEquals(IllegalArgumentException.class,t.getClass());verifyException(e,"don't like that name");}}
@SuppressWarnings("unchecked")public void testIssue465()throws Exception {final String JSON="{\"A\":12}";Map<String,Long> map=MAPPER.readValue(JSON,Map.class);assertEquals(1,map.size());assertEquals(Integer.valueOf(12),map.get("A"));MapBean bean=MAPPER.readValue(JSON,MapBean.class);assertEquals(1,bean.map.size());assertEquals(Long.valueOf(12L),bean.map.get("A"));final String EMPTY_JSON="{}";map=MAPPER.readValue(EMPTY_JSON,Map.class);assertEquals(0,map.size());bean=MAPPER.readValue(EMPTY_JSON,MapBean.class);assertEquals(0,bean.map.size());}
public void testCreatorWithDupNames()throws Exception {try {MAPPER.readValue("{\"bar\":\"x\"}",BrokenCreatorBean.class);fail("Should have caught duplicate creator parameters");}catch(JsonMappingException e){verifyException(e,"duplicate creator property \"bar\"");}}
public void testCreatorMultipleArgumentWithoutAnnotation()throws Exception {AutoDetectConstructorBean value=MAPPER.readValue("{\"bar\":\"bar\",\"foo\":\"foo\"}",AutoDetectConstructorBean.class);assertEquals("bar",value.bar);assertEquals("foo",value.foo);}
public void testIgnoredSingleArgCtor()throws Exception {try {MAPPER.readValue(quote("abc"),IgnoredCtor.class);fail("Should have caught missing constructor problem");}catch(JsonMappingException e){verifyException(e,"no single-String constructor/factory method");}}
public void testAbstractFactory()throws Exception {AbstractBase bean=MAPPER.readValue("{\"a\":3}",AbstractBase.class);assertNotNull(bean);AbstractBaseImpl impl=(AbstractBaseImpl)bean;assertEquals(1,impl.props.size());assertEquals(Integer.valueOf(3),impl.props.get("a"));}
public void testCreatorProperties()throws Exception {Issue700Bean value=MAPPER.readValue("{\"item\" : \"foo\" }",Issue700Bean.class);assertNotNull(value);}
@SuppressWarnings("unchecked")public void testSimpleViaObjectMapper()throws IOException {ObjectMapper mapper=new ObjectMapper();ObjectNode n=mapper.getNodeFactory().objectNode();n.put("number",15);n.put("string","abc");ObjectNode n2=n.putObject("ob");n2.putArray("arr");StringWriter sw=new StringWriter();JsonGenerator jg=mapper.getFactory().createGenerator(sw);mapper.writeTree(jg,n);Map<String,Object> result=(Map<String,Object>)mapper.readValue(sw.toString(),Map.class);assertEquals(3,result.size());assertEquals("abc",result.get("string"));assertEquals(Integer.valueOf(15),result.get("number"));Map<String,Object> ob=(Map<String,Object>)result.get("ob");assertEquals(1,ob.size());List<Object> list=(List<Object>)ob.get("arr");assertEquals(0,list.size());}
/** * Simple test to verify that POJONodes (JsonNode wrapper around any old Java object)work with serialization*/@SuppressWarnings("unchecked")public void testPOJOString()throws Exception {ObjectMapper mapper=new ObjectMapper();ObjectNode n=mapper.getNodeFactory().objectNode();n.set("pojo",mapper.getNodeFactory().POJONode("abc"));StringWriter sw=new StringWriter();JsonGenerator jg=mapper.getFactory().createGenerator(sw);mapper.writeTree(jg,n);Map<String,Object> result=(Map<String,Object>)mapper.readValue(sw.toString(),Map.class);assertEquals(1,result.size());assertEquals("abc",result.get("pojo"));}
@SuppressWarnings("unchecked")public void testPOJOIntArray()throws IOException {ObjectMapper mapper=new ObjectMapper();ObjectNode n=mapper.getNodeFactory().objectNode();n.set("pojo",mapper.getNodeFactory().POJONode(new int[]{1,2,3}));StringWriter sw=new StringWriter();JsonGenerator jg=mapper.getFactory().createGenerator(sw);mapper.writeTree(jg,n);Map<String,Object> result=(Map<String,Object>)mapper.readValue(sw.toString(),Map.class);assertEquals(1,result.size());List<Object> list=(List<Object>)result.get("pojo");assertEquals(3,list.size());for (int i=0;i < 3;++i){assertEquals(Integer.valueOf(i + 1),list.get(i));}}
@SuppressWarnings("unchecked")public void testPOJOBean()throws IOException {ObjectMapper mapper=new ObjectMapper();ObjectNode n=mapper.getNodeFactory().objectNode();n.set("pojo",mapper.getNodeFactory().POJONode(new Bean()));StringWriter sw=new StringWriter();JsonGenerator jg=mapper.getFactory().createGenerator(sw);mapper.writeTree(jg,n);Map<String,Object> result=(Map<String,Object>)mapper.readValue(sw.toString(),Map.class);assertEquals(1,result.size());Map<String,Object> bean=(Map<String,Object>)result.get("pojo");assertEquals(2,bean.size());assertEquals("y",bean.get("x"));assertEquals(Integer.valueOf(13),bean.get("y"));}
public void testSimpleWithJSON()throws Exception {ObjectReader detecting=READER.withType(POJO.class);detecting=detecting.withFormatDetection(detecting);POJO pojo=detecting.readValue(utf8Bytes("{\"x\":1}"));assertNotNull(pojo);assertEquals(1,pojo.x);}
public void testInvalid()throws Exception {ObjectReader detecting=READER.withType(POJO.class);detecting=detecting.withFormatDetection(detecting);try {detecting.readValue(utf8Bytes("<POJO><x>1</x></POJO>"));fail("Should have failed");}catch(JsonProcessingException e){verifyException(e,"Can not detect format from input");}}
public void testFieldIntrospection(){AnnotatedClass ac=AnnotatedClass.construct(FieldBean.class,new JacksonAnnotationIntrospector(),null);assertEquals(2,ac.getFieldCount());for(AnnotatedField f : ac.fields()){String fname=f.getName();if (!"bar".equals(fname)&& !"props".equals(fname)){fail("Unexpected field name '" + fname + "'");}}}
public void testIgnoredType()throws Exception {ObjectMapper mapper=new ObjectMapper();NonIgnoredType bean=mapper.readValue("{\"value\":13}",NonIgnoredType.class);assertNotNull(bean);assertEquals(13,bean.value);bean=mapper.readValue("{\"ignored\":[1,2,{}],\"value\":9 }",NonIgnoredType.class);assertNotNull(bean);assertEquals(9,bean.value);}
public void testPolymorphicRoundtrip()throws Exception {Impl in1=new Impl(123,456);in1.next=new Impl(111,222);in1.next.next=in1;String json=mapper.writeValueAsString(in1);Base result0=mapper.readValue(json,Base.class);assertNotNull(result0);assertSame(Impl.class,result0.getClass());Impl result=(Impl)result0;assertEquals(123,result.value);assertEquals(456,result.extra);Impl result2=(Impl)result.next;assertEquals(111,result2.value);assertEquals(222,result2.extra);assertSame(result,result2.next);}
public void testIssue811()throws Exception {ObjectMapper om=new ObjectMapper();om.disable(MapperFeature.AUTO_DETECT_CREATORS);om.disable(MapperFeature.AUTO_DETECT_GETTERS);om.disable(MapperFeature.AUTO_DETECT_IS_GETTERS);om.setVisibility(PropertyAccessor.FIELD,Visibility.ANY);om.enable(SerializationFeature.WRITE_ENUMS_USING_INDEX);om.enable(SerializationFeature.INDENT_OUTPUT);om.enableDefaultTypingAsProperty(DefaultTyping.NON_FINAL,"@class");Process p=new Process();Scope s=new Scope(p,null);FaultHandler fh=new FaultHandler(p);Catch c=new Catch(p,s);fh.catchBlocks.add(c);s.faultHandlers.add(fh);String json=om.writeValueAsString(p);Process restored=om.readValue(json,Process.class);assertNotNull(restored);assertEquals(0,p.id);assertEquals(3,p.children.size());assertSame(p,p.children.get(0).owner);assertSame(p,p.children.get(1).owner);assertSame(p,p.children.get(2).owner);}
/** * First things first,let's ensure we can serialize using class name,written as main-level property name*/public void testSimpleClassAsProperty()throws Exception {Map<String,Object> result=writeAndMap(MAPPER,new Cat("Beelzebub","tabby"));assertEquals(3,result.size());assertEquals("Beelzebub",result.get("name"));assertEquals("tabby",result.get("furColor"));String classProp=Id.CLASS.getDefaultPropertyName();assertEquals(Cat.class.getName(),result.get(classProp));}
/** * Test inclusion using wrapper style*/public void testTypeAsWrapper()throws Exception {ObjectMapper m=new ObjectMapper();m.addMixInAnnotations(Animal.class,TypeWithWrapper.class);Map<String,Object> result=writeAndMap(m,new Cat("Venla","black"));assertEquals(1,result.size());Map<?,?> cat=(Map<?,?>)result.get(".TestTypedSerialization$Cat");assertNotNull(cat);assertEquals(2,cat.size());assertEquals("Venla",cat.get("name"));assertEquals("black",cat.get("furColor"));}
/** * Test inclusion using 2-element array*/public void testTypeAsArray()throws Exception {ObjectMapper m=new ObjectMapper();m.addMixInAnnotations(Animal.class,TypeWithArray.class);Map<String,Object> result=writeAndMap(m,new AnimalWrapper(new Dog("Amadeus",7)));assertEquals(1,result.size());List<?> l=(List<?>)result.get("animal");assertNotNull(l);assertEquals(2,l.size());assertEquals(Dog.class.getName(),l.get(0));Map<?,?> doggie=(Map<?,?>)l.get(1);assertNotNull(doggie);assertEquals(2,doggie.size());assertEquals("Amadeus",doggie.get("name"));assertEquals(Integer.valueOf(7),doggie.get("boneCount"));}
@SuppressWarnings("unchecked")public void testInArray()throws Exception {ObjectMapper m=new ObjectMapper();m.disableDefaultTyping();Animal[]animals=new Animal[]{new Cat("Miuku","white"),new Dog("Murre",9)};Map<String,Object> map=new HashMap<String,Object>();map.put("a",animals);String json=m.writeValueAsString(map);Map<String,Object> result=m.readValue(json,Map.class);assertEquals(1,result.size());Object ob=result.get("a");if (!(ob instanceof List<?>)){fail("Did not map to entry with 'a' as List (but as " + ob.getClass().getName()+ "): JSON == '"+ json+ "'");}List<?> l=(List<?>)ob;assertNotNull(l);assertEquals(2,l.size());Map<?,?> a1=(Map<?,?>)l.get(0);assertEquals(3,a1.size());String classProp=Id.CLASS.getDefaultPropertyName();assertEquals(Cat.class.getName(),a1.get(classProp));Map<?,?> a2=(Map<?,?>)l.get(1);assertEquals(3,a2.size());assertEquals(Dog.class.getName(),a2.get(classProp));}
/** * Simple unit test to verify that serializing "empty" beans is ok*/public void testEmptyBean()throws Exception {ObjectMapper m=new ObjectMapper();m.configure(SerializationFeature.FAIL_ON_EMPTY_BEANS,false);assertEquals("{\"@type\":\"empty\"}",m.writeValueAsString(new Empty()));}
/** * Unit test for [JACKSON-543]*/public void testTypedMaps()throws Exception {ObjectMapper mapper=new ObjectMapper();Map<Long,Collection<Super>> map=new HashMap<Long,Collection<Super>>();List<Super> list=new ArrayList<Super>();list.add(new A());map.put(1L,list);String json=mapper.writerWithType(new TypeReference<Map<Long,Collection<Super>>>(){}).writeValueAsString(map);assertTrue("JSON does not contain '@class': " + json,json.contains("@class"));}
public void testSubTypesFor356()throws Exception {ObjectMapper mapper=new ObjectMapper();Version v=mapper.version();if (v.getMajorVersion()== 1 && v.getMinorVersion()== 6){System.err.println("Note: skipping test for Jackson 1.6");return;}JSONResponse<List<Parent>> input=new JSONResponse<List<Parent>>();List<Parent> embedded=new ArrayList<Parent>();embedded.add(new Child1());embedded.add(new Child2());input.setResult(embedded);mapper.configure(MapperFeature.USE_STATIC_TYPING,true);JavaType rootType=TypeFactory.defaultInstance().constructType(new TypeReference<JSONResponse<List<Parent>>>(){});byte[]json=mapper.writerWithType(rootType).writeValueAsBytes(input);JSONResponse<List<Parent>> out=mapper.readValue(json,0,json.length,rootType);List<Parent> deserializedContent=(List<Parent>)out.getResult();assertEquals(2,deserializedContent.size());assertTrue(deserializedContent.get(0)instanceof Parent);assertTrue(deserializedContent.get(0)instanceof Child1);assertFalse(deserializedContent.get(0)instanceof Child2);assertTrue(deserializedContent.get(1)instanceof Child2);assertFalse(deserializedContent.get(1)instanceof Child1);assertEquals("PARENT",((Child1)deserializedContent.get(0)).parentContent);assertEquals("PARENT",((Child2)deserializedContent.get(1)).parentContent);assertEquals("CHILD1",((Child1)deserializedContent.get(0)).childContent1);assertEquals("CHILD2",((Child2)deserializedContent.get(1)).childContent2);}
public void testBeanConvert(){PointStrings input=new PointStrings("37","-9");Point point=MAPPER.convertValue(input,Point.class);assertEquals(37,point.x);assertEquals(-9,point.y);assertEquals(-13,point.z);}
public void testErrorReporting()throws Exception {try {MAPPER.readValue("{\"unknownProp\":true}",BooleanBean.class);}catch(JsonProcessingException e){verifyException(e,"unknownProp");}try {MAPPER.readValue("{\"boolProp\":\"foobar\"}",BooleanBean.class);}catch(JsonProcessingException e){verifyException(e,"boolProp");}}
public void testIssue458()throws Exception {ObjectWrapper a=new ObjectWrapper("foo");ObjectWrapper b=new ObjectWrapper(a);ObjectWrapper b2=MAPPER.convertValue(b,ObjectWrapper.class);ObjectWrapper a2=MAPPER.convertValue(b2.getData(),ObjectWrapper.class);assertEquals("foo",a2.getData());}
public void testWrapping()throws Exception {ObjectMapper wrappingMapper=new ObjectMapper();wrappingMapper.enable(DeserializationFeature.UNWRAP_ROOT_VALUE);wrappingMapper.enable(SerializationFeature.WRAP_ROOT_VALUE);_convertAndVerifyPoint(wrappingMapper);wrappingMapper=new ObjectMapper();wrappingMapper.enable(DeserializationFeature.UNWRAP_ROOT_VALUE);wrappingMapper.disable(SerializationFeature.WRAP_ROOT_VALUE);_convertAndVerifyPoint(wrappingMapper);wrappingMapper=new ObjectMapper();wrappingMapper.disable(DeserializationFeature.UNWRAP_ROOT_VALUE);wrappingMapper.enable(SerializationFeature.WRAP_ROOT_VALUE);_convertAndVerifyPoint(wrappingMapper);}
public void testConvertUsingCast()throws Exception {String str=new String("foo");CharSequence seq=str;String result=MAPPER.convertValue(seq,String.class);assertSame(str,result);}
public void testNodeConvert()throws Exception {ObjectNode src=(ObjectNode)MAPPER.readTree("{}");TreeNode node=src;ObjectNode result=MAPPER.treeToValue(node,ObjectNode.class);assertSame(src,result);}
/** * Need to test "shortcuts" introduced by [Issue-11]*/public void testIssue11()throws Exception {ObjectNode root=MAPPER.createObjectNode();JsonNode n=root;ObjectNode ob2=MAPPER.convertValue(n,ObjectNode.class);assertSame(root,ob2);JsonNode n2=MAPPER.convertValue(n,JsonNode.class);assertSame(root,n2);String STR="test";CharSequence seq=MAPPER.convertValue(STR,CharSequence.class);assertSame(STR,seq);Leaf l=new Leaf(13);Map<?,?> m=MAPPER.convertValue(l,Map.class);assertNotNull(m);assertEquals(1,m.size());assertEquals(Integer.valueOf(13),m.get("value"));Leaf l2=MAPPER.convertValue(m,Leaf.class);assertEquals(13,l2.value);Object ob=MAPPER.convertValue(l,Object.class);assertNotNull(ob);assertEquals(LinkedHashMap.class,ob.getClass());final Object plaino=new Object();try {m=MAPPER.convertValue(plaino,Map.class);fail("Conversion should have failed");}catch(IllegalArgumentException e){verifyException(e,"no properties discovered");}ObjectMapper mapper=new ObjectMapper();mapper.disable(SerializationFeature.FAIL_ON_EMPTY_BEANS);try {assertEquals("{}",mapper.writeValueAsString(plaino));}catch(Exception e){throw (Exception)e.getCause();}m=mapper.convertValue(plaino,Map.class);assertNotNull(m);assertEquals(0,m.size());}
public void testPrivateCtor()throws Exception {ObjectMapper m=new ObjectMapper();PrivateBean bean=m.readValue("\"abc\"",PrivateBean.class);assertEquals("abc",bean.a);m=new ObjectMapper();VisibilityChecker<?> vc=m.getVisibilityChecker();vc=vc.withCreatorVisibility(JsonAutoDetect.Visibility.PUBLIC_ONLY);m.setVisibilityChecker(vc);try {m.readValue("\"abc\"",PrivateBean.class);fail("Expected exception for missing constructor");}catch(JsonProcessingException e){verifyException(e,"no single-String constructor/factory");}}
public void testCustomBeanInstantiator()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.registerModule(new MyModule(MyBean.class,new MyBeanInstantiator()));MyBean bean=mapper.readValue("{}",MyBean.class);assertNotNull(bean);assertEquals("secret!",bean._secret);}
public void testCustomListInstantiator()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.registerModule(new MyModule(MyList.class,new MyListInstantiator()));MyList result=mapper.readValue("[]",MyList.class);assertNotNull(result);assertEquals(MyList.class,result.getClass());assertEquals(0,result.size());}
public void testCustomMapInstantiator()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.registerModule(new MyModule(MyMap.class,new MyMapInstantiator()));MyMap result=mapper.readValue("{\"a\":\"b\" }",MyMap.class);assertNotNull(result);assertEquals(MyMap.class,result.getClass());assertEquals(1,result.size());}
public void testDelegateBeanInstantiator()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.registerModule(new MyModule(MyBean.class,new MyDelegateBeanInstantiator()));MyBean bean=mapper.readValue("123",MyBean.class);assertNotNull(bean);assertEquals("123",bean._secret);}
public void testDelegateListInstantiator()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.registerModule(new MyModule(MyList.class,new MyDelegateListInstantiator()));MyList result=mapper.readValue("123",MyList.class);assertNotNull(result);assertEquals(1,result.size());assertEquals(Integer.valueOf(123),result.get(0));}
public void testDelegateMapInstantiator()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.registerModule(new MyModule(MyMap.class,new MyDelegateMapInstantiator()));MyMap result=mapper.readValue("123",MyMap.class);assertNotNull(result);assertEquals(1,result.size());assertEquals(Integer.valueOf(123),result.values().iterator().next());}
public void testPropertyBasedBeanInstantiator()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.registerModule(new MyModule(CreatorBean.class,new InstantiatorBase(){@Override public boolean canCreateFromObjectWith(){return true;}@Override public CreatorProperty[]getFromObjectArguments(DeserializationConfig config){return new CreatorProperty[]{new CreatorProperty("secret",config.constructType(String.class),null,null,null,null,0,null,true)};}@Override public Object createFromObjectWith(DeserializationContext ctxt,Object[]args){return new CreatorBean((String)args[0]);}}));CreatorBean bean=mapper.readValue("{\"secret\":123,\"value\":37}",CreatorBean.class);assertNotNull(bean);assertEquals("123",bean._secret);}
public void testPropertyBasedMapInstantiator()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.registerModule(new MyModule(MyMap.class,new CreatorMapInstantiator()));MyMap result=mapper.readValue("{\"name\":\"bob\",\"x\":\"y\"}",MyMap.class);assertNotNull(result);assertEquals(2,result.size());assertEquals("bob",result.get("bob"));assertEquals("y",result.get("x"));}
public void testBeanFromString()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.registerModule(new MyModule(MysteryBean.class,new InstantiatorBase(){@Override public boolean canCreateFromString(){return true;}@Override public Object createFromString(DeserializationContext ctxt,String value){return new MysteryBean(value);}}));MysteryBean result=mapper.readValue(quote("abc"),MysteryBean.class);assertNotNull(result);assertEquals("abc",result.value);}
public void testBeanFromInt()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.registerModule(new MyModule(MysteryBean.class,new InstantiatorBase(){@Override public boolean canCreateFromInt(){return true;}@Override public Object createFromInt(DeserializationContext ctxt,int value){return new MysteryBean(value + 1);}}));MysteryBean result=mapper.readValue("37",MysteryBean.class);assertNotNull(result);assertEquals(Integer.valueOf(38),result.value);}
public void testBeanFromLong()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.registerModule(new MyModule(MysteryBean.class,new InstantiatorBase(){@Override public boolean canCreateFromLong(){return true;}@Override public Object createFromLong(DeserializationContext ctxt,long value){return new MysteryBean(value + 1L);}}));MysteryBean result=mapper.readValue("9876543210",MysteryBean.class);assertNotNull(result);assertEquals(Long.valueOf(9876543211L),result.value);}
public void testBeanFromDouble()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.registerModule(new MyModule(MysteryBean.class,new InstantiatorBase(){@Override public boolean canCreateFromDouble(){return true;}@Override public Object createFromDouble(DeserializationContext ctxt,double value){return new MysteryBean(2.0 * value);}}));MysteryBean result=mapper.readValue("0.25",MysteryBean.class);assertNotNull(result);assertEquals(Double.valueOf(0.5),result.value);}
public void testBeanFromBoolean()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.registerModule(new MyModule(MysteryBean.class,new InstantiatorBase(){@Override public boolean canCreateFromBoolean(){return true;}@Override public Object createFromBoolean(DeserializationContext ctxt,boolean value){return new MysteryBean(Boolean.valueOf(value));}}));MysteryBean result=mapper.readValue("true",MysteryBean.class);assertNotNull(result);assertEquals(Boolean.TRUE,result.value);}
/** * Beyond basic features,it should be possible to even implement polymorphic handling...*/public void testPolymorphicCreatorBean()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.registerModule(new MyModule(PolymorphicBeanBase.class,new PolymorphicBeanInstantiator()));String JSON="{\"type\":" + quote(PolymorphicBean.class.getName())+ ",\"name\":\"Axel\"}";PolymorphicBeanBase result=mapper.readValue(JSON,PolymorphicBeanBase.class);assertNotNull(result);assertSame(PolymorphicBean.class,result.getClass());assertEquals("Axel",((PolymorphicBean)result).name);}
public void testJackson633()throws Exception {ObjectMapper mapper=new ObjectMapper();AnnotatedBean bean=mapper.readValue("{}",AnnotatedBean.class);assertNotNull(bean);assertEquals("foo",bean.a);assertEquals(3,bean.b);}
/** * Unit test for verifying that leaf-level mix-ins work ok;that is,any annotations added properly override all annotations that masked methods (fields etc)have.*/public void testLeafMixin()throws IOException {ObjectMapper mapper=new ObjectMapper();Map<String,Object> result;BaseClass bean=new BaseClass("a1","b2");result=writeAndMap(mapper,bean);assertEquals(1,result.size());assertEquals("b2",result.get("b"));mapper=new ObjectMapper();mapper.addMixInAnnotations(BaseClass.class,MixIn.class);result=writeAndMap(mapper,bean);assertEquals(2,result.size());assertEquals("b2",result.get("b2"));assertEquals("a1",result.get("a"));}
/** * Unit test for verifying that having a mix-in "between" classes (overriding annotations of a base class,but being overridden further by a sub-class)works as expected*/public void testIntermediateMixin()throws IOException {ObjectMapper mapper=new ObjectMapper();Map<String,Object> result;LeafClass bean=new LeafClass("XXX","b2");mapper.addMixInAnnotations(BaseClass.class,MixIn.class);result=writeAndMap(mapper,bean);assertEquals(1,result.size());assertEquals("XXX",result.get("a"));}
/** * Another intermediate mix-in,to verify that annotations properly "trickle up"*/public void testIntermediateMixin2()throws IOException {ObjectMapper mapper=new ObjectMapper();mapper.addMixInAnnotations(EmptyBean.class,MixInForSimple.class);Map<String,Object> result=writeAndMap(mapper,new SimpleBean());assertEquals(1,result.size());assertEquals(Integer.valueOf(42),result.get("x"));}
/** * Unit test for verifying that it is actually possible to attach mix-in annotations to basic <code>Object.class</code>. This will essentially apply to any and all Objects.*/public void testObjectMixin()throws IOException {ObjectMapper mapper=new ObjectMapper();mapper.addMixInAnnotations(Object.class,ObjectMixIn.class);Map<String,Object> result=writeAndMap(mapper,new BaseClass("a","b"));assertEquals(2,result.size());assertEquals("b",result.get("b"));Object ob=result.get("hashCode");assertNotNull(ob);assertEquals(Integer.class,ob.getClass());}
public void testSharedNames()throws Exception {ObjectMapper mapper=new ObjectMapper();assertEquals("{\"x\":6}",mapper.writeValueAsString(new SharedName(6)));}
public void testSharedNamesFromGetterToSetter()throws Exception {ObjectMapper mapper=new ObjectMapper();String json=mapper.writeValueAsString(new SharedName2());assertEquals("{\"x\":1}",json);SharedName2 result=mapper.readValue(json,SharedName2.class);assertNotNull(result);}
public void testSharedTypeInfo()throws Exception {ObjectMapper mapper=new ObjectMapper();String json=mapper.writeValueAsString(new Wrapper(13L));Wrapper result=mapper.readValue(json,Wrapper.class);assertEquals(Long.class,result.value.getClass());}
public void testSharedTypeInfoWithCtor()throws Exception {ObjectMapper mapper=new ObjectMapper();String json=mapper.writeValueAsString(new TypeWrapper(13L));TypeWrapper result=mapper.readValue(json,TypeWrapper.class);assertEquals(Long.class,result.value.getClass());}
public void testSuperTypes(){Collection<Class<?>> result=ClassUtil.findSuperTypes(SubClass.class,null);Class<?>[]classes=result.toArray(new Class<?>[result.size()]);Class<?>[]exp=new Class[]{SubInt.class,BaseInt.class,BaseClass.class,Comparable.class};assertArrayEquals(exp,classes);}
public void testSuperInterfaces(){Collection<Class<?>> result=ClassUtil.findSuperTypes(SubInt.class,null);Class<?>[]classes=result.toArray(new Class<?>[result.size()]);Class<?>[]exp=new Class[]{BaseInt.class};assertArrayEquals(exp,classes);}
public void testIsConcrete(){assertTrue(ClassUtil.isConcrete(getClass()));assertFalse(ClassUtil.isConcrete(BaseClass.class));assertFalse(ClassUtil.isConcrete(BaseInt.class));}
public void testCanBeABeanType(){assertEquals("annotation",ClassUtil.canBeABeanType(java.lang.annotation.Retention.class));assertEquals("array",ClassUtil.canBeABeanType(String[].class));assertEquals("enum",ClassUtil.canBeABeanType(TestEnum.class));assertEquals("primitive",ClassUtil.canBeABeanType(Integer.TYPE));assertNull(ClassUtil.canBeABeanType(Integer.class));assertEquals("non-static member class",ClassUtil.isLocalType(InnerNonStatic.class,false));assertNull(ClassUtil.isLocalType(Integer.class,false));}
public void testExceptionHelpers(){RuntimeException e=new RuntimeException("test");RuntimeException wrapper=new RuntimeException(e);assertSame(e,ClassUtil.getRootCause(wrapper));try {ClassUtil.throwAsIAE(e);fail("Shouldn't get this far");}catch(RuntimeException e2){assertSame(e,e2);}try {ClassUtil.unwrapAndThrowAsIAE(wrapper);fail("Shouldn't get this far");}catch(RuntimeException e2){assertSame(e,e2);}}
public void testFailedCreateInstance(){try {ClassUtil.createInstance(BaseClass.class,true);}catch(IllegalArgumentException e){verifyException(e,"has no default");}try {ClassUtil.createInstance(Inner.class,false);}catch(IllegalArgumentException e){verifyException(e,"is not accessible");}try {ClassUtil.createInstance(Inner.class,true);}catch(IllegalStateException e){verifyException(e,"test");}}
public void testReadingArrayAsTree()throws IOException {JsonFactory jf=new MappingJsonFactory();final String JSON="[1,2,false ]";for (int i=0;i < 2;++i){JsonParser jp=jf.createParser(new StringReader(JSON));if (i == 0){assertToken(JsonToken.START_ARRAY,jp.nextToken());}JsonNode root=(JsonNode)jp.readValueAsTree();jp.close();assertTrue(root.isArray());assertEquals(3,root.size());assertEquals(1,root.get(0).intValue());assertEquals(2,root.get(1).intValue());assertFalse(root.get(2).booleanValue());}}
public void testPojoReading()throws IOException {JsonFactory jf=new MappingJsonFactory();final String JSON="{\"x\" : 9 }";JsonParser jp=jf.createParser(new StringReader(JSON));assertToken(JsonToken.START_OBJECT,jp.nextToken());Pojo p=jp.readValueAs(Pojo.class);assertEquals(9,p._x);jp.close();jp=jf.createParser(new StringReader(JSON));p=jp.readValueAs(Pojo.class);assertEquals(9,p._x);jp.close();}
/** * Test similar to above,but instead reads a sequence of values*/public void testIncrementalPojoReading()throws IOException {JsonFactory jf=new MappingJsonFactory();final String JSON="[1,true,null,\"abc\" ]";JsonParser jp=jf.createParser(new StringReader(JSON));assertToken(JsonToken.START_ARRAY,jp.nextToken());assertToken(JsonToken.VALUE_NUMBER_INT,jp.nextToken());assertEquals(Integer.valueOf(1),jp.readValueAs(Integer.class));assertEquals(Boolean.TRUE,jp.readValueAs(Boolean.class));assertNull(jp.readValueAs(Object.class));assertEquals(JsonToken.VALUE_NULL,jp.getLastClearedToken());assertEquals("abc",jp.readValueAs(String.class));assertNull(jp.readValueAs(Object.class));assertEquals(JsonToken.END_ARRAY,jp.getLastClearedToken());assertNull(jp.nextToken());jp.close();}
public void testPojoReadingFailing()throws IOException {JsonFactory jf=new JsonFactory();try {final String JSON="{\"x\" : 9 }";JsonParser jp=jf.createParser(new StringReader(JSON));Pojo p=jp.readValueAs(Pojo.class);fail("Expected an exception: got " + p);}catch(IllegalStateException e){verifyException(e,"No ObjectCodec defined");}}
public void testEscapingUsingMapper()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.configure(JsonGenerator.Feature.ESCAPE_NON_ASCII,true);assertEquals(quote("\\u0101"),mapper.writeValueAsString(String.valueOf((char)257)));}
public void testSimpleMapImitation()throws Exception {MapImitator mapHolder=MAPPER.readValue("{\"a\" : 3,\"b\" : true }",MapImitator.class);Map<String,Object> result=mapHolder._map;assertEquals(2,result.size());assertEquals(Integer.valueOf(3),result.get("a"));assertEquals(Boolean.TRUE,result.get("b"));}
public void testSimpleTyped()throws Exception {MapImitatorWithValue mapHolder=MAPPER.readValue("{\"a\" :[3,-1 ],\"b\" :[]}",MapImitatorWithValue.class);Map<String,int[]> result=mapHolder._map;assertEquals(2,result.size());assertEquals(new int[]{3,-1},result.get("a"));assertEquals(new int[0],result.get("b"));}
public void testBrokenWithDoubleAnnotations()throws Exception {try {@SuppressWarnings("unused")Broken b=MAPPER.readValue("{\"a\" : 3 }",Broken.class);fail("Should have gotten an exception");}catch(JsonMappingException e){verifyException(e,"Multiple 'any-setters'");}}
public void testIgnored()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.enable(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES);_testIgnorals(mapper);}
public void testIgnored383()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.disable(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES);_testIgnorals(mapper);}
public void testProblem744()throws Exception {Bean744 bean=MAPPER.readValue("{\"name\":\"Bob\"}",Bean744.class);assertNotNull(bean.additionalProperties);assertEquals(1,bean.additionalProperties.size());assertEquals("Bob",bean.additionalProperties.get("name"));}
public void testIssue797()throws Exception {String json=MAPPER.writeValueAsString(new Bean797BaseImpl());assertEquals("{}",json);}
/** * Unit test to catch bug [JACKSON-8].*/public void testBigDecimal()throws Exception {Map<String,Object> map=new HashMap<String,Object>();String PI_STR="3.14159265";map.put("pi",new BigDecimal(PI_STR));String str=MAPPER.writeValueAsString(map);assertEquals("{\"pi\":3.14159265}",str);}
public void testBigDecimalAsPlainString()throws Exception {MAPPER.enable(SerializationFeature.WRITE_BIGDECIMAL_AS_PLAIN);Map<String,Object> map=new HashMap<String,Object>();String PI_STR="3.00000000";map.put("pi",new BigDecimal(PI_STR));String str=MAPPER.writeValueAsString(map);assertEquals("{\"pi\":3.00000000}",str);}
/** * Unit test related to [JACKSON-155]*/public void testFile()throws IOException {File f=new File(new File("/tmp"),"foo.text");String str=MAPPER.writeValueAsString(f);String escapedAbsPath=f.getAbsolutePath().replaceAll("\\\\","\\\\\\\\");assertEquals(quote(escapedAbsPath),str);}
public void testRegexps()throws IOException {final String PATTERN_STR="\\s+([a-b]+)\\w?";Pattern p=Pattern.compile(PATTERN_STR);Map<String,Object> input=new HashMap<String,Object>();input.put("p",p);Map<String,Object> result=writeAndMap(MAPPER,input);assertEquals(p.pattern(),result.get("p"));}
public void testCurrency()throws IOException {Currency usd=Currency.getInstance("USD");assertEquals(quote("USD"),MAPPER.writeValueAsString(usd));}
public void testLocale()throws IOException {assertEquals(quote("en"),MAPPER.writeValueAsString(new Locale("en")));assertEquals(quote("es_ES"),MAPPER.writeValueAsString(new Locale("es","ES")));assertEquals(quote("fi_FI_savo"),MAPPER.writeValueAsString(new Locale("FI","fi","savo")));}
public void testInetAddress()throws IOException {assertEquals(quote("127.0.0.1"),MAPPER.writeValueAsString(InetAddress.getByName("127.0.0.1")));assertEquals(quote("ning.com"),MAPPER.writeValueAsString(InetAddress.getByName("ning.com")));}
public void testClass()throws IOException {assertEquals(quote("java.lang.String"),MAPPER.writeValueAsString(String.class));assertEquals(quote("int"),MAPPER.writeValueAsString(Integer.TYPE));assertEquals(quote("boolean"),MAPPER.writeValueAsString(Boolean.TYPE));assertEquals(quote("void"),MAPPER.writeValueAsString(Void.TYPE));}
public void testCharset()throws IOException {assertEquals(quote("UTF-8"),MAPPER.writeValueAsString(Charset.forName("UTF-8")));}
/** * Simple test to verify that it is possible to implement polymorphic deserialization manually.*/public void testManualPolymorphicDog()throws Exception {Animal animal=MAPPER.readValue("{\"type\":\"dog\",\"name\":\"Fido\",\"barkVolume\" : 95.0 }",Animal.class);assertEquals(Dog.class,animal.getClass());assertEquals("Fido",animal.name);assertEquals(95.0,((Dog)animal).barkVolume);}
public void testManualPolymorphicCatBasic()throws Exception {Animal animal=MAPPER.readValue("{\"name\" : \"Macavity\",\"type\":\"cat\",\"lives\":18,\"likesCream\":false }",Animal.class);assertEquals(Cat.class,animal.getClass());assertEquals("Macavity",animal.name);Cat cat=(Cat)animal;assertEquals(18,cat.lives);assertEquals(false,cat.likesCream);}
public void testManualPolymorphicCatWithReorder()throws Exception {Animal animal=MAPPER.readValue("{\"likesCream\":true,\"name\" : \"Venla\",\"type\":\"cat\" }",Animal.class);assertEquals(Cat.class,animal.getClass());assertEquals("Venla",animal.name);assertTrue(((Cat)animal).likesCream);}
public void testManualPolymorphicWithNumbered()throws Exception {final ObjectWriter w=MAPPER.writerWithType(AbstractRoot.class);final ObjectReader r=MAPPER.reader(AbstractRoot.class);AbstractRoot input=AbstractRoot.make(1,"oh hai!");String json=w.writeValueAsString(input);AbstractRoot result=r.readValue(json);assertNotNull(result);assertEquals("oh hai!",result.getOpt());}
public void testHibernateCglib()throws Exception {if (!runsFromAnt()){return;}Enhancer enh=new Enhancer();enh.setInterfaces(new Class[]{BeanInterfaceHib.class});enh.setCallback(new MethodInterceptor(){@Override public Object intercept(Object obj,Method method,Object[]args,MethodProxy proxy)throws Throwable {if ("getX".equals(method.getName())){return Integer.valueOf(13);}return proxy.invokeSuper(obj,args);}});BeanInterfaceHib bean=(BeanInterfaceHib)enh.create();ObjectMapper mapper=new ObjectMapper();Map<String,Object> result=writeAndMap(mapper,bean);assertEquals(1,result.size());assertEquals(Integer.valueOf(13),result.get("x"));}
public void test677()throws Exception {ObjectMapper mapper=new ObjectMapper();JavaType t677=mapper.constructType(Result677.Success677.class);assertNotNull(t677);Result677.Success677<Integer> s=new Result677.Success677<Integer>(Integer.valueOf(4));String json=mapper.writeValueAsString(s);assertEquals("{\"value\":4}",json);}
public void testInnerType()throws Exception {ObjectMapper mapper=new ObjectMapper();BaseType.SubType<?> r=mapper.readValue("{}",BaseType.SubType.class);assertNotNull(r);}
public void testSerializeAsInClass()throws IOException {assertEquals("{\"foo\":42}",WRITER.writeValueAsString(new FooImpl()));}
public void testSerializeAsForArrayProp()throws IOException {assertEquals("{\"foos\":[{\"foo\":42}]}",WRITER.writeValueAsString(new Fooables()));}
public void testSerializeAsForSimpleProp()throws IOException {assertEquals("{\"foo\":{\"foo\":42}}",WRITER.writeValueAsString(new FooableWrapper()));}
public void testCollectionDefaulting()throws Exception {ObjectMapper mapper=new ObjectMapper();SimpleModule mod=new SimpleModule("test",Version.unknownVersion());mod.addAbstractTypeMapping(Collection.class,List.class);mod.addAbstractTypeMapping(List.class,LinkedList.class);mapper.registerModule(mod);Collection<?> result=mapper.readValue("[]",Collection.class);assertEquals(LinkedList.class,result.getClass());}
public void testMapDefaulting()throws Exception {ObjectMapper mapper=new ObjectMapper();SimpleModule mod=new SimpleModule("test",Version.unknownVersion());mod.addAbstractTypeMapping(Map.class,TreeMap.class);mapper.registerModule(mod);Map<?,?> result=mapper.readValue("{}",Map.class);assertEquals(TreeMap.class,result.getClass());}
public void testInterfaceDefaulting()throws Exception {ObjectMapper mapper=new ObjectMapper();SimpleModule mod=new SimpleModule("test",Version.unknownVersion());mod.addAbstractTypeMapping(CharSequence.class,MyString.class);mapper.registerModule(mod);Object result=mapper.readValue(quote("abc"),CharSequence.class);assertEquals(MyString.class,result.getClass());assertEquals("abc",((MyString)result).value);}
public void testWrapperWithGetter()throws Exception {Dog dog=new Dog("Fluffy",3);String json=new ObjectMapper().writeValueAsString(new ContainerWithGetter<Animal>(dog));if (json.indexOf("\"object-type\":\"doggy\"")< 0){fail("polymorphic type not kept,result == " + json + ";should contain 'object-type':'...'");}}
public void testWrapperWithField()throws Exception {Dog dog=new Dog("Fluffy",3);String json=new ObjectMapper().writeValueAsString(new ContainerWithField<Animal>(dog));if (json.indexOf("\"object-type\":\"doggy\"")< 0){fail("polymorphic type not kept,result == " + json + ";should contain 'object-type':'...'");}}
public void testWrapperWithExplicitType()throws Exception {Dog dog=new Dog("Fluffy",3);ContainerWithGetter<Animal> c2=new ContainerWithGetter<Animal>(dog);ObjectMapper mapper=new ObjectMapper();String json=mapper.writerWithType(TypeFactory.defaultInstance().constructParametricType(ContainerWithGetter.class,Animal.class)).writeValueAsString(c2);if (json.indexOf("\"object-type\":\"doggy\"")< 0){fail("polymorphic type not kept,result == " + json + ";should contain 'object-type':'...'");}}
public void testJackson387()throws Exception {ObjectMapper om=new ObjectMapper();om.enableDefaultTyping(ObjectMapper.DefaultTyping.JAVA_LANG_OBJECT,JsonTypeInfo.As.PROPERTY);om.setSerializationInclusion(JsonInclude.Include.NON_NULL);om.enable(SerializationFeature.INDENT_OUTPUT);MyClass mc=new MyClass();MyParam<Integer> moc1=new MyParam<Integer>(1);MyParam<String> moc2=new MyParam<String>("valueX");SomeObject so=new SomeObject();so.someValue="xxxxxx";MyParam<SomeObject> moc3=new MyParam<SomeObject>(so);List<SomeObject> colist=new ArrayList<SomeObject>();colist.add(new SomeObject());colist.add(new SomeObject());colist.add(new SomeObject());MyParam<List<SomeObject>> moc4=new MyParam<List<SomeObject>>(colist);mc.params.add(moc1);mc.params.add(moc2);mc.params.add(moc3);mc.params.add(moc4);String json=om.writeValueAsString(mc);MyClass mc2=om.readValue(json,MyClass.class);assertNotNull(mc2);assertNotNull(mc2.params);assertEquals(4,mc2.params.size());}
public void testJackson430()throws Exception {ObjectMapper om=new ObjectMapper();om.setSerializerFactory(new CustomJsonSerializerFactory());MyClass mc=new MyClass();mc.params.add(new MyParam<Integer>(1));String str=om.writeValueAsString(mc);MyClass mc2=om.readValue(str,MyClass.class);assertNotNull(mc2);assertNotNull(mc2.params);assertEquals(1,mc2.params.size());}
/** * Test that verifies that property annotation works*/public void testReadSimplePropertyValue()throws Exception {String json="{\"value\":[true,\"Foobar\",42,13]}";Pojo p=MAPPER.readValue(json,Pojo.class);assertNotNull(p.value);assertTrue(p.value.complete);assertEquals("Foobar",p.value.name);assertEquals(42,p.value.x);assertEquals(13,p.value.y);}
/** * Test that verifies that Class annotation works*/public void testReadSimpleRootValue()throws Exception {String json="[false,\"Bubba\",1,2]";FlatPojo p=MAPPER.readValue(json,FlatPojo.class);assertFalse(p.complete);assertEquals("Bubba",p.name);assertEquals(1,p.x);assertEquals(2,p.y);}
/** * Test that verifies that property annotation works*/public void testWriteSimplePropertyValue()throws Exception {String json=MAPPER.writeValueAsString(new Pojo("Foobar",42,13,true));assertEquals("{\"value\":[true,\"Foobar\",42,13]}",json);}
/** * Test that verifies that Class annotation works*/public void testWriteSimpleRootValue()throws Exception {String json=MAPPER.writeValueAsString(new FlatPojo("Bubba",1,2,false));assertEquals("[false,\"Bubba\",1,2]",json);}
public void testNullColumn()throws Exception {assertEquals("[null,\"bar\"]",MAPPER.writeValueAsString(new TwoStringsBean()));}
public void testSerializeAsArrayWithSingleProperty()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.enable(SerializationFeature.WRITE_SINGLE_ELEM_ARRAYS_UNWRAPPED);String json=mapper.writeValueAsString(new SingleBean());assertEquals("\"foo\"",json);}
public void testAnnotationOverride()throws Exception {assertEquals("{\"value\":{\"x\":1,\"y\":2}}",MAPPER.writeValueAsString(new A()));ObjectMapper mapper2=new ObjectMapper();mapper2.setAnnotationIntrospector(new ForceArraysIntrospector());assertEquals("[[1,2]]",mapper2.writeValueAsString(new A()));}
public void testFromArray()throws Exception {ArrayList<Object> doc=new ArrayList<Object>();doc.add("Elem1");doc.add(Integer.valueOf(3));Map<String,Object> struct=new LinkedHashMap<String,Object>();struct.put("first",Boolean.TRUE);struct.put("Second",new ArrayList<Object>());doc.add(struct);doc.add(Boolean.FALSE);ObjectMapper mapper=new ObjectMapper();JsonFactory f=new JsonFactory();for (int i=0;i < 3;++i){String str=mapper.writeValueAsString(doc);JsonParser jp=f.createParser(str);assertEquals(JsonToken.START_ARRAY,jp.nextToken());assertEquals(JsonToken.VALUE_STRING,jp.nextToken());assertEquals("Elem1",getAndVerifyText(jp));assertEquals(JsonToken.VALUE_NUMBER_INT,jp.nextToken());assertEquals(3,jp.getIntValue());assertEquals(JsonToken.START_OBJECT,jp.nextToken());assertEquals(JsonToken.FIELD_NAME,jp.nextToken());assertEquals("first",getAndVerifyText(jp));assertEquals(JsonToken.VALUE_TRUE,jp.nextToken());assertEquals(JsonToken.FIELD_NAME,jp.nextToken());assertEquals("Second",getAndVerifyText(jp));if (jp.nextToken()!= JsonToken.START_ARRAY){fail("Expected START_ARRAY: JSON == '" + str + "'");}assertEquals(JsonToken.END_ARRAY,jp.nextToken());assertEquals(JsonToken.END_OBJECT,jp.nextToken());assertEquals(JsonToken.VALUE_FALSE,jp.nextToken());assertEquals(JsonToken.END_ARRAY,jp.nextToken());assertNull(jp.nextToken());}}
public void testFromMap()throws Exception {LinkedHashMap<String,Object> doc=new LinkedHashMap<String,Object>();JsonFactory f=new JsonFactory();doc.put("a1","\"text\"");doc.put("int",Integer.valueOf(137));doc.put("foo bar",Long.valueOf(1234567890L));ObjectMapper mapper=new ObjectMapper();for (int i=0;i < 3;++i){String str=mapper.writeValueAsString(doc);JsonParser jp=f.createParser(str);assertEquals(JsonToken.START_OBJECT,jp.nextToken());assertEquals(JsonToken.FIELD_NAME,jp.nextToken());assertEquals("a1",getAndVerifyText(jp));assertEquals(JsonToken.VALUE_STRING,jp.nextToken());assertEquals("\"text\"",getAndVerifyText(jp));assertEquals(JsonToken.FIELD_NAME,jp.nextToken());assertEquals("int",getAndVerifyText(jp));assertEquals(JsonToken.VALUE_NUMBER_INT,jp.nextToken());assertEquals(137,jp.getIntValue());assertEquals(JsonToken.FIELD_NAME,jp.nextToken());assertEquals("foo bar",getAndVerifyText(jp));assertEquals(JsonToken.VALUE_NUMBER_INT,jp.nextToken());assertEquals(1234567890L,jp.getLongValue());assertEquals(JsonToken.END_OBJECT,jp.nextToken());assertNull(jp.nextToken());}}
public void testPrefixedUnwrappingSerialize()throws Exception {assertEquals("{\"name\":\"Tatu\",\"_x\":1,\"_y\":2}",mapper.writeValueAsString(new PrefixUnwrap("Tatu",1,2)));}
public void testDeepPrefixedUnwrappingSerialize()throws Exception {String json=mapper.writeValueAsString(new DeepPrefixUnwrap("Bubba",1,1));assertEquals("{\"u.name\":\"Bubba\",\"u._x\":1,\"u._y\":1}",json);}
public void testHierarchicConfigSerialize()throws Exception {String json=mapper.writeValueAsString(new ConfigRoot("Fred",25));assertEquals("{\"general.names.name\":\"Fred\",\"misc.value\":25}",json);}
public void testPrefixedUnwrapping()throws Exception {PrefixUnwrap bean=mapper.readValue("{\"name\":\"Axel\",\"_x\":4,\"_y\":7}",PrefixUnwrap.class);assertNotNull(bean);assertEquals("Axel",bean.name);assertNotNull(bean.location);assertEquals(4,bean.location.x);assertEquals(7,bean.location.y);}
public void testDeepPrefixedUnwrappingDeserialize()throws Exception {DeepPrefixUnwrap bean=mapper.readValue("{\"u.name\":\"Bubba\",\"u._x\":2,\"u._y\":3}",DeepPrefixUnwrap.class);assertNotNull(bean.unwrapped);assertNotNull(bean.unwrapped.location);assertEquals(2,bean.unwrapped.location.x);assertEquals(3,bean.unwrapped.location.y);assertEquals("Bubba",bean.unwrapped.name);}
public void testHierarchicConfigDeserialize()throws Exception {ConfigRoot root=mapper.readValue("{\"general.names.name\":\"Bob\",\"misc.value\":3}",ConfigRoot.class);assertNotNull(root.general);assertNotNull(root.general.names);assertNotNull(root.misc);assertEquals(3,root.misc.value);assertEquals("Bob",root.general.names.name);}
public void testHierarchicConfigRoundTrip()throws Exception {ConfigAlternate input=new ConfigAlternate(123,"Joe",42);String json=mapper.writeValueAsString(input);ConfigAlternate root=mapper.readValue(json,ConfigAlternate.class);assertEquals(123,root.id);assertNotNull(root.general);assertNotNull(root.general.names);assertNotNull(root.misc);assertEquals("Joe",root.general.names.name);assertEquals(42,root.misc.value);}
/** * Unit test that verifies that a bean is stored with type information,when declared type is <code>Object.class</code> (since it is within Object[]),and default type information is enabled.*/public void testBeanAsObject()throws Exception {ObjectMapper m=new ObjectMapper();m.enableDefaultTyping();String str=m.writeValueAsString(new Object[]{new StringBean("abc")});_verifySerializationAsMap(str);Object ob=m.readValue(str,Object[].class);assertNotNull(ob);Object[]result=(Object[])ob;assertNotNull(result[0]);assertEquals(StringBean.class,result[0].getClass());assertEquals("abc",((StringBean)result[0]).name);}
/** * Unit test that verifies that an abstract bean is stored with type information if default type information is enabled for non-concrete types.*/public void testAbstractBean()throws Exception {ObjectMapper m=new ObjectMapper();AbstractBean[]input=new AbstractBean[]{new StringBean("xyz")};String serial=m.writeValueAsString(input);try {m.readValue(serial,AbstractBean[].class);fail("Should have failed");}catch(JsonMappingException e){verifyException(e,"can not construct");}m=new ObjectMapper();m.enableDefaultTyping(ObjectMapper.DefaultTyping.OBJECT_AND_NON_CONCRETE);serial=m.writeValueAsString(input);AbstractBean[]beans=m.readValue(serial,AbstractBean[].class);assertEquals(1,beans.length);assertEquals(StringBean.class,beans[0].getClass());assertEquals("xyz",((StringBean)beans[0]).name);}
/** * Unit test to verify that type information is included for all non-final types,if default typing suitably configured*/public void testNonFinalBean()throws Exception {ObjectMapper m=new ObjectMapper();m.enableDefaultTyping(ObjectMapper.DefaultTyping.OBJECT_AND_NON_CONCRETE);StringBean bean=new StringBean("x");assertEquals("{\"name\":\"x\"}",m.writeValueAsString(bean));m=new ObjectMapper();m.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);assertEquals("[\"" + StringBean.class.getName()+ "\",{\"name\":\"x\"}]",m.writeValueAsString(bean));}
public void testNullValue()throws Exception {ObjectMapper m=new ObjectMapper();m.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);BeanHolder h=new BeanHolder();String json=m.writeValueAsString(h);assertNotNull(json);BeanHolder result=m.readValue(json,BeanHolder.class);assertNotNull(result);assertNull(result.bean);}
public void testEnumAsObject()throws Exception {Object[]input=new Object[]{Choice.YES};Object[]input2=new Object[]{ComplexChoice.MAYBE};assertEquals("[\"YES\"]",serializeAsString(input));assertEquals("[\"MAYBE\"]",serializeAsString(input2));ObjectMapper m=new ObjectMapper();m.enableDefaultTyping();String json=m.writeValueAsString(input);assertEquals("[[\"" + Choice.class.getName()+ "\",\"YES\"]]",json);Object[]output=m.readValue(json,Object[].class);assertEquals(1,output.length);assertEquals(Choice.YES,output[0]);json=m.writeValueAsString(input2);assertEquals("[[\"" + ComplexChoice.class.getName()+ "\",\"MAYBE\"]]",json);output=m.readValue(json,Object[].class);assertEquals(1,output.length);assertEquals(ComplexChoice.MAYBE,output[0]);}
@SuppressWarnings("unchecked")public void testEnumSet()throws Exception {EnumSet<Choice> set=EnumSet.of(Choice.NO);Object[]input=new Object[]{set};ObjectMapper m=new ObjectMapper();m.enableDefaultTyping();String json=m.writeValueAsString(input);Object[]output=m.readValue(json,Object[].class);assertEquals(1,output.length);Object ob=output[0];assertTrue(ob instanceof EnumSet<?>);EnumSet<Choice> set2=(EnumSet<Choice>)ob;assertEquals(1,set2.size());assertTrue(set2.contains(Choice.NO));assertFalse(set2.contains(Choice.YES));}
@SuppressWarnings("unchecked")public void testEnumMap()throws Exception {EnumMap<Choice,String> map=new EnumMap<Choice,String>(Choice.class);map.put(Choice.NO,"maybe");Object[]input=new Object[]{map};ObjectMapper m=new ObjectMapper();m.enableDefaultTyping();String json=m.writeValueAsString(input);Object[]output=m.readValue(json,Object[].class);assertEquals(1,output.length);Object ob=output[0];assertTrue(ob instanceof EnumMap<?,?>);EnumMap<Choice,String> map2=(EnumMap<Choice,String>)ob;assertEquals(1,map2.size());assertEquals("maybe",map2.get(Choice.NO));assertNull(map2.get(Choice.YES));}
public void testJackson311()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);String json=mapper.writeValueAsString(new PolymorphicType("hello",2));PolymorphicType value=mapper.readValue(json,PolymorphicType.class);assertEquals("hello",value.foo);assertEquals(Integer.valueOf(2),value.bar);}
public void testTokenBuffer()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);TokenBuffer buf=new TokenBuffer(mapper);buf.writeStartObject();buf.writeNumberField("num",42);buf.writeEndObject();String json=mapper.writeValueAsString(new ObjectHolder(buf));ObjectHolder holder=mapper.readValue(json,ObjectHolder.class);assertNotNull(holder.value);assertSame(TokenBuffer.class,holder.value.getClass());JsonParser jp=((TokenBuffer)holder.value).asParser();assertToken(JsonToken.START_OBJECT,jp.nextToken());assertToken(JsonToken.FIELD_NAME,jp.nextToken());assertToken(JsonToken.VALUE_NUMBER_INT,jp.nextToken());assertToken(JsonToken.END_OBJECT,jp.nextToken());assertNull(jp.nextToken());jp.close();buf=new TokenBuffer(mapper);buf.writeStartArray();buf.writeBoolean(true);buf.writeEndArray();json=mapper.writeValueAsString(new ObjectHolder(buf));holder=mapper.readValue(json,ObjectHolder.class);assertNotNull(holder.value);assertSame(TokenBuffer.class,holder.value.getClass());jp=((TokenBuffer)holder.value).asParser();assertToken(JsonToken.START_ARRAY,jp.nextToken());assertToken(JsonToken.VALUE_TRUE,jp.nextToken());assertToken(JsonToken.END_ARRAY,jp.nextToken());assertNull(jp.nextToken());jp.close();buf=new TokenBuffer(mapper);buf.writeNumber(321);json=mapper.writeValueAsString(new ObjectHolder(buf));holder=mapper.readValue(json,ObjectHolder.class);assertNotNull(holder.value);assertSame(TokenBuffer.class,holder.value.getClass());jp=((TokenBuffer)holder.value).asParser();assertToken(JsonToken.VALUE_NUMBER_INT,jp.nextToken());assertEquals(321,jp.getIntValue());assertNull(jp.nextToken());jp.close();}
/** * Test for [JACKSON-352]*/public void testIssue352()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.enableDefaultTyping(ObjectMapper.DefaultTyping.OBJECT_AND_NON_CONCRETE,JsonTypeInfo.As.PROPERTY);DiscussBean d1=new DiscussBean();d1.subject="mouse";d1.weight=88;DomainBeanWrapper wrapper=new DomainBeanWrapper();wrapper.name="mickey";wrapper.myBean=d1;String json=mapper.writeValueAsString(wrapper);DomainBeanWrapper result=mapper.readValue(json,DomainBeanWrapper.class);assertNotNull(result);assertNotNull(wrapper.myBean);assertSame(DiscussBean.class,wrapper.myBean.getClass());}
public void testFeature432()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.enableDefaultTypingAsProperty(ObjectMapper.DefaultTyping.OBJECT_AND_NON_CONCRETE,"*CLASS*");String json=mapper.writeValueAsString(new BeanHolder(new StringBean("punny")));assertEquals("{\"bean\":{\"*CLASS*\":\"com.fasterxml.jackson.databind.jsontype.TestDefaultForObject$StringBean\",\"name\":\"punny\"}}",json);}
public void testSimpleIgnore()throws Exception {ObjectMapper m=new ObjectMapper();SizeClassIgnore result=m.readValue("{\"x\":1,\"y\" : 2 }",SizeClassIgnore.class);assertEquals(1,result._x);assertEquals(0,result._y);}
public void testIntList()throws Exception {ObjectMapper m=new ObjectMapper();String JSON="{\"" + TypedListAsWrapper.class.getName()+ "\":[4,5,6]}";JavaType type=TypeFactory.defaultInstance().constructCollectionType(TypedListAsWrapper.class,Integer.class);TypedListAsWrapper<Integer> result=m.readValue(JSON,type);assertNotNull(result);assertEquals(3,result.size());assertEquals(Integer.valueOf(4),result.get(0));assertEquals(Integer.valueOf(5),result.get(1));assertEquals(Integer.valueOf(6),result.get(2));}
/** * Similar to above,but this time let's request adding type info as property. That would not work (since there's no JSON Object to add property in),so it will basically be same as using WRAPPER_ARRAY*/public void testBooleanListAsProp()throws Exception {ObjectMapper m=new ObjectMapper();String JSON="[\"" + TypedListAsProp.class.getName()+ "\",[true,false]]";JavaType type=TypeFactory.defaultInstance().constructCollectionType(TypedListAsProp.class,Boolean.class);TypedListAsProp<Object> result=m.readValue(JSON,type);assertNotNull(result);assertEquals(2,result.size());assertEquals(Boolean.TRUE,result.get(0));assertEquals(Boolean.FALSE,result.get(1));}
public void testLongListAsWrapper()throws Exception {ObjectMapper m=new ObjectMapper();String JSON="{\"" + TypedListAsWrapper.class.getName()+ "\":[1,3]}";JavaType type=TypeFactory.defaultInstance().constructCollectionType(TypedListAsWrapper.class,Long.class);TypedListAsWrapper<Object> result=m.readValue(JSON,type);assertNotNull(result);assertEquals(2,result.size());assertEquals(Long.class,result.get(0).getClass());assertEquals(Long.valueOf(1),result.get(0));assertEquals(Long.class,result.get(1).getClass());assertEquals(Long.valueOf(3),result.get(1));}
public void testLongArray()throws Exception {ObjectMapper m=new ObjectMapper();m.addMixInAnnotations(long[].class,WrapperMixIn.class);String JSON="{\"" + long[].class.getName()+ "\":[5,6,7]}";long[]value=m.readValue(JSON,long[].class);assertNotNull(value);assertEquals(3,value.length);assertArrayEquals(new long[]{5L,6L,7L},value);}
public void testFactories(){assertNotNull(StdDateFormat.getBlueprintISO8601Format());assertNotNull(StdDateFormat.getBlueprintRFC1123Format());TimeZone tz=TimeZone.getTimeZone("GMT");assertNotNull(StdDateFormat.getISO8601Format(tz));assertNotNull(StdDateFormat.getRFC1123Format(tz));}
public void testInvalid(){StdDateFormat std=new StdDateFormat();try {std.parse("foobar");}catch(java.text.ParseException e){verifyException(e,"Can not parse");}}
public void testForConstructor()throws IOException {ObjectMapper m=new ObjectMapper();m.addMixInAnnotations(BaseClassWithPrivateCtor.class,MixInForPrivate.class);BaseClassWithPrivateCtor result=m.readValue("\"?\"",BaseClassWithPrivateCtor.class);assertEquals("?...",result._a);}
public void testForFactoryAndCtor()throws IOException {ObjectMapper m=new ObjectMapper();BaseClass result;result=m.readValue("\"string\"",BaseClass.class);assertEquals("string...",result._a);m=new ObjectMapper();m.addMixInAnnotations(BaseClass.class,MixIn.class);result=m.readValue("\"string\"",BaseClass.class);assertEquals("stringX",result._a);}
public void testFactoryMixIn()throws IOException {ObjectMapper m=new ObjectMapper();m.addMixInAnnotations(StringWrapper.class,StringWrapperMixIn.class);StringWrapper result=m.readValue("\"a\"",StringWrapper.class);assertEquals("a",result._value);}
/** * This test checks that is possible to mix "regular" Java objects and JsonNode.*/public void testMixed()throws IOException {ObjectMapper om=new ObjectMapper();String JSON="{\"node\" :{\"a\" : 3 },\"x\" : 9 }";Bean bean=om.readValue(JSON,Bean.class);assertEquals(9,bean._x);JsonNode n=bean._node;assertNotNull(n);assertEquals(1,n.size());ObjectNode on=(ObjectNode)n;assertEquals(3,on.get("a").intValue());}
public void testArrayNodeEquality(){ArrayNode n1=new ArrayNode(null);ArrayNode n2=new ArrayNode(null);assertTrue(n1.equals(n2));assertTrue(n2.equals(n1));n1.add(TextNode.valueOf("Test"));assertFalse(n1.equals(n2));assertFalse(n2.equals(n1));n2.add(TextNode.valueOf("Test"));assertTrue(n1.equals(n2));assertTrue(n2.equals(n1));}
public void testObjectNodeEquality(){ObjectNode n1=new ObjectNode(null);ObjectNode n2=new ObjectNode(null);assertTrue(n1.equals(n2));assertTrue(n2.equals(n1));n1.set("x",TextNode.valueOf("Test"));assertFalse(n1.equals(n2));assertFalse(n2.equals(n1));n2.set("x",TextNode.valueOf("Test"));assertTrue(n1.equals(n2));assertTrue(n2.equals(n1));}
public void testReadFromString()throws Exception {String json="{\"field\":\"{\\\"name\\\":\\\"John Smith\\\"}\"}";ObjectMapper mapper=new ObjectMapper();JsonNode jNode=mapper.readValue(json,JsonNode.class);String generated=mapper.writeValueAsString(jNode);JsonNode out=mapper.readValue(generated,JsonNode.class);assertTrue(out.isObject());assertEquals(1,out.size());String value=out.path("field").asText();assertNotNull(value);}
public void testNullHandling()throws Exception {JsonNode n=objectReader().readTree("null");assertNotNull(n);assertTrue(n.isNull());n=objectMapper().readTree("null");assertNotNull(n);assertTrue(n.isNull());ObjectNode root=(ObjectNode)objectReader().readTree("{\"x\":null}");assertEquals(1,root.size());n=root.get("x");assertNotNull(n);assertTrue(n.isNull());}
public void testPojoWriting()throws IOException {JsonFactory jf=new MappingJsonFactory();StringWriter sw=new StringWriter();JsonGenerator gen=jf.createGenerator(sw);gen.writeObject(new Pojo());gen.close();String act=sw.toString().trim();assertEquals("{\"x\":4}",act);}
public void testPojoWritingFailing()throws IOException {JsonFactory jf=new JsonFactory();try {StringWriter sw=new StringWriter();JsonGenerator gen=jf.createGenerator(sw);gen.writeObject(new Pojo());gen.close();fail("Expected an exception: got sw '" + sw.toString()+ "'");}catch(IllegalStateException e){verifyException(e,"No ObjectCodec defined");}}
public void testIssue820()throws IOException {StringBuffer sb=new StringBuffer();while (sb.length()<= 5000){sb.append("Yet another line of text...\n");}String sampleText=sb.toString();assertTrue("Sanity check so I don't mess up the sample text later.",sampleText.contains("\n"));final ObjectMapper mapper=new ObjectMapper();final CharacterEscapes defaultCharacterEscapes=new CharacterEscapes(){private static final long serialVersionUID=1L;@Override public int[]getEscapeCodesForAscii(){return standardAsciiEscapesForJSON();}@Override public SerializableString getEscapeSequence(final int ch){return null;}};mapper.getFactory().setCharacterEscapes(defaultCharacterEscapes);String jacksonJson=mapper.writeValueAsString(sampleText);boolean hasLFs=jacksonJson.indexOf('\n')> 0;assertFalse("Should NOT contain linefeeds,should have been escaped",hasLFs);}
public void testSimple()throws Exception {Bean bean=mapper.readValue("{\"a\":3,\"aa\":\"foo\",\"b\": 9 }",Bean.class);assertEquals(3,bean.a);assertEquals("foo",bean.aa);assertEquals(9,bean.b);bean=mapper.readerWithView(ViewAA.class).withType(Bean.class).readValue("{\"a\":3,\"aa\":\"foo\",\"b\": 9 }");assertEquals(3,bean.a);assertEquals("foo",bean.aa);assertEquals(0,bean.b);bean=mapper.readerWithView(ViewA.class).withType(Bean.class).readValue("{\"a\":1,\"aa\":\"x\",\"b\": 3 }");assertEquals(1,bean.a);assertNull(bean.aa);assertEquals(0,bean.b);bean=mapper.reader(Bean.class).withView(ViewB.class).readValue("{\"a\":-3,\"aa\":\"y\",\"b\": 2 }");assertEquals(0,bean.a);assertEquals("y",bean.aa);assertEquals(2,bean.b);}
public void testWithoutDefaultInclusion()throws Exception {DefaultsBean bean=mapper.readValue("{\"a\":3,\"b\": 9 }",DefaultsBean.class);assertEquals(3,bean.a);assertEquals(9,bean.b);ObjectMapper myMapper=new ObjectMapper();myMapper.disable(MapperFeature.DEFAULT_VIEW_INCLUSION);bean=myMapper.readerWithView(ViewAA.class).withType(DefaultsBean.class).readValue("{\"a\":1,\"b\": 2 }");assertEquals(0,bean.a);assertEquals(2,bean.b);}
public void testAnnotatedContextual()throws Exception {ObjectMapper mapper=new ObjectMapper();AnnotatedContextualClassBean bean=mapper.readValue("{\"value\":\"a\"}",AnnotatedContextualClassBean.class);assertNotNull(bean);assertEquals("xyz=a",bean.value.value);}
public void testDynaBean()throws Exception {DynaBean b=new DynaBean();b.id=123;b.set("name","Billy");assertEquals("{\"id\":123,\"name\":\"Billy\"}",MAPPER.writeValueAsString(b));DynaBean result=MAPPER.readValue("{\"id\":2,\"name\":\"Joe\"}",DynaBean.class);assertEquals(2,result.id);assertEquals("Joe",result.other.get("name"));}
public void testPrivate()throws Exception {String json=MAPPER.writeValueAsString(new PrivateThing());assertEquals("{\"a\":\"A\"}",json);}
public void testSimple()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.setInjectableValues(new InjectableValues.Std().addValue(String.class,"stuffValue").addValue("myId","xyz").addValue(Long.TYPE,Long.valueOf(37)));InjectedBean bean=mapper.readValue("{\"value\":3}",InjectedBean.class);assertEquals(3,bean.value);assertEquals("stuffValue",bean.stuff);assertEquals("xyz",bean.otherStuff);assertEquals(37L,bean.third);}
public void testWithCtors()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.setInjectableValues(new InjectableValues.Std().addValue(String.class,"Bubba"));CtorBean bean=mapper.readValue("{\"age\":55}",CtorBean.class);assertEquals(55,bean.age);assertEquals("Bubba",bean.name);}
public void testTwoInjectablesViaCreator()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.setInjectableValues(new InjectableValues.Std().addValue(String.class,"Bob").addValue("number",Integer.valueOf(13)));CtorBean2 bean=mapper.readValue("{}",CtorBean2.class);assertEquals(Integer.valueOf(13),bean.age);assertEquals("Bob",bean.name);}
public void testInvalidDup()throws Exception {ObjectMapper mapper=new ObjectMapper();try {mapper.readValue("{}",BadBean1.class);}catch(Exception e){verifyException(e,"Duplicate injectable value");}try {mapper.readValue("{}",BadBean2.class);}catch(Exception e){verifyException(e,"Duplicate injectable value");}}
public void testPrettyPrinter()throws Exception {ObjectMapper mapper=new ObjectMapper();ObjectWriter writer=mapper.writer();HashMap<String,Integer> data=new HashMap<String,Integer>();data.put("a",1);assertEquals("{\"a\":1}",writer.writeValueAsString(data));writer=writer.withDefaultPrettyPrinter();String lf=System.getProperty("line.separator");assertEquals("{" + lf + "  \"a\" : 1"+ lf+ "}",writer.writeValueAsString(data));writer=writer.with((PrettyPrinter)null);assertEquals("{\"a\":1}",writer.writeValueAsString(data));}
public void testPrefetch()throws Exception {ObjectWriter writer=objectWriter();assertFalse(writer.hasPrefetchedSerializer());writer=objectWriter().withType(String.class);assertTrue(writer.hasPrefetchedSerializer());}
public void testClassDeserializer()throws Exception {ObjectMapper m=new ObjectMapper();ValueClass result=m.readValue("  123  ",ValueClass.class);assertEquals(123,result._a);}
public void testMethodDeserializer()throws Exception {ObjectMapper m=new ObjectMapper();MethodBean result=m.readValue("{\"ints\" : 3}",MethodBean.class);assertNotNull(result);int[]ints=result._ints;assertNotNull(ints);assertEquals(1,ints.length);assertEquals(3,ints[0]);}
public void testArrayContentUsing()throws Exception {ObjectMapper m=new ObjectMapper();ArrayBean result=m.readValue("{\"values\" :[1,2,3 ]}",ArrayBean.class);assertNotNull(result);Object[]obs=result.values;assertNotNull(obs);assertEquals(3,obs.length);assertEquals(ValueClass.class,obs[0].getClass());assertEquals(1,((ValueClass)obs[0])._a);assertEquals(ValueClass.class,obs[1].getClass());assertEquals(2,((ValueClass)obs[1])._a);assertEquals(ValueClass.class,obs[2].getClass());assertEquals(3,((ValueClass)obs[2])._a);}
public void testListContentUsing()throws Exception {ObjectMapper m=new ObjectMapper();ListBean result=m.readValue("{\"values\" :[1,2,3 ]}",ListBean.class);assertNotNull(result);List<Object> obs=result.values;assertNotNull(obs);assertEquals(3,obs.size());assertEquals(ValueClass.class,obs.get(0).getClass());assertEquals(1,((ValueClass)obs.get(0))._a);assertEquals(ValueClass.class,obs.get(1).getClass());assertEquals(2,((ValueClass)obs.get(1))._a);assertEquals(ValueClass.class,obs.get(2).getClass());assertEquals(3,((ValueClass)obs.get(2))._a);}
public void testMapContentUsing()throws Exception {ObjectMapper m=new ObjectMapper();MapBean result=m.readValue("{\"values\" :{\"a\": 1,\"b\":2}}",MapBean.class);assertNotNull(result);Map<String,Object> map=result.values;assertNotNull(map);assertEquals(2,map.size());assertEquals(ValueClass.class,map.get("a").getClass());assertEquals(1,((ValueClass)map.get("a"))._a);assertEquals(ValueClass.class,map.get("b").getClass());assertEquals(2,((ValueClass)map.get("b"))._a);}
public void testMapKeyUsing()throws Exception {ObjectMapper m=new ObjectMapper();MapKeyBean result=m.readValue("{\"values\" :{\"a\": true}}",MapKeyBean.class);assertNotNull(result);Map<Object,Object> map=result.values;assertNotNull(map);assertEquals(1,map.size());Map.Entry<Object,Object> en=map.entrySet().iterator().next();assertEquals(String[].class,en.getKey().getClass());assertEquals(Boolean.TRUE,en.getValue());}
public void testRootValueWithCustomKey()throws Exception {ObjectMapper m=new ObjectMapper();MapKeyMap result=m.readValue("{\"a\": 13}",MapKeyMap.class);assertNotNull(result);assertNotNull(result);assertEquals(1,result.size());Map.Entry<Object,Object> en=result.entrySet().iterator().next();assertEquals(ValueClass.class,en.getValue().getClass());assertEquals(13,((ValueClass)en.getValue())._a);assertEquals(String[].class,en.getKey().getClass());}
public void testSimpleEnumBean()throws Exception {TimeUnitBean bean=new TimeUnitBean();bean.timeUnit=TimeUnit.SECONDS;ObjectMapper m=new ObjectMapper();String json=m.writeValueAsString(bean);TimeUnitBean result=m.readValue(json,TimeUnitBean.class);assertEquals(TimeUnit.SECONDS,result.timeUnit);m=new ObjectMapper();m.enableDefaultTyping();json=m.writeValueAsString(bean);result=m.readValue(json,TimeUnitBean.class);assertEquals(TimeUnit.SECONDS,result.timeUnit);}
public void testSimpleEnumsInObjectArray()throws Exception {ObjectMapper m=new ObjectMapper();m.enableDefaultTyping();String json=m.writeValueAsString(new Object[]{TestEnum.A});assertEquals("[[\"com.fasterxml.jackson.databind.jsontype.TestDefaultForEnums$TestEnum\",\"A\"]]",json);Object[]value=m.readValue(json,Object[].class);assertEquals(1,value.length);assertSame(TestEnum.A,value[0]);}
public void testSimpleEnumsAsField()throws Exception {ObjectMapper m=new ObjectMapper();m.enableDefaultTyping();String json=m.writeValueAsString(new EnumHolder(TestEnum.B));assertEquals("{\"value\":[\"com.fasterxml.jackson.databind.jsontype.TestDefaultForEnums$TestEnum\",\"B\"]}",json);EnumHolder holder=m.readValue(json,EnumHolder.class);assertSame(TestEnum.B,holder.value);}
public void testPropertyRemoval()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.registerModule(new ModuleImpl(new RemovingModifier("a")));Bean bean=mapper.readValue("{\"b\":\"2\"}",Bean.class);assertEquals("2",bean.b);assertEquals("a",bean.a);}
public void testDeserializerReplacement()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.registerModule(new ModuleImpl(new ReplacingModifier(new BogusBeanDeserializer("foo","bar"))));Bean bean=mapper.readValue("{\"a\":\"xyz\"}",Bean.class);assertEquals("foo",bean.a);assertEquals("bar",bean.b);}
public void testIssue476()throws Exception {final String JSON="{\"value1\" : {\"name\" : \"fruit\",\"value\" : \"apple\"},\"value2\" : {\"name\" : \"color\",\"value\" : \"red\"}}";ObjectMapper mapper=new ObjectMapper();mapper.registerModule(new Issue476Module());mapper.readValue(JSON,Issue476Bean.class);assertEquals(2,Issue476Deserializer.propCount);}
public void testPOJOFromEmptyString()throws Exception {ObjectMapper mapper=new ObjectMapper();try {mapper.readValue(quote(""),Bean.class);fail("Should not accept Empty String for POJO");}catch(JsonProcessingException e){verifyException(e,"from String value");}mapper=new ObjectMapper();mapper.configure(DeserializationFeature.ACCEPT_EMPTY_STRING_AS_NULL_OBJECT,true);Bean result=mapper.readValue(quote(""),Bean.class);assertNull(result);}
public void testModifyArrayDeserializer()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.registerModule(new SimpleModule("test").setDeserializerModifier(new ArrayDeserializerModifier()));Object[]result=mapper.readValue("[1,2]",Object[].class);assertEquals(1,result.length);assertEquals("foo",result[0]);}
public void testModifyCollectionDeserializer()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.registerModule(new SimpleModule("test").setDeserializerModifier(new CollectionDeserializerModifier()));List<?> result=mapper.readValue("[1,2]",List.class);assertEquals(1,result.size());assertEquals("foo",result.get(0));}
public void testModifyMapDeserializer()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.registerModule(new SimpleModule("test").setDeserializerModifier(new MapDeserializerModifier()));Map<?,?> result=mapper.readValue("{\"a\":1,\"b\":2}",Map.class);assertEquals(1,result.size());assertEquals("foo",result.get("a"));}
public void testModifyEnumDeserializer()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.registerModule(new SimpleModule("test").setDeserializerModifier(new EnumDeserializerModifier()));Object result=mapper.readValue(quote("B"),EnumABC.class);assertEquals("foo",result);}
public void testModifyKeyDeserializer()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.registerModule(new SimpleModule("test").setDeserializerModifier(new KeyDeserializerModifier()));Map<?,?> result=mapper.readValue("{\"a\":1}",Map.class);assertEquals(1,result.size());assertEquals("foo",result.entrySet().iterator().next().getKey());}
public void testSimpleConstructor()throws Exception {ConstructorBean bean=MAPPER.readValue("{\"x\" : 42 }",ConstructorBean.class);assertEquals(42,bean.x);}
public void testNoArgsFactory()throws Exception {NoArgFactoryBean value=MAPPER.readValue("{\"y\":13}",NoArgFactoryBean.class);assertEquals(13,value.y);assertEquals(123,value.x);}
public void testSimpleDoubleConstructor()throws Exception {Double exp=new Double("0.25");DoubleConstructorBean bean=MAPPER.readValue(exp.toString(),DoubleConstructorBean.class);assertEquals(exp,bean.d);}
public void testSimpleBooleanConstructor()throws Exception {BooleanConstructorBean bean=MAPPER.readValue(" true ",BooleanConstructorBean.class);assertEquals(Boolean.TRUE,bean.b);BooleanConstructorBean2 bean2=MAPPER.readValue(" true ",BooleanConstructorBean2.class);assertTrue(bean2.b);}
public void testSimpleFactory()throws Exception {FactoryBean bean=MAPPER.readValue("{\"f\" : 0.25 }",FactoryBean.class);assertEquals(0.25,bean.d);}
public void testLongFactory()throws Exception {long VALUE=123456789000L;LongFactoryBean bean=MAPPER.readValue(String.valueOf(VALUE),LongFactoryBean.class);assertEquals(VALUE,bean.value);}
public void testStringFactory()throws Exception {String str="abc";StringFactoryBean bean=MAPPER.readValue(quote(str),StringFactoryBean.class);assertEquals(str,bean.value);}
public void testConstructorCreator()throws Exception {CreatorBean bean=MAPPER.readValue("{\"a\" : \"xyz\",\"x\" : 12 }",CreatorBean.class);assertEquals(13,bean.x);assertEquals("ctor:xyz",bean.a);}
public void testConstructorAndProps()throws Exception {ConstructorAndPropsBean bean=MAPPER.readValue("{\"a\" : \"1\",\"b\": 2,\"c\" : true }",ConstructorAndPropsBean.class);assertEquals(1,bean.a);assertEquals(2,bean.b);assertEquals(true,bean.c);}
public void testFactoryAndProps()throws Exception {FactoryAndPropsBean bean=MAPPER.readValue("{\"a\" :[false,true,false ],\"b\": 2,\"c\" : -1 }",FactoryAndPropsBean.class);assertEquals(2,bean.arg2);assertEquals(-1,bean.arg3);boolean[]arg1=bean.arg1;assertNotNull(arg1);assertEquals(3,arg1.length);assertFalse(arg1[0]);assertTrue(arg1[1]);assertFalse(arg1[2]);}
/** * Test to verify that multiple creators may co-exist,iff they use different JSON type as input*/public void testMultipleCreators()throws Exception {MultiBean bean=MAPPER.readValue("123",MultiBean.class);assertEquals(Integer.valueOf(123),bean.value);bean=MAPPER.readValue(quote("abc"),MultiBean.class);assertEquals("abc",bean.value);bean=MAPPER.readValue("0.25",MultiBean.class);assertEquals(Double.valueOf(0.25),bean.value);}
public void testDeferredConstructorAndProps()throws Exception {DeferredConstructorAndPropsBean bean=MAPPER.readValue("{\"propB\" : \"...\",\"createA\" :[1 ],\"propA\" : null }",DeferredConstructorAndPropsBean.class);assertEquals("...",bean.propB);assertNull(bean.propA);assertNotNull(bean.createA);assertEquals(1,bean.createA.length);assertEquals(1,bean.createA[0]);}
public void testDeferredFactoryAndProps()throws Exception {DeferredFactoryAndPropsBean bean=MAPPER.readValue("{\"prop\" : \"1\",\"ctor\" : \"2\" }",DeferredFactoryAndPropsBean.class);assertEquals("1",bean.prop);assertEquals("2",bean.ctor);}
public void testFactoryCreatorWithMixin()throws Exception {ObjectMapper m=new ObjectMapper();m.addMixInAnnotations(CreatorBean.class,MixIn.class);CreatorBean bean=m.readValue("{\"a\" : \"xyz\",\"x\" : 12 }",CreatorBean.class);assertEquals(11,bean.x);assertEquals("factory:xyz",bean.a);}
public void testFactoryCreatorWithRenamingMixin()throws Exception {ObjectMapper m=new ObjectMapper();m.addMixInAnnotations(FactoryBean.class,FactoryBeanMixIn.class);FactoryBean bean=m.readValue("{\"mixed\" :  20.5 }",FactoryBean.class);assertEquals(20.5,bean.d);}
public void testMapWithConstructor()throws Exception {MapWithCtor result=MAPPER.readValue("{\"text\":\"abc\",\"entry\":true,\"number\":123,\"xy\":\"yx\"}",MapWithCtor.class);assertEquals(Boolean.TRUE,result.get("entry"));assertEquals("yx",result.get("xy"));assertEquals(2,result.size());assertEquals("abc",result._text);assertEquals(123,result._number);}
public void testMapWithFactory()throws Exception {MapWithFactory result=MAPPER.readValue("{\"x\":\"...\",\"b\":true  }",MapWithFactory.class);assertEquals("...",result.get("x"));assertEquals(1,result.size());assertEquals(Boolean.TRUE,result._b);}
public void testBrokenConstructor()throws Exception {try {MAPPER.readValue("{\"x\" : 42 }",BrokenBean.class);}catch(JsonMappingException je){verifyException(je,"has no property name");}}
public void testSimpleAutoDetect()throws Exception {SimpleFieldBean bean=new SimpleFieldBean();bean.x=13;Map<String,Object> result=writeAndMap(MAPPER,bean);assertEquals(2,result.size());assertEquals(Integer.valueOf(13),result.get("x"));assertEquals(Integer.valueOf(0),result.get("y"));}
@SuppressWarnings("unchecked")public void testSimpleAnnotation()throws Exception {SimpleFieldBean2 bean=new SimpleFieldBean2();bean.values=new String[]{"a","b"};Map<String,Object> result=writeAndMap(MAPPER,bean);assertEquals(1,result.size());List<String> values=(List<String>)result.get("values");assertEquals(2,values.size());assertEquals("a",values.get(0));assertEquals("b",values.get(1));}
public void testTransientAndStatic()throws Exception {TransientBean bean=new TransientBean();Map<String,Object> result=writeAndMap(MAPPER,bean);assertEquals(1,result.size());assertEquals(Integer.valueOf(0),result.get("a"));}
public void testNoAutoDetect()throws Exception {NoAutoDetectBean bean=new NoAutoDetectBean();bean._z=-4;Map<String,Object> result=writeAndMap(MAPPER,bean);assertEquals(1,result.size());assertEquals(Integer.valueOf(-4),result.get("z"));}
/** * Unit test that verifies that if both a field and a getter method exist for a logical property (which is allowed),getter has precendence over field.*/public void testMethodPrecedence()throws Exception {FieldAndMethodBean bean=new FieldAndMethodBean();bean.z=9;assertEquals(10,bean.getZ());assertEquals("{\"z\":10}",MAPPER.writeValueAsString(bean));}
/** * Testing [JACKSON-226]: it is ok to have "field override",as long as there are no intra-class conflicts.*/public void testOkDupFields()throws Exception {OkDupFieldBean bean=new OkDupFieldBean(1,2);Map<String,Object> json=writeAndMap(MAPPER,bean);assertEquals(2,json.size());assertEquals(Integer.valueOf(1),json.get("x"));assertEquals(Integer.valueOf(2),json.get("y"));}
public void testFailureDueToDups()throws Exception {try {writeAndMap(MAPPER,new DupFieldBean());}catch(JsonMappingException e){verifyException(e,"Multiple fields representing");}}
public void testFailureDueToDupField()throws Exception {try {writeAndMap(MAPPER,new DupFieldBean2());}catch(JsonMappingException e){verifyException(e,"Multiple fields representing");}}
/** * tests generating json-schema stuff.*/public void testGeneratingJsonSchema()throws Exception {JsonSchema jsonSchema=MAPPER.generateJsonSchema(SimpleBean.class);assertNotNull(jsonSchema);assertTrue(jsonSchema.equals(jsonSchema));assertFalse(jsonSchema.equals(null));assertFalse(jsonSchema.equals("foo"));assertNotNull(jsonSchema.toString());assertNotNull(JsonSchema.getDefaultSchemaNode());ObjectNode root=jsonSchema.getSchemaNode();assertEquals("object",root.get("type").asText());assertEquals(false,root.path("required").booleanValue());JsonNode propertiesSchema=root.get("properties");assertNotNull(propertiesSchema);JsonNode property1Schema=propertiesSchema.get("property1");assertNotNull(property1Schema);assertEquals("integer",property1Schema.get("type").asText());assertEquals(false,property1Schema.path("required").booleanValue());JsonNode property2Schema=propertiesSchema.get("property2");assertNotNull(property2Schema);assertEquals("string",property2Schema.get("type").asText());assertEquals(false,property2Schema.path("required").booleanValue());JsonNode property3Schema=propertiesSchema.get("property3");assertNotNull(property3Schema);assertEquals("array",property3Schema.get("type").asText());assertEquals(false,property3Schema.path("required").booleanValue());assertEquals("string",property3Schema.get("items").get("type").asText());JsonNode property4Schema=propertiesSchema.get("property4");assertNotNull(property4Schema);assertEquals("array",property4Schema.get("type").asText());assertEquals(false,property4Schema.path("required").booleanValue());assertEquals("number",property4Schema.get("items").get("type").asText());}
public void testGeneratingJsonSchemaWithFilters()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.setFilters(secretFilterProvider);JsonSchema schema=mapper.generateJsonSchema(FilteredBean.class);JsonNode node=schema.getSchemaNode().get("properties");assertTrue(node.has("obvious"));assertFalse(node.has("secret"));}
/** * Additional unit test for verifying that schema object itself can be properly serialized*/public void testSchemaSerialization()throws Exception {JsonSchema jsonSchema=MAPPER.generateJsonSchema(SimpleBean.class);Map<String,Object> result=writeAndMap(MAPPER,jsonSchema);assertNotNull(result);assertEquals("object",result.get("type"));assertNull(result.get("required"));assertNotNull(result.get("properties"));}
public void testInvalidCall()throws Exception {try {MAPPER.generateJsonSchema(null);fail("Should have failed");}catch(IllegalArgumentException iae){verifyException(iae,"class must be provided");}}
/** * Test for [JACKSON-454]*/public void testThatObjectsHaveNoItems()throws Exception {JsonSchema jsonSchema=MAPPER.generateJsonSchema(TrivialBean.class);String json=jsonSchema.toString().replaceAll("\"","'");assertEquals("{'type':'object','properties':{'name':{'type':'string'}}}",json);}
public void testSchemaId()throws Exception {JsonSchema jsonSchema=MAPPER.generateJsonSchema(BeanWithId.class);String json=jsonSchema.toString().replaceAll("\"","'");assertEquals("{'type':'object','id':'myType','properties':{'value':{'type':'string'}}}",json);}
public void testDataBindingUsage()throws Exception {ObjectMapper objectMapper=createObjectMapper();ObjectWriter objectWriter=objectMapper.writerWithView(Views.View.class).withDefaultPrettyPrinter();Object object=new ComplexTestData();String json=objectWriter.writeValueAsString(object);assertTrue(json.indexOf("nameHidden")== -1);assertTrue(json.indexOf("\"name\" : \"shown\"")> 0);}
public void testIssue560()throws Exception {ObjectMapper mapper=new ObjectMapper();A a=new A("myname",29,"mysurname");mapper.configure(MapperFeature.DEFAULT_VIEW_INCLUSION,Boolean.FALSE);mapper.addMixInAnnotations(A.class,AMixInAnnotation.class);String json=mapper.writerWithView(AView.class).writeValueAsString(a);assertTrue(json.indexOf("\"name\"")> 0);}
/** * Test that verifies that we can go between couple of types of Maps...*/public void testMapToMap(){Map<String,Integer> input=new LinkedHashMap<String,Integer>();input.put("A",Integer.valueOf(3));input.put("B",Integer.valueOf(-4));Map<AB,String> output=mapper.convertValue(input,new TypeReference<Map<AB,String>>(){});assertEquals(2,output.size());assertEquals("3",output.get(AB.A));assertEquals("-4",output.get(AB.B));Map<String,Integer> roundtrip=mapper.convertValue(input,new TypeReference<TreeMap<String,Integer>>(){});assertEquals(2,roundtrip.size());assertEquals(Integer.valueOf(3),roundtrip.get("A"));assertEquals(Integer.valueOf(-4),roundtrip.get("B"));}
public void testMapToBean(){EnumMap<AB,String> map=new EnumMap<AB,String>(AB.class);map.put(AB.A,"   17");map.put(AB.B," -1");Bean bean=mapper.convertValue(map,Bean.class);assertEquals(Integer.valueOf(17),bean.A);assertEquals(" -1",bean.B);}
public void testBeanToMap(){Bean bean=new Bean();bean.A=129;bean.B="13";EnumMap<AB,String> result=mapper.convertValue(bean,new TypeReference<EnumMap<AB,String>>(){});assertEquals("129",result.get(AB.A));assertEquals("13",result.get(AB.B));}
public void testFormat(){String result=ISO8601Utils.format(date);assertEquals("2007-08-13T19:51:23Z",result);}
public void testFormatMillis(){String result=ISO8601Utils.format(date,true);assertEquals("2007-08-13T19:51:23.789Z",result);result=ISO8601Utils.format(date,false);assertEquals("2007-08-13T19:51:23Z",result);}
public void testFormatTimeZone(){String result=ISO8601Utils.format(date,false,TimeZone.getTimeZone("GMT+02:00"));assertEquals("2007-08-13T21:51:23+02:00",result);result=ISO8601Utils.format(date,true,TimeZone.getTimeZone("GMT+02:00"));assertEquals("2007-08-13T21:51:23.789+02:00",result);result=ISO8601Utils.format(date,true,TimeZone.getTimeZone("GMT"));assertEquals("2007-08-13T19:51:23.789Z",result);}
public void testParse(){Date d=ISO8601Utils.parse("2007-08-13T19:51:23.789Z");assertEquals(date,d);d=ISO8601Utils.parse("2007-08-13T19:51:23Z");assertEquals(dateZeroMillis,d);d=ISO8601Utils.parse("2007-08-13T21:51:23.789+02:00");assertEquals(date,d);}
public void testMixinFieldInheritance()throws IOException {ObjectMapper mapper=new ObjectMapper();mapper.addMixInAnnotations(Beano.class,BeanoMixinSub.class);Map<String,Object> result;result=writeAndMap(mapper,new Beano());assertEquals(2,result.size());assertTrue(result.containsKey("id"));assertTrue(result.containsKey("name"));}
public void testMixinMethodInheritance()throws IOException {ObjectMapper mapper=new ObjectMapper();mapper.addMixInAnnotations(Beano2.class,BeanoMixinSub2.class);Map<String,Object> result;result=writeAndMap(mapper,new Beano2());assertEquals(2,result.size());assertTrue(result.containsKey("id"));assertTrue(result.containsKey("name"));}
@SuppressWarnings("unchecked")public void testSampleDoc()throws Exception {final String JSON=SAMPLE_DOC_JSON_SPEC;JsonFactory jf=new JsonFactory();Object root=new ObjectMapper().readValue(jf.createParser(new StringReader(JSON)),Object.class);assertType(root,Map.class);Map<?,?> rootMap=(Map<?,?>)root;assertEquals(1,rootMap.size());Map.Entry<?,?> rootEntry=rootMap.entrySet().iterator().next();assertEquals("Image",rootEntry.getKey());Object image=rootEntry.getValue();assertType(image,Map.class);Map<?,?> imageMap=(Map<?,?>)image;assertEquals(5,imageMap.size());Object value=imageMap.get("Width");assertType(value,Integer.class);assertEquals(Integer.valueOf(SAMPLE_SPEC_VALUE_WIDTH),value);value=imageMap.get("Height");assertType(value,Integer.class);assertEquals(Integer.valueOf(SAMPLE_SPEC_VALUE_HEIGHT),value);assertEquals(SAMPLE_SPEC_VALUE_TITLE,imageMap.get("Title"));value=imageMap.get("Thumbnail");assertType(value,Map.class);Map<?,?> tnMap=(Map<?,?>)value;assertEquals(3,tnMap.size());assertEquals(Integer.valueOf(SAMPLE_SPEC_VALUE_TN_HEIGHT),tnMap.get("Height"));assertEquals(SAMPLE_SPEC_VALUE_TN_WIDTH,tnMap.get("Width"));assertEquals(SAMPLE_SPEC_VALUE_TN_URL,tnMap.get("Url"));value=imageMap.get("IDs");assertType(value,List.class);List<Object> ids=(List<Object>)value;assertEquals(4,ids.size());assertEquals(Integer.valueOf(SAMPLE_SPEC_VALUE_TN_ID1),ids.get(0));assertEquals(Integer.valueOf(SAMPLE_SPEC_VALUE_TN_ID2),ids.get(1));assertEquals(Integer.valueOf(SAMPLE_SPEC_VALUE_TN_ID3),ids.get(2));assertEquals(Integer.valueOf(SAMPLE_SPEC_VALUE_TN_ID4),ids.get(3));}
public void testObjectSerializeWithLong()throws IOException {final ObjectMapper mapper=new ObjectMapper();mapper.enableDefaultTyping(DefaultTyping.JAVA_LANG_OBJECT,As.PROPERTY);final long VALUE=1337800584532L;String serialized="{\"timestamp\":" + VALUE + "}";JsonNode deserialized=mapper.readTree(serialized);assertEquals(VALUE,deserialized.get("timestamp").asLong());Map<?,?> deserMap=mapper.readValue(serialized,Map.class);Number n=(Number)deserMap.get("timestamp");assertNotNull(n);assertSame(Long.class,n.getClass());assertEquals(Long.valueOf(VALUE),n);}
public void testGlobalAutoDetection()throws IOException {ObjectMapper m=new ObjectMapper();Map<String,Object> result=writeAndMap(m,new GetterClass());assertEquals(2,result.size());assertEquals(Integer.valueOf(-2),result.get("x"));assertEquals(Integer.valueOf(1),result.get("y"));m=new ObjectMapper();m.configure(MapperFeature.AUTO_DETECT_GETTERS,false);result=writeAndMap(m,new GetterClass());assertEquals(1,result.size());assertTrue(result.containsKey("x"));}
public void testPerClassAutoDetection()throws IOException {ObjectMapper m=new ObjectMapper();Map<String,Object> result=writeAndMap(m,new DisabledGetterClass());assertEquals(1,result.size());assertTrue(result.containsKey("x"));m.configure(MapperFeature.AUTO_DETECT_GETTERS,false);result=writeAndMap(m,new EnabledGetterClass());assertEquals(2,result.size());assertTrue(result.containsKey("x"));assertTrue(result.containsKey("y"));}
public void testPerClassAutoDetectionForIsGetter()throws IOException {ObjectMapper m=new ObjectMapper();m.configure(MapperFeature.AUTO_DETECT_GETTERS,true);m.configure(MapperFeature.AUTO_DETECT_IS_GETTERS,false);Map<String,Object> result=writeAndMap(m,new EnabledIsGetterClass());assertEquals(1,result.size());assertTrue(result.containsKey("ok"));assertEquals(Boolean.TRUE,result.get("ok"));}
public void testConfigChainability(){ObjectMapper m=new ObjectMapper();assertTrue(m.isEnabled(MapperFeature.AUTO_DETECT_SETTERS));assertTrue(m.isEnabled(MapperFeature.AUTO_DETECT_GETTERS));m.configure(MapperFeature.AUTO_DETECT_SETTERS,false).configure(MapperFeature.AUTO_DETECT_GETTERS,false);assertFalse(m.isEnabled(MapperFeature.AUTO_DETECT_SETTERS));assertFalse(m.isEnabled(MapperFeature.AUTO_DETECT_GETTERS));}
public void testCloseCloseable()throws IOException {ObjectMapper m=new ObjectMapper();CloseableBean bean=new CloseableBean();m.writeValueAsString(bean);assertFalse(bean.wasClosed);m.configure(SerializationFeature.CLOSE_CLOSEABLE,true);bean=new CloseableBean();m.writeValueAsString(bean);assertTrue(bean.wasClosed);bean=new CloseableBean();m.writerWithType(CloseableBean.class).writeValueAsString(bean);assertTrue(bean.wasClosed);}
public void testCharArrays()throws IOException {char[]chars=new char[]{'a','b','c'};ObjectMapper m=new ObjectMapper();assertEquals(quote("abc"),m.writeValueAsString(chars));m.configure(SerializationFeature.WRITE_CHAR_ARRAYS_AS_JSON_ARRAYS,true);assertEquals("[\"a\",\"b\",\"c\"]",m.writeValueAsString(chars));}
public void testFlushingAutomatic()throws IOException {ObjectMapper mapper=new ObjectMapper();assertTrue(mapper.getSerializationConfig().isEnabled(SerializationFeature.FLUSH_AFTER_WRITE_VALUE));StringWriter sw=new StringWriter();JsonGenerator jgen=mapper.getFactory().createGenerator(sw);mapper.writeValue(jgen,Integer.valueOf(13));assertEquals("13",sw.toString());jgen.close();sw=new StringWriter();jgen=mapper.getFactory().createGenerator(sw);ObjectWriter ow=mapper.writer();ow.writeValue(jgen,Integer.valueOf(99));assertEquals("99",sw.toString());jgen.close();}
public void testFlushingNotAutomatic()throws IOException {ObjectMapper mapper=new ObjectMapper();mapper.configure(SerializationFeature.FLUSH_AFTER_WRITE_VALUE,false);StringWriter sw=new StringWriter();JsonGenerator jgen=mapper.getFactory().createGenerator(sw);mapper.writeValue(jgen,Integer.valueOf(13));assertEquals("",sw.toString());jgen.flush();assertEquals("13",sw.toString());jgen.close();sw=new StringWriter();jgen=mapper.getFactory().createGenerator(sw);ObjectWriter ow=mapper.writer();ow.writeValue(jgen,Integer.valueOf(99));assertEquals("",sw.toString());jgen.flush();assertEquals("99",sw.toString());jgen.close();}
public void testSingleElementCollections()throws IOException {final ObjectWriter writer=objectWriter().with(SerializationFeature.WRITE_SINGLE_ELEM_ARRAYS_UNWRAPPED);ArrayList<String> strs=new ArrayList<String>();strs.add("xyz");assertEquals(quote("xyz"),writer.writeValueAsString(strs));ArrayList<Integer> ints=new ArrayList<Integer>();ints.add(13);assertEquals("13",writer.writeValueAsString(ints));HashSet<Long> longs=new HashSet<Long>();longs.add(42L);assertEquals("42",writer.writeValueAsString(longs));final String EXP_STRINGS="{\"values\":\"foo\"}";assertEquals(EXP_STRINGS,writer.writeValueAsString(new StringListBean(Collections.singletonList("foo"))));final Set<String> SET=new HashSet<String>();SET.add("foo");assertEquals(EXP_STRINGS,writer.writeValueAsString(new StringListBean(SET)));assertEquals("true",writer.writeValueAsString(new boolean[]{true}));assertEquals("true",writer.writeValueAsString(new Boolean[]{Boolean.TRUE}));assertEquals("3",writer.writeValueAsString(new int[]{3}));assertEquals(quote("foo"),writer.writeValueAsString(new String[]{"foo"}));}
public void testSimple()throws Exception {final String JSON=SAMPLE_DOC_JSON_SPEC;ObjectMapper mapper=new ObjectMapper();for (int type=0;type < 2;++type){JsonNode result;if (type == 0){result=mapper.readTree(new StringReader(JSON));}else {result=mapper.readTree(JSON);}assertType(result,ObjectNode.class);assertEquals(1,result.size());assertTrue(result.isObject());ObjectNode main=(ObjectNode)result;assertEquals("Image",main.fieldNames().next());JsonNode ob=main.elements().next();assertType(ob,ObjectNode.class);ObjectNode imageMap=(ObjectNode)ob;assertEquals(5,imageMap.size());ob=imageMap.get("Width");assertTrue(ob.isIntegralNumber());assertFalse(ob.isFloatingPointNumber());assertEquals(SAMPLE_SPEC_VALUE_WIDTH,ob.intValue());ob=imageMap.get("Height");assertTrue(ob.isIntegralNumber());assertEquals(SAMPLE_SPEC_VALUE_HEIGHT,ob.intValue());ob=imageMap.get("Title");assertTrue(ob.isTextual());assertEquals(SAMPLE_SPEC_VALUE_TITLE,ob.textValue());ob=imageMap.get("Thumbnail");assertType(ob,ObjectNode.class);ObjectNode tn=(ObjectNode)ob;ob=tn.get("Url");assertTrue(ob.isTextual());assertEquals(SAMPLE_SPEC_VALUE_TN_URL,ob.textValue());ob=tn.get("Height");assertTrue(ob.isIntegralNumber());assertEquals(SAMPLE_SPEC_VALUE_TN_HEIGHT,ob.intValue());ob=tn.get("Width");assertTrue(ob.isTextual());assertEquals(SAMPLE_SPEC_VALUE_TN_WIDTH,ob.textValue());ob=imageMap.get("IDs");assertTrue(ob.isArray());ArrayNode idList=(ArrayNode)ob;assertEquals(4,idList.size());assertEquals(4,calcLength(idList.elements()));assertEquals(4,calcLength(idList.iterator()));{int[]values=new int[]{SAMPLE_SPEC_VALUE_TN_ID1,SAMPLE_SPEC_VALUE_TN_ID2,SAMPLE_SPEC_VALUE_TN_ID3,SAMPLE_SPEC_VALUE_TN_ID4};for (int i=0;i < values.length;++i){assertEquals(values[i],idList.get(i).intValue());}int i=0;for(JsonNode n : idList){assertEquals(values[i],n.intValue());++i;}}}}
public void testBoolean()throws Exception {ObjectMapper mapper=new ObjectMapper();JsonNode result=mapper.readTree("true\n");assertFalse(result.isNull());assertFalse(result.isNumber());assertFalse(result.isTextual());assertTrue(result.isBoolean());assertType(result,BooleanNode.class);assertTrue(result.booleanValue());assertEquals("true",result.asText());assertFalse(result.isMissingNode());assertEquals(result,BooleanNode.valueOf(true));assertEquals(result,BooleanNode.getTrue());}
public void testDouble()throws Exception {ObjectMapper mapper=new ObjectMapper();double value=3.04;JsonNode result=mapper.readTree(String.valueOf(value));assertTrue(result.isNumber());assertFalse(result.isNull());assertType(result,DoubleNode.class);assertTrue(result.isFloatingPointNumber());assertTrue(result.isDouble());assertFalse(result.isInt());assertFalse(result.isLong());assertFalse(result.isIntegralNumber());assertFalse(result.isTextual());assertFalse(result.isMissingNode());assertEquals(value,result.doubleValue());assertEquals(value,result.numberValue().doubleValue());assertEquals((int)value,result.intValue());assertEquals((long)value,result.longValue());assertEquals(String.valueOf(value),result.asText());assertEquals(result,DoubleNode.valueOf(value));}
public void testInt()throws Exception {ObjectMapper mapper=new ObjectMapper();int value=-90184;JsonNode result=mapper.readTree(String.valueOf(value));assertTrue(result.isNumber());assertTrue(result.isIntegralNumber());assertTrue(result.isInt());assertType(result,IntNode.class);assertFalse(result.isLong());assertFalse(result.isFloatingPointNumber());assertFalse(result.isDouble());assertFalse(result.isNull());assertFalse(result.isTextual());assertFalse(result.isMissingNode());assertEquals(value,result.numberValue().intValue());assertEquals(value,result.intValue());assertEquals(String.valueOf(value),result.asText());assertEquals((double)value,result.doubleValue());assertEquals((long)value,result.longValue());assertEquals(result,IntNode.valueOf(value));}
public void testLong()throws Exception {ObjectMapper mapper=new ObjectMapper();long value=12345678L << 32;JsonNode result=mapper.readTree(String.valueOf(value));assertTrue(result.isNumber());assertTrue(result.isIntegralNumber());assertTrue(result.isLong());assertType(result,LongNode.class);assertFalse(result.isInt());assertFalse(result.isFloatingPointNumber());assertFalse(result.isDouble());assertFalse(result.isNull());assertFalse(result.isTextual());assertFalse(result.isMissingNode());assertEquals(value,result.numberValue().longValue());assertEquals(value,result.longValue());assertEquals(String.valueOf(value),result.asText());assertEquals((double)value,result.doubleValue());assertEquals(result,LongNode.valueOf(value));}
public void testNull()throws Exception {ObjectMapper mapper=new ObjectMapper();JsonNode result=mapper.readTree("   null ");assertNotNull(result);assertTrue(result.isNull());assertFalse(result.isNumber());assertFalse(result.isTextual());assertEquals("null",result.asText());assertEquals(result,NullNode.instance);}
public void testDecimalNode()throws Exception {BigDecimal value=new BigDecimal("0.1");JsonNode result=DecimalNode.valueOf(value);assertFalse(result.isArray());assertFalse(result.isObject());assertTrue(result.isNumber());assertFalse(result.isIntegralNumber());assertFalse(result.isLong());assertType(result,DecimalNode.class);assertFalse(result.isInt());assertTrue(result.isFloatingPointNumber());assertTrue(result.isBigDecimal());assertFalse(result.isDouble());assertFalse(result.isNull());assertFalse(result.isTextual());assertFalse(result.isMissingNode());assertEquals(value,result.numberValue());assertEquals(value.toString(),result.asText());assertEquals(result,DecimalNode.valueOf(value));}
public void testSimpleArray()throws Exception {ObjectMapper mapper=new ObjectMapper();ArrayNode result=mapper.createArrayNode();assertTrue(result.isArray());assertType(result,ArrayNode.class);assertFalse(result.isObject());assertFalse(result.isNumber());assertFalse(result.isNull());assertFalse(result.isTextual());result.add(false);result.insertNull(0);assertEquals(result,result);assertFalse(result.equals(null));assertEquals(NullNode.instance,result.path(0));assertEquals(NullNode.instance,result.get(0));assertEquals(BooleanNode.FALSE,result.path(1));assertEquals(BooleanNode.FALSE,result.get(1));assertEquals(2,result.size());assertNull(result.get(-1));assertNull(result.get(2));JsonNode missing=result.path(2);assertTrue(missing.isMissingNode());assertTrue(result.path(-100).isMissingNode());ArrayNode array2=mapper.createArrayNode();array2.addNull();array2.add(false);assertEquals(result,array2);JsonNode rm1=array2.remove(0);assertEquals(NullNode.instance,rm1);assertEquals(1,array2.size());assertEquals(BooleanNode.FALSE,array2.get(0));assertFalse(result.equals(array2));JsonNode rm2=array2.remove(0);assertEquals(BooleanNode.FALSE,rm2);assertEquals(0,array2.size());}
/** * Type mappers should be able to gracefully deal with end of input.*/public void testEOF()throws Exception {String JSON="{\"key\": [{\"a\" :{\"name\": \"foo\",\"type\": 1\n" + "},\"type\": 3,\"url\": \"http://www.google.com\"}],\n" + "\"name\": \"xyz\",\"type\": 1,\"url\" : null }\n  ";JsonFactory jf=new JsonFactory();ObjectMapper mapper=new ObjectMapper();JsonParser jp=jf.createParser(new StringReader(JSON));JsonNode result=mapper.readTree(jp);assertTrue(result.isObject());assertEquals(4,result.size());assertNull(mapper.readTree(jp));}
public void testMultiple()throws Exception {String JSON="12  \"string\"[1,2,3 ]";JsonFactory jf=new JsonFactory();ObjectMapper mapper=new ObjectMapper();JsonParser jp=jf.createParser(new StringReader(JSON));JsonNode result=mapper.readTree(jp);assertTrue(result.isIntegralNumber());assertTrue(result.isInt());assertFalse(result.isTextual());assertEquals(12,result.intValue());result=mapper.readTree(jp);assertTrue(result.isTextual());assertFalse(result.isIntegralNumber());assertFalse(result.isInt());assertEquals("string",result.textValue());result=mapper.readTree(jp);assertTrue(result.isArray());assertEquals(3,result.size());assertNull(mapper.readTree(jp));}
/** * Let's also verify behavior of "MissingNode" -- one needs to be able to traverse such bogus nodes with appropriate methods.*/@SuppressWarnings("unused")public void testMissingNode()throws Exception {String JSON="[{},[]]";ObjectMapper mapper=new ObjectMapper();JsonNode result=mapper.readTree(new StringReader(JSON));assertTrue(result.isContainerNode());assertTrue(result.isArray());assertEquals(2,result.size());int count=0;for(JsonNode node : result){++count;}assertEquals(2,count);Iterator<JsonNode> it=result.iterator();JsonNode onode=it.next();assertTrue(onode.isContainerNode());assertTrue(onode.isObject());assertEquals(0,onode.size());assertFalse(onode.isMissingNode());assertNull(onode.textValue());assertNull(onode.get(0));JsonNode dummyNode=onode.path(0);assertNotNull(dummyNode);assertTrue(dummyNode.isMissingNode());assertNull(dummyNode.get(3));assertNull(dummyNode.get("whatever"));JsonNode dummyNode2=dummyNode.path(98);assertNotNull(dummyNode2);assertTrue(dummyNode2.isMissingNode());JsonNode dummyNode3=dummyNode.path("field");assertNotNull(dummyNode3);assertTrue(dummyNode3.isMissingNode());JsonNode anode=it.next();assertTrue(anode.isContainerNode());assertTrue(anode.isArray());assertFalse(anode.isMissingNode());assertEquals(0,anode.size());assertNull(anode.get(0));dummyNode=anode.path(0);assertNotNull(dummyNode);assertTrue(dummyNode.isMissingNode());assertNull(dummyNode.get(0));assertNull(dummyNode.get("myfield"));dummyNode2=dummyNode.path(98);assertNotNull(dummyNode2);assertTrue(dummyNode2.isMissingNode());dummyNode3=dummyNode.path("f");assertNotNull(dummyNode3);assertTrue(dummyNode3.isMissingNode());}
public void testArray()throws Exception {ObjectMapper mapper=new ObjectMapper();final String JSON="[[[-0.027512,51.503221],[-0.008497,51.503221],[-0.008497,51.509744],[-0.027512,51.509744]]]";JsonNode n=mapper.readTree(JSON);assertNotNull(n);assertTrue(n.isArray());ArrayNode an=(ArrayNode)n;assertEquals(1,an.size());ArrayNode an2=(ArrayNode)n.get(0);assertTrue(an2.isArray());assertEquals(4,an2.size());}
public void testEnumIndexes(){int max=0;for(DeserializationFeature f : DeserializationFeature.values()){max=Math.max(max,f.ordinal());}if (max >= 31){fail("Max number of DeserializationFeature enums reached: " + max);}}
public void testDefaults(){ObjectMapper m=new ObjectMapper();DeserializationConfig cfg=m.getDeserializationConfig();assertTrue(cfg.isEnabled(MapperFeature.USE_ANNOTATIONS));assertTrue(cfg.isEnabled(MapperFeature.AUTO_DETECT_SETTERS));assertTrue(cfg.isEnabled(MapperFeature.AUTO_DETECT_CREATORS));assertTrue(cfg.isEnabled(MapperFeature.USE_GETTERS_AS_SETTERS));assertTrue(cfg.isEnabled(MapperFeature.CAN_OVERRIDE_ACCESS_MODIFIERS));assertFalse(cfg.isEnabled(DeserializationFeature.USE_BIG_DECIMAL_FOR_FLOATS));assertFalse(cfg.isEnabled(DeserializationFeature.USE_BIG_INTEGER_FOR_INTS));assertTrue(cfg.isEnabled(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES));}
public void testOverrideIntrospectors(){ObjectMapper m=new ObjectMapper();DeserializationConfig cfg=m.getDeserializationConfig();cfg=cfg.with((ClassIntrospector)null);cfg=cfg.with((AnnotationIntrospector)null);assertNull(cfg.getAnnotationIntrospector());}
public void testAnnotationsDisabled()throws Exception {ObjectMapper m=new ObjectMapper();assertTrue(m.getDeserializationConfig().isEnabled(MapperFeature.USE_ANNOTATIONS));AnnoBean bean=m.readValue("{\"y\" : 0 }",AnnoBean.class);assertEquals(0,bean.value);m=new ObjectMapper();m.configure(MapperFeature.USE_ANNOTATIONS,false);bean=m.readValue("{\"x\" : 0 }",AnnoBean.class);assertEquals(0,bean.value);}
public void testEnumsWhenDisabled()throws Exception {ObjectMapper m=new ObjectMapper();assertEquals(Alpha.B,m.readValue(quote("B"),Alpha.class));m=new ObjectMapper();m.configure(MapperFeature.USE_ANNOTATIONS,false);assertEquals(Alpha.B,m.readValue(quote("B"),Alpha.class));}
public void testNoAccessOverrides()throws Exception {ObjectMapper m=new ObjectMapper();m.disable(MapperFeature.CAN_OVERRIDE_ACCESS_MODIFIERS);SimpleBean bean=m.readValue("{\"x\":1,\"y\":2}",SimpleBean.class);assertEquals(1,bean.x);assertEquals(2,bean.y);}
public void testFormatForParsers()throws Exception {ObjectMapper mapper=new ObjectMapper(new FactoryWithSchema());MySchema s=new MySchema();StringReader r=new StringReader("{}");try {mapper.reader(s).withType(Object.class).readValue(r);fail("Excpected exception");}catch(SchemaException e){assertSame(s,e._schema);}}
public void testFormatForGenerators()throws Exception {ObjectMapper mapper=new ObjectMapper(new FactoryWithSchema());MySchema s=new MySchema();StringWriter sw=new StringWriter();try {mapper.writer(s).writeValue(sw,"Foobar");fail("Excpected exception");}catch(SchemaException e){assertSame(s,e._schema);}}
public void testJackson428()throws Exception {ObjectMapper serMapper=new ObjectMapper();TypeResolverBuilder<?> serializerTyper=new ObjectMapper.DefaultTypeResolverBuilder(ObjectMapper.DefaultTyping.NON_FINAL);serializerTyper=serializerTyper.init(JsonTypeInfo.Id.NAME,createTypeNameIdResolver(true));serializerTyper=serializerTyper.inclusion(JsonTypeInfo.As.PROPERTY);serMapper.setDefaultTyping(serializerTyper);MapHolder holder=new MapHolder();holder.map=new HashMap<MapKey,List<Object>>();List<Object> ints=new ArrayList<Object>();ints.add(Integer.valueOf(3));holder.map.put(new MapKey("key"),ints);String json=serMapper.writeValueAsString(holder);ObjectMapper deserMapper=new ObjectMapper();TypeResolverBuilder<?> deserializerTyper=new ObjectMapper.DefaultTypeResolverBuilder(ObjectMapper.DefaultTyping.NON_FINAL);deserializerTyper=deserializerTyper.init(JsonTypeInfo.Id.NAME,createTypeNameIdResolver(false));deserializerTyper=deserializerTyper.inclusion(JsonTypeInfo.As.PROPERTY);deserMapper.setDefaultTyping(deserializerTyper);MapHolder result=deserMapper.readValue(json,MapHolder.class);assertNotNull(result);Map<?,?> map=result.map;assertEquals(1,map.size());Map.Entry<?,?> entry=map.entrySet().iterator().next();Object key=entry.getKey();assertEquals(MapKey.class,key.getClass());Object value=entry.getValue();assertTrue(value instanceof List<?>);List<?> list=(List<?>)value;assertEquals(1,list.size());assertEquals(Integer.class,list.get(0).getClass());assertEquals(Integer.valueOf(3),list.get(0));}
public void testSimpleRefs()throws Exception {SimpleTreeNode root=new SimpleTreeNode("root");SimpleTreeNode child=new SimpleTreeNode("kid");ObjectMapper mapper=new ObjectMapper();root.child=child;child.parent=root;String json=mapper.writeValueAsString(root);SimpleTreeNode resultNode=mapper.readValue(json,SimpleTreeNode.class);assertEquals("root",resultNode.name);SimpleTreeNode resultChild=resultNode.child;assertNotNull(resultChild);assertEquals("kid",resultChild.name);assertSame(resultChild.parent,resultNode);}
public void testSimpleRefsWithGetter()throws Exception {SimpleTreeNode2 root=new SimpleTreeNode2("root");SimpleTreeNode2 child=new SimpleTreeNode2("kid");ObjectMapper mapper=new ObjectMapper();root.child=child;child.parent=root;String json=mapper.writeValueAsString(root);SimpleTreeNode2 resultNode=mapper.readValue(json,SimpleTreeNode2.class);assertEquals("root",resultNode.name);SimpleTreeNode2 resultChild=resultNode.child;assertNotNull(resultChild);assertEquals("kid",resultChild.name);assertSame(resultChild.parent,resultNode);}
public void testFullRefs()throws Exception {FullTreeNode root=new FullTreeNode("root");FullTreeNode child1=new FullTreeNode("kid1");FullTreeNode child2=new FullTreeNode("kid2");ObjectMapper mapper=new ObjectMapper();root.firstChild=child1;child1.parent=root;child1.next=child2;child2.prev=child1;String json=mapper.writeValueAsString(root);FullTreeNode resultNode=mapper.readValue(json,FullTreeNode.class);assertEquals("root",resultNode.name);FullTreeNode resultChild=resultNode.firstChild;assertNotNull(resultChild);assertEquals("kid1",resultChild.name);assertSame(resultChild.parent,resultNode);assertNull(resultChild.prev);FullTreeNode resultChild2=resultChild.next;assertNotNull(resultChild2);assertEquals("kid2",resultChild2.name);assertSame(resultChild,resultChild2.prev);assertNull(resultChild2.next);}
public void testArrayOfRefs()throws Exception {NodeArray root=new NodeArray();ArrayNode node1=new ArrayNode("a");ArrayNode node2=new ArrayNode("b");root.nodes=new ArrayNode[]{node1,node2};ObjectMapper mapper=new ObjectMapper();String json=mapper.writeValueAsString(root);NodeArray result=mapper.readValue(json,NodeArray.class);ArrayNode[]kids=result.nodes;assertNotNull(kids);assertEquals(2,kids.length);assertEquals("a",kids[0].name);assertEquals("b",kids[1].name);assertSame(result,kids[0].parent);assertSame(result,kids[1].parent);}
public void testListOfRefs()throws Exception {NodeList root=new NodeList();NodeForList node1=new NodeForList("a");NodeForList node2=new NodeForList("b");root.nodes=Arrays.asList(node1,node2);ObjectMapper mapper=new ObjectMapper();String json=mapper.writeValueAsString(root);NodeList result=mapper.readValue(json,NodeList.class);List<NodeForList> kids=result.nodes;assertNotNull(kids);assertEquals(2,kids.size());assertEquals("a",kids.get(0).name);assertEquals("b",kids.get(1).name);assertSame(result,kids.get(0).parent);assertSame(result,kids.get(1).parent);}
public void testMapOfRefs()throws Exception {NodeMap root=new NodeMap();NodeForMap node1=new NodeForMap("a");NodeForMap node2=new NodeForMap("b");Map<String,NodeForMap> nodes=new HashMap<String,NodeForMap>();nodes.put("a1",node1);nodes.put("b2",node2);root.nodes=nodes;ObjectMapper mapper=new ObjectMapper();String json=mapper.writeValueAsString(root);NodeMap result=mapper.readValue(json,NodeMap.class);Map<String,NodeForMap> kids=result.nodes;assertNotNull(kids);assertEquals(2,kids.size());assertNotNull(kids.get("a1"));assertNotNull(kids.get("b2"));assertEquals("a",kids.get("a1").name);assertEquals("b",kids.get("b2").name);assertSame(result,kids.get("a1").parent);assertSame(result,kids.get("b2").parent);}
public void testAbstract368()throws Exception {AbstractNode parent=new ConcreteNode("p");AbstractNode child=new ConcreteNode("c");parent.next=child;child.prev=parent;ObjectMapper mapper=new ObjectMapper();String json=mapper.writeValueAsString(parent);AbstractNode root=mapper.readValue(json,AbstractNode.class);assertEquals(ConcreteNode.class,root.getClass());assertEquals("p",root.id);assertNull(root.prev);AbstractNode leaf=root.next;assertNotNull(leaf);assertEquals("c",leaf.id);assertSame(root,leaf.prev);}
public void testIssue693()throws Exception {Parent parent=new Parent();parent.addChild(new Child("foo"));parent.addChild(new Child("bar"));ObjectMapper mapper=new ObjectMapper();byte[]bytes=mapper.writeValueAsBytes(parent);Parent value=mapper.readValue(bytes,Parent.class);for(Child child : value.children){assertEquals(value,child.getParent());}}
public void testIssue708()throws Exception {ObjectMapper mapper=new ObjectMapper();Advertisement708 ad=mapper.readValue("{\"title\":\"Hroch\",\"photos\":[{\"id\":3}]}",Advertisement708.class);assertNotNull(ad);}
public void testLinked()throws Exception {Bean first=new ObjectMapper().readValue("{\"name\":\"first\",\"next\":{" + " \"name\":\"last\",\"next\" : null }}",Bean.class);assertNotNull(first);assertEquals("first",first._name);Bean last=first._next;assertNotNull(last);assertEquals("last",last._name);assertNull(last._next);}
public void testLinkedGeneric()throws Exception {StringLink link=new ObjectMapper().readValue("{\"next\":null}",StringLink.class);assertNotNull(link);assertNull(link.next);}
public void testCycleWith2Classes()throws Exception {LinkA a=new ObjectMapper().readValue("{\"next\":{\"a\":null}}",LinkA.class);assertNotNull(a.next);LinkB b=a.next;assertNull(b.a);}
public void testFieldMixInsTopLevel()throws IOException {ObjectMapper mapper=new ObjectMapper();Map<String,Object> result;BaseClass bean=new BaseClass("1","2");result=writeAndMap(mapper,bean);assertEquals(1,result.size());assertEquals("1",result.get("a"));mapper=new ObjectMapper();mapper.addMixInAnnotations(BaseClass.class,MixIn.class);result=writeAndMap(mapper,bean);assertEquals(2,result.size());assertEquals("1",result.get("a"));assertEquals("2",result.get("banana"));}
public void testMultipleFieldMixIns()throws IOException {ObjectMapper mapper=new ObjectMapper();HashMap<Class<?>,Class<?>> mixins=new HashMap<Class<?>,Class<?>>();mixins.put(SubClass.class,MixIn.class);mixins.put(BaseClass.class,MixIn2.class);mapper.setMixInAnnotations(mixins);Map<String,Object> result;result=writeAndMap(mapper,new SubClass("1","2"));assertEquals(1,result.size());assertEquals("2",result.get("banana"));}
public void testBeanUpdate()throws Exception {Bean bean=new Bean();assertEquals("b",bean.b);assertEquals(3,bean.c.length);assertNull(bean.child);Object ob=MAPPER.readerForUpdating(bean).readValue("{\"b\":\"x\",\"c\":[4,5],\"child\":{\"a\":\"y\"}}");assertSame(ob,bean);assertEquals("a",bean.a);assertEquals("x",bean.b);assertArrayEquals(new int[]{4,5},bean.c);Bean child=bean.child;assertNotNull(child);assertEquals("y",child.a);assertEquals("b",child.b);assertArrayEquals(new int[]{1,2,3},child.c);assertNull(child.child);}
public void testListUpdate()throws Exception {List<String> strs=new ArrayList<String>();strs.add("a");Object ob=MAPPER.readerForUpdating(strs).readValue("[\"b\",\"c\",\"d\" ]");assertSame(strs,ob);assertEquals(4,strs.size());assertEquals("a",strs.get(0));assertEquals("b",strs.get(1));assertEquals("c",strs.get(2));assertEquals("d",strs.get(3));}
public void testMapUpdate()throws Exception {Map<String,String> strs=new HashMap<String,String>();strs.put("a","a");strs.put("b","b");Object ob=MAPPER.readerForUpdating(strs).readValue("{\"c\" : \"c\",\"a\" : \"z\" }");assertSame(strs,ob);assertEquals(3,strs.size());assertEquals("z",strs.get("a"));assertEquals("b",strs.get("b"));assertEquals("c",strs.get("c"));}
public void testUpdateSequence()throws Exception {XYBean toUpdate=new XYBean();Iterator<XYBean> it=MAPPER.readerForUpdating(toUpdate).readValues("{\"x\":1,\"y\":2}\n{\"x\":16}{\"y\":37}");assertTrue(it.hasNext());XYBean value=it.next();assertSame(toUpdate,value);assertEquals(1,value.x);assertEquals(2,value.y);assertTrue(it.hasNext());value=it.next();assertSame(toUpdate,value);assertEquals(16,value.x);assertEquals(2,value.y);assertTrue(it.hasNext());value=it.next();assertSame(toUpdate,value);assertEquals(16,value.x);assertEquals(37,value.y);assertFalse(it.hasNext());}
public void testUpdatingWithViews()throws Exception {Updateable bean=new Updateable();bean.num=100;bean.str="test";Updateable result=MAPPER.readerForUpdating(bean).withView(TextView.class).readValue("{\"num\": 10,\"str\":\"foobar\"}");assertSame(bean,result);assertEquals(100,bean.num);assertEquals("foobar",bean.str);}
public void testDataBindingUsage()throws Exception {ObjectMapper objectMapper=createObjectMapper(null);String result=serializeWithObjectMapper(new ComplexTestData(),Views.View.class,objectMapper);assertEquals(-1,result.indexOf("nameHidden"));}
public void testDataBindingUsageWithoutView()throws Exception {ObjectMapper objectMapper=createObjectMapper(null);String json=serializeWithObjectMapper(new ComplexTestData(),null,objectMapper);assertTrue(json.indexOf("nameHidden")> 0);}
public void testSimple()throws Exception {final String JSON="{\"a\" : 123,\"list\" :[12.25,null,true,{},[]]}";ObjectMapper m=new ObjectMapper();JsonNode tree=m.readTree(JSON);JsonParser jp=tree.traverse();assertNull(jp.getCurrentToken());assertNull(jp.getCurrentName());assertToken(JsonToken.START_OBJECT,jp.nextToken());assertNull(jp.getCurrentName());assertEquals("Expected START_OBJECT",JsonToken.START_OBJECT.asString(),jp.getText());assertToken(JsonToken.FIELD_NAME,jp.nextToken());assertEquals("a",jp.getCurrentName());assertEquals("a",jp.getText());assertToken(JsonToken.VALUE_NUMBER_INT,jp.nextToken());assertEquals("a",jp.getCurrentName());assertEquals(123,jp.getIntValue());assertEquals("123",jp.getText());assertToken(JsonToken.FIELD_NAME,jp.nextToken());assertEquals("list",jp.getCurrentName());assertEquals("list",jp.getText());assertToken(JsonToken.START_ARRAY,jp.nextToken());assertEquals("list",jp.getCurrentName());assertEquals(JsonToken.START_ARRAY.asString(),jp.getText());assertToken(JsonToken.VALUE_NUMBER_FLOAT,jp.nextToken());assertNull(jp.getCurrentName());assertEquals(12.25,jp.getDoubleValue(),0);assertEquals("12.25",jp.getText());assertToken(JsonToken.VALUE_NULL,jp.nextToken());assertNull(jp.getCurrentName());assertEquals(JsonToken.VALUE_NULL.asString(),jp.getText());assertToken(JsonToken.VALUE_TRUE,jp.nextToken());assertNull(jp.getCurrentName());assertTrue(jp.getBooleanValue());assertEquals(JsonToken.VALUE_TRUE.asString(),jp.getText());assertToken(JsonToken.START_OBJECT,jp.nextToken());assertNull(jp.getCurrentName());assertToken(JsonToken.END_OBJECT,jp.nextToken());assertNull(jp.getCurrentName());assertToken(JsonToken.START_ARRAY,jp.nextToken());assertNull(jp.getCurrentName());assertToken(JsonToken.END_ARRAY,jp.nextToken());assertNull(jp.getCurrentName());assertToken(JsonToken.END_ARRAY,jp.nextToken());assertToken(JsonToken.END_OBJECT,jp.nextToken());assertNull(jp.getCurrentName());assertNull(jp.nextToken());jp.close();assertTrue(jp.isClosed());}
public void testArray()throws Exception {ObjectMapper m=new ObjectMapper();JsonParser jp=m.readTree("[]").traverse();assertToken(JsonToken.START_ARRAY,jp.nextToken());assertToken(JsonToken.END_ARRAY,jp.nextToken());jp.close();jp=m.readTree("[[]]").traverse();assertToken(JsonToken.START_ARRAY,jp.nextToken());assertToken(JsonToken.START_ARRAY,jp.nextToken());assertToken(JsonToken.END_ARRAY,jp.nextToken());assertToken(JsonToken.END_ARRAY,jp.nextToken());jp.close();jp=m.readTree("[[12.1 ]]").traverse();assertToken(JsonToken.START_ARRAY,jp.nextToken());assertToken(JsonToken.START_ARRAY,jp.nextToken());assertToken(JsonToken.VALUE_NUMBER_FLOAT,jp.nextToken());assertToken(JsonToken.END_ARRAY,jp.nextToken());assertToken(JsonToken.END_ARRAY,jp.nextToken());jp.close();}
public void testNested()throws Exception {final String JSON="{\"coordinates\":[[[-3,\n1],[179.859681,51.175092]]]}";ObjectMapper m=new ObjectMapper();JsonNode tree=m.readTree(JSON);JsonParser jp=tree.traverse();assertToken(JsonToken.START_OBJECT,jp.nextToken());assertToken(JsonToken.FIELD_NAME,jp.nextToken());assertToken(JsonToken.START_ARRAY,jp.nextToken());assertToken(JsonToken.START_ARRAY,jp.nextToken());assertToken(JsonToken.START_ARRAY,jp.nextToken());assertToken(JsonToken.VALUE_NUMBER_INT,jp.nextToken());assertToken(JsonToken.VALUE_NUMBER_INT,jp.nextToken());assertToken(JsonToken.END_ARRAY,jp.nextToken());assertToken(JsonToken.START_ARRAY,jp.nextToken());assertToken(JsonToken.VALUE_NUMBER_FLOAT,jp.nextToken());assertToken(JsonToken.VALUE_NUMBER_FLOAT,jp.nextToken());assertToken(JsonToken.END_ARRAY,jp.nextToken());assertToken(JsonToken.END_ARRAY,jp.nextToken());assertToken(JsonToken.END_ARRAY,jp.nextToken());assertToken(JsonToken.END_OBJECT,jp.nextToken());}
/** * Unit test that verifies that we can (re)parse sample document from JSON specification.*/public void testSpecDoc()throws Exception {ObjectMapper m=new ObjectMapper();JsonNode tree=m.readTree(SAMPLE_DOC_JSON_SPEC);JsonParser jp=tree.traverse();verifyJsonSpecSampleDoc(jp,true);}
public void testBinaryPojo()throws Exception {byte[]inputBinary=new byte[]{1,2,100};POJONode n=new POJONode(inputBinary);JsonParser jp=n.traverse();assertNull(jp.getCurrentToken());assertToken(JsonToken.VALUE_EMBEDDED_OBJECT,jp.nextToken());byte[]data=jp.getBinaryValue();assertNotNull(data);assertArrayEquals(inputBinary,data);Object pojo=jp.getEmbeddedObject();assertSame(data,pojo);}
public void testBinaryNode()throws Exception {byte[]inputBinary=new byte[]{0,-5};BinaryNode n=new BinaryNode(inputBinary);JsonParser jp=n.traverse();assertNull(jp.getCurrentToken());assertToken(JsonToken.VALUE_EMBEDDED_OBJECT,jp.nextToken());byte[]data=jp.getBinaryValue();assertNotNull(data);assertArrayEquals(inputBinary,data);assertEquals("APs=",jp.getText());assertNull(jp.nextToken());}
public void testTextAsBinary()throws Exception {TextNode n=new TextNode("   APs=\n");JsonParser jp=n.traverse();assertNull(jp.getCurrentToken());assertToken(JsonToken.VALUE_STRING,jp.nextToken());byte[]data=jp.getBinaryValue();assertNotNull(data);assertArrayEquals(new byte[]{0,-5},data);assertNull(jp.nextToken());jp.close();assertTrue(jp.isClosed());n=new TextNode("?!??");jp=n.traverse();assertToken(JsonToken.VALUE_STRING,jp.nextToken());try {jp.getBinaryValue();}catch(JsonParseException e){verifyException(e,"Illegal character");}}
/** * Very simple test case to verify that tree-to-POJO conversion works ok*/public void testDataBind()throws Exception {ObjectMapper m=new ObjectMapper();JsonNode tree=m.readTree("{\"name\" : \"Tatu\",\n" + "\"magicNumber\" : 42," + "\"kids\" :[\"Leo\",\"Lila\",\"Leia\"]\n"+ "}");Person tatu=m.treeToValue(tree,Person.class);assertNotNull(tatu);assertEquals(42,tatu.magicNumber);assertEquals("Tatu",tatu.name);assertNotNull(tatu.kids);assertEquals(3,tatu.kids.size());assertEquals("Leo",tatu.kids.get(0));assertEquals("Lila",tatu.kids.get(1));assertEquals("Leia",tatu.kids.get(2));}
public void testSkipChildrenWrt370()throws Exception {ObjectMapper o=new ObjectMapper();ObjectNode n=o.createObjectNode();n.putObject("inner").put("value","test");n.putObject("unknown").putNull("inner");Jackson370Bean obj=o.readValue(n.traverse(),Jackson370Bean.class);assertNotNull(obj.inner);assertEquals("test",obj.inner.value);}
public void testConfigs()throws IOException {ObjectMapper mapper=new ObjectMapper();byte[]base=jdkSerialize(mapper.getDeserializationConfig().getBaseSettings());assertNotNull(jdkDeserialize(base));DeserializationConfig origDC=mapper.getDeserializationConfig();SerializationConfig origSC=mapper.getSerializationConfig();byte[]dcBytes=jdkSerialize(origDC);byte[]scBytes=jdkSerialize(origSC);DeserializationConfig dc=jdkDeserialize(dcBytes);assertNotNull(dc);assertEquals(dc._deserFeatures,origDC._deserFeatures);SerializationConfig sc=jdkDeserialize(scBytes);assertNotNull(sc);assertEquals(sc._serFeatures,origSC._serFeatures);}
public void testObjectWriter()throws IOException {ObjectWriter origWriter=new ObjectMapper().writer();final String EXP_JSON="{\"x\":2,\"y\":3}";final MyPojo p=new MyPojo(2,3);assertEquals(EXP_JSON,origWriter.writeValueAsString(p));byte[]bytes=jdkSerialize(origWriter);ObjectWriter writer2=jdkDeserialize(bytes);assertEquals(EXP_JSON,writer2.writeValueAsString(p));}
public void testObjectReader()throws IOException {ObjectReader origReader=new ObjectMapper().reader(MyPojo.class);final String JSON="{\"x\":1,\"y\":2}";MyPojo p1=origReader.readValue(JSON);assertEquals(2,p1.y);byte[]bytes=jdkSerialize(origReader);ObjectReader reader2=jdkDeserialize(bytes);MyPojo p2=reader2.readValue(JSON);assertEquals(2,p2.y);}
public void testObjectMapper()throws IOException {ObjectMapper mapper=new ObjectMapper();final String EXP_JSON="{\"x\":2,\"y\":3}";final MyPojo p=new MyPojo(2,3);assertEquals(EXP_JSON,mapper.writeValueAsString(p));byte[]bytes=jdkSerialize(mapper);ObjectMapper mapper2=jdkDeserialize(bytes);assertEquals(EXP_JSON,mapper2.writeValueAsString(p));MyPojo p2=mapper2.readValue(EXP_JSON,MyPojo.class);assertEquals(p.x,p2.x);assertEquals(p.y,p2.y);}
public void testDateUtil()throws Exception {long now=123456789L;java.util.Date value=new java.util.Date(now);assertEquals(value,MAPPER.readValue("" + now,java.util.Date.class));String dateStr=dateToString(value);java.util.Date result=MAPPER.readValue("\"" + dateStr + "\"",java.util.Date.class);assertEquals("Date: expect " + value + " ("+ value.getTime()+ "),got "+ result+ " ("+ result.getTime()+ ")",value.getTime(),result.getTime());}
public void testDateUtilWithStringTimestamp()throws Exception {long now=1321992375446L;String json=quote(String.valueOf(now));java.util.Date value=MAPPER.readValue(json,java.util.Date.class);assertEquals(now,value.getTime());}
public void testDateUtilRFC1123()throws Exception {DateFormat fmt=new SimpleDateFormat("EEE,dd MMM yyyy HH:mm:ss zzz",Locale.US);String inputStr="Sat,17 Jan 2009 06:13:58 +0000";java.util.Date inputDate=fmt.parse(inputStr);assertEquals(inputDate,MAPPER.readValue("\"" + inputStr + "\"",java.util.Date.class));}
public void testDateUtilRFC1123OnNonUSLocales()throws Exception {Locale old=Locale.getDefault();Locale.setDefault(Locale.GERMAN);DateFormat fmt=new SimpleDateFormat("EEE,dd MMM yyyy HH:mm:ss zzz",Locale.US);String inputStr="Sat,17 Jan 2009 06:13:58 +0000";java.util.Date inputDate=fmt.parse(inputStr);assertEquals(inputDate,MAPPER.readValue("\"" + inputStr + "\"",java.util.Date.class));Locale.setDefault(old);}
/** * ISO8601 is supported as well*/public void testDateUtilISO8601()throws Exception {String inputStr="1972-12-28T00:00:00.000+0000";Date inputDate=MAPPER.readValue("\"" + inputStr + "\"",java.util.Date.class);Calendar c=Calendar.getInstance(TimeZone.getTimeZone("GMT"));c.setTime(inputDate);assertEquals(1972,c.get(Calendar.YEAR));assertEquals(Calendar.DECEMBER,c.get(Calendar.MONTH));assertEquals(28,c.get(Calendar.DAY_OF_MONTH));inputStr="1972-12-28T00:00:00.000Z";inputDate=MAPPER.readValue(quote(inputStr),java.util.Date.class);c.setTime(inputDate);assertEquals(1972,c.get(Calendar.YEAR));assertEquals(Calendar.DECEMBER,c.get(Calendar.MONTH));assertEquals(28,c.get(Calendar.DAY_OF_MONTH));inputStr="1972-12-28T00:00:00.000+00:00";inputDate=MAPPER.readValue(quote(inputStr),java.util.Date.class);c.setTime(inputDate);assertEquals(1972,c.get(Calendar.YEAR));assertEquals(Calendar.DECEMBER,c.get(Calendar.MONTH));assertEquals(28,c.get(Calendar.DAY_OF_MONTH));inputStr="1972-12-28T00:00:00.000+00";inputDate=MAPPER.readValue(quote(inputStr),java.util.Date.class);c.setTime(inputDate);assertEquals(1972,c.get(Calendar.YEAR));assertEquals(Calendar.DECEMBER,c.get(Calendar.MONTH));assertEquals(28,c.get(Calendar.DAY_OF_MONTH));inputStr="1984-11-30T00:00:00.000Z";inputDate=MAPPER.readValue(quote(inputStr),java.util.Date.class);c.setTime(inputDate);assertEquals(1984,c.get(Calendar.YEAR));assertEquals(Calendar.NOVEMBER,c.get(Calendar.MONTH));assertEquals(30,c.get(Calendar.DAY_OF_MONTH));}
public void testDateUtilISO8601NoTimezone()throws Exception {String inputStr="1984-11-13T00:00:09";Date inputDate=MAPPER.readValue(quote(inputStr),java.util.Date.class);Calendar c=Calendar.getInstance(TimeZone.getTimeZone("GMT"));c.setTime(inputDate);assertEquals(1984,c.get(Calendar.YEAR));assertEquals(Calendar.NOVEMBER,c.get(Calendar.MONTH));assertEquals(13,c.get(Calendar.DAY_OF_MONTH));assertEquals(0,c.get(Calendar.HOUR_OF_DAY));assertEquals(0,c.get(Calendar.MINUTE));assertEquals(9,c.get(Calendar.SECOND));assertEquals(0,c.get(Calendar.MILLISECOND));}
public void testDateUtilISO8601JustDate()throws Exception {String inputStr="1972-12-28";Date inputDate=MAPPER.readValue(quote(inputStr),java.util.Date.class);Calendar c=Calendar.getInstance(TimeZone.getTimeZone("GMT"));c.setTime(inputDate);assertEquals(1972,c.get(Calendar.YEAR));assertEquals(Calendar.DECEMBER,c.get(Calendar.MONTH));assertEquals(28,c.get(Calendar.DAY_OF_MONTH));}
@SuppressWarnings("deprecation")public void testDateSql()throws Exception {java.sql.Date value=new java.sql.Date(0L);value.setYear(99);value.setDate(19);value.setMonth(Calendar.APRIL);long now=value.getTime();assertEquals(value,MAPPER.readValue(String.valueOf(now),java.sql.Date.class));java.sql.Date result=MAPPER.readValue(quote(value.toString()),java.sql.Date.class);Calendar c=gmtCalendar(result.getTime());assertEquals(1999,c.get(Calendar.YEAR));assertEquals(Calendar.APRIL,c.get(Calendar.MONTH));assertEquals(19,c.get(Calendar.DAY_OF_MONTH));String expStr="1981-07-13";result=MAPPER.readValue(quote(expStr),java.sql.Date.class);c.setTimeInMillis(result.getTime());assertEquals(1981,c.get(Calendar.YEAR));assertEquals(Calendar.JULY,c.get(Calendar.MONTH));assertEquals(13,c.get(Calendar.DAY_OF_MONTH));}
public void testCalendar()throws Exception {java.util.Calendar value=Calendar.getInstance();long l=12345678L;value.setTimeInMillis(l);Calendar result=MAPPER.readValue("" + l,Calendar.class);assertEquals(l,result.getTimeInMillis());String dateStr=dateToString(new Date(l));result=MAPPER.readValue(quote(dateStr),Calendar.class);assertEquals(l,result.getTimeInMillis());}
public void testCustom()throws Exception {final ObjectMapper mapper=new ObjectMapper();DateFormat df=new SimpleDateFormat("yyyy-MM-dd'X'HH:mm:ss");df.setTimeZone(TimeZone.getTimeZone("PST"));mapper.setDateFormat(df);String dateStr="1972-12-28X15:45:00";java.util.Date exp=df.parse(dateStr);java.util.Date result=mapper.readValue("\"" + dateStr + "\"",java.util.Date.class);assertEquals(exp,result);}
/** * Test for [JACKSON-203]: make empty Strings deserialize as nulls by default,without need to turn on feature (which may be added in future)*/public void testDatesWithEmptyStrings()throws Exception {assertNull(MAPPER.readValue(quote(""),java.util.Date.class));assertNull(MAPPER.readValue(quote(""),java.util.Calendar.class));assertNull(MAPPER.readValue(quote(""),java.sql.Date.class));}
public void test8601DateTimeNoMilliSecs()throws Exception {for(String inputStr : new String[]{"2010-06-28T23:34:22Z","2010-06-28T23:34:22+0000","2010-06-28T23:34:22+00"}){Date inputDate=MAPPER.readValue(quote(inputStr),java.util.Date.class);Calendar c=Calendar.getInstance(TimeZone.getTimeZone("GMT"));c.setTime(inputDate);assertEquals(2010,c.get(Calendar.YEAR));assertEquals(Calendar.JUNE,c.get(Calendar.MONTH));assertEquals(28,c.get(Calendar.DAY_OF_MONTH));assertEquals(23,c.get(Calendar.HOUR_OF_DAY));assertEquals(34,c.get(Calendar.MINUTE));assertEquals(22,c.get(Calendar.SECOND));assertEquals(0,c.get(Calendar.MILLISECOND));}}
public void testTimeZone()throws Exception {TimeZone result=MAPPER.readValue(quote("PST"),TimeZone.class);assertEquals("PST",result.getID());}
public void testCustomDateWithAnnotation()throws Exception {DateAsStringBean result=MAPPER.readValue("{\"date\":\"/2005/05/25/\"}",DateAsStringBean.class);assertNotNull(result);assertNotNull(result.date);Calendar c=Calendar.getInstance(TimeZone.getTimeZone("GMT"));long l=result.date.getTime();if (l == 0L){fail("Should not get null date");}c.setTimeInMillis(l);assertEquals(2005,c.get(Calendar.YEAR));assertEquals(Calendar.MAY,c.get(Calendar.MONTH));assertEquals(25,c.get(Calendar.DAY_OF_MONTH));}
public void testCustomCalendarWithAnnotation()throws Exception {CalendarAsStringBean cbean=MAPPER.readValue("{\"cal\":\";2007/07/13;\"}",CalendarAsStringBean.class);assertNotNull(cbean);assertNotNull(cbean.cal);Calendar c=cbean.cal;assertEquals(2007,c.get(Calendar.YEAR));assertEquals(Calendar.JULY,c.get(Calendar.MONTH));assertEquals(13,c.get(Calendar.DAY_OF_MONTH));}
public void testCustomCalendarWithTimeZone()throws Exception {DateInCETBean cet=MAPPER.readValue("{\"date\":\"2001-01-01,10\"}",DateInCETBean.class);Calendar c=Calendar.getInstance(getUTCTimeZone());c.setTimeInMillis(cet.date.getTime());assertEquals(2001,c.get(Calendar.YEAR));assertEquals(Calendar.JANUARY,c.get(Calendar.MONTH));assertEquals(1,c.get(Calendar.DAY_OF_MONTH));assertEquals(9,c.get(Calendar.HOUR_OF_DAY));}
public void testInvalidFormat()throws Exception {try {MAPPER.readValue(quote("foobar"),Date.class);fail("Should have failed with an exception");}catch(InvalidFormatException e){verifyException(e,"Can not construct instance");assertEquals("foobar",e.getValue());assertEquals(Date.class,e.getTargetType());}catch(Exception e){fail("Wrong type of exception (" + e.getClass().getName()+ "),should get "+ InvalidFormatException.class.getName());}}
public void testSimpleDeserializationClass()throws Exception {Identifiable result=mapper.readValue(EXP_SIMPLE_INT_CLASS,Identifiable.class);assertEquals(13,result.value);assertSame(result,result.next);}
public void testSimpleUUIDForClassRoundTrip()throws Exception {UUIDNode root=new UUIDNode(1);UUIDNode child1=new UUIDNode(2);UUIDNode child2=new UUIDNode(3);root.first=child1;root.second=child2;child1.parent=root;child2.parent=root;child1.first=child2;String json=mapper.writeValueAsString(root);UUIDNode result=mapper.readValue(json,UUIDNode.class);assertEquals(1,result.value);UUIDNode result2=result.first;UUIDNode result3=result.second;assertNotNull(result2);assertNotNull(result3);assertEquals(2,result2.value);assertEquals(3,result3.value);assertSame(result,result2.parent);assertSame(result,result3.parent);assertSame(result3,result2.first);}
public void testSimpleDeserializationProperty()throws Exception {IdWrapper result=mapper.readValue(EXP_SIMPLE_INT_PROP,IdWrapper.class);assertEquals(7,result.node.value);assertSame(result.node,result.node.next.node);}
public void testSimpleDeserWithForwardRefs()throws Exception {IdWrapper result=mapper.readValue("{\"node\":{\"value\":7,\"next\":{\"node\":1},\"@id\":1}}",IdWrapper.class);assertEquals(7,result.node.value);assertSame(result.node,result.node.next.node);}
public void testCustomDeserializationClass()throws Exception {IdentifiableCustom result=mapper.readValue(EXP_CUSTOM_VIA_CLASS,IdentifiableCustom.class);assertEquals(-900,result.value);assertSame(result,result.next);}
public void testCustomDeserializationProperty()throws Exception {IdWrapperExt result=mapper.readValue(EXP_CUSTOM_VIA_PROP,IdWrapperExt.class);assertEquals(99,result.node.value);assertSame(result.node,result.node.next.node);assertEquals(3,result.node.customId);}
public void testLinked()throws Exception {Bean last=new Bean(null,"last");Bean first=new Bean(last,"first");Map<String,Object> map=writeAndMap(new ObjectMapper(),first);assertEquals(2,map.size());assertEquals("first",map.get("name"));@SuppressWarnings("unchecked")Map<String,Object> map2=(Map<String,Object>)map.get("next");assertNotNull(map2);assertEquals(2,map2.size());assertEquals("last",map2.get("name"));assertNull(map2.get("next"));}
/** * Test for verifying that [JACKSON-158]works as expected*/public void testSelfReference()throws Exception {Bean selfRef=new Bean(null,"self-refs");Bean first=new Bean(selfRef,"first");selfRef.assignNext(selfRef);ObjectMapper m=new ObjectMapper();Bean[]wrapper=new Bean[]{first};try {writeAndMap(m,wrapper);}catch(JsonMappingException e){verifyException(e,"Direct self-reference leading to cycle");}}
public void testSimpleUnwrappingSerialize()throws Exception {assertEquals("{\"name\":\"Tatu\",\"x\":1,\"y\":2}",mapper.writeValueAsString(new Unwrapping("Tatu",1,2)));}
public void testDeepUnwrappingSerialize()throws Exception {assertEquals("{\"name\":\"Tatu\",\"x\":1,\"y\":2}",mapper.writeValueAsString(new DeepUnwrapping("Tatu",1,2)));}
public void testSimpleUnwrappedDeserialize()throws Exception {Unwrapping bean=mapper.readValue("{\"name\":\"Tatu\",\"y\":7,\"x\":-13}",Unwrapping.class);assertEquals("Tatu",bean.name);Location loc=bean.location;assertNotNull(loc);assertEquals(-13,loc.x);assertEquals(7,loc.y);}
public void testDoubleUnwrapping()throws Exception {TwoUnwrappedProperties bean=mapper.readValue("{\"first\":\"Joe\",\"y\":7,\"last\":\"Smith\",\"x\":-13}",TwoUnwrappedProperties.class);Location loc=bean.location;assertNotNull(loc);assertEquals(-13,loc.x);assertEquals(7,loc.y);Name name=bean.name;assertNotNull(name);assertEquals("Joe",name.first);assertEquals("Smith",name.last);}
public void testDeepUnwrapping()throws Exception {DeepUnwrapping bean=mapper.readValue("{\"x\":3,\"name\":\"Bob\",\"y\":27}",DeepUnwrapping.class);Unwrapping uw=bean.unwrapped;assertNotNull(uw);assertEquals("Bob",uw.name);Location loc=uw.location;assertNotNull(loc);assertEquals(3,loc.x);assertEquals(27,loc.y);}
public void testUnwrappedDeserializeWithCreator()throws Exception {UnwrappingWithCreator bean=mapper.readValue("{\"x\":1,\"y\":2,\"name\":\"Tatu\"}",UnwrappingWithCreator.class);assertEquals("Tatu",bean.name);Location loc=bean.location;assertNotNull(loc);assertEquals(1,loc.x);assertEquals(2,loc.y);}
/** * It should be ok to overload with specialized  version;more specific method should be used.*/public void testSpecialization()throws Exception {ArrayListBean bean=MAPPER.readValue("{\"list\":[\"a\",\"b\",\"c\"]}",ArrayListBean.class);assertNotNull(bean.list);assertEquals(3,bean.list.size());assertEquals(ArrayList.class,bean.list.getClass());assertEquals("a",bean.list.get(0));assertEquals("b",bean.list.get(1));assertEquals("c",bean.list.get(2));}
/** * As per [JACKSON-255],should also allow more general overriding,as long as there are no in-class conflicts.*/public void testOverride()throws Exception {WasNumberBean bean=MAPPER.readValue("{\"value\" : \"abc\"}",WasNumberBean.class);assertNotNull(bean);assertEquals("abc",bean.value);}
public void testConflictResolution()throws Exception {Overloaded739 bean=MAPPER.readValue("{\"value\":\"abc\"}",Overloaded739.class);assertNotNull(bean);assertEquals("abc",bean._value);}
/** * For genuine setter conflict,an exception is to be thrown.*/public void testSetterConflict()throws Exception {try {MAPPER.readValue("{}",ConflictBean.class);}catch(Exception e){verifyException(e,"Conflicting setter definitions");}}
public void testCustomBeanDeserializer()throws Exception {final ObjectMapper map=new ObjectMapper();String json="{\"beans\":[{\"c\":{\"a\":10,\"b\":20},\"d\":\"hello,tatu\"}]}";TestBeans beans=map.readValue(json,TestBeans.class);assertNotNull(beans);List<TestBean> results=beans.beans;assertNotNull(results);assertEquals(1,results.size());TestBean bean=results.get(0);assertEquals("hello,tatu",bean.d);CustomBean c=bean.c;assertNotNull(c);assertEquals(10,c.a);assertEquals(20,c.b);json="{\"beans\":[{\"c\":{\"b\":3,\"a\":-4},\"d\":\"\"}," + "{\"d\":\"abc\",\"c\":{\"b\":15}}]}";beans=map.readValue(json,TestBeans.class);assertNotNull(beans);results=beans.beans;assertNotNull(results);assertEquals(2,results.size());bean=results.get(0);assertEquals("",bean.d);c=bean.c;assertNotNull(c);assertEquals(-4,c.a);assertEquals(3,c.b);bean=results.get(1);assertEquals("abc",bean.d);c=bean.c;assertNotNull(c);assertEquals(0,c.a);assertEquals(15,c.b);}
public void testDeserializer()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.setHandlerInstantiator(new MyInstantiator("abc:"));MyBean result=mapper.readValue(quote("123"),MyBean.class);assertEquals("abc:123",result.value);}
public void testKeyDeserializer()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.setHandlerInstantiator(new MyInstantiator("abc:"));MyMap map=mapper.readValue("{\"a\":\"b\"}",MyMap.class);assertEquals("{\"KEY\":\"b\"}",mapper.writeValueAsString(map));}
public void testSerializer()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.setHandlerInstantiator(new MyInstantiator("xyz:"));assertEquals(quote("xyz:456"),mapper.writeValueAsString(new MyBean("456")));}
public void testTypeIdResolver()throws Exception {ObjectMapper mapper=new ObjectMapper();mapper.setHandlerInstantiator(new MyInstantiator("foobar"));String json=mapper.writeValueAsString(new TypeIdBeanWrapper(new TypeIdBean(123)));assertEquals("{\"bean\":[\"!!!\",{\"x\":123}]}",json);TypeIdBeanWrapper result=mapper.readValue(json,TypeIdBeanWrapper.class);TypeIdBean bean=result.bean;assertEquals(123,bean.x);}
@SuppressWarnings("unchecked")public void testSimple()throws IOException {StringWriter sw=new StringWriter();ObjectMapper mapper=new ObjectMapper();Bean bean=new Bean();Map<String,Object> map=writeAndMap(mapper,bean);assertEquals(3,map.size());sw=new StringWriter();mapper.writerWithView(ViewA.class).writeValue(sw,bean);map=mapper.readValue(sw.toString(),Map.class);assertEquals(1,map.size());assertEquals("1",map.get("a"));sw=new StringWriter();mapper.writerWithView(ViewAA.class).writeValue(sw,bean);map=mapper.readValue(sw.toString(),Map.class);assertEquals(2,map.size());assertEquals("1",map.get("a"));assertEquals("2",map.get("aa"));String json=mapper.writerWithView(ViewB.class).writeValueAsString(bean);map=mapper.readValue(json,Map.class);assertEquals(2,map.size());assertEquals("2",map.get("aa"));assertEquals("3",map.get("b"));json=mapper.writerWithView(ViewBB.class).writeValueAsString(bean);map=mapper.readValue(json,Map.class);assertEquals(2,map.size());assertEquals("2",map.get("aa"));assertEquals("3",map.get("b"));}
/** * Unit test to verify implementation of [JACKSON-232],to allow "opt-in" handling for JSON Views: that is,that default for properties is to exclude unless included in a view.*/@SuppressWarnings("unchecked")public void testDefaultExclusion()throws IOException {MixedBean bean=new MixedBean();StringWriter sw=new StringWriter();ObjectMapper mapper=new ObjectMapper();mapper.writerWithView(ViewA.class).writeValue(sw,bean);Map<String,Object> map=mapper.readValue(sw.toString(),Map.class);assertEquals(2,map.size());assertEquals("1",map.get("a"));assertEquals("2",map.get("b"));mapper=new ObjectMapper();mapper.configure(MapperFeature.DEFAULT_VIEW_INCLUSION,false);String json=mapper.writerWithView(ViewA.class).writeValueAsString(bean);map=mapper.readValue(json,Map.class);assertEquals(1,map.size());assertEquals("1",map.get("a"));assertNull(map.get("b"));}
/** * As per [JACKSON-261],@JsonView annotation should imply that associated method/field does indicate a property.*/public void testImplicitAutoDetection()throws Exception {assertEquals("{\"a\":1}",serializeAsString(new ImplicitBean()));}
public void testVisibility()throws Exception {ObjectMapper mapper=new ObjectMapper();VisibilityBean bean=new VisibilityBean();String json=mapper.writerWithView(Object.class).writeValueAsString(bean);assertEquals("{\"id\":\"id\"}",json);}
public void test()throws IOException {ObjectMapper mapper=new ObjectMapper();mapper.setSerializationInclusion(JsonInclude.Include.NON_DEFAULT);String json=mapper.writerWithView(OtherView.class).writeValueAsString(new Foo());assertEquals(json,"{}");}
